From e3e5ae049371a27fd1737aba946fe26d06e029b5 Mon Sep 17 00:00:00 2001
From: Nick Clifton <nickc@redhat.com>
Date: Mon, 27 Jun 2022 13:43:02 +0100
Subject: [PATCH] Replace a run-time assertion failure with a warning message
 when parsing corrupt DWARF data.

PR 29289
* dwarf.c (display_debug_names): Replace assert with a warning
message.
---
 binutils/ChangeLog | 6 ++++++
 binutils/dwarf.c   | 7 ++++++-
 2 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/binutils/ChangeLog b/binutils/ChangeLog
index a11e60ea..ddf5ff31 100644
--- a/binutils/ChangeLog
+++ b/binutils/ChangeLog
@@ -1,3 +1,9 @@
+2022-06-27  Nick Clifton  <nickc@redhat.com>
+
+	PR 29289
+	* dwarf.c (display_debug_names): Replace assert with a warning
+	message.
+
 2020-01-13  Alan Modra  <amodra@gmail.com>
 
 	PR 25362
diff --git a/binutils/dwarf.c b/binutils/dwarf.c
index 60e0ef89..c4fb8d2e 100644
--- a/binutils/dwarf.c
+++ b/binutils/dwarf.c
@@ -8631,7 +8631,12 @@ display_debug_names (struct dwarf_section *section, void *file)
       printf (_("Out of %lu items there are %zu bucket clashes"
 		" (longest of %zu entries).\n"),
 	      (unsigned long) name_count, hash_clash_count, longest_clash);
-      assert (name_count == buckets_filled + hash_clash_count);
+
+      if (name_count != buckets_filled + hash_clash_count)
+	    warn (_("The name_count (%lu) is not the same as the used bucket_count (%lu) + the hash clash count (%lu)"),
+		  (unsigned long) name_count,
+		  (unsigned long) buckets_filled,
+		  (unsigned long) hash_clash_count);
 
       struct abbrev_lookup_entry
       {
-- 
2.25.1

