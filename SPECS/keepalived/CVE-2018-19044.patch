diff -Naur a/keepalived/core/main.c b/keepalived/core/main.c
--- a/keepalived/core/main.c	2019-02-14 23:30:50.558281188 +0530
+++ b/keepalived/core/main.c	2019-02-14 23:31:25.502282866 +0530
@@ -1141,7 +1141,7 @@
 			__set_bit(DONT_FORK_BIT, &debug);
 			__set_bit(NO_SYSLOG_BIT, &debug);
 			if (optarg && optarg[0]) {
-				int fd = open(optarg, O_WRONLY | O_APPEND | O_CREAT, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);
+				int fd = open(optarg, O_WRONLY | O_APPEND | O_CREAT | O_NOFOLLOW, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);
 				if (fd == -1) {
 					fprintf(stderr, "Unable to open config-test log file %s\n", optarg);
 					exit(EXIT_FAILURE);
diff -Naur a/keepalived/core/pidfile.c b/keepalived/core/pidfile.c
--- a/keepalived/core/pidfile.c	2019-02-14 23:30:50.558281188 +0530
+++ b/keepalived/core/pidfile.c	2019-02-14 23:31:25.502282866 +0530
@@ -60,7 +60,7 @@
 pidfile_write(const char *pid_file, int pid)
 {
 	FILE *pidfile = NULL;
-	int pidfd = creat(pid_file, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);
+	int pidfd = open(pid_file, O_NOFOLLOW | O_CREAT | O_WRONLY | O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);
 
 	if (pidfd != -1) pidfile = fdopen(pidfd, "w");
 
diff -Naur a/keepalived/vrrp/vrrp_dbus.c b/keepalived/vrrp/vrrp_dbus.c
--- a/keepalived/vrrp/vrrp_dbus.c	2019-02-14 23:30:50.554281188 +0530
+++ b/keepalived/vrrp/vrrp_dbus.c	2019-02-14 23:31:25.498282865 +0530
@@ -591,7 +591,7 @@
 	size_t length;
 	gchar *ret = NULL;
 
-	f = fopen(filepath, "rb");
+	f = fopen(filepath, "r");
 	if (f) {
 		fseek(f, 0, SEEK_END);
 		length = (size_t)ftell(f);
diff -Naur a/keepalived/vrrp/vrrp_json.c b/keepalived/vrrp/vrrp_json.c
--- a/keepalived/vrrp/vrrp_json.c	2019-02-14 23:30:50.554281188 +0530
+++ b/keepalived/vrrp/vrrp_json.c	2019-02-14 23:31:25.498282865 +0530
@@ -37,6 +37,7 @@
 #include "vrrp_iprule.h"
 #include "logger.h"
 #include "timer.h"
+#include "utils.h"
 
 static inline double
 timeval_to_double(const timeval_t *t)
@@ -55,7 +56,7 @@
 	if (LIST_ISEMPTY(vrrp_data->vrrp))
 		return;
 
-	file = fopen ("/tmp/keepalived.json","w");
+	file = fopen_safe("/tmp/keepalived.json", "w");
 	if (!file) {
 		log_message(LOG_INFO, "Can't open /tmp/keepalived.json (%d: %s)",
 			errno, strerror(errno));
diff -Naur a/keepalived/vrrp/vrrp_parser.c b/keepalived/vrrp/vrrp_parser.c
--- a/keepalived/vrrp/vrrp_parser.c	2019-02-14 23:30:50.554281188 +0530
+++ b/keepalived/vrrp/vrrp_parser.c	2019-02-14 23:31:25.498282865 +0530
@@ -1197,7 +1197,7 @@
 
 	if (!__test_bit(CONFIG_TEST_BIT, &debug)) {
 		/* Write the value to the file */
-		if ((tf = fopen(tfile->file_path, "w"))) {
+		if ((tf = fopen_safe(tfile->file_path, "w"))) {
 			fprintf(tf, "%d\n", track_file_init_value);
 			fclose(tf);
 		}
diff -Naur a/keepalived/vrrp/vrrp_print.c b/keepalived/vrrp/vrrp_print.c
--- a/keepalived/vrrp/vrrp_print.c	2019-02-14 23:30:50.554281188 +0530
+++ b/keepalived/vrrp/vrrp_print.c	2019-02-14 23:31:25.498282865 +0530
@@ -32,6 +32,7 @@
 #include "vrrp.h"
 #include "vrrp_data.h"
 #include "vrrp_print.h"
+#include "utils.h"
 
 static const char *dump_file = "/tmp/keepalived.data";
 static const char *stats_file = "/tmp/keepalived.stats";
@@ -39,7 +40,7 @@
 void
 vrrp_print_data(void)
 {
-	FILE *file = fopen (dump_file, "w");
+	FILE *file = fopen_safe(dump_file, "w");
 
 	if (!file) {
 		log_message(LOG_INFO, "Can't open %s (%d: %s)",
@@ -55,8 +56,9 @@
 void
 vrrp_print_stats(void)
 {
-	FILE *file;
-	file = fopen (stats_file, "w");
+	FILE *file = fopen_safe(stats_file, "w");
+	element e;
+	vrrp_t *vrrp;
 
 	if (!file) {
 		log_message(LOG_INFO, "Can't open %s (%d: %s)",
@@ -64,19 +66,14 @@
 		return;
 	}
 
-	list l = vrrp_data->vrrp;
-	element e;
-	vrrp_t *vrrp;
 
-	for (e = LIST_HEAD(l); e; ELEMENT_NEXT(e)) {
-		vrrp = ELEMENT_DATA(e);
+	LIST_FOREACH(vrrp_data->vrrp, vrrp, e) {
 		fprintf(file, "VRRP Instance: %s\n", vrrp->iname);
 		fprintf(file, "  Advertisements:\n");
 		fprintf(file, "    Received: %" PRIu64 "\n", vrrp->stats->advert_rcvd);
 		fprintf(file, "    Sent: %d\n", vrrp->stats->advert_sent);
 		fprintf(file, "  Became master: %d\n", vrrp->stats->become_master);
-		fprintf(file, "  Released master: %d\n",
-			vrrp->stats->release_master);
+		fprintf(file, "  Released master: %d\n", vrrp->stats->release_master);
 		fprintf(file, "  Packet Errors:\n");
 		fprintf(file, "    Length: %" PRIu64 "\n", vrrp->stats->packet_len_err);
 		fprintf(file, "    TTL: %" PRIu64 "\n", vrrp->stats->ip_ttl_err);
diff -Naur a/keepalived/vrrp/vrrp_scheduler.c b/keepalived/vrrp/vrrp_scheduler.c
--- a/keepalived/vrrp/vrrp_scheduler.c	2019-02-14 23:30:50.554281188 +0530
+++ b/keepalived/vrrp/vrrp_scheduler.c	2019-02-14 23:31:25.498282865 +0530
@@ -1287,7 +1287,7 @@
 	element e;
 	vrrp_t *vrrp;
 
-	fp = fopen("/tmp/thread_dump", "a");
+	fp = fopen_safe("/tmp/thread_dump", "a");
 
 	set_time_now();
 	ctime_r(&time_now.tv_sec, time_buf);
diff -Naur a/lib/logger.c b/lib/logger.c
--- a/lib/logger.c	2019-02-14 23:46:21.370325878 +0530
+++ b/lib/logger.c	2019-02-14 23:45:59.742324840 +0530
@@ -107,7 +107,7 @@
 	if (extn_start)
 		strcat(file_name, extn_start);
 
-	log_file = fopen(file_name, "a");
+	log_file = fopen_safe(file_name, "a");
 	if (log_file) {
 		int n = fileno(log_file);
 		fcntl(n, F_SETFD, FD_CLOEXEC | fcntl(n, F_GETFD));
diff -Naur a/lib/memory.c b/lib/memory.c
--- a/lib/memory.c	2019-02-14 23:46:21.370325878 +0530
+++ b/lib/memory.c	2019-02-14 23:45:59.742324840 +0530
@@ -455,7 +455,7 @@
 	}
 
 	snprintf(log_name, log_name_len, "/tmp/%s_mem.%d.log", prog_name, getpid());
-	log_op = fopen(log_name, "a");
+	log_op = fopen_safe(log_name, "a");
 	if (log_op == NULL) {
 		log_message(LOG_INFO, "Unable to open %s for appending", log_name);
 		log_op = stderr;
diff -Naur a/lib/notify.c b/lib/notify.c
--- a/lib/notify.c	2019-02-14 23:46:21.370325878 +0530
+++ b/lib/notify.c	2019-02-14 23:45:59.742324840 +0530
@@ -235,7 +235,7 @@
 				notify_fifo_exec(master, script_exit, fifo, fifo->script);
 
 			/* Now open the fifo */
-			if ((fifo->fd = open(fifo->name, O_RDWR | O_CLOEXEC | O_NONBLOCK)) == -1) {
+			if ((fifo->fd = open(fifo->name, O_RDWR | O_CLOEXEC | O_NONBLOCK | O_NOFOLLOW)) == -1) {
 				log_message(LOG_INFO, "Unable to open %snotify fifo %s - errno %d", type, fifo->name, errno);
 				if (fifo->created_fifo) {
 					unlink(fifo->name);
diff -Naur a/lib/parser.c b/lib/parser.c
--- a/lib/parser.c	2019-02-14 23:46:21.370325878 +0530
+++ b/lib/parser.c	2019-02-14 23:45:59.742324840 +0530
@@ -454,11 +454,11 @@
 {
 	unsigned int i;
 	keyword_t *keyword_vec;
-	char file_name[21];
+	char file_name[22];
 
 	if (!level) {
 		snprintf(file_name, sizeof(file_name), "/tmp/keywords.%d", getpid());
-		fp = fopen(file_name, "w");
+		fp = fopen_safe(file_name, "w");
 		if (!fp)
 			return;
 	}
diff -Naur a/lib/utils.c b/lib/utils.c
--- a/lib/utils.c	2019-02-14 23:46:21.370325878 +0530
+++ b/lib/utils.c	2019-02-14 23:45:59.742324840 +0530
@@ -113,7 +113,7 @@
 
 	nptrs = backtrace(buffer, 100);
 	if (file_name) {
-		fd = open(file_name, O_WRONLY | O_APPEND | O_CREAT, 0644);
+		fd = open(file_name, O_WRONLY | O_APPEND | O_CREAT | O_NOFOLLOW, S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH);
 		if (str)
 			dprintf(fd, "%s\n", str);
 		backtrace_symbols_fd(buffer, nptrs, fd);
@@ -606,6 +606,47 @@
 	return !strcmp(str1, str2);
 }
 
+/* We need to use O_NOFOLLOW if opening a file for write, so that a non privileged user can't
+ * create a symbolic link from the path to a system file and cause a system file to be overwritten. */
+FILE *fopen_safe(const char *path, const char *mode)
+{
+	int fd;
+	FILE *file;
+	int flags = O_NOFOLLOW | O_CREAT;
+
+	if (mode[0] == 'r')
+		return fopen(path, mode);
+
+	if (mode[0] != 'a' && mode[0] != 'w')
+		return NULL;
+
+	if (mode[1] &&
+	    (mode[1] != '+' || mode[2]))
+		return NULL;
+
+	if (mode[0] == 'w')
+		flags |= O_TRUNC;
+	else
+		flags |= O_APPEND;
+
+	if (mode[1])
+		flags |= O_RDWR;
+	else
+		flags |= O_WRONLY;
+
+	fd = open(path, flags, S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH);
+	if (fd == -1)
+		return NULL;
+
+	file = fdopen (fd, "w");
+	if (!file) {
+		close(fd);
+		return NULL;
+	}
+
+	return file;
+}
+
 void
 set_std_fd(bool force)
 {
diff -Naur a/lib/utils.h b/lib/utils.h
--- a/lib/utils.h	2019-02-14 23:46:21.370325878 +0530
+++ b/lib/utils.h	2019-02-14 23:45:59.742324840 +0530
@@ -165,6 +165,7 @@
 extern int inet_sockaddrcmp(const struct sockaddr_storage *, const struct sockaddr_storage *);
 extern char *get_local_name(void);
 extern bool string_equal(const char *, const char *);
+extern FILE *fopen_safe(const char *, const char *);
 extern void set_std_fd(bool);
 extern void close_std_fd(void);
 #if !defined _HAVE_LIBIPTC_ || defined _LIBIPTC_DYNAMIC_
