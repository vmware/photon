Summary:        cve-check-tool, as its name suggests, is a tool for checking known (public) CVEs.
Name:           cve-check-tool
Version:        5.6.4.1
Release:        18%{?dist}
Group:          System Environment/Security
URL:            https://github.com/ikeydoherty/cve-check-tool
Vendor:         VMware, Inc.
Distribution:   Photon

Source0: https://github.com/clearlinux/cve-check-tool/archive/refs/tags/%{name}-%{version}.tar.gz
%define sha512  %{name}=1d46b764b6a58b7240c1a37443b350515606d97df130ed6455e1655dc84ee0e685673669cc1aa1515c6b5290003a5d555c9d5c94a905804e74edcfe20df395d5

Source1: packages-mapping.cfg

Source2: license.txt
%include %{SOURCE2}

Patch0: 0001-Set-version-to-5.6.4.1.patch
Patch1: 0002-Migrate-to-NVD-JSON-Feed-1.0.patch
Patch2: 0003-New-option-r-to-select-a-report-plugin.patch
Patch3: 0004-Alternative-csv-output.patch
Patch4: 0005-Add-N-M-mapping-support.-Invert-key-values.patch
Patch5: 0006-Mapping-supports-vendor-product-combination.patch
Patch6: 0007-Search-for-CVE-xxxx-xxxx-comment-in-.spec-parser.patch
Patch7: 0008-String-ignoring-case.patch
Patch8: 0009-Check-database.patch

# We always run autogen.sh
BuildRequires:  autoconf
BuildRequires:  automake
BuildRequires:  libtool
BuildRequires:  json-glib-devel
BuildRequires:  check
BuildRequires:  libxml2-devel
BuildRequires:  sqlite-devel
BuildRequires:  curl-devel
BuildRequires:  openssl-devel
BuildRequires:  jansson-devel

Requires: libxml2
Requires: curl
Requires: jansson
Requires: openssl
Requires: sqlite

%global security_hardening nonow

%description
The tool will identify potentially vunlnerable software packages within Linux distributions through version matching. Where possible it will also seek to determine (through a distribution implemention) if a vulnerability has been addressed by way of a patch.

%prep
%autosetup -p1

%build
./autogen.sh
export CFLAGS="-w -g"
%make_build

%install
%make_install %{?_smp_mflags}
install -m644 %{SOURCE1} %{buildroot}%{_datadir}/%{name}

%if 0%{?with_check}
%check
make %{?_smp_mflags} check
%endif

%clean
rm -rf %{buildroot}/*

%files
%defattr(-,root,root,-)
%{_bindir}/cve-check-*
%{_libdir}/%{name}/*
%{_datadir}/%{name}/*
%doc %{_mandir}/man1/*

%changelog
* Wed Dec 11 2024 Guruswamy Basavaiah <guruswamy.basavaiah@broadcom.com> 5.6.4.1-18
- Release bump for SRP compliance
* Fri Feb 23 2024 Nitesh Kumar <nitesh-nk.kumar@broadcom.com> 5.6.4.1-17
- Bump version as a part of sqlite upgrade to v3.43.2
* Thu May 25 2023 Ashwin Dayanand Kamat <kashwindayan@vmware.com> 5.6.4.1-16
- Bump version as a part of libxml2 upgrade
* Wed Jan 11 2023 Oliver Kurth <okurth@vmware.com> 5.6.4.1-15
- bump release as part of sqlite update
* Sat Jul 30 2022 Shreenidhi Shedi <sshedi@vmware.com> 5.6.4.1-14
- Bump version as a part of sqlite upgrade
* Wed Aug 04 2021 Satya Naga Vasamsetty <svasamsetty@vmware.com> 5.6.4.1-13
- Bump up release for openssl
* Tue Sep 29 2020 Satya Naga Vasamsetty <svasamsetty@vmware.com> 5.6.4.1-12
- openssl 1.1.1
* Tue Oct 29 2019 Alexey Makhalov <amakhalov@vmware.com> 5.6.4.1-11
- JSON feed support.
* Tue Sep 12 2017 Dheeraj Shetty <dheerajs@vmware.com> 5.6.4.1-10
- Added the patch to check-database to correct the func signature
* Wed Apr 26 2017 Siju Maliakkal <smaliakkal@vmware.com> 5.6.4.1-9
- Added the patch for ignoring case of digest digits
* Thu Apr 06 2017 Anish Swaminathan <anishs@vmware.com> 5.6.4.1-8
- Remove vault entry from package mapping file
* Thu Dec 22 2016 Alexey Makhalov <amakhalov@vmware.com> 5.6.4.1-7
- Add more entries in package mapping file
- Improve jdk/jre version parsing
- Improve .spec parser to search comment with CVE-xxxx-xxxx mentioning
* Wed Dec 07 2016 Xiaolin Li <xiaolinl@vmware.com> 5.6.4.1-6
- BuildRequires curl-devel.
* Wed Nov 16 2016 Alexey Makhalov <amakhalov@vmware.com> 5.6.4.1-5
- Use sqlite-devel
* Thu Nov 10 2016 Alexey Makhalov <amakhalov@vmware.com> 5.6.4.1-4
- 0004-Mapping-supports-vendor-product-combination.patch
    to support package=vendor:product mapping
* Fri Oct 28 2016 Alexey Makhalov <amakhalov@vmware.com> 5.6.4.1-3
- N-to-M-mapping-support.patch
    reverse key-values in the mapping file. Photon package name as a key
    and NVD product name(s) as a value.
- mapping: added python[23]->python and curl->curl libcurl
* Wed Oct 05 2016 ChangLee <changlee@vmware.com> 5.6.4.1-2
- Modified %check
* Wed Aug 31 2016 Alexey Makhalov <amakhalov@vmware.com> 5.6.4.1-1
- Update to version 5.6.4.1 (commit 72e272d)
- Add packages mapping file for Photon OS
- new option '-r' to select report plugin to use
- csv2-output-plugin.patch for alternative csv output
* Tue May 24 2016 Priyesh Padmavilasom <ppadmavilasom@vmware.com> 5.6.2-2
- GA - Bump release of all rpms
* Wed Feb 24 2016 Kumar Kaushik <kaushikk@vmware.com>
- Updating version to 5.6.2.
* Wed Jul 29 2015 Luis Zuniga <lzuniga@vmware.com>
- Added new version of cve-check-tool
