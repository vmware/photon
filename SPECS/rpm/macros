#
#   System settings
#
%_topdir            /usr/src/photon
#
#   Build flags
#
#%_optflags_i686    -march=i486 -mtune=i686 -O2 -pipe
#%_optflags_x86_64  -march=x86-64 -mtune=generic -O2 -pipe -fno-strict-aliasing
#
#   Some standard locations
#
%_sysconfdir        /etc
%_lib               /usr/lib
%_lib64             /usr/lib64
%_prefix            /usr
%_exec_prefix       /usr
%_bindir            /usr/bin
%_sbindir           /usr/sbin
%_libdir            /usr/lib
%_lib64dir          /usr/lib64
%_libexecdir        /usr/libexec
%_datadir           /usr/share
%_docdir            /usr/share/doc
%_includedir        /usr/include
%_infodir           /usr/share/info
%_mandir            /usr/share/man
%_oldincludedir     /usr/include
%_sharedstatedir    /var/lib
%_var               /var
%_localstatedir     /var

%__tar              /bin/tar --no-same-owner

%_enable_debug_packages 1
%_include_minidebuginfo 1
%_use_internal_dependency_generator 1

%__os_install_post    \
    %{_rpmconfigdir}/brp-compress \
    %{_rpmconfigdir}/brp-strip %{__strip} \
    %{_rpmconfigdir}/brp-strip-debug-symbols %{__strip} \
    %{_rpmconfigdir}/brp-strip-comment-note %{__strip} %{__objdump} \
    %{_rpmconfigdir}/brp-strip-unneeded %{__strip} \
    %{_rpmconfigdir}/brp-strip-static-archive %{__strip} \
%{nil}

%install %{?_enable_debug_packages:%{?buildsubdir:%{debug_package}}}\
%%install\
%{nil}

# Run a given command with a customized git that redirects all http://, https:// and git://
# clones with a local git mirror. This script will not modify git global config.
# Internally it constructs a customized git script in a temporary directory and set PATH to it.
%with_git_mirror() env 'PHOTON_GIT_MIRROR=%{?photon_git_mirror}' %{_rpmconfigdir}/git-mirror-env %*

%gosrc_prep \
%{__mkdir} -p %{name}-%{version}/src\
%setup -D -T

# Restore the $GOPATH/src or similar directory hierarchy from %1,
# which should be full of '<PATH> <GIT_REMOTE> <GIT_COMMIT>' lines
# e.g.,
#
# github.com/fakeorg/fakeproj https://github.com/fakeorg/fakeproj 00000
# gopkg.in/notneeded https://gopkg.in/notneeded fffff
#
%gosrc_restore() %{_rpmconfigdir}/gosrc-restore %*

# Verify that the local sources hasn't changed, this catches the cases
# where some deps manager tries to checkout different versions.
%gosrc_verify() %{_rpmconfigdir}/gosrc-check %*

# Same as above except that the vendor directory is removed before check.
# This is for golang/dep to work.
%gosrc_verify_no_vendor() env NO_VENDOR=TRUE %{_rpmconfigdir}/gosrc-check %*
