From: "K.Kosako" <kosako@sofnec.co.jp>
Date: Fri, 19 May 2017 15:44:47 +0900
Subject: [PATCH] fix #55 : Byte value expressed in octal must be smaller than
 256

diff --git a/regparse.c b/regparse.c.1
index 1e0dfd9..cd412ec 100644
--- a/regparse.c
+++ b/regparse.c.1
@@ -3084,7 +3084,7 @@ fetch_token_in_cc(OnigToken* tok, UChar** src, UChar* end, ScanEnv* env)
       if (PPEEK_IS('{') && IS_SYNTAX_OP(syn, ONIG_SYN_OP_ESC_X_BRACE_HEX8)) {
 	PINC;
 	num = scan_unsigned_hexadecimal_number(&p, end, 0, 8, enc);
-	if (num < 0) return ONIGERR_TOO_BIG_WIDE_CHAR_VALUE;
+	if (num < 0 || num >= 256) return ONIGERR_TOO_BIG_WIDE_CHAR_VALUE;
 	if (!PEND) {
 	  c2 = PPEEK;
 	  if (ONIGENC_IS_CODE_XDIGIT(enc, c2))
@@ -3534,7 +3534,7 @@ fetch_token(OnigToken* tok, UChar** src, UChar* end, ScanEnv* env)
       if (PPEEK_IS('{') && IS_SYNTAX_OP(syn, ONIG_SYN_OP_ESC_X_BRACE_HEX8)) {
 	PINC;
 	num = scan_unsigned_hexadecimal_number(&p, end, 0, 8, enc);
-	if (num < 0) return ONIGERR_TOO_BIG_WIDE_CHAR_VALUE;
+	if (num < 0 || num >= 256) return ONIGERR_TOO_BIG_WIDE_CHAR_VALUE;
 	if (!PEND) {
 	  if (ONIGENC_IS_CODE_XDIGIT(enc, PPEEK))
 	    return ONIGERR_TOO_LONG_WIDE_CHAR_VALUE;
@@ -4450,6 +4450,9 @@ next_state_val(CClassNode* cc, CClassNode* asc_cc,
   switch (*state) {
   case CCS_VALUE:
     if (*type == CCV_SB) {
+      if (*vs > 0xff)
+          return ONIGERR_INVALID_CODE_POINT_VALUE;
+
       BITSET_SET_BIT_CHKDUP(cc->bs, (int )(*vs));
       if (IS_NOT_NULL(asc_cc))
 	BITSET_SET_BIT(asc_cc->bs, (int )(*vs));
