From d7067ec44a20ba36a23c1509e90575a32c5ec3c0 Mon Sep 17 00:00:00 2001
From: Keerthana K <keerthana.kalyanasundaram@broadcom.com>
Date: Mon, 2 Dec 2024 08:02:22 +0000
Subject: [PATCH 10/12] List canister objs in a file

Signed-off-by: Keerthana K <keerthana.kalyanasundaram@broadcom.com>
---
 crypto/Makefile | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/crypto/Makefile b/crypto/Makefile
index 7babcc5d1..b059d5519 100644
--- a/crypto/Makefile
+++ b/crypto/Makefile
@@ -219,14 +219,17 @@ OBJECT_FILES_NON_STANDARD_x86-aes-xts-avx-x86_64.o := y
 crypto/x86-%.o: arch/x86/crypto/%.c $(recordmcount_source) $(objtool_dep) FORCE
 	$(call cmd,force_checksrc)
 	$(call if_changed_rule,cc_o_c)
+	@$(foreach obj,$(aesni-intel-y),echo x86-$(obj) >> objs;)
 
 crypto/x86-%.o: arch/x86/crypto/%.S $(objtool_dep) FORCE
 	$(call if_changed_rule,as_o_S)
+	@$(foreach obj,$(aesni-intel-y),echo x86-$(obj) >> objs;)
 
 lib-crypto-y := aes.o sha256.o sha1.o
 crypto/lib-crypto-%.o: lib/crypto/%.c $(recordmcount_source) $(objtool_dep) FORCE
 	$(call cmd,force_checksrc)
 	$(call if_changed_rule,cc_o_c)
+	@$(foreach obj,$(lib-crypto-y),echo lib-crypto-$(obj) >> objs;)
 
 canister += crypto_self_test.o
 
@@ -235,6 +238,7 @@ canister += fips_integrity.o
 extra-y += $(canister)
 $(obj)/canister.o: $(addprefix crypto/x86-,$(aesni-intel-y)) $(addprefix crypto/lib-crypto-,$(lib-crypto-y)) $(addprefix $(obj)/,$(canister))
 	$(LD) -z noexecstack -T $(obj)/canister_combine.lds -r $^ -o $@
+	@$(foreach obj,$(canister),echo $(obj) >> objs;)
 define UPDATE_CFLAGS =
   CFLAGS_$1 += -DFIPS_CANISTER
   CFLAGS_REMOVE_$1 += -DLATENT_ENTROPY_PLUGIN -fplugin=./scripts/gcc-plugins/latent_entropy_plugin.so -fplugin-arg-rap_plugin-check=call $(RETPOLINE_CFLAGS) $(RETHUNK_CFLAGS)
-- 
2.39.4

