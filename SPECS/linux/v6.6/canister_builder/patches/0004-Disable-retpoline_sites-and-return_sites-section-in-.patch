From 8661a32500fadfb5e0247b6f37a249952010d5d5 Mon Sep 17 00:00:00 2001
From: Keerthana K <keerthanak@vmware.com>
Date: Wed, 17 May 2023 15:35:53 +0000
Subject: [PATCH 4/8] Disable retpoline_sites and return_sites sections in
 canister

Signed-off-by: Keerthana K <keerthanak@vmware.com>
---
 arch/x86/crypto/aes_ctrby8_avx-x86_64.S  | 1 +
 arch/x86/crypto/aesni-intel_asm.S        | 1 +
 arch/x86/crypto/aesni-intel_avx-x86_64.S | 1 +
 3 files changed, 3 insertions(+)

diff --git a/arch/x86/crypto/aes_ctrby8_avx-x86_64.S b/arch/x86/crypto/aes_ctrby8_avx-x86_64.S
index 2402b9418..d81759263 100644
--- a/arch/x86/crypto/aes_ctrby8_avx-x86_64.S
+++ b/arch/x86/crypto/aes_ctrby8_avx-x86_64.S
@@ -23,6 +23,11 @@
 
 #define VMOVDQ		vmovdqu
 
+#if defined(RET)
+#undef RET
+#define RET ret
+#endif
+
 /*
  * Note: the "x" prefix in these aliases means "this is an xmm register".  The
  * alias prefixes have no relation to XCTR where the "X" prefix means "XOR
diff --git a/arch/x86/crypto/aesni-intel_asm.S b/arch/x86/crypto/aesni-intel_asm.S
index 837c1e0aa..0c6d52311 100644
--- a/arch/x86/crypto/aesni-intel_asm.S
+++ b/arch/x86/crypto/aesni-intel_asm.S
@@ -40,6 +40,11 @@
 #define MOVADQ	movaps
 #define MOVUDQ	movups
 
+#if defined(RET)
+#undef RET
+#define RET ret
+#endif
+
 #ifdef __x86_64__
 
 # constants in mergeable sections, linker can reorder and merge
diff --git a/arch/x86/crypto/aesni-intel_avx-x86_64.S b/arch/x86/crypto/aesni-intel_avx-x86_64.S
index 0852ab573..8bef0e67c 100644
--- a/arch/x86/crypto/aesni-intel_avx-x86_64.S
+++ b/arch/x86/crypto/aesni-intel_avx-x86_64.S
@@ -121,6 +121,11 @@
 
 #include <linux/linkage.h>
 
+#if defined(RET)
+#undef RET
+#define RET ret
+#endif
+
 # constants in mergeable sections, linker can reorder and merge
 .section	.rodata.cst16.POLY, "aM", @progbits, 16
 .align 16
-- 
2.43.0
