From d25f003342aca9889067f2e839963dfeccf1fe05 Mon Sep 17 00:00:00 2001
From: Bram Moolenaar <Bram@vim.org>
Date: Thu, 30 Jun 2022 12:30:19 +0100
Subject: [PATCH] patch 9.0.0011: reading beyond the end of the line with put
 command

Problem:    Reading beyond the end of the line with put command.
Solution:   Adjust the end mark position.

[ssrish: resolved a hunk failure]
Signed-off-by: Srish Srinivasan <ssrish@vmware.com>
---
 src/register.c           |  2 ++
 src/testdir/test_put.vim | 12 ++++++++++++
 src/version.c            |  2 ++
 3 files changed, 16 insertions(+)

diff --git a/src/register.c b/src/register.c
index 56aa9b6..782bd4d 100644
--- a/src/register.c
+++ b/src/register.c
@@ -1920,6 +1920,8 @@ do_put(
 		    vim_memset(ptr, ' ', (size_t)spaces);
 		    ptr += spaces;
 		}
+		else
+		    totlen -= spaces;  // didn't use these spaces
 	    }
 
 	    // may insert some spaces after the new text
diff --git a/src/testdir/test_put.vim b/src/testdir/test_put.vim
index bc507a1..1b6be2c 100644
--- a/src/testdir/test_put.vim
+++ b/src/testdir/test_put.vim
@@ -230,5 +230,17 @@ func Test_put_visual_block_mode()
   set ve=
 endfunc
 
+" this was putting the end mark after the end of the line
+func Test_put_visual_mode()
+  edit! SomeNewBuffer
+  set selection=exclusive
+  exe "norm o\t"
+  m0
+  sil! norm pp
+
+  bwipe!
+  set selection&
+endfunc
+
 
 " vim: shiftwidth=2 sts=2 expandtab
diff --git a/src/version.c b/src/version.c
index 3f44967..f53575f 100644
--- a/src/version.c
+++ b/src/version.c
@@ -735,6 +735,8 @@ static char *(features[]) =
 
 static int included_patches[] =
 {   /* Add new patch number below this line */
+/**/
+    11,
 /**/
     17,
 /**/
-- 
2.35.6

