From b018978c278d42c7abf78941251b887c95dfdb07 Mon Sep 17 00:00:00 2001
From: Michael R Sweet <michael.r.sweet@gmail.com>
Date: Fri, 13 Dec 2019 09:27:14 -0500
Subject: [PATCH] CVE-2019-2228: Fix ippSetValueTag validation of default
 language.

---
 cups/ipp.c | 2 +-

diff --git a/cups/ipp.c b/cups/ipp.c
index d0cac8cfe1..1595b8b610 100644
--- a/cups/ipp.c
+++ b/cups/ipp.c
@@ -4565,7 +4565,7 @@ ippSetValueTag(
           return (0);
 
         if (ipp->attrs && ipp->attrs->next && ipp->attrs->next->name &&
-            !strcmp(ipp->attrs->next->name, "attributes-natural-language"))
+            !strcmp(ipp->attrs->next->name, "attributes-natural-language") && (ipp->attrs->next->value_tag & IPP_TAG_CUPS_MASK) == IPP_TAG_LANGUAGE)
         {
          /*
           * Use the language code from the IPP message...
