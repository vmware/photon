
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Troubleshooting Â· VMware Photon OS 1.0 and 2.0 Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-noembed/style.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Frequently-Asked-Questions.html" />
    
    
    <link rel="prev" href="Remotely-Upgrade-Photon-OS-Machine-With-Lightwave-Client-and-Photon-Management-Daemon-Installed.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Photon OS 1.0 and 2.0</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getting-started-guides.html">
            
                <a href="getting-started-guides.html">
            
                    
                    Getting Started Guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="Downloading-Photon-OS.html">
            
                <a href="Downloading-Photon-OS.html">
            
                    
                    Downloading Photon OS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="photon-admin-guide.html">
            
                <a href="photon-admin-guide.html#getting-started-with-photon-os-20">
            
                    
                    Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="Upgrading-to-Photon-OS-2.0.html">
            
                <a href="Upgrading-to-Photon-OS-2.0.html">
            
                    
                    Upgrading to Photon OS 2.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="What-is-New-in-Photon-OS-2.0.html">
            
                <a href="What-is-New-in-Photon-OS-2.0.html">
            
                    
                    What is New in Photon OS 2.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="Running-Photon-OS-on-vSphere.html">
            
                <a href="Running-Photon-OS-on-vSphere.html">
            
                    
                    Running Photon OS on vSphere
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="Running-Project-Photon-on-Fusion.html">
            
                <a href="Running-Project-Photon-on-Fusion.html">
            
                    
                    Running Photon OS on Fusion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="Running-Photon-OS-on-Workstation.html">
            
                <a href="Running-Photon-OS-on-Workstation.html">
            
                    
                    Running Photon OS on Workstation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="Running-Photon-OS-on-Amazon-Elastic-Cloud-Compute.html">
            
                <a href="Running-Photon-OS-on-Amazon-Elastic-Cloud-Compute.html">
            
                    
                    Running Photon OS on AWS EC2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="Running-Photon-OS-on-Microsoft-Azure.html">
            
                <a href="Running-Photon-OS-on-Microsoft-Azure.html">
            
                    
                    Running Photon OS on Microsoft Azure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="Running-Photon-OS-on-Google-Compute-Engine.html">
            
                <a href="Running-Photon-OS-on-Google-Compute-Engine.html">
            
                    
                    Running Photon OS on Google Compute Engine
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.10.1" data-path="gce.html">
            
                <a href="gce.html">
            
                    
                    Photon OS on GCE
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="Running-Project-Photon-on-vCloud-Air.html">
            
                <a href="Running-Project-Photon-on-vCloud-Air.html">
            
                    
                    Running Project Photon on vCloud Air
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="admin-guides.html">
            
                <a href="admin-guides.html">
            
                    
                    Administration Guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="photon-admin-guide.html">
            
                <a href="photon-admin-guide.html">
            
                    
                    Photon OS Administration Guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="pmd-cli.html">
            
                <a href="pmd-cli.html">
            
                    
                    Photon Management Daemon Command-line Interface (pmd-cli)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="netmgr.c.html">
            
                <a href="netmgr.c.html">
            
                    
                    Network Configuration Manager - C API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="netmgr-cli.html">
            
                <a href="netmgr-cli.html">
            
                    
                    Photon Network Manager Command-line Interface (netmgr)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="netmgr.python.html">
            
                <a href="netmgr.python.html">
            
                    
                    Network Configuration Manager - Python API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="pmd-cli.html">
            
                <a href="pmd-cli.html">
            
                    
                    How to use Photon Management Daemon
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="tdnf.html">
            
                <a href="tdnf.html">
            
                    
                    Managing Packages in Photon OS with tdnf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="Photon-RPM-OSTree-a-simple-guide.html">
            
                <a href="Photon-RPM-OSTree-a-simple-guide.html">
            
                    
                    Photon RPM OSTree
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="Photon-RPM-OSTree-1-Introduction.html">
            
                <a href="Photon-RPM-OSTree-1-Introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1.1" data-path="Photon-RPM-OSTree-1-Introduction.html">
            
                <a href="Photon-RPM-OSTree-1-Introduction.html#11-what-is-ostree-how-about-rpm-ostree">
            
                    
                    What is OSTree? How about   RPM-OSTree?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.2" data-path="Photon-RPM-OSTree-1-Introduction.html">
            
                <a href="Photon-RPM-OSTree-1-Introduction.html#12-why-use-rpm-ostree-in-photon">
            
                    
                    Why use RPM-OSTree in Photon?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.3" data-path="Photon-RPM-OSTree-1-Introduction.html">
            
                <a href="Photon-RPM-OSTree-1-Introduction.html#13-photon-with-rpm-ostree-installation-profiles">
            
                    
                    Photon with RPM-OSTree installation profiles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.4" data-path="Photon-RPM-OSTree-1-Introduction.html">
            
                <a href="Photon-RPM-OSTree-1-Introduction.html#14-terminology">
            
                    
                    Terminology
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.5" data-path="Photon-RPM-OSTree-1-Introduction.html">
            
                <a href="Photon-RPM-OSTree-1-Introduction.html#15-sample-code">
            
                    
                    Sample code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.6" >
            
                <a target="_blank" href="Photon-RPM-OSTree:-1-Introduction#16-how-to-read-this-book">
            
                    
                    How to read this book
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.1.7" >
            
                <a target="_blank" href="Photon-RPM-OSTree:-1-Introduction#17-rpm-ostree-in-photon-os-20">
            
                    
                    RPM-OSTree in Photon OS 2.0
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="Photon-RPM-OSTree-2-Installing-a-host-against-default-server-repository.html">
            
                <a href="Photon-RPM-OSTree-2-Installing-a-host-against-default-server-repository.html">
            
                    
                    Installing a Photon RPM-OSTree host against default server repository
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.2.1" data-path="Photon-RPM-OSTree-2-Installing-a-host-against-default-server-repository.html">
            
                <a href="Photon-RPM-OSTree-2-Installing-a-host-against-default-server-repository.html#21-who-is-this-for">
            
                    
                    Who is this for?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2.2" data-path="Photon-RPM-OSTree-2-Installing-a-host-against-default-server-repository.html">
            
                <a href="Photon-RPM-OSTree-2-Installing-a-host-against-default-server-repository.html#22-installing-the-iso-step-by-step">
            
                    
                    Installing the ISO, step by step
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="Photon-RPM-OStree-3-Concepts-in-action.html">
            
                <a href="Photon-RPM-OStree-3-Concepts-in-action.html">
            
                    
                    Concepts in action
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.3.1" data-path="Photon-RPM-OStree-3-Concepts-in-action.html">
            
                <a href="Photon-RPM-OStree-3-Concepts-in-action.html#31-querying-the-deployed-filetrees">
            
                    
                    Querying the deployed   filetrees
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3.2" data-path="Photon-RPM-OStree-3-Concepts-in-action.html">
            
                <a href="Photon-RPM-OStree-3-Concepts-in-action.html#32-bootable-filetree-version">
            
                    
                    Bootable filetree version
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3.3" data-path="Photon-RPM-OStree-3-Concepts-in-action.html">
            
                <a href="Photon-RPM-OStree-3-Concepts-in-action.html#33-commit-id">
            
                    
                    Commit ID
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3.4" data-path="Photon-RPM-OStree-3-Concepts-in-action.html">
            
                <a href="Photon-RPM-OStree-3-Concepts-in-action.html#34-osname">
            
                    
                    OSname
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3.5" data-path="Photon-RPM-OStree-3-Concepts-in-action.html">
            
                <a href="Photon-RPM-OStree-3-Concepts-in-action.html#35-refspec">
            
                    
                    Refspec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3.6" data-path="Photon-RPM-OStree-3-Concepts-in-action.html">
            
                <a href="Photon-RPM-OStree-3-Concepts-in-action.html#36-deployments">
            
                    
                    Deployments
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html">
            
                <a href="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html">
            
                    
                    Querying for commit, file and package metadata
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.4.1" data-path="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html">
            
                <a href="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html#41-commit-history">
            
                    
                    Commit history
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4.2" data-path="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html">
            
                <a href="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html#42-listing-file-mappings">
            
                    
                    Listing file mappings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4.3" data-path="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html">
            
                <a href="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html#43-listing-configuration-changes">
            
                    
                    Listing configuration changes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4.4" data-path="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html">
            
                <a href="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html#44-listing-packages">
            
                    
                    Listing packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4.5" data-path="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html">
            
                <a href="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html#45-querying-for-package-details">
            
                    
                    Querying for package details
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4.6" data-path="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html">
            
                <a href="Photon-RPM-OSTree-4-Querying-for-commit-file-and-package-metadata.html#46-why-am-i-unable-to-install-update-or-delete-packages">
            
                    
                    Why am I unable to install, update or delete packages?
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.5" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                    
                    Host updating operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.5.1" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html#51-is-it-an-update-or-an-upgrade">
            
                    
                    Is it an update or an upgrade?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5.2" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html#52-incremental-upgrade">
            
                    
                    Incremental upgrade
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5.3" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html#52-listing-file-differences">
            
                    
                    Listing file differences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5.4" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html#52-listing-package-differences">
            
                    
                    Listing package differences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5.5" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html#55-rollback">
            
                    
                    Rollback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5.6" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html#56-deleting-a-deployed-filetree">
            
                    
                    Deleting a deployed filetree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5.7" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html#57-version-skipping-upgrade">
            
                    
                    Version skipping upgrade
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5.8" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html#58-tracking-parent-commits">
            
                    
                    Tracking parent commits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.5.9" data-path="Photon-RPM-OSTree-5-Host-updating-operations.html">
            
                <a href="Photon-RPM-OSTree-5-Host-updating-operations.html#59-resetting-a-branch-to-a-previous-commit">
            
                    
                    Resetting a branch to a previous commit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.6" data-path="Photon-RPM-OSTree-6-Installing-a-server.html">
            
                <a href="Photon-RPM-OSTree-6-Installing-a-server.html">
            
                    
                    Installing a Photon RPM-OSTree server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7" data-path="Photon-RPM-OSTree-7-Installing-a-host-against-a-custom-server-repository.html">
            
                <a href="Photon-RPM-OSTree-7-Installing-a-host-against-a-custom-server-repository.html">
            
                    
                    Installing a Photon RPM-OStree host against a custom server repository
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.7.1" data-path="Photon-RPM-OSTree-7-Installing-a-host-against-a-custom-server-repository.html">
            
                <a href="Photon-RPM-OSTree-7-Installing-a-host-against-a-custom-server-repository.html#71-manual-install-of-a-custom-host">
            
                    
                    Manual install of a custom host
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.7.2" data-path="Photon-RPM-OSTree-7-Installing-a-host-against-a-custom-server-repository.html">
            
                <a href="Photon-RPM-OSTree-7-Installing-a-host-against-a-custom-server-repository.html#72-automated-install-of-a-custom-host-via-kickstart">
            
                    
                    Automated install of a custom host via kickstart
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.8" data-path="Photon-RPM-OStree-8-File-oriented-server-operations.html">
            
                <a href="Photon-RPM-OStree-8-File-oriented-server-operations.html">
            
                    
                    File oriented server operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.8.1" data-path="Photon-RPM-OStree-8-File-oriented-server-operations.html">
            
                <a href="Photon-RPM-OStree-8-File-oriented-server-operations.html#81-starting-a-fresh-ostree-repo">
            
                    
                    Starting a fresh OSTree repo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8.2" data-path="Photon-RPM-OStree-8-File-oriented-server-operations.html">
            
                <a href="Photon-RPM-OStree-8-File-oriented-server-operations.html#82-checking-out-a-filetree">
            
                    
                    Checking out a filetree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8.3" data-path="Photon-RPM-OStree-8-File-oriented-server-operations.html">
            
                <a href="Photon-RPM-OStree-8-File-oriented-server-operations.html#83-committing-changes-to-a-filetree">
            
                    
                    Committing changes to a filetree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8.4" data-path="Photon-RPM-OStree-8-File-oriented-server-operations.html">
            
                <a href="Photon-RPM-OStree-8-File-oriented-server-operations.html#84-downloading-the-changes-at-the-host">
            
                    
                    Downloading the changes at the host
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.8.5" data-path="Photon-RPM-OStree-8-File-oriented-server-operations.html">
            
                <a href="Photon-RPM-OStree-8-File-oriented-server-operations.html#85-creating-summary-metadata">
            
                    
                    Creating summary metadata
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.9" data-path="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                <a href="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                    
                    Package oriented server operations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.9.1" data-path="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                <a href="Photon-RPM-OSTree-9-Package-oriented-server-operations.html#91-json-configuration-file">
            
                    
                    JSON configuration file
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9.2" data-path="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                <a href="Photon-RPM-OSTree-9-Package-oriented-server-operations.html#92-package-addition-removal-upgrade">
            
                    
                    Package addition, removal, upgrade
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9.3" data-path="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                <a href="Photon-RPM-OSTree-9-Package-oriented-server-operations.html#93-rpms-repository">
            
                    
                    RPMS repository
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9.4" data-path="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                <a href="Photon-RPM-OSTree-9-Package-oriented-server-operations.html#94-composing-a-tree">
            
                    
                    Composing a tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9.5" data-path="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                <a href="Photon-RPM-OSTree-9-Package-oriented-server-operations.html#95-automatic-version-prefix">
            
                    
                    Automatic version prefix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9.6" data-path="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                <a href="Photon-RPM-OSTree-9-Package-oriented-server-operations.html#96-installing-package-updates">
            
                    
                    Installing package updates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9.7" data-path="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                <a href="Photon-RPM-OSTree-9-Package-oriented-server-operations.html#97-creating-server-metadata">
            
                    
                    Creating server metadata
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.9.8" data-path="Photon-RPM-OSTree-9-Package-oriented-server-operations.html">
            
                <a href="Photon-RPM-OSTree-9-Package-oriented-server-operations.html#98-starting-a-fresh-ostree-repo">
            
                    
                    Starting a fresh OSTree repo
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.10" data-path="Photon-RPM-OSTree-10-Remotes.html">
            
                <a href="Photon-RPM-OSTree-10-Remotes.html">
            
                    
                    Remotes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.10.1" data-path="Photon-RPM-OSTree-10-Remotes.html">
            
                <a href="Photon-RPM-OSTree-10-Remotes.html#101-listing-remotes">
            
                    
                    Listing remotes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.10.2" data-path="Photon-RPM-OSTree-10-Remotes.html">
            
                <a href="Photon-RPM-OSTree-10-Remotes.html#102-gpg-signature-verification">
            
                    
                    GPG signature verification
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.10.3" data-path="Photon-RPM-OSTree-10-Remotes.html">
            
                <a href="Photon-RPM-OSTree-10-Remotes.html#103-switching-repositories">
            
                    
                    Switching repositories
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.10.4" data-path="Photon-RPM-OSTree-10-Remotes.html">
            
                <a href="Photon-RPM-OSTree-10-Remotes.html#104-adding-and-removing-remotes">
            
                    
                    Adding and removing remotes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.10.5" data-path="Photon-RPM-OSTree-10-Remotes.html">
            
                <a href="Photon-RPM-OSTree-10-Remotes.html#105-list-available-branches">
            
                    
                    List available branches
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.11" data-path="Photon-RPM-OSTree-11-Running-container-applications-between-bootable-images.html">
            
                <a href="Photon-RPM-OSTree-11-Running-container-applications-between-bootable-images.html">
            
                    
                    Running container applications between bootable images
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.11.1" data-path="Photon-RPM-OSTree-11-Running-container-applications-between-bootable-images.html">
            
                <a href="Photon-RPM-OSTree-11-Running-container-applications-between-bootable-images.html#111-downloading-a-docker-container-appliance">
            
                    
                    Downloading a docker container appliance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.11.2" data-path="Photon-RPM-OSTree-11-Running-container-applications-between-bootable-images.html">
            
                <a href="Photon-RPM-OSTree-11-Running-container-applications-between-bootable-images.html#112-rebooting-into-an-existing-image">
            
                    
                    Rebooting into an existing image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.11.3" data-path="Photon-RPM-OSTree-11-Running-container-applications-between-bootable-images.html">
            
                <a href="Photon-RPM-OSTree-11-Running-container-applications-between-bootable-images.html#113-reboot-into-a-newly-created-image">
            
                    
                    Reboot into a newly created image
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2.12" data-path="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html">
            
                <a href="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html">
            
                    
                    Install or rebase to Photon OS 2.0
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.12.1" data-path="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html">
            
                <a href="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html#121-installing-an-rpm-ostree-server">
            
                    
                    Installing an RPM-OSTree server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.12.2" data-path="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html">
            
                <a href="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html#122-installing-an-rpm-ostree-host">
            
                    
                    Installing an RPM-OSTree host
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.12.3" data-path="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html">
            
                <a href="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html#123-rebasing-a-host-from-photon-10-to-20">
            
                    
                    Rebasing a host from Photon 1.0 to 2.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.12.4" data-path="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html">
            
                <a href="Photon-RPM-OSTree-Install-or-rebase-to-Photon-OS-2.0.html#124-creating-a-host-raw-image">
            
                    
                    Creating a host raw image
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="how-to-guides.html">
            
                <a href="how-to-guides.html">
            
                    
                    How-To Guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="Install-and-Configure-a-Swarm-Cluster-with-DNS-Service-on-PhotonOS.html">
            
                <a href="Install-and-Configure-a-Swarm-Cluster-with-DNS-Service-on-PhotonOS.html">
            
                    
                    Setting Up a Swarm Cluster with DNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="Install-and-Configure-a-Production-Ready-Mesos-Cluster-on-Photon-OS.html">
            
                <a href="Install-and-Configure-a-Production-Ready-Mesos-Cluster-on-Photon-OS.html">
            
                    
                    Setting Up a Mesos Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="Install-and-Configure-Marathon-for-Mesos-Cluster-on-PhotonOS.html">
            
                <a href="Install-and-Configure-Marathon-for-Mesos-Cluster-on-PhotonOS.html">
            
                    
                    Setting Up Marathon for a Mesos Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="Install-and-Configure-DCOS-CLI-for-Mesos.html">
            
                <a href="Install-and-Configure-DCOS-CLI-for-Mesos.html">
            
                    
                    Setting Up DCOS CLI for Mesos
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="Install-and-Configure-Mesos-DNS-on-a-Mesos-Cluster.html">
            
                <a href="Install-and-Configure-Mesos-DNS-on-a-Mesos-Cluster.html">
            
                    
                    Setting Up Mesos DNS on a Mesos Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="PXE-boot.html">
            
                <a href="PXE-boot.html">
            
                    
                    Setting Up a Network PXE Boot Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="kickstart.html">
            
                <a href="kickstart.html">
            
                    
                    Working with Kickstart
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="kubernetes.html">
            
                <a href="kubernetes.html">
            
                    
                    Running Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="nfs-utils.html">
            
                <a href="nfs-utils.html">
            
                    
                    Mounting Remote File Systems
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="build-photon.html">
            
                <a href="build-photon.html">
            
                    
                    Building Photon OS from the Source Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="Installing-and-Using-Lightwave-on-Photon-OS.html">
            
                <a href="Installing-and-Using-Lightwave-on-Photon-OS.html">
            
                    
                    Installing and Using Lightwave on Photon OS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.11.1" data-path="Installing-Lightwave-Server-and-Setting-Up-a-Domain.html">
            
                <a href="Installing-Lightwave-Server-and-Setting-Up-a-Domain.html">
            
                    
                    Installing the Lightwave Server and Configuring It as a Domain Controller on a Photon Image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11.2" data-path="Installing-Lightwave-Client-and-Joining-a-Domain.html">
            
                <a href="Installing-Lightwave-Client-and-Joining-a-Domain.html">
            
                    
                    Installing the Lightwave Client on a Photon Image and Joining the Client to a Domain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11.3" data-path="Installing-the-Photon-Management-Daemon-on-a-Lightwave-Client.html">
            
                <a href="Installing-the-Photon-Management-Daemon-on-a-Lightwave-Client.html">
            
                    
                    Installing the Photon Management Daemon on a Lightwave Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11.4" data-path="Remotely-Upgrade-a-Photon-OS-Machine-With-Lightwave-Client-and-Photon-Management-Daemon-Installed.html">
            
                <a href="Remotely-Upgrade-a-Photon-OS-Machine-With-Lightwave-Client-and-Photon-Management-Daemon-Installed.html">
            
                    
                    Remotely Upgrade a Single Photon OS Machine With Lightwave Client and Photon Management Daemon Installed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11.5" data-path="Remotely-Upgrade-Photon-OS-Machine-With-Lightwave-Client-and-Photon-Management-Daemon-Installed.html">
            
                <a href="Remotely-Upgrade-Photon-OS-Machine-With-Lightwave-Client-and-Photon-Management-Daemon-Installed.html">
            
                    
                    Remotely Upgrade Multiple Photon OS Machines With Lightwave Client and Photon Management Daemon Installed
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="photon-os-troubleshooting-guide.html">
            
                <a href="photon-os-troubleshooting-guide.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Frequently-Asked-Questions.html">
            
                <a href="Frequently-Asked-Questions.html">
            
                    
                    Frequently Asked Questions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <a target="_blank" href="https://github.com/vmware/photon/wiki/Security-Advisories">
            
                    
                    Security Advisories
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Troubleshooting</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="photon-os-linux-troubleshooting-guide">Photon OS Linux Troubleshooting Guide</h1>
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#systemd-and-tdnf">Systemd and TDNF</a></li>
<li><a href="#the-root-account-and-the-sudo-and-su-commands">The Root Account and the <code>sudo</code> and <code>su</code>
Commands</a></li>
<li><a href="#checking-the-version-and-build-number">Checking the Version and Build
Number</a></li>
<li><a href="#general-best-practices">General Best Practices</a></li>
<li><a href="#logs-on-photon-os">Logs on Photon OS</a></li>
<li><a href="#troubleshooting-progression">Troubleshooting Progression</a></li>
</ul>
</li>
<li><a href="#solutions-to-common-problems">Solutions to Common Problems</a><ul>
<li><a href="#resetting-a-lost-root-password">Resetting a Lost Root
Password</a></li>
<li><a href="#fixing-permissions-on-network-config-files">Fixing Permissions on Network Config
Files</a></li>
<li><a href="#permitting-root-login-with-ssh">Permitting Root Login with
SSH</a></li>
<li><a href="#fixing-sendmail-if-installed-before-an-fqdn-was-set">Fixing Sendmail If Installed Before an FQDN Was
Set</a></li>
</ul>
</li>
<li><a href="#common-troubleshooting-tools-on-photon-os">Common Troubleshooting Tools on Photon
OS</a><ul>
<li><a href="#top">Top</a></li>
<li><a href="#ps">ps</a></li>
<li><a href="#netstat">netstat</a></li>
<li><a href="#find">find</a></li>
<li><a href="#locate">Locate</a></li>
<li><a href="#df">df</a></li>
<li><a href="#md5sum-and-sha256sum">md5sum and sha256sum</a></li>
<li><a href="#strace">strace</a></li>
<li><a href="#file">file</a></li>
<li><a href="#stat">stat</a></li>
<li><a href="#watch">watch</a></li>
<li><a href="#vmstat-and-fdisk">vmstat and fdisk</a></li>
<li><a href="#lsof">lsof</a></li>
<li><a href="#fuser">fuser</a></li>
<li><a href="#ldd">ldd</a></li>
<li><a href="#gdb">gdb</a></li>
<li><a href="#other-troubleshooting-tools-installed-by-default">Other Troubleshooting Tools Installed by
Default</a></li>
<li><a href="#installing-more-tools-from-repositories">Installing More Tools from
Repositories</a></li>
<li><a href="#linux-troubleshooting-tools-not-on-photon-os">Linux Troubleshooting Tools Not on Photon
OS</a></li>
</ul>
</li>
<li><a href="#systemd">Systemd</a><ul>
<li><a href="#viewing-services">Viewing Services</a></li>
<li><a href="#using-systemd-commands-instead-of-init.d-commands">Using Systemd Commands Instead of Init.d
Commands</a></li>
<li><a href="#analyzing-system-logs-with-journalctl">Analyzing System Logs with
journalctl</a></li>
<li><a href="#inspecting-services-with-systemd-analyze">Inspecting Services with
<code>systemd-analyze</code></a></li>
</ul>
</li>
<li><a href="#networking">Networking</a><ul>
<li><a href="#managing-the-network-configuration">Managing the Network
Configuration</a></li>
<li><a href="#use-ip-and-ss-commands-instead-of-ifconfig-and-netstat">Use <code>ip</code> and <code>ss</code> Commands Instead of <code>ifconfig</code> and
<code>netstat</code></a></li>
<li><a href="#inspecting-the-status-of-network-links-with-networkctl">Inspecting the Status of Network Links with
<code>networkctl</code></a></li>
<li><a href="#turning-on-network-debugging">Turning on Network
Debugging</a></li>
<li><a href="#installing-the-packages-for-tcpdump-and-netcat-with-tdnf">Installing the Packages for tcpdump and netcat with
tdnf</a></li>
<li><a href="#checking-firewall-rules">Checking Firewall Rules</a></li>
<li><a href="#netmgr">Netmgr</a></li>
</ul>
</li>
<li><a href="#file-system">File System</a><ul>
<li><a href="#checking-disk-space">Checking Disk Space</a></li>
<li><a href="#adding-a-disk-and-partitioning-it">Adding a Disk and Partitioning
It</a></li>
<li><a href="#expanding-disk-partition">Expanding Disk Partition</a></li>
<li><a href="#fdisk">fdisk</a></li>
<li><a href="#fsck">fsck</a></li>
<li><a href="#fixing-file-system-errors-when-fsck-fails">Fixing File System Errors When fsck
Fails</a></li>
</ul>
</li>
<li><a href="#packages">Packages</a></li>
<li><a href="#kernel-problems-and-boot-and-login-problems">Kernel Problems and Boot and Login
Problems</a><ul>
<li><a href="#kernel-overview">Kernel Overview</a></li>
<li><a href="#boot-process-overview">Boot Process Overview</a></li>
<li><a href="#blank-screen-on-reboot">Blank Screen on Reboot</a></li>
<li><a href="#investigating-strange-behavior">Investigating Strange
Behavior</a></li>
<li><a href="#investigating-the-guest-kernel-when-you-cannot-log-on">Investigating the Guest Kernel When You Cannot Log
On</a></li>
<li><a href="#kernel-log-replication-with-vprobes">Kernel Log Replication with
VProbes</a></li>
</ul>
</li>
<li><a href="#performance-issues">Performance Issues</a></li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>This guide describes the fundamentals of troubleshooting problems on Photon OS. An open-source minimalist Linux operating system from VMware, Photon OS is optimized for cloud computing platforms, VMware vSphere deployments, virtual appliances, and applications native to the cloud.</p>
<p>This guide covers the basics of troubleshooting systemd, packages, network interfaces, services such as SSH and Sendmail, the file system, and the Linux kernel. The guide includes a quick tour of the tools that you can use for troubleshooting and provides examples along the way. The guide also demonstrates how to access the system&apos;s log files. </p>
<p>For information on how to install and manage Photon OS, see the <a href="https://github.com/vmware/photon/blob/master/docs/photon-admin-guide.md" target="_blank">Photon OS Administration Guide</a>.</p>
<h3 id="systemd-and-tdnf">Systemd and TDNF</h3>
<p>Two characteristics of Photon OS stand out: It manages services with systemd, and it manages packages with its own open source, yum-compatible package manager called tdnf, for Tiny DNF. </p>
<p>By using systemd, Photon OS adopts a contemporary Linux standard to bootstrap the user space and concurrently start services--an architecture that differs from traditional Linux systems such as SUSE Linux Enterprise Server 11.</p>
<!-- [[Image:photon-logo.png|right]] --> 
<p>A traditional Linux system contains an initialization system called SysVinit. With SLES 11, for instance, SysVinit-style init programs control how the system starts up and shuts down. Init implements system runlevels. A SysVinit runlevel defines a state in which a process or service runs. In contrast to a SysVinit system, systemd defines no such runlevels. Instead, systemd uses a dependency tree of <em>targets</em> to determine which services to start when.</p>
<p>Because the systemd commands differ from those of an init.d-based Linux system, a section later in this guide illustrates how to troubleshoot by using systemctl commands instead of init.d-style commands. </p>
<p>Tdnf keeps the operating system as small as possible while preserving yum&apos;s robust package-management capabilities. On Photon OS, tdnf is the default package manager for installing new packages. Since troubleshooting with tdnf differs from using yum, a later section of this guide describes how to solve problems with packages and repositories by using tdnf commands.</p>
<h3 id="the-root-account-and-the-sudo-and-su-commands">The Root Account and the <code>sudo</code> and <code>su</code> Commands</h3>
<p>This guide assumes that you are logged in to Photon OS with the root account and running commands as root. The sudo program comes with the full version of Photon OS. On the minimal version, you must install sudo with tdnf if you want to use it. As an alternative to installing sudo on the minimal version, you can switch users as needed with the <code>su</code> command to run commands that require root privileges.</p>
<h3 id="checking-the-version-and-build-number">Checking the Version and Build Number</h3>
<p>To check the version and build number of Photon OS, concatenate <code>/etc/photon-release</code>. Example: </p>
<pre><code>cat /etc/photon-release
VMware Photon Linux 1.0
PHOTON_BUILD_NUMBER=a6f0f63
</code></pre><p>The build number in the results maps to the commit number on the VMware Photon OS GitHub <a href="https://github.com/vmware/photon/commits/master" target="_blank">commits page</a>.</p>
<h3 id="general-best-practices">General Best Practices</h3>
<p>When troubleshooting, you should follow some general best practices:</p>
<ul>
<li><p><strong>Take a snapshot.</strong> Before you do anything to a virtual machine running Photon OS, take a snapshot of the VM so that you can restore it if need be. </p>
</li>
<li><p><strong>Make a backup copy.</strong> Before you change a configuration file, make a copy of the original in case you need to restore it later; example: <code>cp /etc/tdnf/tdnf.conf /etc/tdnf/tdnf.conf.orig</code></p>
</li>
<li><p><strong>Collect logs.</strong> Save the log files associated with a Photon OS problem; you or others might need them later. Include not only the log files on the guest but also the <code>vmware.log</code> file on the host; <code>vmware.log</code> is in the host&apos;s directory that contains the VM.</p>
</li>
<li><p><strong>Know what&apos;s in your toolbox.</strong> Glance at the man page for a tool before you use it so that you know what your options are. The options can help focus the command&apos;s output on the problem you&apos;re trying to solve.</p>
</li>
<li><p><strong>Understand the system.</strong> The more you know about the operating system and how it works, the better you can troubleshoot.</p>
</li>
</ul>
<h3 id="logs-on-photon-os">Logs on Photon OS</h3>
<p>On Photon OS, all the system logs except the installation log and the cloud-init log are written into the systemd journal. The <code>journalctl</code> command queries the contents of the systemd journal.</p>
<p>The installation log files and the cloud-init log files reside in <code>/var/log</code>. If Photon OS is running on a virtual machine in a VMware hypervisor, the log file for the VMware tools (vmware-vmsvc.log) also resides in <code>/var/log</code>. </p>
<h3 id="troubleshooting-progression">Troubleshooting Progression</h3>
<p>If you encounter a problem running an application or appliance on Photon OS and you suspect it involves the operating system, you can troubleshoot by proceeding as follows. </p>
<p>First, check the services running on Photon OS:</p>
<pre><code>systemctl status
</code></pre><p>Second, check your application&apos;s log files for clues. (For VMware applications, see <a href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1021806" target="_blank">Location of Log Files for VMware Products</a>.)</p>
<p>Third, check the service controller or service monitor for your application or appliance. </p>
<p>Fourth, check the network interfaces and other aspects of the network service with <code>systemd-network</code> commands.</p>
<p>Fifth, check the operating system&apos;s log files: </p>
<pre><code>journalctl
</code></pre><p>Next, run the following commands to view all services according to the order in which they were started:</p>
<pre><code>systemd-analyze critical-chain 
</code></pre><p>Finally, if the previous steps have not revealed enough information to isolate the problem, turn to the troubleshooting tool that you think is most likely to help with the issue at hand. You could, for example, use <code>strace</code> to identify the location of the failure. See the list of troubleshooting tools on Photon OS in a later section. </p>
<h2 id="solutions-to-common-problems">Solutions to Common Problems</h2>
<p>This section describes solutions to problems that you&apos;re likely to encounter.</p>
<h3 id="resetting-a-lost-root-password">Resetting a Lost Root Password</h3>
<p>Here&apos;s how to reset a lost root password. </p>
<p>First, restart the Photon OS machine or the virtual machine running Photon OS. When the Photon OS splash screen appears as it restarts, type the letter <code>e</code> to go to the GNU GRUB edit menu. Be quick about it: Because Photon OS reboots so quickly, you won&apos;t have much time to type <code>e</code>. Remember that in vSphere and Workstation, you might have to give the console focus by clicking in its window before it will register input from the keyboard. </p>
<p>Second, in the GNU GRUB edit menu, go to the end of the line that starts with <code>linux</code>, add a space, and then add the following code exactly as it appears below:</p>
<pre><code>rw init=/bin/bash
</code></pre><p>After you add this code, the GNU GRUB edit menu should look exactly like this:</p>
<p><img src="images/grub-edit-menu-changepw.png" alt="The modified GNU GRUB edit menu"> </p>
<p>Now type <code>F10</code>.</p>
<p>At the command prompt, type <code>passwd</code> and then type (and re-enter) a new root password that conforms to the password complexity rules of Photon OS. Remember the password. </p>
<p>Next, type the following command:</p>
<pre><code>umount /
</code></pre><p>Finally, type the following command. You must include the <code>-f</code> option to force a reboot; otherwise, the kernel enters a state of panic.</p>
<pre><code>reboot -f
</code></pre><p>This sequence of commands should look like this:</p>
<p><img src="images/resetpw.png" alt="The series of commands to reset the root password"></p>
<p>After the Photon OS machine reboots, log in with the new root password. </p>
<h3 id="fixing-permissions-on-network-config-files">Fixing Permissions on Network Config Files</h3>
<p>If you, as the root user, create a new network configuration file on Photon OS, the network service might be unable to process it until you set the file&apos;s mode bits to <code>644</code>.</p>
<p>If you query the journal with <code>journalctl -u systemd-networkd</code>, you might see the following error message along with an indication that the network service did not start: </p>
<pre><code>could not load configuration files. permission denied
</code></pre><p>The permissions on the network files are the likely cause of this problem. Without the correct permissions, networkd-systemd cannot parse and apply the settings, and the network configuration that you created will not be loaded. </p>
<p>After you create a network configuration file with a <code>.network</code> extension, you must run the <code>chmod</code> command to set the new file&apos;s mode bits to <code>644</code>. Example: </p>
<pre><code>chmod 644 10-static-en.network
</code></pre><p>For Photon OS to apply the new configuration, you must restart the <code>systemd-networkd</code> service by running the following command: </p>
<pre><code>systemctl restart systemd-networkd
</code></pre><h3 id="permitting-root-login-with-ssh">Permitting Root Login with SSH</h3>
<p>The full version of Photon OS prevents root login with SSH by default. To permit root login over SSH, open <code>/etc/ssh/sshd_config</code> with the vim text editor and set <code>PermitRootLogin</code> to <code>yes</code>. </p>
<p>Vim is the default text editor available in both the full and minimal versions of Photon OS. (Nano is also in the full version.) After you modify the SSH daemon&apos;s configuration file, you must restart the sshd daemon for the changes to take effect. Example: </p>
<pre><code>vim /etc/ssh/sshd_config

# override default of no subsystems
Subsystem       sftp    /usr/libexec/sftp-server

# Example of overriding settings on a per-user basis
#Match User anoncvs
#       X11Forwarding no
#       AllowTcpForwarding no
#       PermitTTY no
#       ForceCommand cvs server
PermitRootLogin yes
UsePAM yes
</code></pre><p>Save your changes in vim and then restart the sshd daemon: </p>
<pre><code>systemctl restart sshd
</code></pre><p>You can then connect to the Photon OS machine with the root account over SSH:</p>
<pre><code>steve@ubuntu:~$ ssh root@198.51.100.131
</code></pre><h3 id="fixing-sendmail-if-installed-before-an-fqdn-was-set">Fixing Sendmail If Installed Before an FQDN Was Set</h3>
<p>If Sendmail is behaving improperly or if it hangs during installation, it is likely that an FQDN is not set. Take the following corrective action. </p>
<p>First, set an FQDN for your Photon OS machine. </p>
<p>Then, run the following commands in the order below: </p>
<pre><code>echo $(hostname -f) &gt; /etc/mail/local-host-names

cat &gt; /etc/mail/aliases &lt;&lt; &quot;EOF&quot;
    postmaster: root
    MAILER-DAEMON: root
    EOF

/bin/newaliases

cd /etc/mail

m4 m4/cf.m4 sendmail.mc &gt; sendmail.cf

chmod 700 /var/spool/clientmqueue

chown smmsp:smmsp /var/spool/clientmqueue
</code></pre><h2 id="common-troubleshooting-tools-on-photon-os">Common Troubleshooting Tools on Photon OS</h2>
<p>This section describes tools that can help troubleshoot problems. These tools are installed by default on the full version of Photon OS. On the minimal version of Photon OS, you may have to install a tool before you can use it. </p>
<p>There is a manual, or man page, on Photon OS for all the tools covered in this section. The man pages provide more information about each tool&apos;s commands, options, and output. To view a tool&apos;s man page, on the Photon OS command line, type <code>man</code> and then the name of the tool. Example: </p>
<pre><code>man strace
</code></pre><p>Some of the examples in this section are marked as abridged with ellipsis (<code>...</code>).</p>
<h3 id="top">Top</h3>
<p>Photon OS includes the Top tool to monitor system resources, workloads, and performance. It can unmask problems caused by processes or applications overconsuming CPUs, time, or RAM. </p>
<p>To view a textual display of resource consumption, run the <code>top</code> command: </p>
<pre><code>top
</code></pre><p>In Top, you can kill a runaway or stalled process by typing <code>k</code> followed by its process ID (PID). </p>
<p><img src="images/top-in-photon-os.png" alt="Top on Photon OS"></p>
<p>If the percent of CPU utilization is consistently high with little idle time, there might be a runaway process overconsuming CPUs. Restarting the service might solve the problem. </p>
<p>A handy trick while troubleshooting an unknown issue is to run Top in the background by using batch mode to write its output to a file in order to collect data about performance:</p>
<pre><code>top d 120 b &gt;&gt; top120second.output
</code></pre><p>For a list of options that filter top output and other information, see the man page for Top.</p>
<h3 id="ps">ps</h3>
<p>The <code>ps</code> tool shows the processes running on the machine. The <code>ps</code> tool derives flexibility and power from its options, all of which are covered in the tool&apos;s Photon OS man page:</p>
<pre><code>man ps
</code></pre><p>Here are several popular invocations of <code>ps</code> for troubleshooting. </p>
<p>Show processes by user: </p>
<pre><code>ps aux
</code></pre><p>Show processes and child processes by user: </p>
<pre><code>ps auxf
</code></pre><p>Show processes containing the string <code>ssh</code>:</p>
<pre><code>ps aux | grep ssh
</code></pre><p>Show processes and the command and options with which they were started: </p>
<pre><code>ps auxww
</code></pre><p>Example abridged output: </p>
<pre><code>ps auxww
USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root          1  0.0  0.9  32724  3300 ?        Ss   07:51   0:32 /lib/systemd/systemd --switched-root --system --deserialize 22
</code></pre><h3 id="netstat">netstat</h3>
<p>The <code>netstat</code> command can identify bottlenecks causing  performance issues. It lists network connections, listening sockets, port information, and interface statistics for different protocols. Examples: </p>
<pre><code>netstat --statistics
netstat --listening
</code></pre><h3 id="find">find</h3>
<p>The <code>find</code> command can be a useful starting point to troubleshoot a Photon OS machine that has stopped working. The following command, for example, lists the files in the root directory that have changed in the past day: </p>
<pre><code>    find / -mtime -1 
</code></pre><p>See the <code>find</code> <a href="See%20https:/www.gnu.org/software/findutils/manual/find.html">manual</a>. Take note of the security considerations listed in the <code>find</code> manual if you are using <code>find</code> to troubleshoot an appliance running on Photon OS. </p>
<h3 id="locate">Locate</h3>
<p>The <code>locate</code> command is a fast way to find files and directories when all you have is a keyword. Similar to <code>find</code> and part of the same <code>findutils</code> package preinstalled on the full version of Photon OS by default, the <code>locate</code> command finds file names in the file names database. Before you can use <code>locate</code> accurately, you should update its database: </p>
<pre><code>updatedb
</code></pre><p>Then you can run <code>locate</code> to quickly find a file, such as any file name containing <code>.network</code>, which can be helpful to see all the system&apos;s <code>.network</code> configuration files; abridged example: </p>
<pre><code>locate .network
/etc/dbus-1/system.d/org.freedesktop.network1.conf
/etc/systemd/network/10-dhcp-en.network
/usr/lib/systemd/network/80-container-host0.network
/usr/lib/systemd/network/80-container-ve.network
/usr/lib/systemd/system/busnames.target.wants/org.freedesktop.network1.busname
/usr/lib/systemd/system/dbus-org.freedesktop.network1.service
/usr/lib/systemd/system/org.freedesktop.network1.busnname
/usr/share/dbus-1/system-services/org.freedesktop.network1.service
</code></pre><p>The <code>locate</code> command is also a quick way to see whether a troubleshooting tool is installed on Photon OS. Examples: </p>
<pre><code>locate strace
/usr/bin/strace
/usr/bin/strace-graph
/usr/bin/strace-log-merge
/usr/share/man/man1/strace.1.gz
/usr/share/vim/vim74/syntax/strace.vim

locate traceroute
</code></pre><p>The <code>strace</code> tool is there but <code>traceroute</code> is not. You can, however, quickly install <code>traceroute</code> from the Photon OS repository: </p>
<pre><code>tdnf install traceroute
</code></pre><h3 id="df">df</h3>
<p>The <code>df</code> command reports the disk space available on the file system. Because running out of disk space can lead an application to fail, a quick check of the available space makes sense as an early troubleshooting step: </p>
<pre><code>df -h
</code></pre><p>The <code>-h</code> option prints out the available and used space in human-readable sizes. After checking the space, you should also check the number of available inodes. Too few available inodes can lead to difficult-to-diagnose problems:</p>
<pre><code>df -i
</code></pre><h3 id="md5sum-and-sha256sum">md5sum and sha256sum</h3>
<p><code>md5sum</code> calculates 128-bit MD5 hashes--a message digest, or digital signature, of a file--to uniquely identify a file and verify its integrity after file transfers, downloads, or disk errors when the security of the file is not in question. Photon OS also includes <code>sha256sum</code>, which is the preferred method of calculating the authenticity of a file to prevent tampering when security is a concern. Photon OS also includes <code>shasum</code>, <code>sha1sum</code>, <code>sha384sum</code>, and <code>sha512sum</code>. See the man pages for  <code>md3sum</code>, <code>sha256sum</code>, and the other SHA utilities. </p>
<p><code>md5sum</code> can help troubleshooting installation issues by verifying that the version of Photon OS being installed matches the version on the Bintray download page. If, for instance, bytes were dropped during the download, the checksums will not match. Try downloading it again. </p>
<h3 id="strace">strace</h3>
<p>The <code>strace</code> utility follows system calls and signals as they are executed so that you can see what an application, command, or process is doing. <code>strace</code> can trace failed commands, identify where a process obtains its configuration, monitor file activity, and find the location of a crash. </p>
<p>By tracing system calls, <code>strace</code> can help troubleshoot a broad range of problems, including issues with input-output, memory, interprocess communication, network usage, and application performance. </p>
<p>For troubleshooting a problem that gives off few or no clues, the following command displays every system call: </p>
<pre><code>strace ls -al
</code></pre><p>With strace commands, you can route the output to a file to make it easier to analyze: </p>
<pre><code>strace -o output.txt ls -al
</code></pre><p><code>strace</code> can reveal the files that an application is trying to open with the <code>-eopen</code> option. This combination can help troubleshoot an application that is failing because it is missing files or being denied access to a file it needs. If, for example, you see &quot;No such file or directory&quot; in the results of <code>strace -eopen</code>, something might be wrong: </p>
<pre><code>strace -eopen sshd
open(&quot;/usr/lib/x86_64/libpam.so.0&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open(&quot;/usr/lib/libpam.so.0&quot;, O_RDONLY|O_CLOEXEC) = 3
</code></pre><p>In the results above, it&apos;s OK that the first file is missing because it is found in the next line. In other cases, the application might be unable to open one of its configuration files or reading the wrong one. If the results say &quot;permission denied&quot; for one of the files, check the permissions of the file with <code>ls -l</code> or <code>stat</code>.   </p>
<p>When troubleshooting with <code>strace</code>, you can include the process ID in its commands. Here&apos;s an example of how to find a process ID: </p>
<pre><code>ps -ef | grep apache
</code></pre><p>And you can then use <code>strace</code> to examine the file a process is working with: </p>
<pre><code>strace -e trace=file -p 1719
</code></pre><p>A similar command can trace network traffic: </p>
<pre><code>strace -p 812 -e trace=network
</code></pre><p>If an application is crashing, use <code>strace</code> to trace the application and then analyze what happens right before the application crashes.</p>
<p>You can also trace the child processes that an application spawns with the fork system call, and you can do so with systemctl commands that start a process to identify why an application crashes immediately or fails to start: </p>
<pre><code>strace -f -o output.txt systemctl start httpd
</code></pre><p>Here&apos;s another example. If journalctl is showing that networkd is failing, you can run strace to help determine why: </p>
<pre><code>strace -o output.txt systemctl restart systemd-networkd
</code></pre><p>And then grep inside the results for something, such as <em>exit</em> or <em>error</em>: </p>
<pre><code>grep exit output.txt
</code></pre><p>Maybe the results indicate systemd-resolved is going wrong, and you can then strace it, too: </p>
<pre><code>strace -f -o output.txt systemctl restart systemd-resolved
</code></pre><h3 id="file">file</h3>
<p>The <code>file</code> command determines the file type, which can help troubleshoot problems when an application mistakes one type of file for another, leading it to misbehave. Example: </p>
<pre><code>file /usr/sbin/sshd
/usr/sbin/sshd: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, stripped
</code></pre><h3 id="stat">stat</h3>
<p>The <code>stat</code> command can help troubleshoot problems with files or the file system by showing the last date it was modified and other information. Example:  </p>
<pre><code>stat /dev/sda1
File: &apos;/dev/sda1&apos;
Size: 0               Blocks: 0          IO Block: 4096   block special file
Device: 6h/6d   Inode: 6614        Links: 1     Device type: 8,1
Access: (0660/brw-rw----)  Uid: (    0/    root)   Gid: (    8/    disk)
Access: 2016-09-02 12:23:56.135999936 +0000
Modify: 2016-09-02 12:23:52.879999981 +0000
Change: 2016-09-02 12:23:52.879999981 +0000
Birth: -
</code></pre><p>On Photon OS, <code>stat</code> is handy to show permissions for a file or directory in both their absolute octal notation and their read-write-execute abbreviation; truncated example: </p>
<pre><code>chmod 777 tester.md
stat tester.md
  File: &apos;tester.md&apos;
  Size: 0               Blocks: 0          IO Block: 4096   regular empty file
Device: 801h/2049d      Inode: 316385      Links: 1
Access: (0777/-rwxrwxrwx)  Uid: (    0/    root)   Gid: (    0/    root)
</code></pre><h3 id="watch">watch</h3>
<p>The <code>watch</code> utility runs a command at regular intervals so you can observe how its output changes over time. <code>watch</code> can help dynamically monitor network links, routes, and other information when you are troubleshooting networking or performance issues. Examples: </p>
<pre><code>watch -n0 --differences ss
watch -n1 --differences ip route
</code></pre><p>Here&apos;s another example with a screenshot of the command&apos;s output. This command monitors the traffic on your network links. The highlighted numbers are updated every second so you can see the traffic fluctuating: </p>
<pre><code>watch -n1 --differences ip -s link show up
</code></pre><p><img src="images/watchcmd.png" alt="The dynamic output of the watch utility">  </p>
<h3 id="vmstat-and-fdisk">vmstat and fdisk</h3>
<p>The <code>vmstat</code> tool displays statistics about virtual memory, processes, block input-output, disks, and CPU activity. This tool can help diagnose performance problems, especially system bottlenecks.  </p>
<p>Its output on a Photon OS virtual machine running in VMware Workstation 12 Pro without a heavy load looks like this: </p>
<pre><code>vmstat
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 0  0      0   5980  72084 172488    0    0    27    44  106  294  1  0 98  1  0
</code></pre><p>What do all these codes mean? They are explained in the vmstat man page. </p>
<p>If <code>r</code>, the number of runnable processes, is higher than 10, the machine is under stress; consider intervening to reduce the number of processes or to distribute some of the processes to other machines. In other words, the machine has a bottleneck in executing processes.</p>
<p>If <code>cs</code>, the number of context switches per second, is really high, there may be too many jobs running on the machine. </p>
<p>If <code>in</code>, the number of interrupts per second, is relatively high, there might be a bottleneck for network or disk IO. </p>
<p>You can investigate disk IO further by using vmstat&apos;s <code>-d</code> option to report disk statistics; abridged example on a machine with little load: </p>
<pre><code>vmstat -d
disk- ------------reads------------ ------------writes----------- -----IO------
       total merged sectors      ms  total merged sectors      ms    cur    sec
ram0       0      0       0       0      0      0       0       0      0      0
ram1       0      0       0       0      0      0       0       0      0      0
loop0      0      0       0       0      0      0       0       0      0      0
loop1      0      0       0       0      0      0       0       0      0      0
sr0        0      0       0       0      0      0       0       0      0      0
sda    22744    676  470604   12908  72888  24949  805224  127692      0    130
</code></pre><p>The <code>-D</code> option summarizes disk statistics:</p>
<pre><code>vmstat -D
           26 disks
            2 partitions
        22744 total reads
          676 merged reads
       470604 read sectors
        12908 milli reading
        73040 writes
        25001 merged writes
       806872 written sectors
       127808 milli writing
            0 inprogress IO
          130 milli spent IO
</code></pre><p>You can also get statistics about a partition. First, run the <code>fdisk -l</code> command to list the machine&apos;s devices. Then run <code>vmstat -p</code> with the name of a device to view its stats: </p>
<pre><code>fdisk -l
Disk /dev/ram0: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
...
Device        Start      End  Sectors Size Type
/dev/sda1      2048 16771071 16769024   8G Linux filesystem
/dev/sda2  16771072 16777182     6111   3M BIOS boot

vmstat -p /dev/sda1
sda1          reads   read sectors  writes    requested writes
               22579     473306      78510     866088
</code></pre><p>See the vmstat man page for more options. </p>
<h3 id="lsof">lsof</h3>
<p>The <code>lsof</code> command lists open files. And this tool&apos;s definition of an open file is quite broad--directories, libraries, streams, domain sockets, and Internet sockets are all considered files, making <code>lsof</code> broadly applicable as a mid-level troubleshooting tool to identify the files a process is using. Because a Linux system like Photon OS uses files to do its work, you can run <code>lsof</code> as root to see how the system is using them and to see how an application works. </p>
<p>If, for example, you cannot unmount a disk because it is in use, you can run <code>lsof</code> to identify the files on the disk that are being used. Here&apos;s an example showing what&apos;s using the root directory: </p>
<pre><code>lsof /root
COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME
bash       879 root  cwd    DIR    8,1     4096 262159 /root
bash      1265 root  cwd    DIR    8,1     4096 262159 /root
sftp-serv 1326 root  cwd    DIR    8,1     4096 262159 /root
gdb       1351 root  cwd    DIR    8,1     4096 262159 /root
bash      1395 root  cwd    DIR    8,1     4096 262159 /root
lsof      1730 root  cwd    DIR    8,1     4096 262159 /root
</code></pre><p>You can do the same with an application or virtual appliance by running <code>lsof</code> with the user name or process ID of the app. Here&apos;s an example that lists the open files used by the Apache HTTP Server:  </p>
<pre><code>lsof -u apache
</code></pre><p>Running the command with the <code>-i</code> option lists all the open network and Internet files, which can help troubleshoot network problems: </p>
<pre><code>lsof -i
</code></pre><p>See the Unix socket addresses of a user like <em>zookeeper</em>: </p>
<pre><code>lsof -u zookeeper -U
</code></pre><p>And here&apos;s an example that shows the processes running on Ports 1 through 80:</p>
<pre><code>lsof -i TCP:1-80
COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
httpd    403   root    3u  IPv6  10733      0t0  TCP *:http (LISTEN)
httpd    407 apache    3u  IPv6  10733      0t0  TCP *:http (LISTEN)
httpd    408 apache    3u  IPv6  10733      0t0  TCP *:http (LISTEN)
httpd    409 apache    3u  IPv6  10733      0t0  TCP *:http (LISTEN)
sshd     820   root    3u  IPv4  11336      0t0  TCP *:ssh (LISTEN)
sshd     820   root    4u  IPv6  11343      0t0  TCP *:ssh (LISTEN)
sshd    1258   root    3u  IPv4  48040      0t0  TCP 198.51.100.143:ssh-&gt;198.51.100.1:49759 (ESTABLISHED)
sshd    1319   root    3u  IPv4  50866      0t0  TCP 198.51.100.143:ssh-&gt;198.51.100.1:51054 (ESTABLISHED)
sshd    1388   root    3u  IPv4  56438      0t0  TCP 198.51.100.143:ssh-&gt;198.51.100.1:60335 (ESTABLISHED)
</code></pre><p>You can also inspect the files opened by a process ID. Here&apos;s a truncated example that queries the files open by the systemd network service: </p>
<pre><code>lsof -p 1917
COMMAND    PID            USER   FD      TYPE             DEVICE SIZE/OFF   NODE NAME
systemd-n 1917 systemd-network  cwd       DIR                8,1     4096      2 /
systemd-n 1917 systemd-network  txt       REG                8,1   887896 272389 /usr/lib/systemd/systemd-networkd
systemd-n 1917 systemd-network  mem       REG                8,1   270680 262267 /usr/lib/libnss_files-2.22.so
systemd-n 1917 systemd-network    0r      CHR                1,3      0t0   5959 /dev/null
systemd-n 1917 systemd-network    1u     unix 0x0000000000000000      0t0  45734 type=STREAM
systemd-n 1917 systemd-network    3u  netlink                         0t0   6867 ROUTE
systemd-n 1917 systemd-network    4u     unix 0x0000000000000000      0t0  45744 type=DGRAM
systemd-n 1917 systemd-network    9u  netlink                         0t0  45754 KOBJECT_UEVENT
systemd-n 1917 systemd-network   12u  a_inode               0,11        0   5955 [timerfd]
systemd-n 1917 systemd-network   13u     IPv4             104292      0t0    UDP 198.51.100.143:bootpc
</code></pre><h3 id="fuser">fuser</h3>
<p>The <code>fuser</code> command identifies the process IDs of processes using files or sockets. The term <em>process</em> is, in this case, synonymous with <em>user</em>. To identify the process ID of a process using a socket, run <code>fuser</code> with its namespace option and specify <code>tcp</code> or <code>udp</code> and the name of the process or port. Examples: </p>
<pre><code>fuser -n tcp ssh
ssh/tcp:               940  1308
fuser -n tcp http
http/tcp:              592   594   595   596
fuser -n tcp 80
80/tcp:                592   594   595   596
</code></pre><h3 id="ldd">ldd</h3>
<p>By revealing the shared libraries that a program depends on, <code>ldd</code> can help troubleshoot an application that is missing a library or finding the wrong one.</p>
<p>If, for example, you find output that says &quot;file not found,&quot; check the path to the library.  </p>
<pre><code>ldd /usr/sbin/sshd
linux-vdso.so.1 (0x00007ffc0e3e3000)
libpam.so.0 =&gt; (file not found)
libcrypto.so.1.0.0 =&gt; /usr/lib/libcrypto.so.1.0.0 (0x00007f624e570000)
</code></pre><p>You can also use the <code>objdump</code> command to show dependencies for a program&apos;s object files; example:</p>
<pre><code>objdump -p /usr/sbin/sshd | grep NEEDED
</code></pre><h3 id="gdb">gdb</h3>
<p>The gdb tool is the GNU debugger. It lets you peer inside a program while it executes or when it crashes so that you can catch bugs on the fly. The gdb tool is typically used to debug programs written in C and C++. On Photon OS, gdb can help you determine why an application crashed. See the man page for gdb for instructions on how to run it. For an extensive example on how to use gdb to troubleshoot Photon OS running on a VM when you cannot login to Photon OS, see the section on troubleshooting boot and logon problems. </p>
<h3 id="other-troubleshooting-tools-installed-by-default">Other Troubleshooting Tools Installed by Default</h3>
<p>The following troubleshooting tools are included in the full version of Photon OS: </p>
<ul>
<li><code>grep</code> searches files for patterns. </li>
<li><code>ping</code> tests network connectivity. </li>
<li><code>strings</code> displays the characters in a file to identify its contents.</li>
<li><code>lsmod</code> lists loaded modules.</li>
<li><code>ipcs</code> shows data about the inter-process communication (IPC) resources to which a process has read access--typically, shared memory segments, message queues, and semaphore arrays.</li>
<li><code>nm</code> lists symbols from object files. </li>
<li><code>diff</code> compares files side by side. Useful to compare two configuration files when one version works and the other doesn&apos;t. </li>
</ul>
<h3 id="installing-more-tools-from-repositories">Installing More Tools from Repositories</h3>
<p>You can install several troubleshooting tools from the Photon OS repositories by using the default package management system, <code>tdnf</code>. </p>
<p>If a tool you need is not installed, the first thing you should do is search the repositories to see whether it&apos;s available. The traceroute tool, for example, is not installed by default. Here&apos;s how to search for it in the repositories:  </p>
<pre><code>tdnf search traceroute
traceroute : Traces the route taken by packets over an IPv4/IPv6 network
</code></pre><p>The results of the above command show that traceroute exists in the repository. You install it with <code>tdnf</code>: </p>
<pre><code>tdnf install traceroute
</code></pre><p>Additional tools are not installed by default but are in the repository for instant installation with <code>tdnf</code>: </p>
<ul>
<li><code>net-tools</code>: networking tools.</li>
<li><code>ltrace</code>: tool for intercepting and recording dynamic library calls. It can identify the function an application was calling when it crashed, making it useful for debugging.</li>
<li><code>nfs-utils</code>: client tools for the kernel Network File System, or NFS, including showmount; installed by default in the full version of Photon OS but not in the minimal version. </li>
<li><code>pcstat</code>: A tool that inspects which pages of a file or files are being cached by the Linux kernel.</li>
<li><code>sysstat</code> and <code>sar</code>: Utilities to monitor system performance and usage activity. Installing sysstat also installs sar.</li>
<li><code>systemtap</code> and <code>crash</code>: The systemtap utility is a programmable instrumentation system for diagnosing problems of performance or function. Installing systemtap also installs crash, which is a kernel crash analysis utility for live systems and dump files.</li>
<li><code>dstat</code>: versatile tool for viewing and analyzing statistics about system resources.</li>
</ul>
<p>The <code>dstat</code> tool, for example, can help troubleshoot system performance. The tool shows a live, running list of statistics about system resources: </p>
<pre><code>dstat
You did not select any stats, using -cdngy by default.
----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw
  1   0  98   1   0   0|4036B   42k|   0     0 |   0     0 |  95   276
  1   0  98   1   0   0|   0    64k|  60B  940B|   0     0 | 142   320
  1   1  98   0   0   0|   0    52k|  60B  476B|   0     0 | 149   385
</code></pre><h3 id="linux-troubleshooting-tools-not-on-photon-os">Linux Troubleshooting Tools Not on Photon OS</h3>
<p>The following Linux troubleshoot tools are neither installed on Photon OS by default nor available in the Photon OS repositories: </p>
<ul>
<li>iostat</li>
<li>telnet (use SSH instead)</li>
<li>Iprm</li>
<li>hdparm</li>
<li>syslog (use journalctl instead)</li>
<li>ddd</li>
<li>ksysmoops</li>
<li>xev</li>
<li>GUI tools (because Photon OS has no GUI)</li>
</ul>
<h2 id="systemd">Systemd</h2>
<p>Photon OS manages services with systemd and its command-line utility for inspecting and controlling the system, <code>systemctl</code>, not the deprecated commands of init.d. For example, instead of running the /etc/init.d/ssh script to stop and start the OpenSSH server on a init.d-based Linux system, you control the service by running the following systemctl commands on Photon OS: </p>
<pre><code>systemctl stop sshd
systemctl start sshd
</code></pre><p>For an overview of systemd, see <a href="https://www.freedesktop.org/wiki/Software/systemd/" target="_blank">systemd System and Service Manager</a> and the <a href="https://www.freedesktop.org/software/systemd/man/systemd.html" target="_blank">man page for systemd</a>. The systemd man pages are listed at <a href="https://www.freedesktop.org/software/systemd/man/" target="_blank">https://www.freedesktop.org/software/systemd/man/</a>.</p>
<h3 id="viewing-services">Viewing Services</h3>
<p>To view a description of all the active, loaded units, execute the systemctl command without any options or arguments: </p>
<pre><code>systemctl
</code></pre><p>To see all the loaded, active, and inactive units and their description, run this command: </p>
<pre><code>systemctl --all
</code></pre><p>To see all the unit files and their current status but no description, run this command: </p>
<pre><code>systemctl list-unit-files
</code></pre><p>The <code>grep</code> command filters the services by a search term, a helpful tactic to recall the exact name of a unit file without looking through a long list of names. Example: </p>
<pre><code>systemctl list-unit-files | grep network
org.freedesktop.network1.busname           static
dbus-org.freedesktop.network1.service      enabled
systemd-networkd-wait-online.service       enabled
systemd-networkd.service                   enabled
systemd-networkd.socket                    enabled
network-online.target                      static
network-pre.target                         static
network.target  
</code></pre><h3 id="using-systemd-commands-instead-of-initd-commands">Using Systemd Commands Instead of Init.d Commands</h3>
<p>Basic system administration commands on Photon OS differ from those on operating systems that use SysVinit. Since Photon OS uses systemd instead of SysVinit, you must use systemd commands to manage services. </p>
<p>For example, to list all the services that you can manage on Photon OS, you run the following command instead of <code>ls /etc/rc.d/init.d/</code>: </p>
<pre><code>systemctl list-unit-files --type=service
</code></pre><p>Similarly, to check whether the <code>sshd</code> service is enabled, on Photon OS you run the following command instead of <code>chkconfig sshd</code>:</p>
<pre><code>systemctl is-enabled sshd
</code></pre><p>The <code>chkconfig --list</code> command that shows which services are enabled for which runlevel on a SysVinit computer becomes substantially different on Photon OS because there are no runlevels, only targets: </p>
<pre><code>ls /etc/systemd/system/*.wants
</code></pre><p>You can also display similar information with the following command: </p>
<pre><code>systemctl list-unit-files --type=service
</code></pre><p>Here is a list of some of the systemd commands that take the place of SysVinit commands on Photon OS: </p>
<pre><code>USE THIS SYSTEMD COMMAND     INSTEAD OF THIS SYSVINIT COMMAND
systemctl start sshd         service sshd start
systemctl stop sshd         service sshd stop
systemctl restart sshd         service sshd restart
systemctl reload sshd         service sshd reload
systemctl condrestart sshd     service sshd condrestart
systemctl status sshd         service sshd status
systemctl enable sshd         chkconfig sshd on
systemctl disable sshd         chkconfig sshd off
systemctl daemon-reload        chkconfig sshd --add
</code></pre><h3 id="analyzing-system-logs-with-journalctl">Analyzing System Logs with journalctl</h3>
<p>The journalctl tool queries the contents of the systemd journal. On Photon OS, all the system logs except the installation log and the cloud-init log are written into the systemd journal. </p>
<p>If called without parameters, the <code>journalctl</code> command shows all the contents of the journal, beginning with the oldest entry. To display the output in reverse order with new entries first, include the <code>-r</code> option in the command:</p>
<pre><code>journalctl -r
</code></pre><p>The <code>journalctl</code> command includes many options to filter its output. For help troubleshooting systemd, two journalctl queries are particularly useful: showing the log entries for the last boot and showing the log entries for a systemd service unit. This command displays the messages that systemd generated during the last time the machine started: </p>
<pre><code>journalctl -b
</code></pre><p>This command reveals the messages for only the systemd service unit specified by the <code>-u</code> option, which in the following example is the auditing service: </p>
<pre><code>journalctl -u auditd
</code></pre><p>You can look at the messages for systemd itself or for the network service:</p>
<pre><code>journalctl -u systemd
journalctl -u systemd-networkd
</code></pre><p>Example:  </p>
<pre><code>root@photon-1a0375a0392e [ ~ ]# journalctl -u systemd-networkd
-- Logs begin at Tue 2016-08-23 14:35:50 UTC, end at Tue 2016-08-23 23:45:44 UTC. --
Aug 23 14:35:52 photon-1a0375a0392e systemd[1]: Starting Network Service...
Aug 23 14:35:52 photon-1a0375a0392e systemd-networkd[458]: Enumeration completed
Aug 23 14:35:52 photon-1a0375a0392e systemd[1]: Started Network Service.
Aug 23 14:35:52 photon-1a0375a0392e systemd-networkd[458]: eth0: Gained carrier
Aug 23 14:35:53 photon-1a0375a0392e systemd-networkd[458]: eth0: DHCPv4 address 198.51.100.1
Aug 23 14:35:54 photon-1a0375a0392e systemd-networkd[458]: eth0: Gained IPv6LL
Aug 23 14:35:54 photon-1a0375a0392e systemd-networkd[458]: eth0: Configured
</code></pre><p>For more information, see <a href="https://www.freedesktop.org/software/systemd/man/journalctl.html" target="_blank">journalctl</a> or the journalctl man page by running this command: <code>man journalctl</code></p>
<h3 id="inspecting-services-with-systemd-analyze">Inspecting Services with <code>systemd-analyze</code></h3>
<p>The <code>systemd-analyze</code> command reveals performance statistics for boot times, traces system services, and verifies unit files. It can help troubleshoot slow system boots and incorrect unit files. See the man page for a list of options. Examples:</p>
<pre><code>systemd-analyze blame

systemd-analyze dump
</code></pre><h2 id="networking">Networking</h2>
<h3 id="managing-the-network-configuration">Managing the Network Configuration</h3>
<p>The network service, which is enabled by default, starts when the system boots. You manage the network service by using systemd commands, such as systemd-networkd, systemd-resolvd, and networkctl. You can check its status of the network service by running the following command: </p>
<pre><code>systemctl status systemd-networkd
</code></pre><p>Here is a healthy result of the command: </p>
<pre><code>* systemd-networkd.service - Network Service
   Loaded: loaded (/usr/lib/systemd/system/systemd-networkd.service; enabled; vendor preset: enabled)
   Active: active (running) since Fri 2016-04-29 15:08:51 UTC; 6 days ago
     Docs: man:systemd-networkd.service(8)
 Main PID: 291 (systemd-network)
   Status: &quot;Processing requests...&quot;
   CGroup: /system.slice/systemd-networkd.service
           `-291 /lib/systemd/systemd-networkd
</code></pre><p>Because Photon OS relies on systemd to manage services, you should employ the systemd suite of commands, not deprecated init.d commands or other deprecated commands, to manage networking. </p>
<h3 id="use-ip-and-ss-commands-instead-of-ifconfig-and-netstat">Use <code>ip</code> and <code>ss</code> Commands Instead of <code>ifconfig</code> and <code>netstat</code></h3>
<p>Although the <code>ifconfig</code> command and the <code>netstat</code> command work on Photon OS, VMware recommends that you use the <code>ip</code> or <code>ss</code> commands. The <code>ifconfig</code> and <code>netstat</code> commands are deprecated. </p>
<p>For example, instead of running <code>netstat</code> to display a list of network interfaces, consider running the <code>ss</code> command. Similarly, to display information for IP addresses, instead of running <code>ifconfig -a</code>, run the <code>ip addr</code> command. Examples:</p>
<pre><code>USE THIS IPROUTE COMMAND     INSTEAD OF THIS NET-TOOL COMMAND
ip addr                     ifconfig -a
ss                             netstat
ip route                     route
ip maddr                     netstat -g
ip link set eth0 up         ifconfig eth0 up
ip -s neigh                    arp -v
ip link set eth0 mtu 9000    ifconfig eth0 mtu 9000
</code></pre><p>Using the <code>ip route</code> version of a command instead of the net-tools version often provides more complete, accurate information on Photon OS, as the following example demonstrates: </p>
<pre><code>ip neigh
198.51.100.2 dev eth0 lladdr 00:50:56:e2:02:0f STALE
198.51.100.254 dev eth0 lladdr 00:50:56:e7:13:d9 STALE
198.51.100.1 dev eth0 lladdr 00:50:56:c0:00:08 DELAY

arp -a
? (198.51.100.2) at 00:50:56:e2:02:0f [ether] on eth0
? (198.51.100.254) at 00:50:56:e7:13:d9 [ether] on eth0
? (198.51.100.1) at 00:50:56:c0:00:08 [ether] on eth0
</code></pre><p><strong>Important:</strong> If you modify an IPv6 configuration or add an IPv6 interface, you must restart <code>systemd-networkd</code>. Traditional methods of using <code>ifconfig</code> commands will be inadequate to register the changes. Run the following command instead: </p>
<pre><code>systemctl restart systemd-networkd
</code></pre><h3 id="inspecting-the-status-of-network-links-with-networkctl">Inspecting the Status of Network Links with <code>networkctl</code></h3>
<p>The <code>networkctl</code> command shows information about network connections that helps you configure networking services and troubleshoot networking problems. You can, for example, progressively add options and arguments to the <code>networkctl</code> command to move from general information about network connections to specific information about a network connection. </p>
<p>Running <code>networkctl</code> without options defaults to the list command:  </p>
<pre><code>networkctl
IDX LINK             TYPE               OPERATIONAL SETUP
  1 lo               loopback           carrier     unmanaged
  2 eth0             ether              routable    configured
  3 docker0          ether              routable    unmanaged
 11 vethb0aa7a6      ether              degraded    unmanaged
 4 links listed.
</code></pre><p>Running <code>networkctl</code> with the status command displays information that looks like this; you can see there are active network links with IP addresses for not only the Ethernet connection but also a Docker container. </p>
<pre><code>root@photon-rc [ ~ ]# networkctl status
*      State: routable
     Address: 198.51.100.131 on eth0
              172.17.0.1 on docker0
              fe80::20c:29ff:fe55:3ca6 on eth0
              fe80::42:f0ff:fef7:bd81 on docker0
              fe80::4c84:caff:fe76:a23f on vethb0aa7a6
     Gateway: 198.51.100.2 on eth0
         DNS: 198.51.100.2
</code></pre><p>You can then add a network link, such as the Ethernet connection, as the argument of the status command to show specific information about the link: </p>
<pre><code>root@photon-rc [ ~ ]# networkctl status eth0
* 2: eth0
       Link File: /usr/lib/systemd/network/99-default.link
    Network File: /etc/systemd/network/10-dhcp-en.network
            Type: ether
           State: routable (configured)
            Path: pci-0000:02:01.0
          Driver: e1000
      HW Address: 00:0c:29:55:3c:a6 (VMware, Inc.)
             MTU: 1500
         Address: 198.51.100.131
                  fe80::20c:29ff:fe55:3ca6
         Gateway: 198.51.100.2
             DNS: 198.51.100.2
        CLIENTID: ffb6220feb00020000ab116724f520a0a77337
</code></pre><p>And you can do the same thing with the Docker container: </p>
<pre><code>networkctl status docker0
* 3: docker0
       Link File: /usr/lib/systemd/network/99-default.link
    Network File: n/a
            Type: ether
           State: routable (unmanaged)
          Driver: bridge
      HW Address: 02:42:f0:f7:bd:81
             MTU: 1500
         Address: 172.17.0.1
                  fe80::42:f0ff:fef7:bd81
</code></pre><p>In the example above, it is OK that the state of the Docker container is unmanaged; Docker handles managing the networking for the containers without using systemd-resolved or systemd-networkd. Instead, Docker manages the container&apos;s connection by using its bridge drive.</p>
<p>For more information about <code>networkctl</code> commands and options, see <a href="https://www.freedesktop.org/software/systemd/man/networkctl.html" target="_blank">https://www.freedesktop.org/software/systemd/man/networkctl.html</a>.</p>
<h3 id="turning-on-network-debugging">Turning on Network Debugging</h3>
<p>You can set <code>systemd-networkd</code> to work in debug mode so that you can analyze log files with debugging information to help troubleshoot networking problems. The following procedure turns on network debugging by adding a drop-in file in /etc/systemd to customize the default systemd configuration in /usr/lib/systemd. </p>
<p>First, run the following command as root to create a directory with this exact name, including the <code>.d</code> extension:</p>
<pre><code>mkdir -p /etc/systemd/system/systemd-networkd.service.d/
</code></pre><p>Second, run the following command as root to establish a systemd drop-in unit with a debugging configuration for the network service:</p>
<pre><code>cat &gt; /etc/systemd/system/systemd-networkd.service.d/10-loglevel-debug.conf &lt;&lt; &quot;EOF&quot;
[Service]
Environment=SYSTEMD_LOG_LEVEL=debug
EOF
</code></pre><p>You must reload the systemctl daemon and restart the systemd-networkd service for the changes to take effect: </p>
<pre><code>systemctl daemon-reload
systemctl restart systemd-networkd
</code></pre><p>Verify that your changes took effect:</p>
<pre><code>systemd-delta --type=extended
</code></pre><p>View the log files by running this command: </p>
<pre><code>journalctl -u systemd-networkd
</code></pre><p>When you are finished debugging the network connections, turn debugging off by deleting the drop-in file: </p>
<pre><code>rm /etc/systemd/system/systemd-networkd.service.d/10-loglevel-debug.conf
</code></pre><h3 id="installing-the-packages-for-tcpdump-and-netcat-with-tdnf">Installing the Packages for tcpdump and netcat with tdnf</h3>
<p>The minimal version of Photon OS leaves out several useful networking tools to keep the operating system lean. Tcpdump, for example, is absent in the minimal version but available in the repository. The minimal version does, however, include the iproute2 tools by default. </p>
<p>Tcpdump captures and analyzes packets on a network interface. On Photon OS, you install tcpdump and its accompanying package libpcap, a C/C++ library for capturing network traffic, by using tdnf, Photon&apos;s command-line package manager: </p>
<pre><code>tdnf install tcpdump
</code></pre><p>Netcat, a tool for sending data over network connections with TCP or UDP, appears in neither the minimal nor the full version of Photon OS. But since netcat furnishes powerful options for analyzing, troubleshooting, and debugging network connections, you might want to install it. To do so, run the following command: </p>
<pre><code>tdnf install netcat
</code></pre><h3 id="checking-firewall-rules">Checking Firewall Rules</h3>
<p>The design of Photon OS emphasizes security. On the minimal and full versions of Photon OS, the default security policy turns on the firewall and drops packets from external interfaces and  applications. As a result, you might need to add rules to iptables to permit forwarding, allow protocols like HTTP, and open ports. In other words, you must configure the firewall for your applications and requirements. </p>
<p>The default iptables settings on the full version look like this:</p>
<pre><code>iptables --list
Chain INPUT (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh

Chain FORWARD (policy DROP)
target     prot opt source               destination

Chain OUTPUT (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
</code></pre><p>To find out how to adjust the settings, see the man page for iptables. </p>
<p>Although the default iptables policy accepts SSH connections, the <code>sshd</code> configuration file on the full version of Photon OS  is set to reject SSH connections. See <a href="#permitting-root-login-with-ssh">Permitting Root Login with SSH</a>.</p>
<p>If you are unable to ping a Photon OS machine, one of the first things you should do is check the firewall rules. Do they allow connectivity for the port and protocol in question? You can supplement the <code>iptables</code> commands by using <code>lsof</code> to, for instance, see the processes listening on ports: </p>
<pre><code>lsof -i -P -n
</code></pre><h3 id="netmgr">Netmgr</h3>
<p>If you are running a VMware appliance on Photon OS and the VAMI module has problems or if there are networking issues, you can use the Photon OS <code>netmgr</code> utility to inspect the networking settings. Make sure, in particular, that the IP addresses for the DNS server and other infrastructure are correct. Use <code>tcpdump</code> to analyze the issues. </p>
<p>If you get an error code from netmgr, it is a standard Unix error code--enter it into a search engine to obtain more information.</p>
<h2 id="file-system">File System</h2>
<p>This section covers troubleshooting the file system.</p>
<h3 id="checking-disk-space">Checking Disk Space</h3>
<p>One of the first simple steps to take when you&apos;re troubleshooting is to check how much disk space is available by running the <code>df</code> command: </p>
<pre><code>df -h
</code></pre><h3 id="adding-a-disk-and-partitioning-it">Adding a Disk and Partitioning It</h3>
<p>If the <code>df</code> command shows that the file system is indeed nearing capacity, you can add a new disk on the fly and partition it to increase capacity. </p>
<p>First, add a new disk. You can, for example, add a new disk to a virtual machine by using the VMware vSphere Client. After adding a new disk, check for the new disk by using <code>fdisk</code>; see the section on <code>fdisk</code> below. In the following example, the new disk is named <code>/dev/sdb</code>:</p>
<pre><code>fdisk -l
Device        Start      End  Sectors Size Type
/dev/sda1      2048 16771071 16769024   8G Linux filesystem
/dev/sda2  16771072 16777182     6111   3M BIOS boot

Disk /dev/sdb: 1 GiB, 1073741824 bytes, 2097152 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
</code></pre><p>After you confirm that Photon OS registers the new disk, you can partition it with the <code>parted</code> wizard. The command to partition the disk on Photon OS is as follows: </p>
<pre><code>parted /dev/sdb
</code></pre><p>And then you use the parted wizard to create it (see the man page for <code>parted</code> for more information):</p>
<pre><code>mklabel gpt
mkpart ext3 1 1024
</code></pre><p>Then you must create a file system on the partition:</p>
<pre><code>mkfs -t ext3 /dev/sdb1
</code></pre><p>Make a directory where you will mount the new file system: </p>
<pre><code>mkdir /newdata
</code></pre><p>Finally, open <code>/etc/fstab</code> and add the new file system with the options that you want: </p>
<pre><code>#system mnt-pt  type    options dump    fsck
/dev/sda1       /       ext4    defaults,barrier,noatime,noacl,data=ord$
/dev/cdrom      /mnt/cdrom      iso9660 ro,noauto       0       0
/dev/sdb1       /newdata        ext3    defaults        0        0
</code></pre><p>Mount it for now: </p>
<pre><code>mount /newdata
</code></pre><p>Check your work: </p>
<pre><code>df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root       7.8G  4.4G  3.1G  59% /
devtmpfs        172M     0  172M   0% /dev
tmpfs           173M     0  173M   0% /dev/shm
tmpfs           173M  664K  172M   1% /run
tmpfs           173M     0  173M   0% /sys/fs/cgroup
tmpfs           173M   36K  173M   1% /tmp
tmpfs            35M     0   35M   0% /run/user/0
/dev/sdb1       945M  1.3M  895M   1% /newdata
</code></pre><h3 id="expanding-disk-partition">Expanding Disk Partition</h3>
<p>If you need more space, you can expand the last partition of your disk after resizing the disk. In the examples we are assuming <code>sda</code> as disk device.</p>
<p>After the disk is resized in the virtual machine, it&apos;s necessary to tell the system to recognize the new disk ending boundary without rebooting:</p>
<pre><code>echo 1 &gt; /sys/class/block/sda/device/rescan
</code></pre><p>You will need to install the parted package to resize the disk partition, which is not available by default. Just run the following command to install it: <code>tdnf install parted</code>.</p>
<pre><code># parted /dev/sda
GNU Parted 3.2
Using /dev/sda
Welcome to GNU Parted! Type &apos;help&apos; to view a list of commands.
</code></pre><p>List all partitions available to fix the GPT and check the last partition number:</p>
<pre><code>(parted) print

Warning: Not all of the space available to /dev/sda appears to be used, you can
fix the GPT to use all of the space (an extra 4194304 blocks) or continue with
the current setting? 
Fix/Ignore?
</code></pre><p>Press <code>f</code> to fix the GPT layout.</p>
<pre><code>Model: VMware Virtual disk (scsi)
Disk /dev/sda: 34.4GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name  Flags
1      1049kB  3146kB  2097kB                     bios_grub
2      3146kB  8590MB  8587MB  ext4
</code></pre><p>In this case we have the partition <code>2</code> as last, then we extend the partition to 100% of the remaining size:</p>
<pre><code>(parted) resizepart 2 100%
</code></pre><p>Finally, expand the filesystem to the new size:</p>
<pre><code>resize2fs /dev/sda2
resize2fs 1.42.13 (17-May-2015)
Filesystem at /dev/sda2 is mounted on /; on-line resizing required
old_desc_blocks = 1, new_desc_blocks = 2
The filesystem on /dev/sda2 is now 8387835 (4k) blocks long.
</code></pre><p>The new space is already available in the system:</p>
<pre><code>df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root        32G  412M   30G   2% /
devtmpfs       1001M     0 1001M   0% /dev
tmpfs          1003M     0 1003M   0% /dev/shm
tmpfs          1003M  252K 1003M   1% /run
tmpfs          1003M     0 1003M   0% /sys/fs/cgroup
tmpfs          1003M     0 1003M   0% /tmp
tmpfs           201M     0  201M   0% /run/user/0
</code></pre><h3 id="fdisk">fdisk</h3>
<p>The <code>fdisk</code> command manipulates the disk partition table. You can, for example, use <code>fdisk</code> to list the disk partitions so that you can identify the root Linux file system. Here is an truncated example showing <code>/dev/sda1</code> to be the root Linux partition: </p>
<pre><code>fdisk -l
Disk /dev/ram0: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
...
Disk /dev/sda: 8 GiB, 8589934592 bytes, 16777216 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 3CFA568B-2C89-4290-8B52-548732A3972D

Device        Start      End  Sectors Size Type
/dev/sda1      2048 16771071 16769024   8G Linux filesystem
/dev/sda2  16771072 16777182     6111   3M BIOS boot
</code></pre><p>Remember the <code>fdisk -l</code> command--it will be used later in a section that demonstrates how to reset a lost root password. </p>
<h3 id="fsck">fsck</h3>
<p>The Photon OS file system includes btrfs and ext4. The default root file system is ext4, which you can see by looking at the file system configuration file, <code>/etc/fstab</code>: </p>
<pre><code>cat /etc/fstab
#system mnt-pt  type    options dump    fsck
/dev/sda1       /       ext4    defaults,barrier,noatime,noacl,data=ordered     1       1
/dev/cdrom      /mnt/cdrom      iso9660 ro,noauto       0       0
</code></pre><p>The <code>1</code> in the fifth column, under <code>fsck</code>, indicates that fsck checks the file system when the system boots.</p>
<p>You can manually check the file system by using the file system consistency check tool, <code>fsck</code>, after you unmount the file system. You can also perform a read-only check without unmounting it:</p>
<pre><code>fsck -nf /dev/sda1
fsck from util-linux 2.27.1
e2fsck 1.42.13 (17-May-2015)
Warning!  /dev/sda1 is mounted.
Warning: skipping journal recovery because doing a read-only filesystem check.
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
Free blocks count wrong (1439651, counted=1423942).
Fix? no
Free inodes count wrong (428404, counted=428397).
Fix? no
/dev/sda1: 95884/524288 files (0.3% non-contiguous), 656477/2096128 blocks
</code></pre><p>The inodes count is probably off because the file system is mounted and in use. To fix problems, you must first unmount the file system and then run fsck again: </p>
<pre><code>umount /dev/sda1
umount: /: target is busy
        (In some cases useful info about processes that
         use the device is found by lsof(8) or fuser(1).)
</code></pre><p>So check it with <code>lsof</code>:</p>
<pre><code>lsof | grep ^jbd2/sd
jbd2/sda1   99                root  cwd       DIR                8,1     4096          2 /
jbd2/sda1   99                root  rtd       DIR                8,1     4096          2 /
jbd2/sda1   99                root  txt   unknown                                        /proc/99/exe
</code></pre><p>The file system is indeed in use. What troubleshooting tool would you use next to further explore the applications or processes that are using the file system?  </p>
<h3 id="fixing-file-system-errors-when-fsck-fails">Fixing File System Errors When fsck Fails</h3>
<p>A potential issue is that when <code>fsck</code> runs during startup, it finds a problem that prevents the system from fully booting until you fix the issue by running fsck manually. This kind of a problem can occur when Photon OS is the operating system for a VM running an appliance. </p>
<p>If fsck fails when the computer boots and an error message says to run fsck manually, you can troubleshoot by restarting the VM, altering the GRUB edit menu to enter emergency mode before Photon OS fully boots, and running fsck.</p>
<ol>
<li><p>Take a snapshot of the virtual machine. </p>
</li>
<li><p>Restart the virtual machine running Photon OS. </p>
</li>
<li><p>When the Photon OS splash screen appears as it restarts, type the letter <code>e</code> to go to the GNU GRUB edit menu. Be quick about it: Because Photon OS reboots so quickly, you won&apos;t have much time to type <code>e</code>. Remember that in VMware vSphere or VMware Workstation Pro, you might have to give the console focus by clicking in its window before it will register input from the keyboard. </p>
</li>
<li><p>In the GNU GRUB edit menu, go to the end of the line that starts with <code>linux</code>, add a space, and then add the following code exactly as it appears below:</p>
<p> <code>systemd.unit=emergency.target</code></p>
</li>
<li><p>Type <code>F10</code>.</p>
</li>
<li><p>In the bash shell, run one of the following commands to fix the file system errors, depending on whether <code>sda1</code> or <code>sda2</code> represents the root file system: </p>
<p> <code>e2fsck -y /dev/sda1</code></p>
<p> or</p>
<p> <code>e2fsck -y /dev/sda2</code></p>
</li>
<li><p>Restart the virtual machine.</p>
</li>
</ol>
<h2 id="packages">Packages</h2>
<p>On Photon OS, tdnf is the default package manager. The standard syntax for <code>tdnf</code> commands is the same as that for DNF and Yum: </p>
<pre><code>tdnf [options] &lt;command&gt; [&lt;arguments&gt;...]
</code></pre><p>The main configuration files reside in <code>/etc/tdnf/tdnf.conf</code>. The repositories appear in <code>/etc/yum.repos.d/</code> with <code>.repo</code> file extensions. For more information, see the <a href="https://github.com/vmware/photon/blob/master/docs/photon-admin-guide.md" target="_blank">Photon OS Administration Guide</a>.</p>
<p>The cache files for data and metadata reside in <code>/var/cache/tdnf</code>. The local cache is populated with data from the repository: </p>
<pre><code>ls -l /var/cache/tdnf/photon
total 8
drwxr-xr-x 2 root root 4096 May 18 22:52 repodata
d-wxr----t 3 root root 4096 May  3 22:51 rpms
</code></pre><p>You can clear the cache to help troubleshoot a problem, but keep in mind that doing so might slow the performance of tdnf until the cache becomes repopulated with data. Cleaning the cache can remove stale information. Here is how to clear the cache: </p>
<pre><code>tdnf clean all
Cleaning repos: photon photon-extras photon-updates lightwave
Cleaning up everything
</code></pre><p>Some tdnf commands can help you troubleshoot problems with packages:</p>
<p><code>makecache</code>: This command updates the cached binary metadata for all known repositories. You can run it after you clean the cache to make sure you are working with the latest repository data as you troubleshoot. Example:</p>
<pre><code>tdnf makecache
Refreshing metadata for: &apos;VMware Lightwave 1.0(x86_64)&apos;
Refreshing metadata for: &apos;VMware Photon Linux 1.0(x86_64)Updates&apos;
Refreshing metadata for: &apos;VMware Photon Extras 1.0(x86_64)&apos;
Refreshing metadata for: &apos;VMware Photon Linux 1.0(x86_64)&apos;
Metadata cache created.
</code></pre><p><code>tdnf check-local</code>: This command resolves dependencies by using the local RPMs to help check RPMs for quality assurance before publishing them. To check RPMs with this command, you must create a local directory and place your RPMs in it. The command, which includes no options, takes the path to the local directory containing the RPMs as its argument. The command does not, however, recursively parse directories; it checks the RPMs only in the directory that you specify. For example, after creating a directory named <code>/tmp/myrpms</code> and placing your RPMs in it, you can run the following command to check them:  </p>
<pre><code>tdnf check-local /tmp/myrpms
Checking all packages from: /tmp/myrpms
Found 10 packages
Check completed without issues
</code></pre><p><code>tdnf provides</code>: This command finds the packages that provide the package that you supply as an argument. If you are used to a package name for another system, you can use <code>tdnf provides</code> to find the corresponding name of the package on Photon OS. Example: </p>
<pre><code>tdnf provides docker
docker-1.11.0-1.ph1.x86_64 : Docker
Repo     : photon
docker-1.11.0-1.ph1.x86_64 : Docker
Repo     : @System
</code></pre><p>For a file, you must provide the full path. Here&apos;s an example: </p>
<pre><code>tdnf provides /usr/include/stdio.h
glibc-devel-2.22-8.ph1.x86_64 : Header files for glibc
Repo     : photon
glibc-devel-2.22-8.ph1.x86_64 : Header files for glibc
Repo     : @System
</code></pre><p>Here&apos;s an example that shows you how to find the package that provides a pluggable authentication module, which you might need to find if the system is mishandling passwords. </p>
<pre><code>tdnf provides /etc/pam.d/system-account
shadow-4.2.1-7.ph1.x86_64 : Programs for handling passwords in a secure way
Repo     : photon
shadow-4.2.1-8.ph1.x86_64 : Programs for handling passwords in a secure way
Repo     : photon-updates
</code></pre><p>Additional commands appear in the <a href="https://github.com/vmware/photon/blob/master/docs/photon-admin-guide.md" target="_blank">Photon OS Administration Guide</a>.</p>
<p>If you find a package that is installed but is not working, try re-installing it; example: </p>
<pre><code>tdnf reinstall shadow
Reinstalling:
shadow     x86_64     4.2.1-7.ph1   3.85 M
</code></pre><h2 id="kernel-problems-and-boot-and-login-problems">Kernel Problems and Boot and Login Problems</h2>
<h3 id="kernel-overview">Kernel Overview</h3>
<p>Photon OS 1.0 uses Linux kernel version 4.4. Troubleshooting kernel problems starts with <code>dmesg</code>. The <code>dmesg</code> command prints messages from the kernel ring buffer. The following command, for example, presents kernel messages in a human-readable format: </p>
<pre><code>dmesg --human --kernel
</code></pre><p>To examine kernel messages as you perform actions, such as reproducing a problem, in another terminal, you can run the command with the <code>--follow</code> option, which waits for new messages and prints them as they occur: </p>
<pre><code>dmesg --human --kernel --follow
</code></pre><p>The kernel buffer is limited in memory size. As a result, the kernel cyclically overwrites the end of the information in the buffer from which dmesg pulls information. The systemd journal, however, saves the information from the buffer to a log file so that you can access older information. To view it, run the following command: </p>
<pre><code>journalctl -k
</code></pre><p>If need be, you can check the modules that are loaded on your Photon OS machine by running the <code>lsmod</code> command; truncated example:  </p>
<pre><code>lsmod
Module                  Size  Used by
vmw_vsock_vmci_transport    28672  1
vsock                  36864  2 vmw_vsock_vmci_transport
coretemp               16384  0
hwmon                  16384  1 coretemp
crc32c_intel           24576  0
hid_generic            16384  0
usbhid                 28672  0
hid                   106496  2 hid_generic,usbhid
xt_conntrack           16384  1
iptable_nat            16384  0
nf_conntrack_ipv4      16384  2
nf_defrag_ipv4         16384  1 nf_conntrack_ipv4
nf_nat_ipv4            16384  1 iptable_nat
nf_nat                 24576  1 nf_nat_ipv4
iptable_filter         16384  1
ip_tables              24576  2 iptable_filter,iptable_nat
</code></pre><h3 id="boot-process-overview">Boot Process Overview</h3>
<p>When a Photon OS machine boots, the BIOS initializes the hardware and uses a boot loader to start the kernel. After the kernel starts, systemd takes over and boots the rest of the operating system. </p>
<p>More specifically, the BIOS checks the memory and initializes the keyboard, the screen, and other peripherals. When the BIOS finds the first hard disk, the boot loader--GNU GRUB 2.02--takes over. From the hard disk, GNU GRUB loads the master boot record (MBR) and initializes the root partition of the random-access memory by using initrd. The device manager, udev, provides initrd with the drivers it needs to access the device containing the root file system. Here&apos;s what the GNU GRUB edit menu looks like in Photon OS with its default commands to load the boot record and initialize the RAM disk: </p>
<p><img src="images/grub-edit-menu-orig.png" alt="The GNU GRUB edit menu in the full and minimal versions of Photon OS">  </p>
<p>At this point, the Linux kernel in Photon OS, which is kernel version 4.4.8, takes control. Systemd kicks in, initializes services in parallel, mounts the rest of the file system, and checks the file system for errors. </p>
<h3 id="blank-screen-on-reboot">Blank Screen on Reboot</h3>
<p>If the Photon OS kernel enters a state of panic during a reboot and all you see is a blank screen, note the name of the virtual machine running Photon OS and then power off the VM. </p>
<p>In the host, open the <code>vmware.log</code> file for the VM. When a kernel panics, the guest VM prints the entire kernel log in  <code>vmware.log</code> in the host&apos;s directory containing the VM. This log file contains the output of the <code>dmesg</code> command from the guest, and you can analyze it to help identify the cause of the boot problem. </p>
<p>Here&apos;s an example. After searching for <code>Guest:</code> in the following abridged <code>vmware.log</code>, this line appears, identifying the root cause of the reboot problem: </p>
<pre><code>2016-08-30T16:02:43.220-07:00| vcpu-0| I125: Guest: 
&lt;0&gt;[1.125804] Kernel panic - not syncing: 
VFS: Unable to mount root fs on unknown-block(0,0)
</code></pre><p>Further inspection finds the following lines: </p>
<pre><code>2016-08-30T16:02:43.217-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125782] VFS: Cannot open root device &quot;sdc1&quot; or unknown-block(0,0): error -6
2016-08-30T16:02:43.217-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125783] Please append a correct &quot;root=&quot; boot option; 
here are the available partitions: 
2016-08-30T16:02:43.217-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125785] 0100            4096 ram0  (driver?)
...
0800         8388608 sda  driver: sd
2016-08-30T16:02:43.220-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125802]   0801         8384512 sda1 611e2d9a-a3da-4ac7-9eb9-8d09cb151a93
2016-08-30T16:02:43.220-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125803]   0802            3055 sda2 8159e59c-b382-40b9-9070-3c5586f3c7d6
</code></pre><p>In this unlikely case, the GRUB configuration points to a root device named <code>sdc1</code> instead of the correct root device, <code>sda1</code>. You can fix the problem by restoring the GRUB GNU edit screen and the GRUB configuration file (<code>/boot/grub/grub.cfg</code>) to their original configurations. </p>
<h3 id="investigating-strange-behavior">Investigating Strange Behavior</h3>
<p>If you rebooted to address strange behavior before the reboot of if you encountered strange behavior during the reboot but have reached the shell, you should analyze what happened since the previous boot. Start broad by running the following command to check the logs: </p>
<pre><code>journalctl
</code></pre><p>Next, run the following command to look at what happened since the penultimate reboot: </p>
<pre><code>journalctl --boot=-1
</code></pre><p>Then look at the log from the reboot: </p>
<pre><code>journalctl -b
</code></pre><p>If need be, examine the logs for the kernel: </p>
<pre><code>journalctl -k
</code></pre><p>Check which kernel is in use:</p>
<pre><code>uname -r
</code></pre><p>The kernel version of Photon OS in the full version is 4.4.8. The kernel version of in the OVA version is 4.4.8-esx. With the ESX version of the kernel, some services might not start. Run this command to check the overall status of services: </p>
<pre><code>systemctl status 
</code></pre><p>If a service is in red, check it: </p>
<pre><code>systemctl status service-name
</code></pre><p>Start it if need be: </p>
<pre><code>systemctl start service-name
</code></pre><p>If looking at the journal and checking the status of services gets you nowhere, run the following <code>systemd-analyze</code> commands to examine the boot time and the speed with which services start.</p>
<pre><code>systemd-analyze time
systemd-analyze blame
systemd-analyze critical-chain
</code></pre><p>Keep in mind that the output of these commands might be misleading because one service might just be waiting for another service to finish initializing.</p>
<h3 id="investigating-the-guest-kernel-when-you-cannot-log-on">Investigating the Guest Kernel When You Cannot Log On</h3>
<p>If a VM running Photon OS and an application or virtual appliance is behaving so oddly that, for example, you cannot log on to the machine, you can still troubleshoot by extracting the kernel logs from the guest&apos;s memory and analyzing them with <code>gdb</code>. </p>
<p>This advanced troubleshooting method works when you are running Photon OS as the operating system for an application or appliance on VMware Workstation, Fusion, or ESXi. This approach assumes that the virtual machine running Photon OS is functioning normally. </p>
<p>This troubleshooting method has the following requirements: </p>
<ul>
<li>Root access to a Linux machine other than the one you are troubleshooting. It can be another Photon OS machine, Ubuntu, or another Linux variant. </li>
<li>The <code>vmss2core</code> utility from VMware. It is installed by default in VMware Workstation and some other VMware products. If your system doesn&apos;t already contain it, you can download it for free from <a href="https://labs.vmware.com/flings/vmss2core" target="_blank">https://labs.vmware.com/flings/vmss2core</a>.</li>
<li>A local copy of the Photon OS ISO of the exact same version and release number as the Photon OS machine that you are troubleshooting. </li>
</ul>
<p>The process to use this troubleshooting method varies by environment. The examples in this section assume that the troublesome Photon OS virtual machine is running in VMware Workstation 12 Pro on a Microsoft Windows 8 Enterprise host. The examples also use an additional, fully functional Photon OS virtual machine running in Workstation.</p>
<p>You can, however, use other hosts, hypervisors, and operating systems--but you will have to adapt the example process below to them. Directory paths, file names, and other aspects might be different on other systems. </p>
<p><strong>Overview</strong>   </p>
<p>The process to apply this troubleshooting method goes like this: On a local computer, you open a file on the Photon OS ISO that contains Linux debugging information. Then you suspend the troublesome Photon OS VM and extract the kernel memory logs from the VMware hypervisor running Photon OS. </p>
<p>Next, you use the vmss2core tool to convert the memory logs into core dump files. The vmss2core utility converts VMware checkpoint state files into formats that third-party debugging tools understand. It can handle both suspend (.vmss) and snapshot (.vmsn) checkpoint state files (hereafter referred to as a <em>vmss file</em>) as well as monolithic and non-monolithic (separate .vmem file) encapsulation of checkpoint state data. See <a href="http://www.vmware.com/pdf/snapshot2core_technote.pdf" target="_blank">Debugging Virtual Machines with the Checkpoint to Core Tool</a>.</p>
<p>Finally, you prepare to run the gdb tool by using the debug info file from the ISO to create a <code>.gdbinit</code> file, which you can then analyze with the gdb shell on your local Linux machine.</p>
<p>All three components must be in the same directory on a Linux machine.  </p>
<p><strong>Process</strong></p>
<p>First, obtain a local copy of the Photon OS ISO of the exact same version and release number as the Photon OS machine that you are troubleshooting and mount the ISO on a Linux machine (or open it on a Windows machine):</p>
<pre><code>mount /mnt/cdrom
</code></pre><p>Second, locate the following file. (If you opened the Photon OS ISO on a Windows computer, copy the following file to the root folder of a Linux machine.)</p>
<pre><code>/RPMS/x86_64/linux-debuginfo-4.4.8-6.ph1.x86_64.rpm
</code></pre><p>Third, on a Linux machine, run the following <code>rpm2cpio</code> command to convert the RPM file to a cpio file and to extract the contents of the RPM to the current directory:</p>
<pre><code>rpm2cpio /mnt/cdrom/RPMS/x86_64/linux-debuginfo-4.4.8-6.ph1.x86_64.rpm | cpio -idmv
</code></pre><p>From the extracted files, copy the following file to your current directory: </p>
<pre><code>cp usr/lib/debug/lib/modules/4.4.8/vmlinux-4.4.8.debug .
</code></pre><p>Run the following command to download the dmesg functions that will help extract the kernel log from the coredump: <!--    wget https://www.kernel.org/doc/Documentation/kdump/gdbmacros.txt
--></p>
<pre><code>wget https://github.com/vmware/photon/blob/master/tools/scripts/gdbmacros-for-linux.txt
</code></pre><p>Move the file as follows: </p>
<pre><code>mv gdbmacros-for-linux.txt .gdbinit
</code></pre><p>Next, switch to your host machine so you can get the kernel memory files from the VM. Suspend the troublesome VM and locate the <code>.vmss</code> and <code>.vmem</code> files in the virtual machine&apos;s directory on the host. Example: </p>
<pre><code>C:\Users\tester\Documents\Virtual Machines\VMware Photon 64-bit (7)&gt;dir
 Volume in drive C is Windows
 Directory of C:\Users\tester\Documents\Virtual Machines\VMware Photon 64-bit
 (7)
09/20/2016  12:22 PM    &lt;DIR&gt;          .
09/20/2016  12:22 PM    &lt;DIR&gt;          ..
09/19/2016  03:39 PM       402,653,184 VMware Photon 64-bit (7)-f6b070cd.vmem
09/20/2016  12:11 PM         5,586,907 VMware Photon 64-bit (7)-f6b070cd.vmss
09/20/2016  12:11 PM     1,561,001,984 VMware Photon 64-bit (7)-s001.vmdk
...
09/20/2016  12:11 PM           300,430 vmware.log
...
</code></pre><p>Now that you have located the <code>.vmss</code> and <code>.vmem</code> files, convert them to one or more core dump files by using the vmss2core tool that comes with Workstation. Here is an example of how to run the command. Be careful with your pathing, escaping, file names, and so forth--all of which might be different from this example on your Windows machine. </p>
<pre><code>C:\Users\shoenisch\Documents\Virtual Machines\VMware Photon 64-bit (7)&gt;C:\&quot;Program Files (x86)\VMware\VMware Workstation&quot;\vmss2core.exe &quot;VMware Photon 64-bit (7)-f6b070cd.vmss&quot; &quot;VMware Photon 64-bit (7)-f6b070cd.vmem&quot;
</code></pre><p>The result of this command is one or more files with a <code>.core</code> extension plus a digit. Truncated example: </p>
<pre><code>C:\Users\tester\Documents\Virtual Machines\VMware Photon 64-bit (7)&gt;dir
 Directory of C:\Users\tester\Documents\Virtual Machines\VMware Photon 64-bit(7)
09/20/2016  12:22 PM       729,706,496 vmss.core0
</code></pre><p>Copy the <code>.core</code> file or files to the your current directory on the Linux machine where you so that you can analyze it with gdb. </p>
<p>Run the following <code>gdb</code> command to enter the gdb shell attached to the memory core dump file. You might have to change the name of the <code>vmss.core</code> file in the example to match your <code>.core</code> file:</p>
<pre><code>gdb vmlinux-4.4.8.debug vmss.core0

GNU gdb (GDB) 7.8.2
Copyright (C) 2014 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it. 
There is NO WARRANTY, to the extent permitted by law. ...
Type &quot;show configuration&quot; for configuration details.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at: &lt;http://www.gnu.org/software/gdb/documentation/&gt;.
For help, type &quot;help&quot;.
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
Reading symbols from vmlinux-4.4.8.debug...done.
warning: core file may not match specified executable file.
[New LWP 12345]
Core was generated by `GuestVM&apos;.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0xffffffff813df39a in insb (count=0, addr=0xffffc90000144000, port=&lt;optimized out&gt;)
    at arch/x86/include/asm/io.h:316
316     arch/x86/include/asm/io.h: No such file or directory.
(gdb)
</code></pre><p>In the results above, the <em>(gdb)</em> of the last line is the prompt of the gdb shell. You can now analyze the core dump by using commands like <code>bt</code> (to perform a backtrace) and <code>dmesg</code> (to view the Photon OS kernel log and see Photon OS kernel error messages). </p>
<h3 id="kernel-log-replication-with-vprobes">Kernel Log Replication with VProbes</h3>
<p>Replicating the Photon OS kernel logs on the VMware ESXi host is an advanced but powerful method of troubleshooting a kernel problem. This method is applicable when the virtual machine running Photon OS is hanging or inaccessible because, for instance, the hard disk has failed.</p>
<p>There is a prerequisite, however: You must have preemptively enabled the VMware VProbes facility on the VM before a problem rendered it inaccessible. You must also create a VProbes script on the ESXi host, but you can do that after the fact. </p>
<p>Although the foresight to implement these prerequisites might limit the application of this troubleshooting method for production systems, the method can be particularly useful in analyzing kernel issues when testing an application or appliance that is running on Photon OS.   </p>
<p>There are two similar ways in which you can replicate the Photon OS kernel logs on ESXi by using VProbes. The first modifies the VProbes script so that it works only for the VM that you set; it uses a hard-coded address. The second uses an abstraction instead of a hard-coded address so that the same VProbes script can be used for any VM on an ESXi host that you have enabled for VProbe and copied its kernel symbol table (kallsyms) to ESXi.</p>
<p>For more information on VMware VProbes, see <a href="https://labs.vmware.com/vmtj/vprobes-deep-observability-into-the-esxi-hypervisor" target="_blank">VProbes: Deep Observability Into the ESXi Hypervisor</a> and the <a href="http://www.vmware.com/pdf/ws7_f3_vprobes_reference.pdf" target="_blank">VProbes Programming Reference</a>.</p>
<p><strong>Using VProbes Script with a Hard-Coded Address</strong></p>
<p>Here&apos;s how to set a VProbe for an individual VM: </p>
<p>First, power off the VM so that you can turn on the VProbe facility. Edit the <code>.vmx</code> configuration file for the VM. The file resides in the directory that contains the VM in the ESXi data store. Add the following line of code to the <code>.vmx</code> file and then power the VM on: </p>
<pre><code>vprobe.enable = &quot;TRUE&quot;
</code></pre><p>When you edit the <code>.vmx</code> file to add the above line of code, you must first turn off the VM--otherwise, your changes will not persist. </p>
<p>Second, obtain the kernel log_store function address by connecting to the VM with SSH and running the following commands as root. (Photon OS uses the <code>kptr_restrict</code> setting to place restrictions on the kernel addresses exposed through <code>/proc</code> and other interfaces. This setting hides exposed kernel pointers to prevent attackers from exploiting kernel write vulnerabilities. When you are done using VProbes, you should return <code>kptr_restrict</code> to the original setting of <code>2</code> by rebooting.)</p>
<pre><code>echo 0 &gt; /proc/sys/kernel/kptr_restrict
grep log_store /proc/kallsyms
</code></pre><p>The output of the <code>grep</code> command will look similar to the following string. The first set of characters (without the <code>t</code>) is the log_store function address:</p>
<pre><code>ffffffff810bb680 t log_store
</code></pre><p>Third, connect to the ESXi host with SSH so that you can create a VProbes script. Here&apos;s the template for the script; <code>log_store</code> in the first line is a placeholder for the VM&apos;s log_store function address: </p>
<pre><code>GUEST:ENTER:log_store {
   string dst;
   getgueststr(dst, getguest(RSP+16) &amp; 0xff, getguest(RSP+8));
   printf(&quot;%s\n&quot;, dst);
}
</code></pre><p>On the ESXi host, create a new file, add the template to it, and then change <code>log_store</code> to the function address that was the output from the grep command on the VM. </p>
<p>You must add a <code>0x</code> prefix to the function address. In this example, the modified template looks like this: </p>
<pre><code>GUEST:ENTER:0xffffffff810bb680 {
   string dst;
   getgueststr(dst, getguest(RSP+16) &amp; 0xff, getguest(RSP+8));
   printf(&quot;%s\n&quot;, dst);
}
</code></pre><p>Save your VProbes script as <code>console.emt</code> in the <code>/tmp</code> directory. (The file extension for VProbe scripts is <code>.emt</code>.) </p>
<p>While still connected to the ESXi host with SSH, run the following command to obtain the ID of the virtual machine that you want to troubleshoot: </p>
<pre><code>vim-cmd vmsvc/getallvms
</code></pre><p>This command lists all the VMs running on the ESXi host. Find the VM you want to troubleshoot in the list and make a note of its ID. </p>
<p>Finally, run the following command to print all the kernel messages from Photon OS in your SSH console; replace <code>&lt;VM ID&gt;</code> with the ID of your VM:  </p>
<pre><code>vprobe -m &lt;VM ID&gt; /tmp/console.emt
</code></pre><p>When you&apos;re done, type <code>Ctrl-C</code> to stop the loop. </p>
<p><strong>A Reusable VProbe Script Using the kallsyms File</strong></p>
<p>Here&apos;s how to create one VProbe script and use for all the VMs on your ESXi host. </p>
<p>First, power off the VM and turn on the VProbe facility on each VM that you want to be able to analyze. Add <code>vprobe.enable = &quot;TRUE&quot;</code> to the VM&apos;s <code>.vmx</code> configuration file. See the instructions above. </p>
<p>Second, power on the VM, connect to it with SSH, and run the following command as root: </p>
<pre><code>echo 0 &gt; /proc/sys/kernel/kptr_restrict
</code></pre><p>Third, connect to the ESXi host with SSH to create the following VProbes script and save it as <code>/tmp/console.emt</code>:</p>
<pre><code>GUEST:ENTER:log_store {
   string dst;
   getgueststr(dst, getguest(RSP+16) &amp; 0xff, getguest(RSP+8));
   printf(&quot;%s\n&quot;, dst);
}
</code></pre><p>Fourth, from the ESXi host, run the following command to copy the VM&apos;s <code>kallysms</code> file to the <code>tmp</code> directory on the ESXi host: </p>
<pre><code>scp root@&lt;vm ip address&gt;:/proc/kallsyms /tmp
</code></pre><p>While still connected to the ESXi host with SSH, run the following command to obtain the ID of the virtual machine that you want to troubleshoot: </p>
<pre><code>vim-cmd vmsvc/getallvms
</code></pre><p>This command lists all the VMs running on the ESXi host. Find the VM you want to troubleshoot in the list and make a note of its ID. </p>
<p>Finally, run the following command to print all the kernel messages from Photon OS in your SSH console; replace <code>&lt;VM ID&gt;</code> with the ID of your VM. When you&apos;re done, type <code>Ctrl-C</code> to stop the loop.  </p>
<pre><code>vprobe -m &lt;VM ID&gt; -k /tmp/kallysyms /tmp/console.emt
</code></pre><p>You can use a directory other than <code>tmp</code> if you want.</p>
<!--
### Deep Kernel Analysis with the Crash Utility

-->
<!-- 

### Go to the Debug Shell

â panic=1 init=/bin/bashâ
mount âo rw,remount /
cd /lib/systemd/system/multi-user.target.wants
ln âs ../debug-shell.service
umount /
sync
exit

After reboot debug-shell will be available on tty9. No password required.

-->
<h2 id="performance-issues">Performance Issues</h2>
<p>Performance issues can be difficult to troubleshoot because so many variables play a role in overall system performance. Interpreting performance data often depends on the context and the situation. To better identify and isolate variables and to gain insight into performance data, you can use the troubleshooting tools on Photon OS to diagnose the system.  </p>
<p>If you have no indication what the cause of a performance degradation might be, start by getting a broad picture of the system&apos;s state. Then look for clues in the data that might point to a cause. The systemd journal is a useful place to start. </p>
<p>The <code>top</code> tool can unmask problems caused by processes or applications overconsuming CPUs, time, or RAM. If the percent of CPU utilization is consistently high with little idle time, for example, there might be a runaway process. Restart it. </p>
<p>The <code>netstat --statistics</code> command can identify bottlenecks causing performance issues. It lists interface statistics for different protocols. </p>
<p>If <code>top</code> and <code>netstat</code> reveal no clues, run the <code>strace ls -al</code> to view every system call.</p>
<p>The following <code>watch</code> command can help dynamically monitor a command to help troubleshoot performance issues:</p>
<pre><code>watch -n0 --differences &lt;command&gt;
</code></pre><p>You can, for example, combine <code>watch</code> with the <code>vmstat</code> command to dig deeper into statistics about virtual memory, processes, block input-output, disks, and CPU activity. Are there any bottlenecks? </p>
<p>Another option is to use the <code>dstat</code> utility. It shows a live, running list of statistics about system resources. </p>
<p>In addition, <code>systemd-analyze</code>, which reveals performance statistics for boot times, can help troubleshoot slow system boots and incorrect unit files.</p>
<p>The additional tools that you select depend on the clues that your initial investigation reveals. The following tools can also help troubleshoot performance: <code>sysstat</code>, <code>sar</code>, <code>systemtap</code>, and <code>crash</code>. </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Remotely-Upgrade-Photon-OS-Machine-With-Lightwave-Client-and-Photon-Management-Daemon-Installed.html" class="navigation navigation-prev " aria-label="Previous page: Remotely Upgrade Multiple Photon OS Machines With Lightwave Client and Photon Management Daemon Installed">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Frequently-Asked-Questions.html" class="navigation navigation-next " aria-label="Next page: Frequently Asked Questions">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Troubleshooting","level":"1.5","depth":1,"next":{"title":"Frequently Asked Questions","level":"1.6","depth":1,"path":"Frequently-Asked-Questions.md","ref":"Frequently-Asked-Questions.md","articles":[]},"previous":{"title":"Remotely Upgrade Multiple Photon OS Machines With Lightwave Client and Photon Management Daemon Installed","level":"1.4.11.5","depth":3,"path":"Remotely-Upgrade-Photon-OS-Machine-With-Lightwave-Client-and-Photon-Management-Daemon-Installed.md","ref":"Remotely-Upgrade-Photon-OS-Machine-With-Lightwave-Client-and-Photon-Management-Daemon-Installed.md","articles":[]},"dir":"ltr"},"config":{"plugins":["insert-logo","chapter-fold","edit-link","noembed"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"chapter-fold":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"noembed":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit this Page","base":"https://github.com/vmware/photon/tree/master/docs"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"insert-logo":{"style":"background: none","url":"images/photonos-logo-sm.png"}},"theme":"default","pdf":{"pageBreaksBefore":"/","headerTemplate":"_TITLE_","paperSize":"letter","margin":{"right":62,"left":62,"top":56,"bottom":56},"fontSize":12,"fontFamily":"Arial","footerTemplate":"_PAGENUM_","chapterMark":"pagebreak","pageNumbers":true},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"VMware Photon OS 1.0 and 2.0 Documentation","gitbook":"3.x.x"},"file":{"path":"photon-os-troubleshooting-guide.md","mtime":"2018-09-27T04:20:47.399Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-10-16T08:29:51.824Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-noembed/scripts.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

