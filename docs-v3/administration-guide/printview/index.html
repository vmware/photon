<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.81.0"><link rel=canonical type=text/html href=../../../docs-v3/administration-guide/><link rel=alternate type=application/rss+xml href=../../../docs-v3/administration-guide/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=../../../favicons/favicon.ico><link rel=apple-touch-icon href=../../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../../favicons/android-192x192.png sizes=192x192><title>Administration Guide |</title><meta property="og:title" content="Administration Guide"><meta property="og:description" content="VMware Photon docs"><meta property="og:type" content="website"><meta property="og:url" content="/docs-v3/administration-guide/"><meta itemprop=name content="Administration Guide"><meta itemprop=description content="VMware Photon docs"><meta name=twitter:card content="summary"><meta name=twitter:title content="Administration Guide"><meta name=twitter:description content="VMware Photon docs"><link rel=preload href=../../../scss/main.min.fbc832d1daa7d85e7d90a824d752c554779e63f96692310092a213ef9e02013f.css as=style><link href=../../../scss/main.min.fbc832d1daa7d85e7d90a824d752c554779e63f96692310092a213ef9e02013f.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-section><header><div class="container-fluid pl-3 pr-3" id=navbarish><nav class="navbar navbar-default navbar-dark navbar-expand-md d-flex justify-content-between" role=navigation data-toggle=collapse data-target=#menu_items aria-expanded=false aria-controls=navbar><div class="navbar-header d-flex align-items-center justify-content-between"><a class=navbar-brand href=../../../><span class=navbar-logo><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511.4375 135.7375" height="135.7375" width="511.4375" id="svg3355"><defs id="defs3359"><clipPath id="clipPath3387" clipPathUnits="userSpaceOnUse"><path id="path3389" d="M142.293 245.191l494.93 337.36L74.8398 348.098"/></clipPath><linearGradient id="linearGradient3391" spreadMethod="pad" gradientTransform="matrix(-493.8,-339.007,339.007,-493.8,601.845,634.081)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3393" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3395" offset="1" style="stop-opacity:1;stop-color:#80c64c"/></linearGradient><clipPath id="clipPath3405" clipPathUnits="userSpaceOnUse"><path id="path3407" d="M85.2852 570.719 516.813 593.84 54.5195 690.582"/></clipPath><linearGradient id="linearGradient3409" spreadMethod="pad" gradientTransform="matrix(-304.079,-208.759,208.759,-304.079,420.197,734.568)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3411" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3413" offset="1" style="stop-opacity:1;stop-color:#22437e"/></linearGradient><clipPath id="clipPath3423" clipPathUnits="userSpaceOnUse"><path id="path3425" d="m538.137 270.234 95.324 293.5-205.699-247.089"/></clipPath><linearGradient id="linearGradient3427" spreadMethod="pad" gradientTransform="matrix(-255.101,-175.134,175.134,-255.101,686.667,486.234)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3429" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3431" offset="1" style="stop-opacity:1;stop-color:#65a5de"/></linearGradient><clipPath id="clipPath3441" clipPathUnits="userSpaceOnUse"><path id="path3443" d="M857.758 94.3906 656.035 546.801 745.172 53.6406"/></clipPath><linearGradient id="linearGradient3445" spreadMethod="pad" gradientTransform="matrix(-102.35,-449.574,449.574,-102.35,800.888,513.826)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3447" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3449" offset="1" style="stop-opacity:1;stop-color:#c6da3a"/></linearGradient><clipPath id="clipPath3459" clipPathUnits="userSpaceOnUse"><path id="path3461" d="M481.316 864.746 635.938 602.125l-41.313 301.32"/></clipPath><linearGradient id="linearGradient3463" spreadMethod="pad" gradientTransform="matrix(67.7401,274.401,-274.401,67.7401,532.514,627.656)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3465" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3467" offset="1" style="stop-opacity:1;stop-color:#c6da3a"/></linearGradient><clipPath id="clipPath3477" clipPathUnits="userSpaceOnUse"><path id="path3479" d="M1085.54 913.828 683.598 585.359l456.522 219.75"/></clipPath><linearGradient id="linearGradient3481" spreadMethod="pad" gradientTransform="matrix(441.375,262.068,-262.068,441.375,675.147,599.59)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3483" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3485" offset="1" style="stop-opacity:1;stop-color:#22638b"/></linearGradient><clipPath id="clipPath3495" clipPathUnits="userSpaceOnUse"><path id="path3497" d="M1177.19 335.031 693.664 556.211 1106.69 235.887"/></clipPath><linearGradient id="linearGradient3499" spreadMethod="pad" gradientTransform="matrix(450.785,-274.875,274.875,450.785,694.818,558.101)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3501" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3503" offset="1" style="stop-opacity:1;stop-color:#a6dbe7"/></linearGradient><clipPath id="clipPath3513" clipPathUnits="userSpaceOnUse"><path id="path3515" d="M209.754 773.73l382.32-187.417L280.926 872.391"/></clipPath><linearGradient id="linearGradient3517" spreadMethod="pad" gradientTransform="matrix(-360.263,223.047,-223.047,-360.263,601.957,602.271)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3519" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3521" offset="1" style="stop-opacity:1;stop-color:#a6dbe7"/></linearGradient></defs><g transform="matrix(1.25,0,0,-1.25,0,135.7375)" id="g3363"><g transform="scale(0.1,0.1)" id="g3365"><path id="path3367" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1544.2 536.77c69.27.0 114.66 37.031 114.66 91.972v1.192c0 59.726-44.79 90.781-112.28 90.781h-105.7V536.77h103.32zm-150.51 203.652c0 13.141 10.75 23.891 23.29 23.891h133.19c94.36.0 156.47-50.172 156.47-132.586v-1.192c0-90.183-75.25-136.765-164.24-136.765h-101.52V367.148c0-13.132-10.76-23.886-23.9-23.886-12.54.0-23.29 10.754-23.29 23.886v373.274"/><path id="path3369" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1765.51 743.41c0 13.141 10.76 23.887 23.29 23.887 13.14.0 23.9-10.746 23.9-23.887V578.574h241.28V743.41c0 13.141 10.74 23.887 23.88 23.887 12.55.0 23.3-10.746 23.3-23.887V367.148c0-13.132-10.75-23.886-23.3-23.886-13.14.0-23.88 10.754-23.88 23.886v167.227H1812.7V367.148c0-13.132-10.76-23.886-23.9-23.886-12.53.0-23.29 10.754-23.29 23.886V743.41"/><path id="path3371" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m2554.86 554.082v1.203c0 94.957-69.28 172.598-164.83 172.598-95.56.0-163.65-76.445-163.65-171.406v-1.192c0-94.961 69.28-172.597 164.84-172.597 95.55.0 163.64 76.445 163.64 171.394zm-377.45.0v1.203c0 115.262 86.6 216.192 213.81 216.192 127.2.0 212.6-99.739 212.6-215v-1.192c0-115.265-86.59-216.203-213.79-216.203-127.22.0-212.62 99.738-212.62 215"/><path id="path3373" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m2756.35 720.715h-121.24c-11.94.0-22.09 9.555-22.09 21.5.0 11.941 10.15 22.098 22.09 22.098h290.26c11.94.0 22.1-10.157 22.1-22.098.0-11.945-10.16-21.5-22.1-21.5h-121.23V367.148c0-13.132-10.75-23.886-23.9-23.886-13.13.0-23.89 10.754-23.89 23.886v353.567"/><path id="path3375" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3332.78 554.082v1.203c0 94.957-69.28 172.598-164.83 172.598-95.56.0-163.65-76.445-163.65-171.406v-1.192c0-94.961 69.28-172.597 164.84-172.597 95.55.0 163.64 76.445 163.64 171.394zm-377.45.0v1.203c0 115.262 86.6 216.192 213.81 216.192 127.2.0 212.6-99.739 212.6-215v-1.192c0-115.265-86.59-216.203-213.79-216.203-127.22.0-212.62 99.738-212.62 215"/><path id="path3377" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3458.31 742.813c0 12.539 10.75 23.292 23.29 23.292h6.57c10.75.0 17.32-5.375 23.89-13.742l253.83-323.691v315.332c0 12.547 10.14 23.293 23.29 23.293 12.54.0 22.69-10.746 22.69-23.293V366.555c0-12.539-8.96-22.09-21.5-22.09h-2.4c-10.14.0-17.31 5.965-24.48 14.324l-259.2 331.465V366.555c0-12.539-10.14-23.293-23.29-23.293-12.54.0-22.69 10.754-22.69 23.293v376.258"/><path id="path3379" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3982.91 759.98c0 4.528 3.13 7.665 7.66 7.665h2.09c3.14.0 5.22-1.395 6.97-3.829l37.6-58.503 38.3 58.503c1.74 2.434 3.83 3.829 6.61 3.829h2.09c3.83.0 7.32-3.485 7.32-7.665v-94.011c0-4.18-3.49-7.66-7.66-7.66-4.18.0-7.31 3.48-7.31 7.66v72.426l-32.38-48.403c-1.75-2.785-3.83-4.527-6.97-4.527-3.13.0-5.22 1.742-6.96 4.527l-32.04 48.403v-72.426c0-4.18-3.48-7.66-7.66-7.66s-7.66 3.48-7.66 7.66v94.011zm-73.47-7.308h-28.91c-3.82.0-7.3 3.48-7.3 7.308.0 3.836 3.48 7.317 7.3 7.317h72.78c4.18.0 7.31-3.481 7.31-7.317.0-3.828-3.13-7.308-7.31-7.308h-28.55v-86.703c0-4.18-3.48-7.66-8.01-7.66-4.18.0-7.31 3.48-7.31 7.66v86.703"/><path id="path3381" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m597.898 989.039c-236.39.0-428.714-192.324-428.714-428.719.0-236.39 192.324-428.715 428.714-428.715 236.395.0 428.722 192.325 428.722 428.715.0 236.395-192.327 428.719-428.722 428.719zm0-954.289c-289.796.0-525.566 235.773-525.566 525.57s235.77 525.57 525.566 525.57c289.801.0 525.572-235.773 525.572-525.57S887.699 34.75 597.898 34.75"/><g id="g3383"><g clip-path="url(#clipPath3387)" id="g3385"><path id="path3397" style="fill:url(#linearGradient3391);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M142.293 245.191l494.93 337.36L74.8398 348.098"/></g></g><path id="path3399" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m167.938 304.09c-4.524 34.332-36.024 58.496-70.356 53.973-34.332-4.52-58.5-36.02-53.9765-70.352 4.5234-34.336 36.0234-58.5 70.3555-53.977 34.332 4.524 58.5 36.02 53.977 70.356"/><g id="g3401"><g clip-path="url(#clipPath3405)" id="g3403"><path id="path3415" style="fill:url(#linearGradient3409);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M85.2852 570.719 516.813 593.84 54.5195 690.582"/></g></g><path id="path3417" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m124.875 636.605c-4.523 34.333-36.0234 58.5-70.3555 53.977C20.1875 686.059-3.98047 654.559.542969 620.227 5.06641 585.895 36.5664 561.727 70.8984 566.25c34.3356 4.523 58.4996 36.023 53.9766 70.355"/><g id="g3419"><g clip-path="url(#clipPath3423)" id="g3421"><path id="path3433" style="fill:url(#linearGradient3427);fill-opacity:1;fill-rule:nonzero;stroke:none" d="m538.137 270.234 95.324 293.5-205.699-247.089"/></g></g><path id="path3435" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m541.352 289.715c-4.524 34.332-36.024 58.5-70.356 53.973-34.336-4.52-58.5-36.02-53.976-70.352 4.523-34.336 36.023-58.5 70.355-53.977 34.332 4.524 58.496 36.024 53.977 70.356"/><g id="g3437"><g clip-path="url(#clipPath3441)" id="g3439"><path id="path3451" style="fill:url(#linearGradient3445);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M857.758 94.3906 656.035 546.801 745.172 53.6406"/></g></g><path id="path3453" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m846.91 110.883c-26.609 22.164-66.144 18.558-88.308-8.051-22.164-26.6132-18.559-66.1406 8.05-88.3125 26.61-22.16013 66.145-18.55075 88.309 8.0586 22.164 26.6016 18.559 66.1446-8.051 88.3049"/><g id="g3455"><g clip-path="url(#clipPath3459)" id="g3457"><path id="path3469" style="fill:url(#linearGradient3463);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M481.316 864.746 635.938 602.125l-41.313 301.32"/></g></g><path id="path3471" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m491.863 848.059c26.203-22.645 65.797-19.758 88.442 6.441 22.64 26.203 19.758 65.797-6.446 88.441-26.199 22.645-65.796 19.758-88.437-6.445-22.645-26.199-19.762-65.797 6.441-88.437"/><g id="g3473"><g clip-path="url(#clipPath3477)" id="g3475"><path id="path3487" style="fill:url(#linearGradient3481);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M1085.54 913.828 683.598 585.359l456.522 219.75"/></g></g><path id="path3489" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1050.12 855.145c2.26-34.555 32.1-60.743 66.66-58.485 34.55 2.254 60.74 32.098 58.48 66.653-2.25 34.554-32.09 60.742-66.65 58.484-34.56-2.254-60.74-32.098-58.49-66.652"/><g id="g3491"><g clip-path="url(#clipPath3495)" id="g3493"><path id="path3505" style="fill:url(#linearGradient3499);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M1177.19 335.031 693.664 556.211 1106.69 235.887"/></g></g><path id="path3507" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1108.75 338.84c-29.47-18.176-38.63-56.805-20.46-86.281 18.18-29.477 56.81-38.637 86.29-20.461 29.47 18.179 38.63 56.808 20.45 86.285-18.17 29.476-56.8 38.637-86.28 20.457"/><g id="g3509"><g clip-path="url(#clipPath3513)" id="g3511"><path id="path3523" style="fill:url(#linearGradient3517);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M209.754 773.73l382.32-187.417L280.926 872.391"/></g></g><path id="path3525" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m278.168 769.453c29.598 17.977 39.02 56.543 21.043 86.145-17.977 29.597-56.543 39.019-86.145 21.043-29.597-17.977-39.019-56.543-21.043-86.141 17.977-29.602 56.543-39.023 86.145-21.047"/><path id="path3527" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m714.422 718.262c8.172-9.321 22.351-10.246 31.672-2.074 9.316 8.175 10.246 22.355 2.07 31.675-8.172 9.317-22.351 10.246-31.672 2.071-9.316-8.172-10.246-22.356-2.07-31.672"/><path id="path3529" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m827.305 484.969c8.175-9.321 22.355-10.25 31.672-2.074 9.32 8.171 10.25 22.355 2.074 31.671-8.172 9.321-22.356 10.247-31.672 2.075-9.32-8.176-10.246-22.356-2.074-31.672"/><path id="path3531" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m906.813 877.289c8.175-9.316 22.355-10.246 31.675-2.07 9.317 8.172 10.246 22.351 2.071 31.672-8.172 9.32-22.356 10.246-31.672 2.074-9.321-8.176-10.246-22.356-2.074-31.676"/><path id="path3533" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m987.531 166.984c8.172-9.32 22.359-10.246 31.669-2.074 9.32 8.176 10.25 22.356 2.08 31.676-8.18 9.316-22.358 10.242-31.678 2.07-9.317-8.176-10.247-22.355-2.071-31.672"/><path id="path3535" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m140.008 473.707c8.172-9.32 22.351-10.246 31.672-2.074 9.316 8.176 10.246 22.355 2.074 31.676-8.176 9.316-22.356 10.246-31.676 2.07-9.316-8.172-10.246-22.356-2.07-31.672"/><path id="path3537" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m609.063 315.641c8.171-9.321 22.355-10.246 31.671-2.075 9.321 8.176 10.246 22.356 2.075 31.676-8.176 9.317-22.356 10.246-31.676 2.071-9.317-8.172-10.246-22.352-2.07-31.672"/><path id="path3539" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m458.551 398.422c8.172-9.317 22.351-10.246 31.672-2.07 9.32 8.171 10.246 22.351 2.074 31.671-8.176 9.317-22.356 10.247-31.676 2.071-9.316-8.172-10.246-22.352-2.07-31.672"/><path id="path3541" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m518.754 661.82c8.176-9.32 22.355-10.246 31.672-2.074 9.32 8.176 10.25 22.356 2.074 31.676-8.176 9.316-22.355 10.246-31.672 2.07-9.32-8.172-10.25-22.355-2.074-31.672"/><path id="path3543" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m744.523 394.66c8.172-9.32 22.356-10.246 31.672-2.074 9.321 8.176 10.246 22.355 2.075 31.676-8.176 9.316-22.356 10.246-31.672 2.07-9.321-8.172-10.25-22.355-2.075-31.672"/><path id="path3545" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m714.422 605.379c8.172-9.32 22.351-10.246 31.672-2.074 9.316 8.172 10.246 22.355 2.07 31.672-8.172 9.32-22.351 10.246-31.672 2.074-9.316-8.176-10.246-22.356-2.07-31.672"/><path id="path3547" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m368.242 469.918c8.172-9.32 22.356-10.25 31.672-2.074 9.32 8.172 10.246 22.355 2.074 31.672-8.175 9.32-22.355 10.246-31.675 2.074-9.317-8.176-10.247-22.356-2.071-31.672"/><path id="path3549" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m633.461 620.176c8.172-9.317 22.355-10.246 31.672-2.071 9.32 8.172 10.246 22.356 2.074 31.672-8.176 9.321-22.355 10.246-31.676 2.075-9.316-8.176-10.246-22.356-2.07-31.676"/><path id="path3551" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m646.691 752.129c8.172-9.32 22.352-10.25 31.672-2.074 9.321 8.172 10.246 22.355 2.075 31.672-8.176 9.32-22.356 10.246-31.676 2.074-9.317-8.176-10.246-22.356-2.071-31.672"/><path id="path3553" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m819.777 334.453c8.176-9.316 22.356-10.246 31.676-2.07 9.317 8.172 10.246 22.351 2.07 31.672-8.171 9.32-22.351 10.246-31.671 2.074-9.321-8.176-10.247-22.356-2.075-31.676"/><path id="path3555" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m812.242 571.512c8.176-9.321 22.356-10.246 31.676-2.074 9.316 8.175 10.246 22.355 2.07 31.675-8.172 9.317-22.351 10.246-31.672 2.071-9.316-8.172-10.246-22.356-2.074-31.672"/><path id="path3557" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m382.156 392.988c8.172-9.316 22.356-10.246 31.672-2.07 9.32 8.172 10.246 22.355 2.074 31.672-8.175 9.32-22.355 10.246-31.672 2.074-9.32-8.176-10.25-22.355-2.074-31.676"/><path id="path3559" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m613.543 476.398c8.176-9.32 22.355-10.25 31.676-2.074 9.316 8.176 10.246 22.356 2.07 31.672-8.172 9.32-22.355 10.246-31.672 2.074-9.32-8.175-10.246-22.355-2.074-31.672"/><path id="path3561" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m435.969 645.902c8.172-9.32 22.351-10.246 31.672-2.074 9.32 8.176 10.246 22.356 2.074 31.676-8.176 9.316-22.356 10.246-31.676 2.07-9.316-8.172-10.246-22.355-2.07-31.672"/><path id="path3563" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m629.688 164.293c8.171-9.32 22.355-10.246 31.671-2.074 9.321 8.176 10.246 22.355 2.075 31.676-8.176 9.316-22.356 10.246-31.672 2.07-9.321-8.172-10.25-22.356-2.074-31.672"/><path id="path3565" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m499.398 462.395c12.329-1.301 23.379 7.632 24.684 19.96 1.305 12.325-7.633 23.375-19.961 24.68-12.324 1.305-23.375-7.633-24.68-19.957-1.304-12.328 7.633-23.379 19.957-24.683"/><path id="path3567" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m721.23 510.641c-12.3 1.527-23.511-7.207-25.039-19.508-1.527-12.301 7.207-23.512 19.508-25.039 12.301-1.528 23.512 7.207 25.039 19.508 1.528 12.3-7.207 23.507-19.508 25.039"/><path id="path3569" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m594.34 420.676c-7.543 9.836-21.629 11.695-31.469 4.152-9.836-7.543-11.691-21.633-4.148-31.469s21.632-11.695 31.468-4.152 11.696 21.633 4.149 31.469"/><path id="path3571" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m594.828 581.156c-7.543 9.836-21.633 11.696-31.469 4.153s-11.695-21.633-4.152-31.469c7.547-9.836 21.633-11.695 31.469-4.152 9.836 7.542 11.695 21.632 4.152 31.468"/><path id="path3573" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m458.199 576.973c5.156 11.273.199 24.59-11.07 29.75-11.274 5.156-24.59.199-29.746-11.071-5.16-11.273-.203-24.589 11.066-29.75 11.274-5.156 24.594-.199 29.75 11.071"/><path id="path3575" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m635.691 569.449c-5.234-11.234-.367-24.59 10.868-29.82 11.238-5.234 24.589-.371 29.824 10.867 5.234 11.234.367 24.586-10.867 29.82-11.239 5.235-24.59.372-29.825-10.867"/></g></g></svg></span><span class="text-uppercase font-weight-bold"></span></a></div><div class=ml-auto><button type=button class="navbar-toggler third-button collapsed" data-toggle=collapse data-target=#menu_items aria-expanded=false aria-controls=navbar><div class=animated-icon><span></span><span></span><span></span></div></button></div><div id=menu_items class="navbar-collapse collapse ml-md-auto justify-content-end text-center"><ul class="nav navbar-nav"><li class="nav-item p-0"><a class=nav-link href=../../../><span>Home</span></a></li><li class="nav-item p-0"><a class=nav-link href=../../../blog/><span>Blog</span></a></li><li class="nav-item p-0"><a class=nav-link href=../../../#features><span>Features</span></a></li><li class="nav-item p-0"><a class=nav-link href=../../../#contributing><span>Contribute</span></a></li><li class="nav-item p-0"><a class=nav-link href=../../../docs/><span>Docs</span></a></li><li class="nav-item p-0"><a class=nav-link href=https://github.com/vmware/photon target=_blank><span>Github</span></a></li><div class="navbar-nav dropdown border-0"><li class=nav-item><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Release</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=../../../docs/>v4 - Latest</a>
<a class=dropdown-item href=../../../docs-v3/>v3</a>
<a class=dropdown-item href=../../../assets/files/html/3.0/>v3 (old)</a>
<a class=dropdown-item href=../../../assets/files/html/1.0-2.0/>v2 and v1</a></div></li></div></ul></div></nav></div></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=../../../docs-v3/administration-guide/>Return to the regular view of this page</a>.</p></div><h1 class=title>Administration Guide</h1><ul><li>1: <a href=#pg-8af60584bbfa1efb9c9372d018d3ee08>Photon OS Packages</a></li><ul><li>1.1: <a href=#pg-ced92ab161130e05f00ccd9cb8d20af6>Examining the Packages in the SPECS Directory on Github</a></li><li>1.2: <a href=#pg-ea61d91a7ed7c7e763d8a2f52cc85585>Looking at the Differences Between the Minimal and the Full Version</a></li><li>1.3: <a href=#pg-59939bd96843c3d228e3f346dceadc06>The Root Account and the `sudo` and `su` Commands</a></li><li>1.4: <a href=#pg-437afb32f1be7802b4481f4dc65a257f>Examining Signed Packages</a></li><li>1.5: <a href=#pg-6fed130ce947acc52049d10dc4d27304>Photon OS Package Repositories</a></li><li>1.6: <a href=#pg-f3c54727a727f8ec6623310d8c981536>Building a Package from a Source RPM</a></li><li>1.7: <a href=#pg-6634d43432a34970d800d1a0f2b37570>Compiling C++ Code on the Minimal Version of Photon OS</a></li></ul><li>2: <a href=#pg-3e0f72b6cbcb4b80af2d10cb3a877611>Package Management in Photon OS with `tdnf`</a></li><ul><li>2.1: <a href=#pg-f532121e1d7bdf1c548be913843e2b6f>Introduction to 'tdnf'</a></li><li>2.2: <a href=#pg-0a58de94f50c4dc5bf089a82799d503a>Configuration Files and Repositories</a></li><li>2.3: <a href=#pg-b903c9c04d719f1db2b2de6bb5929523>Adding a New Repository</a></li><li>2.4: <a href=#pg-7ba787a4fbf0d12a06a9cf6c8ee0fb8c>Configure a Repository</a></li><li>2.5: <a href=#pg-e5a0d6886420253cd7e8d90f45ffcc29>Adding the Dev Repository to Get New Packages from the GitHub Dev Branch</a></li><li>2.6: <a href=#pg-31b2264775f23ddd8947d654e34f0054>Standard Syntax for tdnf Commands</a></li><ul><li>2.6.1: <a href=#pg-01e6ca1fe54c76897b029d7521d14a26>tndf Commands</a></li><li>2.6.2: <a href=#pg-c8f7031a6c3ac2cb9e73b98f5b4ae2f7>tndf Command Options</a></li></ul></ul><li>3: <a href=#pg-b059e84be831ab0194f275a5954f8533>Managing Services with `systemd`</a></li><ul><li>3.1: <a href=#pg-a20282a0c192a1ba77670eae4980540a>Viewing Services</a></li><li>3.2: <a href=#pg-e8f72e8f9daeccde0058f5b18b8df2fc>Controlling Services</a></li><li>3.3: <a href=#pg-66fd8c47a7772e3694a7e6cec277190b>Creating a Startup Service</a></li><li>3.4: <a href=#pg-18af2aedd7babb8cc32fd9d2eab8c479>Disabling the Photon OS httpd.service</a></li><li>3.5: <a href=#pg-d457ce808bee76ca65bd9f2e4abb80b7>Auditing System Events with auditd</a></li><li>3.6: <a href=#pg-d38bfc4c8716171851e4d4916b541b25>Analyzing systemd Logs with journalctl</a></li><li>3.7: <a href=#pg-e6d10934c78f7e80adf4be5f4c6af403>Migrating Scripts to systemd</a></li><li>3.8: <a href=#pg-d1f0e04c6c20c480fc126cc7283bdaca></a></li></ul><li>4: <a href=#pg-305c4712c6b1355beeb4783b507fcff1>Configure Wireless Networking</a></li><li>5: <a href=#pg-b2dadcbb26192ea0e6c9e3d6e835f44d>Managing the Network Configuration</a></li><ul><li>5.1: <a href=#pg-fc53ddd4aeeaf9d82f1d6c96db02600d>Commands to Manage Network Service</a></li><li>5.2: <a href=#pg-80942de722613148c835397eacd1689e>Using the Network Configuration Manager</a></li><li>5.3: <a href=#pg-9629bafba70f4f15cd61e4059d52ccfc>Use `ip` and `ss` Commands</a></li><li>5.4: <a href=#pg-6e2e43bbd8612f6f86b51fa951265dee>Configuring Network Interfaces</a></li><li>5.5: <a href=#pg-24b8ff5a4b30298fd0bb1eb1054befa8>Setting a Static IP Address</a></li><li>5.6: <a href=#pg-8d3a3360097ed466fb3816843d3f0651>Turning Off DHCP</a></li><li>5.7: <a href=#pg-a552c6bd7a3b651db21dc3817083c578>Adding a DNS Server</a></li><li>5.8: <a href=#pg-5b4e7843381c14bbcd362defe84933e6>Setting Up Networking for Multiple NICs</a></li><ul><li>5.8.1: <a href=#pg-e9ae6aae699b9a9210f9a60cf34af138>Combining DHCP and Static IP Addresses with IPv4 and IPv6</a></li></ul><li>5.9: <a href=#pg-b41fae09f8057342561ce3ed6fe2bf0a>Clearing the Machine ID of a Cloned Instance for DHCP</a></li><li>5.10: <a href=#pg-97b31518a5a4646e2d150af3ccdebc62>Using Predictable Network Interface Names</a></li><li>5.11: <a href=#pg-8c81b2cb6747cd35911212e45c01f3d4>Inspecting the Status of Network Links with `networkctl`</a></li><li>5.12: <a href=#pg-29409ea1e796abd82aedb1fccefb6eb4>Turning On Network Debugging</a></li><li>5.13: <a href=#pg-27c7642ff95c8161690077370fc57222>Mounting a Network File System</a></li><li>5.14: <a href=#pg-32b838b1422d5e03790da93aae06b2c3>Network Configuration Manager - C API</a></li><li>5.15: <a href=#pg-a2c499b13b1449ec62f78af30d54d9d0>Network Configuration Manager - Python API</a></li><li>5.16: <a href=#pg-a82ef4d2ec225c8b31691b80c956da04></a></li></ul><li>6: <a href=#pg-d8209c5493f1fb6a1d2178ece727cb42>Prioritize eth0 Route Over WLAN</a></li><li>7: <a href=#pg-833e39de4cc98ce7eac9e63da3824f3c>Cloud-Init on Photon OS</a></li><ul><li>7.1: <a href=#pg-88c90d8eeb3c8c6eea5c96bed38bf431>Cloud-Init Overview</a></li><li>7.2: <a href=#pg-f8d56103ef1a4dc0532efc64363fc40d>Deploy Photon OS With `cloud-init`</a></li><li>7.3: <a href=#pg-a81d2ef57638de58e167883385851db4>Customizing Guest OS using Cloud-Init</a></li><li>7.4: <a href=#pg-8d1d064ff32b9086a691bf769b1119e9>Creating a Stand-Alone Photon Machine With cloud-init</a></li><li>7.5: <a href=#pg-19e9a57097b9a10a14e9fe0e892ac425>Customizing a Photon OS Machine on EC2</a></li><li>7.6: <a href=#pg-2a00e7f392acef2068b651bde33db542>Running a Photon OS Machine on GCE</a></li></ul><li>8: <a href=#pg-0990d9372509a57cc6bcbd54bb06dd5b>Containers</a></li><ul><li>8.1: <a href=#pg-049de2e7e2971394ac98bd0fbaf437ba>Docker Containers</a></li><li>8.2: <a href=#pg-236638060a87773fb6e1ad2401baba69>Kubernetes</a></li></ul><li>9: <a href=#pg-c17a1e127da35ce88db6ba685c12104c>Changing the Locale</a></li><li>10: <a href=#pg-aa12f342ea5e96c0bf80a28c55f666ea>Security Policy</a></li><ul><li>10.1: <a href=#pg-74864e4a4766a18875ff1ba7ea83c95d>Default Firewall Settings</a></li><li>10.2: <a href=#pg-e38c9d1982878fda5ab827b2767db33c>Default Permissions and umask</a></li><li>10.3: <a href=#pg-c7abef9aaf3c4a27b0772f48541f3371>Disabling TLS 1.0 to Improve Transport Layer Security</a></li></ul><li>11: <a href=#pg-7b214cc408cfd2696dd663e9695fa956>Photon RPM OSTree: a simple guide</a></li><ul><li>11.1: <a href=#pg-8bc44d4a336637a36731fa2fec02b610>Introduction</a></li><ul></ul><li>11.2: <a href=#pg-892db7bed87d9eb3b9fa6fae638395b0>Installing a host against default server repository</a></li><ul></ul><li>11.3: <a href=#pg-e35a78141715aabfec52a74c647a086a>Concepts in Action</a></li><ul></ul><li>11.4: <a href=#pg-84649216fef2a5c5bc00f0d7146ddb38>Querying For Commit File and Package Metadata</a></li><ul></ul><li>11.5: <a href=#pg-ba1fa102a185c528f503dc2105bda918>Host Updating Operations</a></li><ul></ul><li>11.6: <a href=#pg-7f2ee5bef24972135e64293d2eec474f>Creating a Server</a></li><ul></ul><li>11.7: <a href=#pg-9a44f81f40079416d0814c0d7e6093cc>Installing a Photon RPM-OStree host against a custom server repository</a></li><ul></ul><li>11.8: <a href=#pg-aa06d00ff26aed06d1458656d5014d3b>Automatic Updates</a></li><ul></ul><li>11.9: <a href=#pg-b901522c7ceba939641d14dc328418b6>File Oriented Server Operations</a></li><ul></ul><li>11.10: <a href=#pg-481240d4c42564fc6771e086012b4ab6>Package Oriented Server Operations</a></li><ul></ul><li>11.11: <a href=#pg-c576f34fd93bc55d29c98e625f27b9b0>Remotes</a></li><ul></ul><li>11.12: <a href=#pg-c3cbddd48a0df603ff7ba6bab63aa2c6>Running container applications between bootable images</a></li><ul></ul><li>11.13: <a href=#pg-47d938d24c094a3c507e7cead3de3897>Install or rebase to Photon OS 3.0</a></li><ul></ul></ul></ul><div class=content><p>The Photon OS <em>Administration Guide</em> describes the fundamentals of administering Photon OS.</p><p>The <em>Administration Guide</em> covers the basics of managing packages, controlling services with systemd, setting up networking, initializing Photon OS with cloud-init, running Docker containers, and working with other technologies, such as Kubernetes.</p><p><strong>Product version: 3.0</strong></p><p>This documentation applies to all 3.0.x releases.</p><h2 id=intended-audiences>Intended Audiences</h2><p>This information is intended for Photon OS administrators who install and set up Photon OS.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-8af60584bbfa1efb9c9372d018d3ee08>1 - Photon OS Packages</h1><p>The design of Photon OS simplifies life-cycle management and improves the security of packages. Photon reduces the burden and complexity of managing clusters of Linux machines by providing curated package repositories and by securing packages with GPG signatures.</p><p>Photon OS is available in a variety of pre-built packages in binary formats.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ced92ab161130e05f00ccd9cb8d20af6>1.1 - Examining the Packages in the SPECS Directory on Github</h1><p>The SPECS directory of the GitHub website for Photon OS contains all the packages that can appear in Photon OS repositories. The following is the path to the SPECS directory :</p><p><code>https://github.com/vmware/photon/tree/master/SPECS</code></p><p>To see the version of a package, in the SPECS directory, click the name of the subdirectory of the package that you want to examine, and then click the <code>.spec</code> filename in the subdirectory.</p><p>For example, the version of OpenJDK, which contains the openjre package that installs the Java class library and the javac Java compiler appears as follows:</p><pre><code>%define _use_internal_dependency_generator 0
Summary:	OpenJDK 
Name:		openjdk
Version:	1.8.0.72
Release:	1%{?dist}
License:	GNU GPL
URL:		https://openjdk.java.net
Group:		Development/Tools
Vendor:		VMware, Inc.
Distribution:   Photon
AutoReqProv: 	no
Source0:	http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-%{version}/OpenJDK-%{version}-x86_64-bin.tar.xz
%define sha1 OpenJDK=0c705d7b13f4e22611d2da654209f469a6297f26
%description
The OpenJDK package installs java class library and javac java compiler. 

%package	-n openjre
Summary:	Jave runtime environment
AutoReqProv: 	no
%description	-n openjre
It contains the libraries files for Java runtime environment
#%global __requires_exclude ^libgif.*$
#%filter_from_requires ^libgif.*$...
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-ea61d91a7ed7c7e763d8a2f52cc85585>1.2 - Looking at the Differences Between the Minimal and the Full Version</h1><p>The minimal version of Photon OS contains around 50 packages. As it is installed, the number of packages increases to nearly 100 to fulfill dependencies. The full version of Photon OS adds several hundred packages to those in the minimal version to deliver a more fully featured operating system.</p><p>You can view a list of the packages that appear in the minimal version by examining the following file:</p><p><a href=https://github.com/vmware/photon/blob/master/common/data/packages_minimal.json>https://github.com/vmware/photon/blob/master/common/data/packages_minimal.json</a></p><p>You can view a list of the packages that appear in the full version by examining the following file:</p><p><a href=https://github.com/vmware/photon/blob/master/common/data/packages_full.json>https://github.com/vmware/photon/blob/master/common/data/packages_full.json</a></p><p>If the minimal or the full version of Photon OS does not contain a package that you want, you can install it with tdnf, which appears in both the minimal and full versions of Photon OS by default. In the full version of Photon OS, you can also install packages by using yum.</p><p>One notable difference between the two versions of Photon OS pertains to OpenJDK, the package that contains not only the Java runtime environment (<code>openjre</code>) but also the Java compiler (<code>javac</code>). The OpenJDK package appears in the full but not the minimal version of Photon OS.</p><p>To add support for Java programs to the minimal version of Photon OS, install the Java packages and their dependencies by using the following command:</p><pre><code>tdnf install openjdk
Installing:
openjre 	x86_64    1.8.0.92-1.ph1    95.09 M
openjdk 	x86_64    1.8.0.92-1.ph1    37.63 M
</code></pre><p><strong>NOTE:</strong> <code>openjdk</code> and <code>openjre</code> are available as openjdk8 and openjre8 in Photon OS 3.0</p><p>For more information about <code>tdnf</code>, see <a href=../../managing-packages-with-tdnf/>Tiny DNF for Package Management</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-59939bd96843c3d228e3f346dceadc06>1.3 - The Root Account and the `sudo` and `su` Commands</h1><p>The <em>Photon OS Administration Guide</em> assumes that you are logged in to Photon OS with the root account and running commands as root. The <code>sudo</code> program contains the full version of Photon OS.</p><p>On the minimal version, you must install <code>sudo</code> with tdnf if you want to use it. As an alternative to installing <code>sudo</code>, to run commands that require root privileges you can switch users as needed with the <code>su</code> command.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-437afb32f1be7802b4481f4dc65a257f>1.4 - Examining Signed Packages</h1><p>Photon OS signs its packages and repositories with GPG signatures to enhance security. The GPG signature uses keyed-hash authentication method codes, typically the SHA1 algorithm and an RSA Data Security, Inc. MD5 Message Digest Algorithm, to simultaneously verify the integrity of a package. A keyed-hash message authentication code combines a cryptographic hash function with a secret cryptographic key.</p><p>In Photon OS, GPG signature verification automatically takes place when you install or update a package with the default package manager, <code>tdnf</code>. The default setting in the tdnf configuration file for checking the GPG is set to <code>1</code> for true:</p><pre><code>cat /etc/tdnf/tdnf.conf
[main]
gpgcheck=1
installonly_limit=3
clean_requirements_on_remove=true
repodir=/etc/yum.repos.d
cachedir=/var/cache/tdnf
</code></pre><p>On Photon OS, you can view the key with which VMware signs packages by running the following command:</p><pre><code>rpm -qa gpg-pubkey*
</code></pre><p>The command returns the GPG public key:</p><pre><code>gpg-pubkey-66fd4949-4803fe57
</code></pre><p>Once you have the name of the key, you can view information about the key with the <code>rpm -qi</code> command, as the following abridged output demonstrates:</p><pre><code>rpm -qi gpg-pubkey-66fd4949-4803fe57
Name        : gpg-pubkey
Version     : 66fd4949
Release     : 4803fe57
Architecture: (none)
Install Date: Thu Jun 16 11:51:39 2016
Group       : Public Keys
Size        : 0
License     : pubkey
Signature   : (none)
Source RPM  : (none)
Build Date  : Tue Apr 15 01:01:11 2008
Build Host  : localhost
Relocations : (not relocatable)
Packager    : VMware, Inc. -- Linux Packaging Key -- &lt;linux-packages@vmware.com&gt;
Summary     : gpg(VMware, Inc. -- Linux Packaging Key -- &lt;linux-packages@vmware.                        com&gt;)
Description :
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: rpm-4.11.2 (NSS-3)
mI0ESAP+VwEEAMZylR8dOijUPNn3He3GdgM/kOXEhn3uQl+sRMNJUDm1qebi2D5b ...
</code></pre><p>If you have one of the RPMs from Photon OS on another Linux system, such as Ubuntu, you can use SHA and the RSA Data Security, Inc. MD5 Message Digest Algorithm for the package to verify that it has not been tampered with:</p><pre><code>rpm -K /home/steve/workspace/photon/stage/SRPMS/kubernetes-1.1.8-4.ph1.src.rpm
/home/steve/workspace/photon/stage/SRPMS/kubernetes-1.1.8-4.ph1.src.rpm: sha1 md5 OK
</code></pre><p>You can view the SHA1 digest and the RSA Data Security, Inc. MD5 Message Digest Algorithm by running the following command:</p><pre><code>rpm -Kv /home/steve/workspace/photon/stage/SRPMS/kubernetes-1.1.8-4.ph1.src.rpm
/home/steve/workspace/photon/stage/SRPMS/kubernetes-1.1.8-4.ph1.src.rpm:
Header SHA1 digest: OK (89b55443d4c9f67a61ae0c1ec9bf4ece2d6aa32b)
        MD5 digest: OK (51eee659a8730e25fd2a52aff9a6c2c2)
</code></pre><p>The above examples show that the Kubernetes package has not been tampered with.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6fed130ce947acc52049d10dc4d27304>1.5 - Photon OS Package Repositories</h1><p>The default installation of Photon OS includes four yum-compatible repositories plus the repository on the Photon OS ISO when it is available in a CD-ROM drive:</p><pre><code>ls /etc/yum.repos.d/
lightwave.repo
photon-extras.repo
photon-iso.repo
photon-updates.repo
photon.repo 
</code></pre><p>The Photon ISO repository (<code>photon-iso.repo</code>) contains the installation packages for Photon OS. All the packages that Photon builds and publishes reside in the RPMs directory of the ISO when it is mounted. The RPMs directory contains metadata that lets it act as a yum repository. Mounting the ISO gives you all the packages corresponding to a Photon OS build. If, however, you built Photon OS yourself from the source code, the packages correspond only to your build, though they will typically be the latest. In contrast, the ISO that you obtain from the Bintray web site contains only the packages that are in the ISO at the point of publication. As a result, the packages may no longer match those on Bintray, which are updated regularly.</p><p>The main Photon OS repository (<code>photon.repo</code>) contains all the packages that are built from the ISO or from another source. This repository points to a static batch of packages and spec files at the point of a release.</p><p>The updates repository (<code>photon-updates.repo</code>) is irrelevant to a major release until after the release is installed. Thereafter, the updates repository holds the updated packages for that release. The repository points to updates for the installed version, such as a version of Kubernetes that supersedes the version installed during the major release.</p><p>The Photon extras repository (<code>photon-extras.repo</code>) holds Likewise Open, an open source authentication engine, and other VMware software that you can add to Photon OS for free. Photon OS supports but does not build the packages in the extras repository.</p><p>Similarly, the Lightwave repository (<code>lightwave.repo</code>) contains the packages that make up the VMware Lightwave security suite for cloud applications, including tools for identity management, access control, and certificate management.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f3c54727a727f8ec6623310d8c981536>1.6 - Building a Package from a Source RPM</h1><p>This section describes how to install and build a package on the full version of Photon OS from the package&rsquo;s source RPM. Obtain the source RPMs that Photon OS uses from the Packages location, <a href=https://packages.vmware.com/photon>https://packages.vmware.com/photon</a></p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>To build a package from its source RPM, or SRPM, Photon OS requires the following packages:</p><ul><li><p><code>rpmbuild</code>. This package is installed by default on the full version of Photon OS, so you should not have to install it.</p></li><li><p><code>gcc</code>. This package is also installed by default on the full version of Photon OS, so you should not have to install it.</p></li><li><p><code>make</code>, <code>Cmake</code>, <code>automake</code>, or another <code>make</code> package, depending on the package you are trying to install and build from its source RPM. Cmake is installed by default on Photon OS.</p><p>You can install other make packages by using tdnf or yum.</p></li></ul></li><li><p>A local unprivileged user account other than the root account. You should build RPMs as an unprivileged user. Do not build a package as <code>root</code> becau&ndash;building an RPM with the root account might damage your system.</p></li><li><p>Take a snapshot of your virtual machine before building the package if you are building a package on a virtual machine running Photon OS in VMware vSphere, VMware Workstation, or VMware Fusion.</p></li></ul><h2 id=procedure>Procedure</h2><p>VMware recommends that you install and build packages from their source RPMs on the full version of Photon OS. Do not use the minimal version to work with source RPMs.</p><p>Perfrom the following steps to install and build an example package- <code>sed</code> from its source RPM on Photon OS with an unprivileged account.</p><ol><li><p>check whether rpmbuild is installed by running the following command:</p><pre><code>rpmbuild --version
</code></pre></li></ol><pre><code>    If it is not installed, install it by running the following command as root: 
	
    ```
    tdnf install rpm-build
</code></pre><ol><li><p>Create the directories for building RPMs under your local user account home directory and not under root:</p><pre><code>mkdir -p ~/rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS}
</code></pre></li></ol><pre><code>
1. Create a `.rpmmacros` file under your home directory and override the default location of the RPM building tree with the new one. This command overwrites an existing `.rpmmacros` file. Before running the following command, make sure you do not already have a `.rpmmacros file`. If a `.rpmmacros` file exists, back it up under a new name in case you want to restore it later.    

    ```
echo '%_topdir %(echo $HOME)/rpmbuild' &gt; ~/.rpmmacros
</code></pre><ol><li><p>Place the source RPM file that you want to install and build in the <code>/tmp</code> directory.</p></li><li><p>Install the source file, run the following command with your unprivileged user account, replacing the sed example source RPM with the name of the one that you want to install:</p><pre><code>rpm -i /tmp/sed-4.2.2-2.ph1.src.rpm
</code></pre><p>The above command unpacks the source RPM and places its <code>.spec</code> file in your <code>~/rpmbuild/SPECS</code> directory. In the next step, the <code>rpmbuild</code> tool uses the <code>.spec</code> file to build the RPM.</p></li><li><p>Build the RPM, run the following commands with your unprivileged user account. Replace the <code>sed.spec</code> example file with the name of the <code>.spec</code> file that you want to build.</p><pre><code>cd ~/rpmbuild/SPECS
rpmbuild -ba sed.spec
</code></pre></li></ol><pre><code>
    If successful, the rpmbuild -ba command builds the RPM and generates an RPM package file in your ~/rpmbuild/RPMS/x86_64 directory. For example:
	
    ```
    ls RPMS/x86_64/
	sed-4.2.2-2.x86_64.rpm  sed-debuginfo-4.2.2-2.x86_64.rpm  sed-lang-4.2.2-2.x86_64.rpm
</code></pre><pre><code>The rpmbuild command also generates a new SRPM file and saves it in your ~/rpmbuild/SRPMS directory. For example:  

```
ls SRPMS/
sed-4.2.2-2.src.rpm
</code></pre><pre><code>
    If the rpmbuild command is unsuccessful with an error that it cannot find a library, you must install the RPMs for the library that your source RPM depends on before you can successfully build your source RPM. Iterate through installing the libraries that your source RPM relies on until you can successfully build it. 

1. To install the RPM, run the following command with your unprivileged user account:  
	
    ```
rpm -i RPMS/x86_64/sed-4.2.2-2.x86_64.rpm
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-6634d43432a34970d800d1a0f2b37570>1.7 - Compiling C++ Code on the Minimal Version of Photon OS</h1><p>As a minimalist Linux run-time environment, the minimal version of Photon OS lacks the packages that you need to compile the code for a C++ program. For example, without the requisite packages, trying to compile the file containing the following code with the <code>gcc</code> command will generate errors:</p><pre><code>#include &lt;stdio.h&gt;
int main()
{
return 0;
}
</code></pre><p>The errors appear as follows:</p><pre><code>gcc test.c
-bash: gcc: command not found
tdnf install gcc -y
gcc test.c
test.c:1:19: fatal error: stdio.h: No such file or directory
compilation terminated.
</code></pre><p>To enable the minimal version of Photon OS to preprocess, compile, assemble, and link C++ code, you must install the following packages as root with tdnf:</p><ul><li><code>gcc</code></li><li><code>glibc-devel</code></li><li><code>binutils</code></li></ul><p>To install the packages, use the following the <code>tdnf</code> command:</p><pre><code>tdnf install gcc glibc-devel binutils</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-3e0f72b6cbcb4b80af2d10cb3a877611>2 - Package Management in Photon OS with `tdnf`</h1><p>Photon OS manages packages with an open source, yum-compatible package manager called <code>tdnf</code>, for <a href=https://github.com/vmware/tdnf>Tiny Dandified Yum</a>. Tdnf keeps the operating system as small as possible while preserving yum&rsquo;s robust package-management capabilities.</p></div><div class=td-content><h1 id=pg-f532121e1d7bdf1c548be913843e2b6f>2.1 - Introduction to 'tdnf'</h1><p>On Photon OS, tdnf is the default package manager for installing new packages. It is a C implementation of the DNF package manager without Python dependencies. DNF is the next upcoming major version of yum.</p><p>Tdnf appears in the minimal and full versions of Photon OS. Tdnf reads yum repositories and works like yum. The full version of Photon OS also includes yum, and you can install packages by using yum if you want.</p><p>In the minimal version of Photon OS, you can manage packages by using yum, but you must install it first by running the following <code>tdnf</code> command as root:</p><pre><code>tdnf install yum
</code></pre><p>Tdnf implements a subset of the <code>dnf</code> commands as listed in the <a href=http://dnf.readthedocs.org/en/latest/>dnf guide</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0a58de94f50c4dc5bf089a82799d503a>2.2 - Configuration Files and Repositories</h1><p>The main configuration files reside in /etc/tdnf/tdnf.conf. The configuration file appears as follows:</p><pre><code>cat /etc/tdnf/tdnf.conf
[main]
gpgcheck=1
installonly_limit=3
clean_requirements_on_remove=true
repodir=/etc/yum.repos.d
cachedir=/var/cache/tdnf
</code></pre><p>The cache files for data and metadata reside in /var/cache/tdnf.</p><p>The following repositories appear in /etc/yum.repos.d/ with <code>.repo</code> file extensions:</p><pre><code>ls /etc/yum.repos.d/
lightwave.repo
photon-extras.repo
photon-iso.repo
photon-updates.repo
photon.repo 
</code></pre><p>You can list the the repositories by using the <code>tdnf repolist</code> command. Tdnf filters the results with <code>enabled</code>, <code>disabled</code>, and <code>all</code>. Running the command without specifying an argument returns the enabled repositories:</p><pre><code>tdnf repolist
repo id             repo name                               status
photon-updates      VMware Photon Linux 2.0(x86_64)Updates  enabled
photon-extras       VMware Photon Extras 2.0(x86_64)        enabled
photon              VMware Photon Linux 2.0(x86_64)         enabled
</code></pre><p>The <code>photon-iso.repo</code>, however, does not appear in the list of repositories because it is unavailable on the virtual machine from which these examples are taken. The <code>photon-iso.repo</code> is the default repository and it points to /media/cdrom. The <code>photon-iso.repo</code> appears as follows:</p><pre><code>cat /etc/yum.repos.d/photon-iso.repo
[photon-iso]
name=VMWare Photon Linux 2.0(x86_64)
baseurl=file:///mnt/cdrom/RPMS
gpgkey=file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY
gpgcheck=1
enabled=0
skip_if_unavailable=True
</code></pre><p>The local cache is populated with data from the repository:</p><pre><code>ls -l /var/cache/tdnf/photon
total 8
drwxr-xr-x 2 root root 4096 May 18 22:52 repodata
d-wxr----t 3 root root 4096 May  3 22:51 rpms
</code></pre><p>You can clear the cache to help troubleshoot a problem, but doing so might slow the performance of <code>tdnf</code> until the cache becomes repopulated with data. To clear the cache, use the following command:</p><pre><code>tdnf clean all
Cleaning repos: photon photon-extras photon-updates lightwave
Cleaning up everything
</code></pre><p>The command purges the repository data from the cache:</p><pre><code>ls -l /var/cache/tdnf/photon
total 4
d-wxr----t 3 root root 4096 May  3 22:51 rpms</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b903c9c04d719f1db2b2de6bb5929523>2.3 - Adding a New Repository</h1><p>On Photon OS, you can add a new repository from which <code>tdnf</code> installs packages. To add a new repository, you create a repository configuration file with a <code>.repo</code> extension and place it in <code>/etc/yum.repos.d</code>. The repository can be on either the Internet or a local server containing your in-house applications.</p><p>Be careful if you add a repository that is on the Internet. Installing packages from untrusted or unverified sources might put the security, stability, or compatibility of your system at risk. It might also make your system harder to maintain.</p><p>On Photon OS, the existing repositories appear in the <code>/etc/yum.repos.d</code> directory:</p><pre><code>ls /etc/yum.repos.d/
lightwave.repo
photon-extras.repo
photon-iso.repo
photon-updates.repo
photon.repo 
</code></pre><p>To view the the format and information that a new repository configuration file should contain, see one of the <code>.repo</code> files. The following is an example:</p><pre><code>cat /etc/yum.repos.d/lightwave.repo
[lightwave]
name=VMware Lightwave 1.0(x86_64)
baseurl=https://packages.vmware.com/photon/1.0/lightwave
gpgkey=file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY
gpgcheck=1
enabled=1
skip_if_unavailable=True
</code></pre><p>The minimal information needed to establish a repository is an ID and human-readable name of the repository and its base URL. The ID, which appears in square brackets, must be one word that is unique amoung the system&rsquo;s repositories; in the example above, it is <code>[lightwave]</code>.</p><p>The <code>baseurl</code> is a URL for the repository&rsquo;s repodata directory. For a repository on a local server that can be accessed directly or mounted as a file system, the base URL can be a file referenced by <code>file://</code>. Example:</p><pre><code>baseurl=file:///server/repo/
</code></pre><p>The <code>gpgcheck</code> setting specifies whether to check the GPG signature. The <code>gpgkey</code> setting furnishes the URL for the repository&rsquo;s ASCII-armored GPG key file. Tdnf uses the GPG key to verify a package if its key has not been imported into the RPM database.</p><p>The <code>enabled</code> setting tells <code>tdnf</code> whether to poll the repository. If <code>enabled</code> is set to <code>1</code>, <code>tdnf</code> polls it; if it is set to <code>0</code>, <code>tdnf</code> ignores it.</p><p>The <code>skip_if_unavailable</code> setting instructs <code>tdnf</code> to continue running if the repository goes offline.</p><p>Other options and variables can appear in the repository file. The variables that are used with some of the options can reduce future changes to the repository configuration files. There are variables to replace the value of the version of the package and to replace the base architecture. For more information, see the man page for <code>yum.conf</code> on the full version of Photon OS: <code>man yum.conf</code></p><p>The following is an example of how to add a new repository for a local server that <code>tdnf</code> polls for packages:</p><pre><code>cat &gt; /etc/yum.repos.d/apps.repo &lt;&lt; &quot;EOF&quot;
[localapps]
name=Local In-House Applications(x86_64)
baseurl=file:///appserver/apps
enabled=1
skip_if_unavailable=True
EOF
</code></pre><p>Because this new repository resides on a local server, make sure the Photon OS machine can connect to it by mounting it.</p><p>After establishing a new repository, you must run the following command to update the cached binary metadata for the repositories that <code>tdnf</code> polls:</p><pre><code>tdnf makecache
Refreshing metadata for: 'VMware Lightwave 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)Updates'
Refreshing metadata for: 'VMware Photon Extras 1.0(x86_64)'
Refreshing metadata for: 'Local In-House Applications(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)'
Metadata cache created.
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-7ba787a4fbf0d12a06a9cf6c8ee0fb8c>2.4 - Configure a Repository</h1><p>Photon OS comes with a preconfigured repository called <code>photon-iso</code> that resides in <code>\etc\yum.repos.d.</code> If you receive an access error message when working with the <code>photon-iso</code> repository, it is probably because you do not have the Photon OS ISO mounted. Mount the ISO and the run the following command to update the metadata for all known repositories, including <code>photon-iso</code>:</p><pre><code>mount /dev/cdrom /media/cdrom
tdnf makecache

Refreshing metadata for: 'VMware Lightwave 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)Updates'
Refreshing metadata for: 'VMware Photon Extras 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)'
Metadata cache created.
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-e5a0d6886420253cd7e8d90f45ffcc29>2.5 - Adding the Dev Repository to Get New Packages from the GitHub Dev Branch</h1><p>To try out new packages or the latest versions of existing packages as they are merged into the dev branch of the Photon OS GitHub site, add the <code>dev</code> repository to your repository list.</p><p>Perform th following steps:</p><ol><li>On your Photon OS machine, run the following command as root to create a repository configuration file named <code>photon-dev.repo</code>, place it in <code>/etc/yum.repos.d</code>, and concatenate the repository information into the file:</li></ol><pre><code>cat &gt; /etc/yum.repos.d/photon-dev.repo &lt;&lt; &quot;EOF&quot; 
    [photon-dev]
    name=VMware Photon Linux Dev(x86_64)
    baseurl=https://dl.bintray.com/vmware/photon_dev_$basearch
    gpgkey=file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY
    gpgcheck=1
    enabled=1
    skip_if_unavailable=True
    EOF
``` . 

2. After establishing a new repository, run the following command to update the cached binary metadata for the repositories that `tdnf` polls: 
    
</code></pre><p>tdnf makecache</p><pre><code>
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-31b2264775f23ddd8947d654e34f0054>2.6 - Standard Syntax for tdnf Commands</h1><p>The standard syntax for <code>tdnf</code> commands is the same as that for DNF and is as follows:</p><pre><code>tdnf [options] &lt;command&gt; [&lt;arguments&gt;...]
</code></pre><p>You can view help information by using the following commands:</p><pre><code>tdnf --help
tdnf -h</code></pre></div><div class=td-content><h1 id=pg-01e6ca1fe54c76897b029d7521d14a26>2.6.1 - tndf Commands</h1><p><strong>check</strong>: Checks for problems in installed and available packages for all enabled repositories. The command has no arguments. You can use <code>--enablerepo</code> and <code>--disablerepo</code> to control the repos used. Supported in Photon OS 2.0 (only).</p><p><strong>check-local</strong>: This command resolves dependencies by using the local RPMs to help check RPMs for quality assurance before publishing them. To check RPMs with this command, you must create a local directory and place your RPMs in it. The command, which includes no options, takes the path to the local directory containing the RPMs as its argument. The command does not recursively parse directories. It checks the RPMs only in the directory that you specify. For example, after creating a directory named <code>/tmp/myrpms</code> and placing your RPMs in it, you can run the following command to check them:</p><pre><code>tdnf check-local /tmp/myrpms
Checking all packages from: /tmp/myrpms
Found 10 packages
Check completed without issues
</code></pre><p><strong>check-update</strong>: This command checks for updates to packages. It takes no arguments. The <code>tdnf list updates</code> command performs the same function. Here is an example of the <code>check update</code> command:</p><pre><code>tdnf check-update
rpm-devel.x86_64 	4.11.2-8.ph1 	photon
yum.noarch      	3.4.3-3.ph1 	photon
</code></pre><p><strong>clean</strong>: This command cleans up temporary files, data, and metadata. It takes the argument <code>all</code>. Example:</p><pre><code>tdnf clean all
Cleaning repos: photon photon-extras photon-updates lightwave
Cleaning up everything
</code></pre><p><strong>distro-sync</strong>: This command synchronizes the machine&rsquo;s RPMs with the latest version of all the packages in the repository. The following is an abridged example:</p><pre><code>tdnf distro-sync

Upgrading:
zookeeper                             x86_64        3.4.8-2.ph1               3.38 M
yum                                   noarch        3.4.3-3.ph1               4.18 M

Total installed size: 113.01 M

Reinstalling:
zlib-devel                            x86_64        1.2.8-2.ph1             244.25 k
zlib                                  x86_64        1.2.8-2.ph1             103.93 k
yum-metadata-parser                   x86_64        1.1.4-1.ph1              57.10 k

Total installed size: 1.75 G

Obsoleting:
tftp                                  x86_64        5.2-3.ph1                32.99 k

Total installed size: 32.99 k
Is this ok [y/N]:
</code></pre><p><strong>downgrade</strong>: This command downgrades the package that you specify as an argument to the next lower package version. The following is an example:</p><pre><code>tdnf downgrade boost
Downgrading:
boost                                 x86_64        1.56.0-2.ph1              8.20 M
Total installed size: 8.20 M
Is this ok [y/N]:y
Downloading:
boost                                  2591470    100%
Testing transaction
Running transaction
Complete!
</code></pre><p>To downgrade to a version lower than the next one, you must specify it by name, epoch, version, and release, all properly hyphenated. The following is an example:</p><pre><code>tdnf downgrade boost-1.56.0-2.ph1 
</code></pre><p><strong>erase</strong>: This command removes the package that you specify as an argument.</p><p>To remove a package, run the following command:</p><pre><code>tdnf erase pkgname
</code></pre><p>The following is an example:</p><pre><code>tdnf erase vim
Removing:
vim                                   x86_64        7.4-4.ph1                 1.94 M
Total installed size: 1.94 M
Is this ok [y/N]:
</code></pre><p>You can also erase multiple packages:</p><pre><code>tdnf erase docker cloud-init
</code></pre><p><strong>info</strong>: This command displays information about packages. It can take the name of a package. Or it can take one of the following arguments: all, available, installed, extras, obsoletes, recent, upgrades. The following are examples:</p><pre><code>tdnf info ruby
tdnf info obsoletes
tdnf info upgrades
</code></pre><p><strong>install</strong>: This command takes the name of a package as its argument. It then installs the package and its dependencies.</p><p>To install a package, run the following command:</p><pre><code>tdnf install pkgname
</code></pre><p>The following are examples:</p><pre><code>tdnf install kubernetes
</code></pre><p>You can also install multiple packages:</p><pre><code>tdnf install python-curses lsof audit gettext chkconfig ntsysv bindutils 
     wget gawk irqbalance lvm2 cifs-utils c-ares distrib-compat
</code></pre><p><strong>list</strong>: This command lists the packages of the package that you specify as the argument. The command can take one of the following arguments: all, available, installed, extras, obsoletes, recent, upgrades.</p><pre><code>tdnf list updates
</code></pre><p>The list of packages might be long. To more easily view it, you can concatenate it into a text file, and then open the text file in a text editor:</p><pre><code>tdnf list all &gt; pkgs.txt
vi pkgs.txt
</code></pre><p>To list enabled repositories, run the following command:</p><pre><code>tdnf repolist
</code></pre><p><strong>makecache</strong>: This command updates the cached binary metadata for all known repositories. The following is an example:</p><pre><code>tdnf makecache
Refreshing metadata for: 'VMware Lightwave 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)Updates'
Refreshing metadata for: 'VMware Photon Extras 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)'
Metadata cache created.
</code></pre><p><strong>provides</strong>: This command finds the packages that provide the package that you supply as an argument. The following is an example:</p><pre><code>tdnf provides docker
docker-1.11.0-1.ph1.x86_64 : Docker
Repo     : photon
docker-1.11.0-1.ph1.x86_64 : Docker
Repo     : @System
</code></pre><p><strong>reinstall</strong>: This command reinstalls the packages that you specify. If some packages are unavailable or not installed, the command fails. The following is an example:</p><pre><code>tdnf reinstall docker kubernetes

Reinstalling:
kubernetes                            x86_64        1.1.8-1.ph1             152.95 M
docker                                x86_64        1.11.0-1.ph1             57.20 M

Total installed size: 210.15 M
</code></pre><p><strong>remove</strong>: This command removes a package. When removing a package, tdnf by default also removes dependencies that are no longer used if they were was installed by tdnf as a dependency without being explicitly requested by a user. You can modify the dependency removal by changing the <code>clean_requirements_on_remove</code> option in /etc/tdnf/tdnf.conf to <code>false</code>.</p><pre><code>tdnf remove packagename
</code></pre><p><strong>search</strong>: This command searches for the attributes of packages. The argument can be the names of packages. The following is an example:</p><pre><code>tdnf search docker kubernetes
docker : Docker
docker : Docker
docker-debuginfo : Debug information for package docker
docker : Docker
kubernetes : Kubernetes cluster management
kubernetes : Kubernetes cluster management
kubernetes-debuginfo : Debug information for package kubernetes
kubernetes : Kubernetes cluster management
</code></pre><p>The argument of the search command can also be a keyword or a combination of keywords and packages:</p><pre><code>tdnf search terminal bash
rubygem-terminal-table : Simple, feature rich ascii table generation library
ncurses : Libraries for terminal handling of character screens
mingetty : A minimal getty program for virtual terminals
ncurses : Libraries for terminal handling of character screens
ncurses : Libraries for terminal handling of character screens
bash : Bourne-Again SHell
bash-lang : Additional language files for bash
bash-lang : Additional language files for bash
bash : Bourne-Again SHell
bash-debuginfo : Debug information for package bash
bash : Bourne-Again SHell
bash-lang : Additional language files for bash
</code></pre><p><strong>upgrade</strong>: This command upgrades the package or packages that you specify to an available higher version that tdnf can resolve. If the package is already the latest version, the command returns <code>Nothing to do</code>. The following is an example:</p><pre><code>tdnf upgrade boost

Upgrading:
boost                                 x86_64        1.60.0-1.ph1              8.11 M

Total installed size: 8.11 M
Is this ok [y/N]:y

Downloading:
boost                                  2785950    100%
Testing transaction
Running transaction

Complete!
</code></pre><p>You can also run the <code>upgrade</code> command with the <code>refresh</code> option to update the cached metadata with the latest information from the repositories. The following example refreshes the metadata and then checks for a new version of tdnf but does not find one, so tdnf takes no action:</p><pre><code>tdnf upgrade tdnf --refresh
Refreshing metadata for: 'VMware Lightwave 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)Updates'
Refreshing metadata for: 'VMware Photon Extras 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)'
Nothing to do.
</code></pre><p><strong>upgrade-to</strong>: This command upgrades to the version of the package that you specify. EThe following is an example:</p><pre><code>tdnf upgrade-to ruby2.3
</code></pre><p>The commands and options of tdnf are a subset of those of dnf. For more help with <code>tdnf</code> commands, see the <a href=https://media.readthedocs.org/pdf/dnf/latest/dnf.pdf>DNF documentation</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c8f7031a6c3ac2cb9e73b98f5b4ae2f7>2.6.2 - tndf Command Options</h1><p>You can add the following options to <code>tdnf</code> commands. If the option to override a configuration is unavailable in a command, you can add it to the <code>/etc/tdnf/tdnf.conf</code> configuration file.</p><pre><code>OPTION                     DESCRIPTION
--allowerasing             Allow erasing of installed packages to resolve dependencies
--assumeno                 Answer no for all questions
--best                     Try the best available package versions in transactions
--debugsolver              Dump data aiding in dependency solver debugging info.
--disablerepo=&lt;repoid&gt;     Disable specific repositories by an id or a glob.
--enablerepo=&lt;repoid&gt;      Enable specific repositories
-h, --help                 Display help
--refresh                  Set metadata as expired before running command
--nogpgcheck               Skip gpg check on packages
--rpmverbosity=&lt;debug level name&gt;
                           Debug level for rpm
--version                  Print version and exit
-y, --assumeyes            Answer yes to all questions
-q, --quiet                Quiet operation
</code></pre><p>The following is an example that adds the short form of the <code>assumeyes</code> option to the install command:</p><pre><code>tdnf -y install gcc
Upgrading:
gcc 	x86_64	5.3.0-1.ph1 	91.35 M
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b059e84be831ab0194f275a5954f8533>3 - Managing Services with `systemd`</h1><p>Photon OS manages services with <code>systemd</code>. By using <code>systemd</code>, Photon OS adopts a contemporary Linux standard to bootstrap the user space and concurrently start services. This is an architecture that differs from traditional Linux systems such as SUSE Linux Enterprise Server.</p><p>A traditional Linux system contains an initialization system called SysVinit. With SLES 11, for instance, the SysVinit-style init programs control how the system starts up and shuts down. Init implements system runlevels. A SysVinit runlevel defines a state in which a process or service runs.</p><p>In contrast to a SysVinit system, <code>systemd</code> defines no such runlevels. Instead, <code>systemd</code> uses a dependency tree of targets to determine which services to start when. Combined with the declarative nature of <code>systemd</code> commands, <code>systemd</code> targets reduce the amount of code needed to run a command, leaving you with code that is easier to maintain and probably faster to execute. For an overview of <code>systemd</code>, see <a href=https://www.freedesktop.org/wiki/Software/systemd/>systemd System and Service Manager</a> and the <a href=https://www.freedesktop.org/software/systemd/man/systemd.html>man page for systemd</a>.</p><p>On Photon OS, you must manage services with systemd and <code>systemctl</code>, its command-line utility for inspecting and controlling the system, and not the deprecated commands of <code>init.d</code>.</p><p>For more information, see the index of all the systemd man pages, including systemctl, at
<a href=https://www.freedesktop.org/software/systemd/man/>https://www.freedesktop.org/software/systemd/man/</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-a20282a0c192a1ba77670eae4980540a>3.1 - Viewing Services</h1><p>To view a description of all the loaded and active units, run the <code>systemctl</code> command without any options or arguments:</p><pre><code>systemctl
</code></pre><p>To see all the loaded, active, and inactive units and their description, run the following command:</p><pre><code>systemctl --all
</code></pre><p>To see all the unit files and their current status but no description, run thie following command:</p><pre><code>systemctl list-unit-files
</code></pre><p>The <code>grep</code> command filters the services by a search term, a helpful tactic to recall the exact name of a unit file without looking through a long list of names. Example:</p><pre><code>systemctl list-unit-files | grep network
org.freedesktop.network1.busname           static
dbus-org.freedesktop.network1.service      enabled
systemd-networkd-wait-online.service       enabled
systemd-networkd.service                   enabled
systemd-networkd.socket                    enabled
network-online.target                      static
network-pre.target                         static
network.target                             static</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-e8f72e8f9daeccde0058f5b18b8df2fc>3.2 - Controlling Services</h1><p>To control services on Photon OS, use <code>systemctl</code> command.</p><p>For example, instead of running the <code>/etc/init.d/ssh</code> script to stop and start the OpenSSH server on a init.d-based Linux system, run the following <code>systemctl</code> commands on Photon OS:</p><pre><code>systemctl stop sshd
systemctl start sshd
</code></pre><p>The systemctl tool includes a range of commands and options for inspecting and controlling the state of systemd and the service manager. For more information, see the <a href=https://www.freedesktop.org/software/systemd/man/systemctl.html>systemctl man page</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-66fd8c47a7772e3694a7e6cec277190b>3.3 - Creating a Startup Service</h1><p>Use <code>systemd</code> to create a startup service.</p><p>The following example shows you how to create a systemd startup service that changes the maximum transmission unit (MTU) of the default Ethernet connection, <code>eth0</code>.</p><ol><li>Concatenate the following block of code into a file:</li></ol><pre><code>cat &lt;&lt; EOF &gt;&gt; /lib/systemd/system/eth0.service
	[Unit]
	Description=Network interface initialization
	After=local-fs.target network-online.target network.target
	Wants=local-fs.target network-online.target network.target

	[Service]
	ExecStart=/usr/sbin/ifconfig eth0 mtu 1460 up
	Type=oneshot

	[Install]
	WantedBy=multi-user.target
	EOF
</code></pre><ol><li>Set the service to auto-start when the system boots:</li></ol><pre><code>cd /lib/systemd/system/multi-user.target.wants/
	ln -s ../eth0.service eth0.service
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-18af2aedd7babb8cc32fd9d2eab8c479>3.4 - Disabling the Photon OS httpd.service</h1><p>If your application or appliance includes its own HTTP server, you must turn off and disable the HTTP server that comes with Photon OS so that it does not conflict with your own HTTP server.</p><p>To stop it and disable it, run the following commands as root:</p><pre><code>systemctl stop httpd.service
systemctl disable httpd.service
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-d457ce808bee76ca65bd9f2e4abb80b7>3.5 - Auditing System Events with auditd</h1><p>To manage security on Photon OS, the Linux auditing service <code>auditd</code> is enabled and active by default on the full version of Photon OS.</p><p>The following command shows the security status:</p><pre><code>systemctl status auditd
	* auditd.service - Security Auditing Service
	   Loaded: loaded (/usr/lib/systemd/system/auditd.service; enabled; vendor preset: enabled)
	   Active: active (running) since Fri 2016-04-29 15:08:50 UTC; 1 months 9 days ago
	 Main PID: 250 (auditd)
	   CGroup: /system.slice/auditd.service
	           `-250 /sbin/auditd -n
</code></pre><p>To help improve security, the <code>auditd</code> service can monitor file changes, system calls, executed commands, authentication events, and network access. After you implement an audit rule to monitor an event, the <code>aureport</code> tool generates reports to display information about the events.</p><p>You can use the auditctl utility to set a rule that monitors the <code>sudoers</code> file for changes:</p><pre><code>auditctl -w /etc/sudoers -p wa -k sudoers_changes
</code></pre><p>This rule specifies that the auditd service must watch (<code>-w</code>) the <code>/etc/sudoers</code> file to log permissions changes (<code>-p</code>) to the write access (<code>w</code>) or attributes (<code>a</code>) of the file and to identify them in logs as <code>sudoers_changes</code>. The auditing logs appear in <code>/var/log/audit/audit.log</code>. You can list the auditing rules as follows:</p><pre><code>auditctl -l
-w /etc/sudoers -p wa -k sudoers_changes
</code></pre><p>For more information on the Linux Audit Daemon, see the <code>auditd</code> man page:</p><pre><code>man auditd
</code></pre><p>For more information on setting auditing rules and options, see the <code>auditctl</code> man page:</p><pre><code>man auditctl
</code></pre><p>For more information on viewing reports on audited events, see the <code>aureport</code> man page:</p><pre><code>man aureport
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-d38bfc4c8716171851e4d4916b541b25>3.6 - Analyzing systemd Logs with journalctl</h1><p>The <code>journalctl</code> tool queries the contents of the <code>systemd</code> journal.</p><p>The following command displays the messages that <code>systemd</code> generated the last time the machine started:</p><pre><code>journalctl -b
</code></pre><p>The following command reveals the messages for the systemd service unit specified by the <code>-u</code> option:</p><pre><code>journalctl -u auditd
</code></pre><p>In the above example, <code>auditd</code> is the system service unit.</p><p>For more information, see the <code>journalctl</code> man page by running the following command on Photon OS:</p><pre><code>man journalctl
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-e6d10934c78f7e80adf4be5f4c6af403>3.7 - Migrating Scripts to systemd</h1><p>Although <code>systemd</code> maintains compatibility with <code>init.d</code> scripts, as a best practice, you must adapt the scripts that you want to run on Photon OS to <code>systemd</code> to avoid potential problems.</p><p>Such a conversion standardizes the scripts, reduces the footprint of your code, makes the scripts easier to read and maintain, and improves their robustness on a <code>systemd</code> system.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d1f0e04c6c20c480fc126cc7283bdaca>3.8 -</h1><h1 id=installing-sendmail>Installing Sendmail</h1><p>Before you install Sendmail, you should set the fully qualified domain name (FQDN) of your Photon OS machine.</p><p>By default, Sendmail is not installed with either the minimal or full version of Photon OS. When you install Sendmail, it provides Photon OS with a <code>systemd</code> service file that typically enables Sendmail. If the service is not enabled after installation, you must enable it.</p><p>Sendmail resides in the Photon extras repository. You can install it with <code>tdnf</code> after setting the machine&rsquo;s FQDN.</p><h2 id=procedure>Procedure</h2><ol><li><p>Check whether the FQDN of the machine is set by running the <code>hostnamectl status</code> command:</p><pre><code></code></pre></li></ol><p>hostnamectl status
Static hostname: photon-d9ee400e194e
Icon name: computer-vm
Chassis: vm
Machine ID: a53b414142f944319bd0c8df6d811f36
Boot ID: 1f75baca8cc249f79c3794978bd82977
Virtualization: vmware
Operating System: VMware Photon/Linux
Kernel: Linux 4.4.8
Architecture: x86-64</p><pre><code>
    In the results above, the FQDN is not set. The Photon OS machine only has a short name. If the FQDN were set, the hostname would be in its full form, typically with a domain name. 
    
1. If the machine does not have an FQDN, set one by running `hostnamectl set-hostname new-name`, replacing `new-name` with the FQDN that you want. For example:  
     
    ```
hostnamectl set-hostname photon-d9ee400e194e.corp.example.com
</code></pre><pre><code>The `hostnamectl status` command now shows that the machine has an FQDN: 

```
</code></pre><p>root@photon-d9ee400e194e [ ~ ]# hostnamectl status
Static hostname: photon-d9ee400e194e.corp.example.com
Icon name: computer-vm
Chassis: vm
Machine ID: a53b414142f944319bd0c8df6d811f36
Boot ID: 1f75baca8cc249f79c3794978bd82977
Virtualization: vmware
Operating System: VMware Photon/Linux
Kernel: Linux 4.4.8
Architecture: x86-64</p><pre><code>
1. Install Sendmail: 
    
    ```
tdnf install sendmail
</code></pre><ol><li><p>Verify if Sendmail is enabled:</p><pre><code></code></pre></li></ol><p>systemctl status sendmail</p><pre><code>
1. Enable Sendmail if it is disabled and then start it: 
    
    ```
systemctl enable sendmail
 systemctl start sendmail
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-305c4712c6b1355beeb4783b507fcff1>4 - Configure Wireless Networking</h1><p>You can configure wireless networking in Photon OS. Connect to an open network or a WPA2 protected network using <code>wpa_cli</code> and configure <code>systemd-networkd</code> to assign an IP address to the network.</p><ul><li><a href=#connect-using-wpa-cli>Connect using <code>wpa_cli</code></a></li><li><a href=#assign-ip-address-to-network>Assign IP address to network</a></li></ul><h2 id=connect-using-wpa_cli>Connect Using wpa_cli</h2><p>When you connect using <code>wpa_cli</code>, you can scan for available networks and associate the network with a network ID.</p><p>Perform the following steps:</p><ol><li><p>Ensure that the <code>wpa_supplicant service</code> is running on the WLAN interface:</p><p><code>Systemctl status wpa_supplicant@&lt;wlan-interface>.service</code></p></li><li><p>Connect to <code>wpa_cli</code>:</p><p><code>wpa_cli -i wlan0</code></p></li><li><p>Scan for available networks:</p><p><code>scan</code></p></li><li><p>To see the list of networks, use the following command:</p><p><code>scan_results</code></p></li><li><p>Add the network:</p><p><code>add_network</code></p><p>This command returns a network ID.</p></li><li><p>Associate the network with the network ID.</p><p><code>set_network &lt;network ID> ssid &lt;ssid-name></code></p></li><li><p>For a WPA2 network, set the passphrase:</p><p><code>set_network &lt;network ID> psk &lt;passphrase></code></p></li><li><p>Enable the network:</p><p><code>enable_network &lt;network ID></code></p></li><li><p>Save the configuration file:</p><p><code>save_config</code></p><p>To exit the <code>wpa_cli</code>, type &lsquo;quit`.</p></li></ol><h2 id=assign-ip-address-to-network>Assign IP Address To Network</h2><p>Configure <code>systemd-networkd</code> to assign IP address to network. Perform the following steps:</p><ol><li><p>Create a <code>/etc/systemd/network/98-dhcp-wlan.network</code> file with the following contents:</p><pre><code>[Match]
Name=wlan*
[Network]
DHCP=yes
IPv6AcceptRA=no
</code></pre></li><li><p>Restart <code>systemd-networkd</code> using:</p><p><code>Systemctl restart systemd-networkd</code></p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-b2dadcbb26192ea0e6c9e3d6e835f44d>5 - Managing the Network Configuration</h1><p>The network service, which is enabled by default, starts when the system boots.</p></div><div class=td-content><h1 id=pg-fc53ddd4aeeaf9d82f1d6c96db02600d>5.1 - Commands to Manage Network Service</h1><p>You manage the network service by using systemd commands, such as <code>systemd-networkd</code>, <code>systemd-resolvd</code>, and <code>networkctl</code>.</p><p>To check the status of the network service, run the following command:</p><pre><code>systemctl status systemd-networkd
</code></pre><p><strong>Output</strong></p><pre><code>* systemd-networkd.service - Network Service
   Loaded: loaded (/usr/lib/systemd/system/systemd-networkd.service; enabled; vendor preset: enabled)
   Active: active (running) since Fri 2016-04-29 15:08:51 UTC; 6 days ago
     Docs: man:systemd-networkd.service(8)
 Main PID: 291 (systemd-network)
   Status: &quot;Processing requests...&quot;
   CGroup: /system.slice/systemd-networkd.service
           `-291 /lib/systemd/systemd-networkd
</code></pre><p>Because Photon OS relies on systemd to manage services, you must use the <code>systemd</code> suite of commands and not the deprecated <code>init.d</code> commands or other deprecated commands to manage networking.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-80942de722613148c835397eacd1689e>5.2 - Using the Network Configuration Manager</h1><p>The Network Configuration Manager library that ships with Photon OS 3.0 provides a collection of C, Python, and CLI APIs that simplify common onfiguration tasks for:</p><ul><li>interfaces</li><li>IP addresses (IPv4 and IPv6 addresses)</li><li>routes</li><li>DNS server and domain settings</li><li>DHCP DUID and IAID settings</li><li>NTP server settings</li><li>service management</li><li>object parameters (interfaces and files)</li></ul><p>For more information, see:</p><ul><li><strong>CLI</strong> - see the <code>-net</code> commands in the <a href=../../../command-line-reference/commnad-line-interfaces/photon-management-daemon-cli/>Photon Management Daemon Command-line Interface (pmd-cli)</a></li><li><strong>C APIs</strong> - <a href=../netmgr.c/>Network Configuration Manager - C API</a></li><li><strong>Python APIs</strong> - <a href=../netmgr.python/>Network Configuration Manager - Python API</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-9629bafba70f4f15cd61e4059d52ccfc>5.3 - Use `ip` and `ss` Commands</h1><p>Use the <code>ip</code> and <code>ss</code> commands to view a list of network interfaces and information for IP addresses.</p><p>Although the <code>ifconfig</code> command and the <code>netstat</code> command work on Photon OS, VMware recommends that you use the <code>ip</code> or <code>ss</code> commands. The <code>ipconfig</code> and <code>netstat</code> commands are deprecated.</p><p>For example, to display a list of network interfaces, run the <code>ss</code> command instead of <code>netstat</code>. To display information for IP addresses, run the <code>ip addr</code> command instead of <code>ifconfig -a</code>.</p><p>Examples are as follows:</p><pre><code>USE THIS IPROUTE COMMAND 	INSTEAD OF THIS NET-TOOL COMMAND
ip addr 					ifconfig -a
ss 							netstat
ip route 					route
ip maddr 					netstat -g
ip link set eth0 up 		ifconfig eth0 up
ip -s neigh					arp -v
ip link set eth0 mtu 9000	ifconfig eth0 mtu 9000
</code></pre><p>Using the <code>ip route</code> version of a command instead of the net-tools version often provides more complete and accurate information on Photon OS. Examples are as follows:</p><pre><code>ip neigh
198.51.100.2 dev eth0 lladdr 00:50:56:e2:02:0f STALE
198.51.100.254 dev eth0 lladdr 00:50:56:e7:13:d9 STALE
198.51.100.1 dev eth0 lladdr 00:50:56:c0:00:08 DELAY

arp -a
? (198.51.100.2) at 00:50:56:e2:02:0f [ether] on eth0
? (198.51.100.254) at 00:50:56:e7:13:d9 [ether] on eth0
? (198.51.100.1) at 00:50:56:c0:00:08 [ether] on eth0
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-6e2e43bbd8612f6f86b51fa951265dee>5.4 - Configuring Network Interfaces</h1><p>Network configuration files for systemd-networkd reside in <code>/etc/systemd/network</code> and <code>/usr/lib/systemd/network</code>. Example:</p><pre><code>root@photon-rc [ ~ ]# ls /etc/systemd/network/
99-dhcp-en.network
</code></pre><p>By default, when Photon OS starts, it creates a DHCP network configuration file, or rule, which appears in /etc/systemd/network, the highest priority directory for network configuration files with the lowest priority filename:</p><pre><code>cat /etc/systemd/network/99-dhcp-en.network
[Match]
Name=e*

[Network]
DHCP=yes
</code></pre><p>Network configuration files can also appear in the system network directory, <code>/usr/lib/systemd/network</code>, as the results of the following search illustrate:</p><pre><code>root@photon-rc [ ~ ]# updatedb
root@photon-rc [ ~ ]# locate systemd/network
/etc/systemd/network
/etc/systemd/network/99-dhcp-en.network
/usr/lib/systemd/network
/usr/lib/systemd/network/80-container-host0.network
/usr/lib/systemd/network/80-container-ve.network
/usr/lib/systemd/network/99-default.link
root@photon-rc [ ~ ]#
</code></pre><p>In the above search, the <code>/usr/lib/systemd/network</code> directory contains several network configuration files. Photon OS applies the configuration files in <a href=https://en.wikipedia.org/wiki/Lexicographical_order>lexicographical order</a> specified by the file names without regard for the network configuration directory in which the file resides unless the file name is the same. Photon OS processes files with identical names by giving precedence to files in the <code>/etc</code> directory over the other directory. Thus, the settings in <code>/etc/systemd/network</code> override those in <code>/usr/lib/systemd/network</code>. Once Photon OS matches an interface in a file, Photon OS ignores the interface if it appears in files processed later in the lexicographical order.</p><p>Each .network file contains a matching rule and a configuration that Photon OS applies when a device matches the rule. Set the matching rule and the configuration as sections containing vertical sets of key-value pairs according to the information in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>systemd network configuration</a>.</p><p>To configure Photon OS to handle a networking use case, such as setting a static IP address or adding a name server, create a configuration file with a <code>.network</code> extension and place it in the <code>/etc/systemd/network directory</code>.</p><p>After you create a network configuration file with a <code>.network</code> extension, you must run the <code>chmod</code> command to set the new file&rsquo;s mode bits to <code>644</code>. Example:</p><pre><code>chown systemd-network:systemd-network 10-static-en.network
</code></pre><p>For Photon OS to apply the new configuration, you must restart the <code>systemd-networkd</code> service by running the following command:</p><pre><code>systemctl restart systemd-networkd
</code></pre><p>For information about network configuration files, their processing order, and their matching rules, sections, and keys, see <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>.</p><p>For information about creating virtual network device files (<code>.netdev</code>), see <a href=https://www.freedesktop.org/software/systemd/man/systemd.netdev.html>https://www.freedesktop.org/software/systemd/man/systemd.netdev.html</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-24b8ff5a4b30298fd0bb1eb1054befa8>5.5 - Setting a Static IP Address</h1><p>Before you set a static IP address, obtain the name of your Ethernet link by running the following command:</p><pre><code>networkctl
IDX LINK             TYPE               OPERATIONAL SETUP
  1 lo               loopback           carrier     unmanaged
  2 eth0             ether              routable    configured
</code></pre><p>In the results of the command, you can see the name of an Ethernet link, <code>eth0</code>.</p><p>To create a network configuration file that systemd-networkd uses to establish a static IP address for the eth0 network interface, execute the following command as root:</p><pre><code>cat &gt; /etc/systemd/network/10-static-en.network &lt;&lt; &quot;EOF&quot;

[Match]
Name=eth0

[Network]
Address=198.51.0.2/24
Gateway=198.51.0.1
EOF
</code></pre><p>Change the new file&rsquo;s mode bits by running the <code>chmod</code> command:</p><pre><code>chmod 644 10-static-en.network
</code></pre><p>Apply the configuration by running the following command:</p><pre><code>systemctl restart systemd-networkd
</code></pre><p>For more information, see the man page for systemd-networkd: <code>man systemd.network</code></p></div><div class=td-content style=page-break-before:always><h1 id=pg-8d3a3360097ed466fb3816843d3f0651>5.6 - Turning Off DHCP</h1><p>By default, when Photon OS first starts, it creates a DHCP network configuration file or rule, which appears in <code>/etc/systemd/network</code>, the highest priority directory for network configuration files with the lowest priority filename:</p><pre><code>cat /etc/systemd/network/99-dhcp-en.network
[Match]
Name=e*

[Network]
DHCP=yes
</code></pre><p>To turn off DHCP for all Ethernet interfaces, change the value of <code>DHCP</code> from <code>yes</code> to <code>no</code>, save the changes, and then restart the <code>systemd-networkd</code> service:</p><pre><code>systemctl restart systemd-networkd
</code></pre><p>If you create a configuration file with a higher priority filename (e.g. <code>10-static-en.network</code>), it is not necessary but still recommended to turn off DHCP.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a552c6bd7a3b651db21dc3817083c578>5.7 - Adding a DNS Server</h1><p>Photon OS uses <code>systemd-resolved</code> to resolve domain names, IP addresses, and network names for local applications. The <code>systemd-resolved</code> daemon automatically creates and maintains the <code>/etc/resolv.conf</code> file, into which systemd-resolved places the IP address of the DNS server. You must not modify the <code>/etc/resolv.conf</code> file.</p><p><strong>Note</strong>: If you want to implement a local resolver like <code>bind</code> instead of <code>systemd-resolved</code>, stop the <code>systemd-resolved</code> service and disable it.</p><p>If you open the default <code>/etc/resolv.conf</code> file after you deploy Photon OS, it looks like this:</p><pre><code>root@photon-rc [ ~ ]# cat /etc/resolv.conf
# This file is managed by systemd-resolved(8). Do not edit.
#
# Third party programs must not access this file directly, but
# only through the symlink at /etc/resolv.conf. To manage
# resolv.conf(5) in a different way, replace the symlink by a
# static file or a different symlink.

nameserver 198.51.100.2
</code></pre><p>To add a DNS server, insert a DNS key into the Network section of the static network configuration file, for example, <code>/etc/systemd/network/10-eth0-static.network</code> and set it to the IP address of your DNS server:</p><pre><code>[Match]
Name=e*

[Network]
Address=198.51.0.2/24
Gateway=198.51.0.1
DNS=198.51.0.1
</code></pre><p><strong>Note</strong>: To apply the changes made to <code>/etc/systemd/network/*.network</code> files, perform the following:</p><ul><li>Restart <code>systemd-networkd</code> and <code>systemd-resolved</code> services by running the following commands:<ul><li><code>systemctl restart systemd-networkd</code></li><li><code>systemctl restart systemd-resolved</code></li></ul></li></ul><p>If your machine is working with DHCP, you can add a DNS server by modifying the <code>/etc/systemd/resolved.conf--a</code> method.</p><p>For more information, see <a href=https://www.freedesktop.org/software/systemd/man/resolved.conf.html>https://www.freedesktop.org/software/systemd/man/resolved.conf.html</a>.</p><p>You can optionally activate the local DNS stub resolver of systemd-resolved by adding <code>dns</code> and <code>resolve</code> to the <code>/etc/nsswitch.conf</code> file. To do so, make a backup copy of the <code>/etc/nsswitch.conf</code> file and then execute the following command as root:</p><pre><code>sed -i 's/^hosts.*$/hosts: files resolve dns/' /etc/nsswitch.conf
</code></pre><p>For more information about the <code>systemd-resolved</code> service, see <a href=https://www.freedesktop.org/software/systemd/man/systemd-resolved.service.html>https://www.freedesktop.org/software/systemd/man/systemd-resolved.service.html</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-5b4e7843381c14bbcd362defe84933e6>5.8 - Setting Up Networking for Multiple NICs</h1><p>If your machine contains multiple NICs, it is recommend that you create a <code>.network</code> configuration file for each network interface. The following scenario demonstrates how to set one wired network interface to use a static IP address and another wired network interface to use a dynamic IP address obtained through DHCP.</p><p><strong>Note</strong>: The following configurations are examples and you must change the IP addresses and other information to match your network and requirements.</p><p>First, create the <code>.network</code> file for the static Ethernet connection in <code>/etc/systemd/network</code>. A best practice is to match the exact name of the network interface, which is <code>eth0</code> in this example. This example file also includes a DNS server for the static IP address. As a result, the configuration sets the UseDNS key to false in the DHCP column so that Photon OS ignores the DHCP server for DNS for this interface.</p><pre><code>cat &gt; /etc/systemd/network/10-eth0-static-en.network &lt;&lt; &quot;EOF&quot;
[Match]
Name=eth0

[Network]
Address=10.137.20.11/19
Gateway=10.137.23.253
DNS=10.132.71.1

[DHCP]
UseDNS=false
EOF
</code></pre><p>Second, create the <code>.network</code> file for the second network interface, which is <code>eth1</code> in this example. This configuration file sets the eth1 interface to an IP address from DHCP and sets DHCP as the source for DNS lookups. Setting the DHCP key to <code>yes</code> acquires an IP address for IPv4 and IPv6. To acquire an IP address for IPv4 only, set the DHCP key to <code>ipv4</code>.</p><pre><code>cat &gt; /etc/systemd/network/50-eth1-dhcp-en.network &lt;&lt; &quot;EOF&quot;

[Match]
Name=eth1

[Network]
DHCP=yes  

[DHCP]
UseDNS=true
EOF</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-e9ae6aae699b9a9210f9a60cf34af138>5.8.1 - Combining DHCP and Static IP Addresses with IPv4 and IPv6</h1><p>You can combine DHCP and static IP addresses with both IPv4 and IPv6.</p><h2 id=examples>Examples</h2><p>The following example shows how to use DHCP to allocate both IPv4 and IPv6 addresses:</p><pre><code>[Network]
DHCP=yes
</code></pre><p>The following example shows how to use DHCP to allocate only IPv4 addresses:</p><pre><code>[Network]
DHCP=ipv4
</code></pre><p>The following example shows how to use DHCP to allocate only IPv6 addresses:</p><pre><code>[Network]
DHCP=ipv6
</code></pre><p>The following example shows how to use DHCP for IPv4 addresses and static IP addresses for IPv6 addresses:</p><pre><code>[Network]
DHCP=ipv4
Address=fd00::1/48
Gateway=fd00::252
</code></pre><p>The following example shows how to use DHCP for IPv6 addresses and static IP addresses for IPv4:</p><pre><code>[Network]
DHCP=ipv6
Address=10.10.10.1/24
Gateway=10.10.10.253
</code></pre><p>The following example shows how to use static IP addresses for both IPv4 and IPv6:</p><pre><code>[Network]
DHCP=ipv6
Address=10.10.10.1/24
Gateway=10.10.10.253
Address=fd00::1/48
Gateway=fd00::252</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b41fae09f8057342561ce3ed6fe2bf0a>5.9 - Clearing the Machine ID of a Cloned Instance for DHCP</h1><p>Photon OS uses the contents of <code>/etc/machine-id</code> to determine the DHCP unique identifier (duid) that is used for DHCP requests. If you use a Photon OS instance as the base system for cloning, to create additional Photon OS instances, you must clear the <code>machine-id</code> with this command:</p><pre><code>echo -n &gt; /etc/machine-id
</code></pre><p>When the value is cleared, <code>systemd</code> regenerates the machine-id and all DHCP requests will contain a unique duid.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-97b31518a5a4646e2d150af3ccdebc62>5.10 - Using Predictable Network Interface Names</h1><p>When you run Photon OS on a virtual machine or a bare-metal machine, the Ethernet network interface name might shift from one device to another if you add or remove a card and reboot the machine. For example, a device named <code>eth2</code> might become <code>eth1</code> after you remove a NIC and restart the machine.</p><p>You can prevent interface names from reordering by turning on <a href=https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/>predictable network interface names</a>. The naming schemes that Photon OS uses can then assign fixed, predictable names to network interfaces even after you add or remove cards or other firmware and the restart the system.</p><p>When you enable predictable network interface names, you can use one of the following options to assign persistent names to network interfaces:</p><ul><li>Apply the <code>slot</code> name policy to set the name of networking devices in the <code>ens</code> format with a statically assigned PCI slot number.</li><li>Apply the <code>mac</code> name policy to set the name of networking devices in the <code>enx</code> format a unique MAC address.</li><li>Apply the <code>path</code> name policy to set the name of networking devices in the <code>enpXsY</code> format derived from a device connector&rsquo;s physical location.</li></ul><p>Though Photon OS supports the <code>onboard</code> name policy to set the name of networking devices from index numbers given by the firmware in the <code>eno</code> format, the policy might result in nonpersistent names.</p><p>The option to choose depends on your use case and your unique networking requirements. For example, when you clone virtual machines and require the MAC addresses to be different from one another but the interface name to be the same, consider using <code>ens</code> to keep the slot the same after system reboots.</p><p>Alternatively, if the cloning function supports <code>enx</code>, you can use it to set a MAC address which persists after reboots.</p><p>Perform the following steps to turn on predictable network interface names:</p><ol><li><p>Make a backup copy of the following file in case you need to restore it later:</p><pre><code>cp /boot/grub/grub.cfg /boot/grub/grub.cfg.original
</code></pre></li><li><p>To turn on predictable network interface names, edit <code>/boot/grub/grub.cfg</code> to remove the following string:</p><pre><code>net.ifnames=0Item
</code></pre><p>The string appears near the bottom of the file in the <code>menuentry</code> section:</p><pre><code>menuentry &quot;Photon&quot; {
   linux &quot;/boot/&quot;$photon_linux root=$rootpartition net.ifnames=0 $photon_cmdline
   if [ &quot;$photon_initrd&quot; ]; then
        initrd &quot;/boot/&quot;$photon_initrd
   fi
}
# End /boot/grub2/grub.cfg
</code></pre><p>Edit out <code>net.ifnames=0</code>, but make no other changes to the file, and then save it.</p></li><li><p>Specify the types of policies that you want to use for predictable interface names by modifying the <code>NamePolicy</code> option in <code>/lib/systemd/network/99-default.link</code>. The file contents are as follows:</p><pre><code>cat /lib/systemd/network/99-default.link
[Link]
NamePolicy=kernel database
MACAddressPolicy=persistent

</code></pre></li></ol><p>To use the <code>ens</code> or <code>enx</code> option, the <code>slot</code> policy or the <code>mac</code> policy can be added to the space-separated list of policies that follow the <code>NamePolicy</code> option in the default link file, <code>/lib/systemd/network/99-default.link</code>. The order of the policies matters. Photon OS applies the policy listed first before proceeding to the next policy if the first one fails.</p><p>For example:</p><pre><code>/lib/systemd/network/99-default.link
    [Link]
    NamePolicy=slot mac kernel database
    MACAddressPolicy=persistent
</code></pre><p>With the name policy specified in the above example, you might still have an Ethernet-style interface name if the two previous policies, <code>slot</code> and <code>mac</code>, fail.</p><p>For information on setting name policies, see <a href=https://www.freedesktop.org/software/systemd/man/systemd.link.html>systemd.link&ndash;network device configuration</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8c81b2cb6747cd35911212e45c01f3d4>5.11 - Inspecting the Status of Network Links with `networkctl`</h1><p>You can inspect information about network connections by using the <code>networkctl</code> command. This can help you configure networking services and troubleshoot networking problems.</p><p>You can progressively add options and arguments to the <code>networkctl</code> command to move from general information about network connections to specific information about a network connection.</p><h1 id=networkctl-command-without-options><code>networkctl</code> Command Without Options</h1><p>Run the <code>networkctl</code> command without options to default to the list command:</p><pre><code>networkctl
IDX LINK             TYPE               OPERATIONAL SETUP
  1 lo               loopback           carrier     unmanaged
  2 eth0             ether              routable    configured
  3 docker0          ether              routable    unmanaged
 11 vethb0aa7a6      ether              degraded    unmanaged
 4 links listed.
</code></pre><h2 id=networkctl-status-command><code>networkctl status</code> Command</h2><p>Run <code>networkctl</code> with the status command to display the following information:</p><pre><code>root@photon-rc [ ~ ]# networkctl status
	*      State: routable
	     Address: 198.51.100.131 on eth0
	              172.17.0.1 on docker0
	              fe80::20c:29ff:fe55:3ca6 on eth0
	              fe80::42:f0ff:fef7:bd81 on docker0
	              fe80::4c84:caff:fe76:a23f on vethb0aa7a6
	     Gateway: 198.51.100.2 on eth0
	         DNS: 198.51.100.2
</code></pre><p>You can see that there are active network links with IP addresses for not only the Ethernet connection but also a Docker container.</p><h3 id=networkctl-status-command-with-network-link-option><code>networkctl status</code> Command With Network Link Option</h3><p>You can add a network link, such as the Ethernet connection, as the argument of the <code>status</code> command to show specific information about the link:</p><pre><code>	root@photon-rc [ ~ ]# networkctl status eth0
	* 2: eth0
	       Link File: /usr/lib/systemd/network/99-default.link
	    Network File: /etc/systemd/network/99-dhcp-en.network
	            Type: ether
	           State: routable (configured)
	            Path: pci-0000:02:01.0
	          Driver: e1000
	      HW Address: 00:0c:29:55:3c:a6 (VMware, Inc.)
	             MTU: 1500
	         Address: 198.51.100.131
	                  fe80::20c:29ff:fe55:3ca6
	         Gateway: 198.51.100.2
	             DNS: 198.51.100.2
	        CLIENTID: ffb6220feb00020000ab116724f520a0a77337
</code></pre><h3 id=networkctl-status-command-with-docker-option><code>networkctl status</code> Command With Docker Option</h3><p>You can add a Docker container as the argument of the <code>status</code> command to show specific information about the container:</p><pre><code>networkctl status docker0
	* 3: docker0
	       Link File: /usr/lib/systemd/network/99-default.link
	    Network File: n/a
	            Type: ether
	           State: routable (unmanaged)
	          Driver: bridge
	      HW Address: 02:42:f0:f7:bd:81
	             MTU: 1500
	         Address: 172.17.0.1
	                  fe80::42:f0ff:fef7:bd81
</code></pre><p>In the example above, the state of the Docker container is unmanaged because Docker handles managing the networking for the containers without using systemd-resolved or systemd-networkd. Docker manages the container connection by using its bridge drive.</p><p>For more information about <code>networkctl</code> commands and options, see <a href=https://www.freedesktop.org/software/systemd/man/networkctl.html>https://www.freedesktop.org/software/systemd/man/networkctl.html</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-29409ea1e796abd82aedb1fccefb6eb4>5.12 - Turning On Network Debugging</h1><p>You can set <code>systemd-networkd</code> to work in debug mode so that you can analyze log files with debugging information to help troubleshoot networking problems.</p><p>You can turn on network debugging by adding a drop-in file in <code>/etc/systemd</code> to customize the default systemd configuration in <code>/usr/lib/systemd</code>.</p><p><strong>Procedure</strong></p><ol><li><p>Run the following command as root to create a directory with the name <code>systemd-networkd.service.d</code>, including the <code>.d</code> extension:</p><pre><code></code></pre></li></ol><p>mkdir -p /etc/systemd/system/systemd-networkd.service.d/</p><pre><code>
1. Run the following command as root to establish a `systemd` drop-in unit with a debugging configuration for the network service:

    ```
cat &gt; /etc/systemd/system/systemd-networkd.service.d/10-loglevel-debug.conf &lt;&lt; &quot;EOF&quot;
	[Service]
	Environment=SYSTEMD_LOG_LEVEL=debug
	EOF
</code></pre><ol><li><p>Reload the <code>systemctl</code> daemon and restart the <code>systemd-networkd</code> service for the changes to take effect:</p><pre><code></code></pre></li></ol><p>systemctl daemon-reload
systemctl restart systemd-networkd</p><pre><code>
1. Verify your changes:

    ```
systemd-delta --type=extended
</code></pre><ol><li><p>View the log files by running this command:</p><pre><code></code></pre></li></ol><p>journalctl -u systemd-networkd</p><pre><code>
1. After debugging the network connections, turn debugging off by deleting the drop-in file: 
	
    ```
rm /etc/systemd/system/systemd-networkd.service.d/10-loglevel-debug.conf
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-27c7642ff95c8161690077370fc57222>5.13 - Mounting a Network File System</h1><p>To mount a network file system, Photon OS requires <code>nfs-utils</code>. The <code>nfs-utils</code> package contains the daemon, userspace server, and client tools for the kernel Network File System (NFS). The tools include <code>mount.nfs</code>, <code>umount.nfs</code>, and <code>showmount</code>.</p><p>The <code>nfs-utils</code> package is installed by default in the full version of Photon OS but not in the minimal version. To install <code>nfs-utils</code> in the minimal version, run the following command as root:</p><pre><code>tdnf install nfs-utils
</code></pre><p>For instructions on how to use <code>nfs-utils</code> to share files over a network, see <a href=../../../user-guide/mounting-remote-file-systems/>Photon OS nfs-utils</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-32b838b1422d5e03790da93aae06b2c3>5.14 - Network Configuration Manager - C API</h1><p>Photon OS 2.0 provides a C API for the Network Configuration Manager.</p><ul><li><a href=#about-the-network-configuration-manager-c-api>About the Network Configuration Manager C API</a></li><li><a href=#interface-configuration-apis>Interface Configuration APIs</a></li><li><a href=#ip-address-configuration-apis>IP Address Configuration APIs</a></li><li><a href=#route-configuration-apis>Route Configuration APIs</a></li><li><a href=#dns-configuration-apis>DNS Configuration APIs</a></li><li><a href=#dhcp-options-duid-and-iaid-configuration-apis>DHCP Options DUID and IAID Configuration APIs</a></li><li><a href=#ntp-configuration-apis>NTP Configuration APIs</a></li><li><a href=#service-management-apis>Service Management APIs</a></li></ul><h1 id=about-the-network-configuration-manager-c-api>About the Network Configuration Manager C API</h1><p>Use the Network Configuration Manager C API to simplify common network configuration tasks for:</p><ul><li>interfaces</li><li>IP addresses (IPv4 and IPv6 addresses)</li><li>routes</li><li>DNS server and domain settings</li><li>DHCP DUID and IAID settings</li><li>NTP server settings</li><li>service management</li><li>object parameters (interfaces and files)</li></ul><h2 id=header-file>Header File</h2><p>Header files for all the C APIs are defined in the following location:</p><p><a href=https://github.com/vmware/pmd/tree/master/include>https://github.com/</a> <a href=https://github.com/vmware/pmd/tree/master/include>vmware</a> <a href=https://github.com/vmware/pmd/tree/master/include>/pmd/tree/master/include</a></p><p>To install the Network Configuration Manager header file, run the following command:</p><p><code>tdnf install netmgmt-devel</code>
n
Once installed, you can reference the header file in the following location:</p><p><code>/usr/include/netmgmt/netmgr.h</code></p><h2 id=freeing-memory>Freeing Memory</h2><p>For all get APIs that take a pointer-to-pointer parameter, the caller has the responsibility to free the memory upon successful response from API by calling free().</p><h2 id=error-codes>Error Codes</h2><p>All C API calls return 0 for success, or one of the following error codes for failure.</p><ul><li>4097 - NM_ERR_INVALID_PARAMETER</li><li>4098 - NM_ERR_NOT_SUPPORTED</li><li>4099 - NM_ERR_OUT_OF_MEMORY</li><li>4100 - NM_ERR_VALUE_NOT_FOUND</li><li>4101 - NM_ERR_VALUE_EXISTS</li><li>4102 - NM_ERR_INVALID_INTERFACE</li><li>4103 - NM_ERR_INVALID_ADDRESS</li><li>4104 - NM_ERR_INVALID_MODE</li><li>4105 - NM_ERR_BAD_CONFIG_FILE</li><li>4106 - NM_ERR_WRITE_FAILED</li><li>4107 - NM_ERR_TIME_OUT</li><li>4108 - NM_ERR_DHCP_TIME_OUT</li></ul><p>Use nm_get_error_info to retrieve information about an error code.</p><pre><code> const char \*
 nm_get_error_info(
     uint32_t nmErrCode
 );``
</code></pre><h1 id=interface-configuration-apis>Interface Configuration APIs</h1><p>The Photon OS 2.0 network manager C API enables you to manage network interfaces.</p><h2 id=structure-declarations>Structure Declarations</h2><h3 id=link-mode>Link Mode</h3><p><strong>Description</strong></p><p>Link mode. Available settings:</p><ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_LINK_MODE
 {
     LINK_AUTO = 0,
     LINK_MANUAL,
     LINK_MODE_UNKNOWN
 } NET_LINK_MODE;``
</code></pre><h3 id=link-state>Link State</h3><p><strong>Description</strong></p><p>Link state. Available settings:</p><ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal</li><li><code>LINK_STATE_UNKNOWN</code> - link state is unknown</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_LINK_STATE
 {
     LINK_DOWN = 0,
     LINK_UP,
     LINK_STATE_UNKNOWN,
 } NET_LINK_STATE;
</code></pre><h3 id=link-information>Link Information</h3><p><strong>Description</strong></p><p>Link information. Includes the following information:</p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li><li><code>mtu</code> - maximum transmission unit (MTU)</li><li><code>mode</code> - link mode (see above)</li><li><code>state</code> - link state (see above)</li></ul><p><strong>Declaration</strong></p><pre><code> typedef struct _NET_LINK_INFO
 {
     struct _NET_LINK_INFO \*pNext;
     char \*pszInterfaceName;
     char \*pszMacAddress;
     uint32_t mtu;
     NET_LINK_MODE mode;
     NET_LINK_STATE state;
 } NET_LINK_INFO, \*PNET_LINK_INFO;
</code></pre><h2 id=nm_set_link_mac_addr>nm_set_link_mac_addr</h2><p><strong>Description</strong></p><p>Set the MAC address of the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t

nm_set_link_mac_addr(

     const char \*pszInterfaceName,
     const char \*pszMacAddress
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_mac_addr>nm_get_link_mac_addr</h2><p><strong>Description</strong></p><p>Get the MAC address of the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_link_mac_addr(
     const char \*pszInterfaceName,
     char \*\*ppszMacAddress
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>ppszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_link_mode>nm_set_link_mode</h2><p><strong>Description</strong></p><p>Set the mode of the interface (auto or manual).</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_link_mode(
     const char \*pszInterfaceName,
     NET_LINK_MODE mode
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>mode</code> - link mode. One of the following values:<ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_mode>nm_get_link_mode</h2><p><strong>Description</strong></p><p>Get the mode of the interface (auto or manual).</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_link_mode(
     const char \*pszInterfaceName,
     NET_LINK_MODE \*pLinkMode
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pLinkMode</code> - link mode. One of the following values:<ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_link_mtu>nm_set_link_mtu</h2><p><strong>Description</strong></p><p>Set the maximum transmission unit (MTU) of the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_link_mtu(
     const char \*pszInterfaceName,
     uint32_t mtu
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>mtu</code> - maximum transmission unit (MTU)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_mtu>nm_get_link_mtu</h2><p><strong>Description</strong></p><p>Get the maximum transmission unit (MTU) of the interface.</p><p><strong>Declaration</strong></p><pre><code>nm_get_link_mtu
 uint32_t
 nm_get_link_mtu(
     const char \*pszInterfaceName,
     uint32_t \*pMtu
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pMtu</code> - maximum transmission unit (MTU)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_link_state>nm_set_link_state</h2><p><strong>Description</strong></p><p>Set the link state of the interface (up or down).</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_set_link_state(
     const char \*pszInterfaceName,
     NET_LINK_STATE state
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>state</code> - link state. One of the following values:<ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal.</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal.</li><li><code>LINK_STATE_UNKNOWN</code> - the link state is unknown</li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_state>nm_get_link_state</h2><p><strong>Description</strong></p><p>Get the link state of the interface (up or down).</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_link_state(
     const char \*pszInterfaceName,
     NET_LINK_STATE \*pLinkState
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pLinkState</code> - link state. One of the following values:<ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal</li><li><code>LINK_STATE_UNKNOWN</code> - the link state is unknown</li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_ifup>nm_ifup</h2><p><strong>Description</strong></p><p>Set the specified interface state to UP. Additionally, if the interface is configured to have an IP address, it waits for the interface to acquire the IP address, and then updates neighbors of its IP address via the address resolution protocol (ARP) messages.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_ifup(
     const char \*pszInterfaceName
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_ifdown>nm_ifdown</h2><p><strong>Description</strong></p><p>Set the specified interface state to DOWN.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_ifdown(
     const char \*pszInterfaceName
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_info>nm_get_link_info</h2><p><strong>Description</strong></p><p>Get link information for the interface. The caller is responsible for freeing ppLinkInfo by calling nm_free_link_info.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_link_info(
     const char \*pszInterfaceName,
     NET_LINK_INFO \*\*ppLinkInfo
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>ppLinkInfo</code>, which includes the following information:<ul><li>*<code>pszInterfaceName</code> - interface name</li><li>*<code>pszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li><li><code>mtu</code> - maximum transmission unit (MTU)</li><li><code>mode</code> - One of the following values:<ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul></li><li><code>state</code> - One of the following values:<ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal</li><li><code>LINK_STATE_UNKNOWN</code> - the link state is unknown</li></ul></li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_free_link_info>nm_free_link_info</h2><p><strong>Description</strong></p><p>Frees the NET_LINK_INFO structure returned by a successful nm_get_link_info call.</p><p><strong>Declaration</strong></p><pre><code>void
 nm_free_link_info(
     NET_LINK_INFO \*pNetLinkInfo
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pNetLinkInfo</code>, which includes the following information:<ul><li>*<code>pszInterfaceName</code> - interface name</li><li>*<code>pszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li><li><code>mtu</code> - maximum transmission unit (MTU)</li><li><code>mode</code> - One of the following values:<ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul></li><li><code>state</code> - One of the following values:<ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal</li><li><code>LINK_STATE_UNKNOWN</code> - the link state is unknown</li></ul></li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=ip-address-configuration-apis>IP Address Configuration APIs</h1><p>The Photon OS 2.0 network manager C API enables you to manage IP addresses for interfaces that are managed by systemd network manager.</p><h2 id=structure-declarations-1>Structure Declarations</h2><h3 id=ip-address-mode>IP Address Mode</h3><p><strong>Description</strong></p><p>Defines the IP address mode. One of the following values:</p><ul><li><code>IPV4_ADDR_MODE_NONE</code> - no IPv4 address configured on the interface</li><li><code>IPV4_ADDR_MODE_STATIC</code> - the interface is configured with a static IPv4 address</li><li><code>IPV4_ADDR_MODE_DHCP</code> - the interface is configured with a DHCP IPv4 address</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_IPV4_ADDR_MODE
 {
     IPV4_ADDR_MODE_NONE = 0,
     IPV4_ADDR_MODE_STATIC,
     IPV4_ADDR_MODE_DHCP,
     IPV4_ADDR_MODE_MAX
 } NET_IPV4_ADDR_MODE;
</code></pre><h3 id=address-type>Address Type</h3><p><strong>Description</strong></p><p>Defines the type of IP address. One of the following options:</p><ul><li><code>STATIC_IPV4</code> - static IPv4 address</li><li><code>STATIC_IPV6</code> - static IPv6 address</li><li><code>DHCP_IPV4</code> - DHCP IPv4 address</li><li><code>DHCP_IPV6</code> - DHCP IPv6 address</li><li><code>AUTO_IPV6</code> - stateless dynamic IPv6 address</li><li><code>LINK_LOCAL_IPV6</code> - link local IPv6 address</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_ADDR_TYPE
 {
     STATIC_IPV4        =  0x00000001,
     STATIC_IPV6        =  0x00000002,
     DHCP_IPV4          =  0x00000010,
     DHCP_IPV6          =  0x00000020,
     AUTO_IPV6          =  0x00000040,
     LINK_LOCAL_IPV6    =  0x00000080,
 } NET_ADDR_TYPE;
</code></pre><h3 id=ip-addresses>IP Addresses</h3><p><strong>Description</strong></p><p>Defines IP addresses.</p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>type</code> - address type</li><li><code>pszIPAddrPrefix</code> - IP address</li></ul><p><strong>Declarations</strong></p><pre><code> typedef struct _NET_IP_ADDR
 {
     char \*pszInterfaceName;
     NET_ADDR_TYPE type;
     char \*pszIPAddrPrefix;
 } NET_IP_ADDR, \*PNET_IP_ADDR;
</code></pre><h2 id=nm_set_ipv4_addr_gateway>nm_set_ipv4_addr_gateway</h2><p><strong>Description</strong></p><p>Set the IPv4 address and (optionally) the default gateway address for the interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t

 nm_set_ipv4_addr_gateway(

     const char \*pszInterfaceName,
     NET_IPV4_ADDR_MODE mode,
     const char \*pszIPv4AddrPrefix,
     const char \*pszIPv4Gateway
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>mode</code> - IP address mode; one of the following values:<ul><li><code>IPV4_ADDR_MODE_NONE</code></li><li><code>IPV4_ADDR_MODE_STATIC</code></li><li><code>IPV4_ADDR_MODE_DHCP</code></li></ul></li><li><code>pszIPv4AddrPrefix</code> - IPv4 address specified in dot-decimal / prefix notation (for example, 10.10.10.101/23). If the prefix is not specified, then a /32 prefix is assumed.</li><li><code>pszIPv4Gateway</code> - IPv4 gateway (optional) specified in the dot-decimal format (for example,10.10.20.30).</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ipv4_addr_gateway>nm_get_ipv4_addr_gateway</h2><p><strong>Description</strong></p><p>Get the IPv4 address and the default gateway address for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_ipv4_addr_gateway(
     const char \*pszInterfaceName,
     NET_IPV4_ADDR_MODE \*pMode,
     char \*\*ppszIPv4AddrPrefix,
     char \*\*ppszIPv4Gateway
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pmode</code> - IP mode; one of the following values:<ul><li><code>IPV4_ADDR_MODE_NONE</code></li><li><code>IPV4_ADDR_MODE_STATIC</code></li><li><code>IPV4_ADDR_MODE_DHCP</code></li></ul></li><li><code>ppszIPv4AddrPrefix</code> - IPv4 address returned in dot-decimal / prefix notation (for example, 10.10.10.101/23). If the prefix is not specified, then a /32 prefix is assumed.</li><li><code>ppszIPv4Gateway</code> - IPv4 gateway (optional) returned in the dot-decimal format (for example,10.10.10.250).</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_add_static_ipv6_addr>nm_add_static_ipv6_addr</h2><p><strong>Description</strong></p><p>Add an IPv6 address to the specified interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_add_static_ipv6_addr(
     const char \*pszInterfaceName,
     const char \*pszIPv6AddrPrefix
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszIPv6AddrPrefix</code> - IPv6 address specified in the standard colon-separated IPv6 address format followed by the prefix (for example, 2010:a1:b2::25/64). If the not prefix is specified, then a /128 prefix is assumed.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_static_ipv6_addr>nm_delete_static_ipv6_addr</h2><p><strong>Description</strong></p><p>Delete a static IPv6 address from the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_delete_static_ipv6_addr(
     const char \*pszInterfaceName,
     const char \*pszIPv6AddrPrefix
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszIPv6AddrPrefix</code> - IPv6 address specified in the standard colon-separated IPv6 address format followed by the prefix (for example, 2010:a1:b2::25/64). If the not prefix is specified, then a /128 prefix is assumed.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_ipv6_addr_mode>nm_set_ipv6_addr_mode</h2><p><strong>Description</strong></p><p>Set the mode for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_ipv6_addr_mode(
     const char \*pszInterfaceName,
     uint32_t enableDhcp,
     uint32_t enableAutoconf
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>enableDhcp</code> - enable (1) or disable (0) DHCP; enabling configures the interface to acquire a DHCP IPv6 address.</li><li><code>enableAutoconf</code> - enable (1) or disable (0) autoconf; enabling configures the interface to acquire a stateless autoconfiguration IPv6 address.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ipv6_addr_mode>nm_get_ipv6_addr_mode</h2><p><strong>Description</strong></p><p>Get the mode for the interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_ipv6_addr_mode(
     const char \*pszInterfaceName,
     uint32_t \*pDhcpEnabled,
     uint32_t \*pAutoconfEnabled
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pDhcpEnabled</code> - returns whether IPv6 DHCP is enabled (1) or disabled (0).</li><li><code>pAutoconfEnabled</code> - returns whether IPv6 stateless autoconfiguration is enabled (1) or disabled (0).</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ip_addr>nm_get_ip_addr</h2><p><strong>Description</strong></p><p>Get the IP address for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_ip_addr(
     const char \*pszInterfaceName,
     uint32_t addrTypes,
     size_t \*pCount,
     NET_IP_ADDR \*\*\*pppIpAddrList
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>addrTypes</code> - type of IP address; one of the following values:<ul><li><code>STATIC_IPV4</code></li><li><code>STATIC_IPV6</code></li><li><code>DHCP_IPV4</code></li><li><code>DHCP_IPV6</code></li><li><code>AUTO_IPV6</code></li><li><code>LINK_LOCAL_IPV6</code></li></ul></li><li><code>pCount</code> - number of IP address structures in the pppIpAddrList array returned by the API call.</li><li><code>pppIpAddrList</code> - array of NET_IP_ADDR elements that includes the following:<ul><li><code>pszInterfaceName</code></li><li><code>type</code></li><li><code>pszIPAddrPrefix</code></li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_ipv6_gateway>nm_set_ipv6_gateway</h2><p><strong>Description</strong></p><p>Set the default IPv6 gateway for the interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_set_ipv6_gateway(
     const char \*pszInterfaceName,
     const char \*pszIPv6Gateway
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszIPv6Gateway</code> - IPv6 gateway specified in the standard colon-separated IPv6 address format (for example, 2010:125::100)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ipv6_gateway>nm_get_ipv6_gateway</h2><p><strong>Description</strong></p><p>Get the default IPv6 gateway for the interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_ipv6_gateway(
     const char \*pszInterfaceName,
     char \*\*ppszIPv6Gateway
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>ppszIPv6Gateway</code> - IPv6 gateway specified in the standard colon-separated IPv6 address format (for example, 2010:125::100)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=route-configuration-apis>Route Configuration APIs</h1><p>The Photon OS 2.0 network manager C API enables you to manage static IP routes configuration.</p><h2 id=structure-declarations-2>Structure Declarations</h2><h3 id=route-scope>Route Scope</h3><p><strong>Description</strong></p><p>Defines the scope of a route. One of the following options.</p><ul><li><code>GLOBAL_ROUTE</code> - route to a destination one or more hops away</li><li><code>LINK_ROUTE</code> - route to a destination on the local network</li><li><code>HOST_ROUTE</code> - route to a destination address on the local host</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_ROUTE_SCOPE
 {
     GLOBAL_ROUTE = 0,
     LINK_ROUTE,
     HOST_ROUTE,
     NET_ROUTE_SCOPE_MAX
 } NET_ROUTE_SCOPE;
</code></pre><h3 id=ip-route>IP Route</h3><p><strong>Description</strong></p><p>Defines an IP route. Includes the following information:</p><ul><li><code>pszInterfaceName</code> - interface through which the specified destination network can be reached</li><li><code>pszDestNetwork</code> - destination IP network reached by the specified route</li><li><code>pszSourceNetwork</code> - source network for the specified route</li><li><code>pszGateway</code> - IP gateway through which the specified destination network can be reached</li><li><code>scope</code> - scope of this route entry; one of the following values: GLOBAL_ROUTE, LINK_ROUTE, or HOST_ROUTE as defined above</li><li><code>metric</code> - metric of this route, an unsigned integer</li><li><code>table</code> - identifier for the route table to which this route belongs.</li></ul><p><strong>Declaration</strong></p><pre><code> typedef struct _NET_IP_ROUTE
 {
     char \*pszInterfaceName;
     char \*pszDestNetwork;
     char \*pszSourceNetwork;
     char \*pszGateway;
     NET_ROUTE_SCOPE scope;
     uint32_t metric;
     uint32_t table;
 } NET_IP_ROUTE, \*PNET_IP_ROUTE;
</code></pre><h2 id=nm_add_static_ip_route>nm_add_static_ip_route</h2><p><strong>Description</strong></p><p>Add a static IP route.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_add_static_ip_route(
     NET_IP_ROUTE \*pRoute
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pRoute</code> - static IP route</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_static_ip_route>nm_delete_static_ip_route</h2><p><strong>Description</strong></p><p>Delete a static IP route.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_delete_static_ip_route(
     NET_IP_ROUTE \*pRoute
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pRoute</code> - static IP route</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_static_ip_routes>nm_get_static_ip_routes</h2><p><strong>Description</strong></p><p>Get the static IP routes for an interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_static_ip_routes(
     const char \*pszInterfaceName,
     size_t \*pCount,
     NET_IP_ROUTE \*\*\*pppRouteList
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pCount</code> - number of NET_IP_ROUTE elements returned in the pppRouteList array by the API call upon success</li><li><code>pppRouteList</code> - array of static IP routes</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=dns-configuration-apis>DNS Configuration APIs</h1><p>The Photon OS 2.0 network manager C API enables you to manage the DNS and Domains configuration.</p><h2 id=structure-declarations-3>Structure Declarations</h2><h3 id=dns-mode>DNS Mode</h3><p><strong>Description</strong></p><p>DNS mode. Any of the following values:</p><ul><li><code>DNS_MODE_INVALID</code> - DNS mode is unknown</li><li><code>STATIC_DNS</code> - DNS servers are statically configured</li><li><code>DHCP_DNS</code> - DNS servers configuration is acquired from DHCP protocol.</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_DNS_MODE
 {
     DNS_MODE_INVALID = 0,
     STATIC_DNS,
     DHCP_DNS,
     DNS_MODE_MAX,
 } NET_DNS_MODE;
</code></pre><h2 id=nm_set_dns_servers>nm_set_dns_servers</h2><p><strong>Description</strong></p><p>Set the DNS servers list for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_dns_servers(
     const char \*pszInterfaceName,
     NET_DNS_MODE mode,
     size_t count,
     const char \*\*ppszDnsServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>mode</code> - DNS mode. One of the following values:<ul><li><code>DNS_MODE_INVALID</code> = 0</li><li><code>DNS_MODE_MA</code></li><li><code>DHCP_DNS</code></li><li><code>STATIC_DNS</code></li></ul></li><li><code>count</code> - number of NUL terminated DNS server entries passed in the ppszDnsServers array to the API call (for example, 10.10.10.200 or 2020::40)</li><li><code>ppszDnsServers</code> - array of DNS servers</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_add_dns_server>nm_add_dns_server</h2><p><strong>Description</strong></p><p>Add a server to the DNS servers list associated with an interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_add_dns_server(
     const char \*pszInterfaceName,
     const char \*pszDnsServer
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>ppszDnsServer</code> - server to add to the DNS server list</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_dns_server>nm_delete_dns_server</h2><p><strong>Description</strong></p><p>Delete a server from the DNS servers list associated with an interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_delete_dns_server(
     const char \*pszInterfaceName,
     const char \*pszDnsServer
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>ppszDnsServer</code> - server to remove from the DNS server list</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_dns_servers>nm_get_dns_servers</h2><p><strong>Description</strong></p><p>Get the the DNS servers list for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_dns_servers(
     const char \*pszInterfaceName,
     NET_DNS_MODE \*pMode,
     size_t \*pCount,
     char \*\*\*pppszDnsServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>pMode</code> - DNS mode. One of the following values:<ul><li><code>DNS_MODE_INVALID</code></li><li><code>DHCP_DNS</code></li><li><code>STATIC_DNS</code></li></ul></li><li><code>pCount</code> - number of NUL terminated DNS server entries in the pppszDnsServers array returned by the API call (for example, 10.10.10.200 or 2020::40)</li><li><code>pppszDnsServers</code> - array of DNS servers</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_dns_domains>nm_set_dns_domains</h2><p><strong>Description</strong></p><p>Set the DNS domain list.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_dns_domains(
     const char \*pszInterfaceName,
     size_t count,
     const char \*\*ppszDnsDomains
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>count</code> - number of DNS domains specified in the ppszDnsDomains array to the API call (for example, if count = 2, then there are two elements: ppszDnsDomains[0] and ppszDnsDomains[1])</li><li><code>ppszDnsDomains</code> - array of DNS domains</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_add_dns_domain>nm_add_dns_domain</h2><p><strong>Description</strong></p><p>Add a DNS domain to the DNS domain list.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_add_dns_domain(
     const char \*pszInterfaceName,
     const char \*pszDnsDomain
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>pszDnsDomain</code> - DNS domain to add to the list</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_dns_domain>nm_delete_dns_domain</h2><p><strong>Description</strong></p><p>Delete a DNS domain from the DNS domain list.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_delete_dns_domain(
     const char \*pszInterfaceName,
     const char \*pszDnsDomain
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>pszDnsDomain</code> - DNS domain to remove from the list</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_dns_domains>nm_get_dns_domains</h2><p><strong>Description</strong></p><p>Get the list of DNS domains.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_dns_domains(
     const char \*pszInterfaceName,
     size_t \*pCount,
     char \*\*\*pppszDnsDomains
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>pCount</code> - number of DNS domains returned in the pppszDnsDomains from the API call (for example, if count = 2, then there are two elements: ppszDnsDomains[0] and ppszDnsDomains[1])</li><li><code>pppszDnsDomains</code> - array of DNS domains</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=dhcp-options-duid-and-iaid-configuration-apis>DHCP Options DUID and IAID Configuration APIs</h1><p>The Photon OS 2.0 network manager C API enables you to manage DHCP DUID and Interface IAID.</p><h2 id=nm_set_iaid>nm_set_iaid</h2><p><strong>Description</strong></p><p>Set the IAID for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_iaid(
     const char \*pszInterfaceName,
     uint32_t iaid
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>iaid</code> - interface association identifier (IAID)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_iaid>nm_get_iaid</h2><p><strong>Description</strong></p><p>Get the IAID for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_iaid(
     const char \*pszInterfaceName,
     uint32_t \*pIaid
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pIaid</code> - interface association identifier (IAID)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_duid>nm_set_duid</h2><p><strong>Description</strong></p><p>Set the DUID for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_duid(
     const char \*pszInterfaceName,
     const char \*pszDuid
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, specify NULL to set system global DUID configuration)</li><li><code>pszDuid</code> - DHCP unique identifier (DUID)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_duid>nm_get_duid</h2><p><strong>Description</strong></p><p>Get the DUID for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_duid(
     const char \*pszInterfaceName,
     char \*\*ppszDuid
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, specify NULL to query system global DUID configuration)</li><li><code>ppszDuid</code> - DHCP unique identifier (DUID)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=ntp-configuration-apis>NTP Configuration APIs</h1><p>The Photon OS 2.0 network manager C API enables you to manage NTP servers configured for the system.</p><h2 id=nm_set_ntp_servers>nm_set_ntp_servers</h2><p><strong>Description</strong></p><p>Set the list of NTP servers.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_set_ntp_servers(
     size_t count,
     const char \*\*ppszNtpServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>count</code> - number of NTP servers in the ppszNtpServers array passed to the API call.</li><li><code>ppszNtpServers</code> - array of NTP servers</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_add_ntp_servers>nm_add_ntp_servers</h2><p><strong>Description</strong></p><p>Add a server to the NTP servers list.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_add_ntp_servers(
     size_t count,
     const char \*\*ppszNtpServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>count</code> - number of NTP servers to add (specified in the ppszNtpServers array) passed to the API call.</li><li><code>ppszNtpServers</code> - array of NTP servers to add</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_ntp_servers>nm_delete_ntp_servers</h2><p><strong>Description</strong></p><p>Delete a server from the NTP servers list.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_delete_ntp_servers(
     size_t count,
     const char \*\*ppszNtpServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>count</code> - number of NTP servers to delete (specified in the ppszNtpServers array) passed to the API call</li><li><code>ppszNtpServers</code> - array of NTP servers to delete</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ntp_servers>nm_get_ntp_servers</h2><p><strong>Description</strong></p><p>Get the NTP servers list.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_ntp_servers(
     size_t \*pCount,
     char \*\*\*pppszNtpServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pCount</code> - number of NTP servers in the pppszNtpServers array returned from the API call</li><li><code>pppszNtpServers</code> - array of NTP servers</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><p>Other APIs</p><h2 id=nm_set_hostname>nm_set_hostname</h2><p><strong>Description</strong></p><p>Set the host name for the system.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_set_hostname(
     const char \*pszHostname
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszHostname</code> - host name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_hostname>nm_get_hostname</h2><p><strong>Description</strong></p><p>Get the host name for the system.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_hostname(
     char \*\*ppszHostname
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>ppszHostname</code> - host name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_wait_for_link_up>nm_wait_for_link_up</h2><p><strong>Description</strong></p><p>Wait for the specified interface to come up.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_wait_for_link_up(
     const char \*pszInterfaceName,
     uint32_t timeout
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>timeout</code> - maximum time (in seconds) to wait (until the link is up) before timing out of the request; specify 0 for no timeout (wait indefinitely)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_wait_for_ip>nm_wait_for_ip</h2><p><strong>Description</strong></p><p>Wait for the interface to acquire an IP address of the specified IP address type.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_wait_for_ip(
     const char \*pszInterfaceName,
     uint32_t timeout,
     NET_ADDR_TYPE addrTypes
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>timeout</code> - maximum time (in seconds) to wait (until the link has an IP address of the specified address type) before timing out of the request; specify 0 for no timeout (wait indefinitely)</li><li><code>addrTypes</code> - type of IP address; one of the following values:<ul><li><code>STATIC_IPV4</code></li><li><code>STATIC_IPV6</code></li><li><code>DHCP_IPV4</code></li><li><code>DHCP_IPV6</code></li><li><code>AUTO_IPV6</code></li><li><code>LINK_LOCAL_IPV6</code></li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_network_param>nm_set_network_param</h2><p><strong>Description</strong></p><p>Set the value of a network parameter for an object.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_network_param(
     const char \*pszObjectName,
     const char \*pszParamName,
     const char \*pszParamValue
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszObjectName</code> - an interface name (for example, &ldquo;eth0&rdquo;) or a file name (for example, /etc/systemd/resolved.conf)</li><li><code>pszParamName</code> - name of a parameter associated with the object; specified in the format SectionName_KeyName (for example, Link_MTUBytes represents the MtuBytes key in [Link] section in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>)</li><li><code>pszParamValue</code> - points to the parameter value to set; you can add (+) or remove (-) a parameter by prepending the parameter name with + or -. For example:</li></ul><p>netmgr net_info &ndash;set &ndash;object eth1 &ndash;paramname +Network_Address &ndash;paramvalue &ldquo;10.10.10.1/24&rdquo;</p><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_network_param>nm_get_network_param</h2><p><strong>Description</strong></p><p>Get the value of a network parameter associated with an object.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_network_param(
     const char \*pszObjectName,
     const char \*pszParamName,
     char \*\*ppszParamValue
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszObjectName</code> - an interface name (for example, &ldquo;eth0&rdquo;) or a file name (for example, /etc/systemd/resolved.conf)</li><li><code>pszParamName</code> - name of a parameter associated with the object; returned in the format SectionName_KeyName (for example, Link_MTUBytes represents the MtuBytes key in [Link] section in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>)</li><li><code>ppszParamValue</code> - parameter value</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=service-management-apis>Service Management APIs</h1><h2 id=nm_stop_network_service>nm_stop_network_service</h2><p><strong>Description</strong></p><p>Stop the network service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_stop_network_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_restart_network_service>nm_restart_network_service</h2><p><strong>Description</strong></p><p>Restart the network service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_restart_network_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><p>nm_stop_dns_service</p><p><strong>Description</strong></p><p>Stop the DNS service.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_stop_dns_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_restart_dns_service>nm_restart_dns_service</h2><p><strong>Description</strong></p><p>Restart the DNS service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_restart_dns_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_stop_ntp_service>nm_stop_ntp_service</h2><p><strong>Description</strong></p><p>Stop the NTP service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_stop_ntp_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_restart_ntp_service>nm_restart_ntp_service</h2><p><strong>Description</strong></p><p>Restart the NTP service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_restart_ntp_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a2c499b13b1449ec62f78af30d54d9d0>5.15 - Network Configuration Manager - Python API</h1><p>Photon OS 2.0 provides a Python API for the Network Configuration Manager.</p><ul><li><a href=#setup-instructions>Setup Instructions</a></li><li><a href=#initialization-steps>Initialization Steps</a></li><li><a href=#get-online-help>Get Online Help</a></li><li><a href=#basic-information>Basic Information</a></li><li><a href=#interface-configuration>Interface Configuration</a></li><li><a href=#ip-address-configuration>IP Address Configuration</a></li><li><a href=#dns-configuration>DNS Configuration</a></li><li><a href=#dhcp-options-duid-and-iaid-configuration>DHCP Options, DUID, and IAID Configuration</a></li><li><a href=#ntp-servers>NTP Servers</a></li></ul><h2 id=setup-instructions>Setup Instructions</h2><p>To set up and run the latest version of the Network Manager API for Python:</p><pre><code># tdnf install pmd pmd-python3
# systemctl start pmd
</code></pre><h2 id=initialization-steps>Initialization Steps</h2><pre><code># python3
&gt;&gt;&gt; import pmd
&gt;&gt;&gt; net = pmd.server().net
</code></pre><h2 id=get-online-help>Get Online Help</h2><p>Get help for all commands.</p><pre><code>&gt;&gt;&gt; help(net)
</code></pre><p>Get help for a specific command.</p><pre><code>&gt;&gt;&gt; help(net.add_ntp_servers)
-in function add_ntp_servers:
add_ntp_servers(...) method of  [server.net](http://server.net/) instance
    net.add_ntp_servers(ntpservers = [&quot;20.20.20.20&quot;, &quot;25.30.40.70&quot;])
    adds ntp servers. returns success: 0, failure: exception.
(END)
</code></pre><h2 id=basic-information>Basic Information</h2><h3 id=get_system_network_info>get_system_network_info</h3><p>Get network information details that are common to the entire system.</p><p><strong>Syntax</strong></p><pre><code>net.get_system_network_info()
</code></pre><p><strong>Returns</strong></p><ul><li>details about the system network (DUID, DNS mode, DNS server list, DNS domain list, NTP server list)</li></ul><p><strong>Example</strong></p><pre><code>&gt;&gt;&gt; system_network_info = netmgmt.get_system_network_info()

&gt;&gt;&gt; print ( system_network_info)

[{DUID: 00:02:11:22:33:44:55:66:77:20, DNS Mode: (null), DNS ServerList: ['10.10.100.100', '20.20.200.10'], DNS domain list: [' [abcd.com](http://abcd.com)'], NTP ServerList: (null)}]
</code></pre><h3 id=get_err_info>get_err_info</h3><p>Get information about the specified error number.</p><p><strong>Syntax</strong></p><pre><code>net.get_err_info(error = &lt;error_number&gt;)
</code></pre><p><strong>Parameters</strong></p><ul><li>error - error number</li></ul><p>Here is the list of error numbers:</p><ul><li>4097 - invalid parameter</li><li>4098 - not supported</li><li>4099 - out of memory</li><li>4100 - value not found</li><li>4101 - value exists</li><li>4102 - invalid interface</li><li>4103 - invalid mode</li><li>4104 - bad configuration file</li><li>4105 - write failed</li><li>4106 - timout</li><li>4107 - DCHP timeout</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><p>Example</p><pre><code>&gt;&gt; net.get_err_info(error = 4097)

'invalid parameter'
</code></pre><h2 id=interface-configuration>Interface Configuration</h2><p>Use these commands to manage the configuration for a network interface.</p><h3 id=get_link_info>get_link_info</h3><p>Get the link info for the specified interface or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><pre><code>net.get_link_info(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: link info</li><li>failure: exception</li></ul><h3 id=get_link_macaddr>get_link_macaddr</h3><p>Get the MAC address for the specified interface or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><pre><code>net.get_link_macaddr(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: MAC address</li><li>failure: exception</li></ul><h3 id=get_link_mode>get_link_mode</h3><p>Get the link mode for the specified interface (auto or manual), or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><pre><code>net.get_link_mode(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: link mode (auto, manual, or unknown)</li><li>failure: exception</li></ul><h3 id=get_link_mtu>get_link_mtu</h3><p>Get the MTU of the specified interface or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><pre><code>net.get_link_mtu(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: link MTU</li><li>failure: exception</li></ul><h3 id=get_link_state>get_link_state</h3><p>Get the link state of the specified interface or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><pre><code>net.get_link_state(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: link state (up, down, unknown)</li><li>failure: exception</li></ul><h3 id=set_link_down>set_link_down</h3><p>Bring down the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_link_down(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_macaddr>set_link_macaddr</h3><p>Set the MAC address of the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_link_macaddr(ifname = interface_name, macaddr = mac_address)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>macaddr</code> = MAC address</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_mode>set_link_mode</h3><p>Set the mode (auto or manual) of the specifed interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_link_mode(ifname = interface_name, link_mode = [auto, manual])
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>link_mode</code> - auto or manual</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_mtu>set_link_mtu</h3><p>Set the MTU for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_link_mtu(ifname = interface_name, mtu = mtu)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>mtu</code> - <code>mtu</code></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_state>set_link_state</h3><p>Set the state (up or down) of the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_link_state(ifname = interface_name, link_state = [down, up])
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>link_state</code> - down or up</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_up>set_link_up</h3><p>Brings up the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_link_up(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>link_state</code> - down or up</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h2 id=ip-address-configuration>IP Address Configuration</h2><p>Use these commands to manage IP address configuration for a network interface.</p><h3 id=add_static_ipv6_addr>add_static_ipv6_addr</h3><p>Add a static IPv6 address to the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.add_static_ipv6_addr(ifname = interface_name, addr_prefix = ipv6address_prefix)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>addr_prefix</code> - IPv6 address prefix</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=del_static_ipv6_addr>del_static_ipv6_addr</h3><p>Delete a static IPv6 address from the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.del_static_ipv6_addr(ifname = interface_name, addr_prefix = ipv6address_prefix)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>addr_prefix</code> - IPv6 address prefix</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=get_ipv4_addr_gateway>get_ipv4_addr_gateway</h3><p>Get the IPv4 address with the prefix and gateway for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.get_ipv4_addr_gateway(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: IPv4 address with the prefix and gateway</li><li>failure: exception</li></ul><h3 id=get_ipv6_addr>get_ipv6_addr</h3><p>Get the list of IPv6 addresses for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.get_ipv6_addr(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: IPv6 address list</li><li>failure: exception</li></ul><h3 id=get_ipv6_addr_mode>get_ipv6_addr_mode</h3><p>Get the address mode for the specified interface to determine whether DHCPv6, autoconf are enabled or disabled.</p><p><strong>Syntax</strong></p><pre><code>net.get_ipv6_addr_mode(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>Status for DHCPv6, autoconf (True=enabled, False=disabled)</li><li>failure: exception</li></ul><h3 id=get_ipv6_gateway>get_ipv6_gateway</h3><p>Get the IPv6 gateway for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.get_ipv6_gateway(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: IPv6 gateway</li><li>failure: exception</li></ul><h3 id=set_ipv4_addr_gateway>set_ipv4_addr_gateway</h3><p>Set the IPv4 address with the prefix and gateway for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.get_ipv4_addr_gateway(ifname = interface_name, addr_mode = [dhcp, static, none], addr_prefix = ipv4addressprefix, gateway = ipv4gateway)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>addr_mode</code> - address mode - dhcp, static, or none</li><li><code>addr_prefix</code> - IPv4 address or prefix</li><li><code>gateway</code> - IPv4 gateway</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_ipv6_addr_mode>set_ipv6_addr_mode</h3><p>Set the address mode for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_ipv6_addr_mode(ifname = interface_name, enable_dhcp = [True, False], enable_autoconf = [True, False])
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>enable_dhcp</code> - True to enable, False to disable</li><li><code>enable_autoconf</code> - True to enable, False to disable</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_ipv6_gateway>set_ipv6_gateway</h3><p>Set the IPv6 gateway for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_ipv6_gateway(ifname = interface_name, gateway = ipv6gateway)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>gateway</code> - IPv6 gateway</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h2 id=dns-configuration>DNS Configuration</h2><p>Use these commands to manage DNS domains and servers for a network interface.</p><h3 id=get_dns_domains>get_dns_domains</h3><p>Get the list of DNS domains for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.get_dns_domains(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: list of DNS domains</li><li>failure: exception</li></ul><h3 id=get_dns_servers>get_dns_servers</h3><p>Get the list of DNS servers and the mode for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.get_dns_servers(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: list of DNS servers and mode</li><li>failure: exception</li></ul><h3 id=set_dns_domains>set_dns_domains</h3><p>Set the list of DNS domains for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_dns_domains(domains = [&quot;domain1&quot;,&quot;domain2&quot;,...], ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>domains</code> - comma-separated list of one or more domains</li><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_dns_servers>set_dns_servers</h3><p>Set the list of DNS servers for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_dns_servers(dns_mode = [dhcp, static], servers = [&quot;server1&quot;,&quot;server2&quot;, ...], ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>dns_mode</code> - dhcp or static</li><li><code>servers</code> - comma-separate list of one or more servers</li><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h2 id=dhcp-options-duid-and-iaid-configuration>DHCP Options DUID and IAID Configuration</h2><h3 id=get_link_iaid>get_link_iaid</h3><p>Get the IAID for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.get_link_iaid(ifname = interface)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: IAID</li><li>failure: exception</li></ul><h3 id=set_link_iaid>set_link_iaid</h3><p>Set the IAID for the specified interface.</p><p><strong>Syntax</strong></p><pre><code>net.set_link_iaid(ifname = interface_name, iaid = &lt;iaid&gt;)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li>iaid - IAID</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=get_dhcp_duid>get_dhcp_duid</h3><p>Get the DCHP DUID.</p><p><strong>Syntax</strong></p><pre><code>net.get_dhcp_duid(ifname = interface_name)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: DUID</li><li>failure: exception</li></ul><h3 id=set_dhcp_duid>set_dhcp_duid</h3><p>Set the DCHP DUID.</p><p><strong>Syntax</strong></p><pre><code>net.set_dhcp_duid(ifname = interface_name duid = duid)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li><li><code>duid</code> - DUID to set</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h2 id=ntp-servers>NTP Servers</h2><p>Use these commands to manage the NTP servers list.</p><h3 id=add_ntp_servers>add_ntp_servers</h3><p>Add one or more NTP servers to the NTP servers list.</p><p><strong>Syntax</strong></p><pre><code>net.add_ntp_servers(ntpservers = [&quot;server1&quot;, &quot;server2&quot;, ...])
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ntpservers</code> - Comma-separated list of NTP servers to add to the list.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=del_ntp_servers>del_ntp_servers</h3><p>Remove one or more NTP servers from the NTP servers list.</p><p><strong>Syntax</strong></p><pre><code>net.del_ntp_servers(ntpservers = [&quot;server1&quot;, &quot;server2&quot;, ...])
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ntpservers</code> - Comma-separated list of NTP servers to remove from the list.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=get_ntp_servers>get_ntp_servers</h3><p>Get the NTP servers list.</p><p><strong>Syntax</strong></p><pre><code>net.get_ntp_servers()
</code></pre><p><strong>Returns</strong></p><ul><li>success: NTP servers list</li><li>failure: exception</li></ul><h3 id=set_ntp_servers>set_ntp_servers</h3><p>Set the NTP servers list.</p><p><strong>Syntax</strong></p><pre><code>net.set_ntp_servers(ntpservers = [&quot;server1&quot;, &quot;server2&quot;, ...])
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ntpservers</code> - Comma-separated list of NTP servers to set in the list.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=get_hostname>get_hostname</h3><p>Get the host name.</p><p><strong>Syntax</strong></p><p>net.get_hostname()</p><p><strong>Returns</strong></p><ul><li>success: host name</li><li>failure: exception</li></ul><h3 id=set_hostname>set_hostname</h3><p>Set the host name.</p><p><strong>Syntax</strong></p><pre><code>net.set_hostname(hostname)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>hostname</code> - name to assign to the host</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=wait_for_ip>wait_for_ip</h3><p>Wait for the specified interface to acquire a valid IP address of the specified IP address type.</p><p><strong>Syntax</strong></p><pre><code>net.wait_for_ip(ifname = interface_name, timeout = timeout, addrtypes = [ipv4, ipv6, static_ipv4, static_ipv6, dhcp_ipv4, dhcp_ipv6, auto_ipv6, link_local_ipv6])
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>timeout</code> - maximum time (in seconds) to wait (until the link is up) before timing out of the request; specify 0 for no timeout (wait indefinitely)</li><li><code>addrtypes</code> - one of the following address types: ipv4, ipv6, static_ipv4, static_ipv6, dhcp_ipv4, dhcp_ipv6, auto_ipv6, or link_local_ipv6</li></ul><p><strong>Returns</strong></p><ul><li>success: 0 (when the link has an IP of the specified type)</li><li>failure: exception (for example, timeout expired)</li></ul><h3 id=wait_for_link_up>wait_for_link_up</h3><p>Wait for the specified interface to come up.</p><p><strong>Syntax</strong></p><pre><code>net.wait_for_link_up(ifname = interface_name, timeout = timeout)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>timeout</code> - maximum time (in seconds) to wait (until the link is up) before timing out of the request; specify 0 for no timeout (wait indefinitely)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0 (when link is up)</li><li>failure: exception (for example, timeout expired)</li></ul><h3 id=get_network_param>get_network_param</h3><p>Get the specified network configuration parameter for the specified interface or filename.</p><p><strong>Syntax</strong></p><pre><code>net.get_network_param(object = IfName or Filename, paramname = SectionName_KeyName)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>object</code> - an interface name (for example, "eth0") or a file name (for example, /etc/systemd/resolved.conf)</li><li><code>paramname</code> - name of a parameter associated with the object; specified in the format SectionName_KeyName (for example, Link_MTUBytes represents the MtuBytes key in [Link] section in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_network_param>set_network_param</h3><p>Set the value of a network configuration parameter for the specified interface or filename.</p><p><strong>Syntax</strong></p><pre><code>net.set_network_param(object = interface_name or filename, paramname = SectionName_KeyName, paramvalue = key_value)
</code></pre><p><strong>Parameters</strong></p><ul><li><code>object</code> - an interface name (for example, "eth0") or a file name (for example, /etc/systemd/resolved.conf)</li><li><code>paramname</code> - name of a parameter associated with the object; specified in the format SectionName_KeyName (for example, Link_MTUBytes represents the MtuBytes key in [Link] section in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a82ef4d2ec225c8b31691b80c956da04>5.16 -</h1><p>Photon OS includes the following networking tools:</p><ul><li><p><strong>tcpdump</strong>. A networking tool that captures and analyzes packets on a network interface. <code>tcpdump</code> is not available with the minimal version of Photon OS but available in the repository. The minimal version includes the <code>iproute2</code> tools by default.</p><p>You can install <code>tcpdump</code> and its accompanying package <code>libpcap</code>, a C/C++ library for capturing network traffic, by using <code>tdnf</code>:</p><pre><code></code></pre></li></ul><p>tdnf install tcpdump</p><pre><code>
- **netcat**. A tool to send data over network connections with TCP or UDP. This tool is not included in either the minimal or the full version of Photon OS. But since `netcat` furnishes powerful options for analyzing, troubleshooting, and debugging network connections, you might want to install it. To install `netcat', run the following command: 

    ```
tdnf install netcat
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-d8209c5493f1fb6a1d2178ece727cb42>6 - Prioritize eth0 Route Over WLAN</h1><p>You can prioritise the eth0 route over the WLAN route. Perform the following steps:</p><ol><li><p>Modify the <code>/etc/systemd/network/99-dhcp-en.network</code> file and add the following content:</p><pre><code>[DHCP]
RouteMetric=512
</code></pre></li><li><p>Restart <code>systemd-networkd</code>.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-833e39de4cc98ce7eac9e63da3824f3c>7 - Cloud-Init on Photon OS</h1><p>The minimal and full versions of Photon OS include the cloud-init service as a built-in component. Cloud-init is a set of Python scripts that initialize cloud instances of Linux machines. The cloud-init scripts configure SSH keys and run commands to customize the machine without user interaction. The commands can set the root password, create a hostname, configure networking, write files to disk, upgrade packages, run custom scripts, and restart the system.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-88c90d8eeb3c8c6eea5c96bed38bf431>7.1 - Cloud-Init Overview</h1><p><code>cloud-init</code> is a multi-distribution package that handles early initialization of a cloud instance.</p><p>In-depth documentation for cloud-init is available here:</p><p><a href=https://cloudinit.readthedocs.org/en/latest/>https://cloudinit.readthedocs.org/en/latest/</a></p><h1 id=supported-installations>Supported installations</h1><p>Both the full version of and the minimal version of Photon OS support cloud-init.</p><h1 id=supported-capabilities>Supported capabilities</h1><p>Photon OS supports the following cloud-init capabilities:</p><ul><li>run commands: execute a list of commands with output to console.</li><li>configure ssh keys: add an entry to ~/.ssh/authorized_keys for the configured user.</li><li>install package: install additional packages on first boot.</li><li>configure networking: update /etc/hosts, hostname, etc.</li><li>write files: write arbitrary files to disk.</li><li>add yum repository: add a yum repository to /etc/yum.repos.d.</li><li>create groups and users: add groups and users to the system and set properties for them.</li><li>run yum upgrade: upgrade all packages.</li><li>reboot: reboot or power off when done with cloud-init.</li></ul><h1 id=getting-started>Getting Started</h1><p>The Amazon Machine Image of Photon OS has an <code>ec2 datasource</code> turned on by default so an <code>ec2</code> configuration is accepted.
However, for testing, the following methods provide ways to do <code>cloud-init</code> with a standalone instance of Photon OS.</p><h2 id=using-a-seed-iso>Using a Seed ISO</h2><p>This will be using the <code>nocloud</code> data source. In order to initialize the system in this way, an ISO file needs to be created with a meta-data file and an user-data file as shown below:</p><pre><code>$ { echo instance-id: iid-local01; echo local-hostname: cloudimg; } &gt; meta-data
$ printf &quot;#cloud-config\nhostname: testhost\n&quot; &gt; user-data
$ genisoimage  -output seed.iso -volid cidata -joliet -rock user-data meta-data
</code></pre><p>Attach the <code>seed.iso</code> generated above to your machine and reboot for the init to take effect.
In this case, the hostname is set to <code>testhost</code>.</p><h2 id=using-a-seed-disk-file>Using a Seed Disk File</h2><p>To init using local disk files, do the following:</p><pre><code>mkdir /var/lib/cloud/seed/nocloud
cd /var/lib/cloud/seed/nocloud
$ { echo instance-id: iid-local01; echo local-hostname: cloudimg; } &gt; meta-data
$ printf &quot;#cloud-config\nhostname: testhost\n&quot; &gt; user-data
</code></pre><p>Reboot the machine and the hostname will be set to <code>testhost</code>.</p><h2 id=frequencies>Frequencies</h2><p>Cloud-init modules have predetermined frequencies. Based on the frequency setting, multiple runs will yield different results. For the scripts to always run, remove the <code>instances</code> directory before rebooting.</p><pre><code>rm -rf /var/lib/cloud/instances
</code></pre><h2 id=module-frequency-info>Module Frequency Info</h2><table><thead><tr><th>Name</th><th>Frequency</th></tr></thead><tbody><tr><td>disable_ec2_metadata</td><td>Always</td></tr><tr><td>users_groups</td><td>Instance</td></tr><tr><td>write_files</td><td>Instance</td></tr><tr><td>update_hostname</td><td>Always</td></tr><tr><td>final_message</td><td>Always</td></tr><tr><td>resolv_conf</td><td>Instance</td></tr><tr><td>growpart</td><td>Always</td></tr><tr><td>update_etc_hosts</td><td>Always</td></tr><tr><td>power_state_change</td><td>Instance</td></tr><tr><td>phone_home</td><td>Instance</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-f8d56103ef1a4dc0532efc64363fc40d>7.2 - Deploy Photon OS With `cloud-init`</h1><p>You can deploy Photon OS with <code>cloud-init</code> in the following ways:</p><ul><li>As a stand-alone Photon machine</li><li>In Amazon Elastic Compute Cloud, called EC2</li><li>In the Google cloud through the Google Compute Engine, or GCE</li><li>In a VMware Vsphere private cloud</li></ul><p>When a cloud instance of Photon OS starts, <code>cloud-init</code> requires a data source. The data source can be an EC2 file for Amazon&rsquo;s cloud platform, a <code>seed.iso</code> file for a stand-alone instance of Photon OS, or the internal capabilities of a system for managing virtual machines, such as VMware vSphere or vCenter. Cloud-init also includes data sources for OpenStack, Apache CloudStack, and OVF. The data source comprises two parts:</p><ol><li>Metadata</li><li>User data</li></ol><p>The metadata gives the cloud service provider instructions on how to implement the Photon OS machine in the cloud infrastructure. Metadata typically includes the instance ID and the local host name.</p><p>The user data contains the commands and scripts that Photon OS executes when it starts in the cloud. The user data commonly takes the form of a shell script or a YAML file containing a cloud configuration. The <a href=https://launchpad.net/cloud-init>cloud-init overview</a> and <a href=https://cloudinit.readthedocs.org/en/latest/>cloud-init documentation</a> contains information about the types of data sources and the formats for metadata and user data.</p><p>On Photon OS, <code>cloud-init</code> is enabled and running by default. You can use the following command to check the status:</p><pre><code>systemctl status cloud-init 
</code></pre><p>The Photon OS directory that contains the local data and other resources for cloud-init is <code>/var/lib/cloud</code>.</p><p>Photon OS stores the logs for cloud-init in the <code>/var/log/cloud-init.log</code> file.</p><p>The following sections demonstrate how to use cloud-init to customize a stand-alone Photon OS machine, instantiate a Photon OS machine in the Amazon EC2 cloud, and deploy a virtual machine running Photon OS in vSphere. Each section uses a different combination of the available options for the metadata and the user data that make up the data source. Specifications, additional options, and examples appear in the cloud-init documentation.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a81d2ef57638de58e167883385851db4>7.3 - Customizing Guest OS using Cloud-Init</h1><p>A guest operating system is an operating system that runs inside a virtual machine. You can install a guest operating system in a virtual machine and control guest operating system customization for virtual machines created from vApp templates.</p><p>When you customize your guest OS you can set up a virtual machine with the operating system that you want.</p><h3 id=procedure>Procedure</h3><ol><li>Perform the following steps before cloning or customizing the guest operating system:</li><li>Ensure that <code>disable_vmware_customization</code> is set to false in the <code>/etc/cloud/cloud.cfg</code> file.</li><li>Set <code>manage_etc_hosts: true</code> in the <code>/etc/cloud/cloud.cfg</code> file.</li><li>Make a backup of the <code>99-disable-networking-config.cfg</code> file and delete the file from <code>/etc/cloud/cloud.cfg.d</code> folder after backup.</li><li>Clone the VM or customize the guest operating system.</li><li>After you clone your VM or customize the guest operating system, perform the following steps:</li><li>Ensure that <code>disable_vmware_customization</code> is set to true in the <code>/etc/cloud/cloud.cfg</code> file in the newly created VM and the VM from where cloning was initiated.</li><li>Remove <code>manage_etc_hosts: true</code> from the <code>/etc/cloud/cloud.cfg</code> file in the newly created VM and the VM from where cloning was initiated.</li><li>Add a copy of the backed up file <code>99-disable-networking-config.cfg</code> to its original folder <code>/etc/cloud/cloud.cfg.d</code> in the newly created VM and the VM from where cloning was initiated.</li></ol><p><strong>Note</strong>:</p><ol><li>The <code>disable_vmware_customization</code> flag in <code>/etc/cloud/cloud.cfg.d</code> file decides which customization workflow to be initiated.</li></ol><ul><li>Setting this to <strong>false</strong> invokes the Cloud-Init GOS customization workflow.</li><li>Setting this to <strong>true</strong> invokes the traditional GOSC script based customization workflow.</li></ul><ol><li><p>When the <code>manage_etc_hosts</code> flag is set to <strong>true</strong>, Cloud-Init can edit the <code>/etc/hosts</code> file with the updated values.</p><p>When the flag is set to <strong>true</strong> Cloud-Init edits the <code>/etc/hosts</code> file, even when there is no cloud config metadata available. Remove this entry once the Cloud-Init GOS customization is done, to stop Cloud-Init from editing <code>/etc/hosts</code> file and set a fallback configuration.</p></li><li><p>The <code>99-disable-networking-config.cfg</code> file is packaged as part of Cloud-Init RPM in photon and it prevents Cloud-Init from configuring the network. Delete this file before starting the Cloud-Init customization and then paste the backup of the file in the <code>/etc/cloud/cloud.cfg.d/</code> folder once the cloud-init workflow is complete. It is important to replace this file after Cloud-Init customization to avoid removal of network configuration in the Cloud-Init instance.</p></li></ol><h3 id=result>Result</h3><p>Cloud-Init guest OS customization is now enabled.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8d1d064ff32b9086a691bf769b1119e9>7.4 - Creating a Stand-Alone Photon Machine With cloud-init</h1><p>Cloud-init can customize a Photon OS virtual machine by using the <code>nocloud</code> data source. The <code>nocloud</code> data source bundles the <code>cloud-init</code> metadata and user data into an ISO that acts as a seed when you boot the machine. The <code>seed.iso</code> delivers the metadata and the user data without requiring a network connection.</p><p><strong>Procedure</strong></p><ol><li><p>Create the metadata file with the following lines in the <a href=http://www.yaml.org/start.html>YAML</a> format and name it <code>meta-data</code>:</p><pre><code> instance-id: iid-local01
        local-hostname: cloudimg
</code></pre></li><li><p>Create the user data file with the following lines in YAML and name it user-data:</p><pre><code>  #cloud-config
  hostname: testhost
  packages:
   - vim
</code></pre></li><li><p>Generate the ISO that will serve as the seed. The ISO must have the volume ID set to <code>cidata</code>. In the following example, the ISO is generated on an Ubuntu 14.04 computer containing the files named <code>meta-data</code> and <code>user-data</code> in the local directory:</p><pre><code>genisoimage -output seed.iso -volid cidata -joliet -rock user-data meta-data
</code></pre><p>The ISO now appears in the current directory:</p><pre><code> ```
</code></pre><p>steve@ubuntu:~$ ls
meta-data seed.iso user-data</p><pre><code>
</code></pre></li><li><p>Optionally, check the ISO that you generated on Ubuntu by transferring the ISO to the root directory of your Photon OS machine and then running the following command:</p><pre><code>cloud-init --file seed.iso --debug init
</code></pre><p>After running the <code>cloud-init</code> command above, check the <code>cloud-init</code> log file:</p><pre><code>more /var/log/cloud-init.log
</code></pre></li><li><p>Attach the ISO to the Photon OS virtual machine as a CD-ROM and reboot it so that the changes specified by seed.iso take effect. In this case, <code>cloud-init</code> sets the <code>hostname</code> and adds the <code>vim</code> package.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-19e9a57097b9a10a14e9fe0e892ac425>7.5 - Customizing a Photon OS Machine on EC2</h1><p>You can upload an <code>ami</code> image of Photon OS to Amazon Elastic Compute Cloud (EC2) and customize the Photon OS machine by using <code>cloud-init</code> with an EC2 data source. The Amazon machine image version of Photon OS is available as a free download on Packages URL at the location <code>https://packages.vmware.com/photon/</code>.</p><p>The <code>cloud-init</code> service is commonly used on EC2 to configure the cloud instance of a Linux image. On EC2, <code>cloud-init</code> sets the <code>.ssh/authorized_keys</code> file to let you log in with a private key from another computer, that is, a computer besides the workstation that you are already using to connect with the Amazon cloud.</p><h2 id=example>Example</h2><p>The cloud-config user-data file that appears in the following example contains abridged SSH authorized keys to show you how to set them.</p><h3 id=prerequisites>Prerequisites</h3><ul><li>To work with EC2, obtain Amazon accounts for both AWS and EC2 with valid payment information. If you execute the below examples, you will be charged by Amazon. You must replace the <code>&lt;placeholders></code> for access keys and other account information in the examples with your account information.</li><li>Install and set up the Amazon AWS CLI and the EC2 CLI tools, including <code>ec2-ami-tools</code>.
For more information, see <a href=http://docs.aws.amazon.com/cli/latest/userguide/installing.html>Installing the AWS Command Line Interface</a>, <a href=http://docs.aws.amazon.com/AWSEC2/latest/CommandLineReference/set-up-ec2-cli-linux.html>Setting Up the Amazon EC2 Command Line Interface Tools on Linux</a> and <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-up-ami-tools.html>Setting Up the AMI Tools</a>.</li><li>Create SSH keys and an RSA user signing certificate and its corresponding private RSA key file.</li></ul><h3 id=procedure>Procedure</h3><ol><li>Upload the Photon OS <code>.ami</code> image to the Amazon cloud and configure it with cloud-init. The correct virtualization type for Photon OS is <code>hvm</code>.</li></ol><pre><code>$ mkdir bundled
	$ tar -zxvf ./photon-ami.tar.gz 
	$ ec2-bundle-image -c ec2-certificate.pem -k ec2-privatekey.pem -u &lt;EC2 account id&gt;  --arch x86_64 --image photon-ami.raw --destination ./bundled/
	$ aws s3 mb s3://&lt;bucket-name&gt;
	$ ec2-upload-bundle --manifest ./bundled/photon-ami.manifest.xml --bucket &lt;bucket-name&gt; --access-key &lt;Account Access Key&gt; --secret-key &lt;Account Secret key&gt;
	$ ec2-register &lt;bucket-name&gt;/photon-ami.manifest.xml --name photon-ami --architecture x86_64 --virtualization-type hvm
</code></pre><ol><li>Import the cloud-config data. In the following command, the <code>--user-data-file</code> option instructs cloud-init to import the cloud-config data in <code>user-data.txt</code>. The command assumes you have uploaded the <code>user-data.txt file</code> and created the keypair <code>mykeypair</code> and the security group <code>photon-sg</code>.</li></ol><pre><code> $ ec2-run-instances &lt;ami-ID&gt; --instance-type m3.medium -g photon-sg --key mykeypair --user-data-file user-data.txt
</code></pre><p>Describe the instance to see its ID:</p><pre><code>$ ec2-describe-instances
</code></pre><ol><li>Run the following command to obtain its public IP address, which you can use to connect to the instance with SSH:</li></ol><pre><code>$ aws ec2 describe-instances --instance-ids &lt;instance-id&gt; --query 'Reservations[*].Instances[*].PublicIpAddress' --output=text
$ ec2-describe-images
</code></pre><ol><li>Run the following commands to terminate the machine. It is important to shut down the machine because Amazon charges you while the host is running down.</li></ol><pre><code>$ ec2-deregister &lt;ami-image-identifier&gt;
$ ec2-terminate-instances &lt;instance-id&gt;
</code></pre><h3 id=result>Result</h3><p>The following are the contents of the <code>user-data.txt</code> file that <code>cloud-init</code> applies to the machine the first time that it boots up in the cloud:</p><pre><code>#cloud-config
    hostname: photon-on-01
    groups:
    - cloud-admins
    - cloud-users
    users:
    - default
    - name: photonadmin
       gecos: photon test admin user
       primary-group: cloud-admins
       groups: cloud-users
       lock-passwd: false
       passwd: vmware
    - name: photonuser
       gecos: photon test user
       primary-group: cloud-users
       groups: users
       passwd: vmware
    packages:
    - vim
	ssh_authorized_keys:
	 - ssh-rsa MIIEogIBAAKCAQEAuvHKAjBhpwuomcUTpIzJWRJAe71JyBgAWrwqyN1Mk5N+c9X5
	Ru2fazFA7WxQSD1KyTEvcuf8JzdBfrEJ0v3/nT2x63pvJ8fCl6HRkZtHo8zRu8vY
	KYTZS/sdvM/ruubHfq1ldRpgtYSqbkykoe6PCQIDAQABAoIBAEgveQtjVzHDhLTr
	rmwJmO316ERfkQ/chLaElhi9qwYJG/jqlNIISWFyztqD1b3fxU6m5MOBIujh7Xpg
	... ec3test@example.com 
</code></pre><p>You can view the cloud-init output log file on EC2 at <code>/var/log/cloud-init-output.log</code>.</p><p>For more information on using cloud-init user data on EC2, see <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html>Running Commands on Your Linux Instance at Launch</a>.</p><p>For more information on how to get Photon OS up and running on EC2 and run a containerized application in the Docker engine, see <a href=../../../installation-guide/run-photon-aws-ec2/>Running Photon OS on Amazon Elastic Cloud Compute</a>.</p><p>With Photon OS, you can also build cloud images on Google Compute Engine and other cloud providers. For more information, see <a href=../../../installation-guide/cloud-images/>Compatible Cloud Images</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2a00e7f392acef2068b651bde33db542>7.6 - Running a Photon OS Machine on GCE</h1><p>Photon OS comes in a preconfigured image ready for Google Cloud Engine.</p><h2 id=example>Example</h2><p>The example in this section shows how to create a Photon OS instance on Google Cloud Engine with and without cloud-init user data.</p><h3 id=prerequisites>Prerequisites</h3><ul><li>You must have set up a GCE account and are ready to pay Google for its cloud services. The GCE-ready version of Photon OS is licensed as described in the Photon OS <a href=https://github.com/vmware/photon/blob/master/LICENSE.md>LICENSE guide</a>. GCE and other environment-specific Packages are stored in the open using the following URL pattern: <code>https://packages.vmware.com/photon/&lt;release>/&lt;revision>/gce</code></li></ul><p>For example, the current GA revision of the 4.0 release would be located at the following URL: <a href=https://packages.vmware.com/photon/4.0/GA/gce/>https://packages.vmware.com/photon/4.0/GA/gce/</a>, and the 3.0 GA version would be located at: <a href=https://packages.vmware.com/photon/3.0/GA/gce/>https://packages.vmware.com/photon/3.0/GA/gce/</a>.</p><pre><code>The GCE-ready image of Photon OS contains packages and scripts that prepare it for the Google cloud to save you time as you implement a compute cluster or develop cloud applications. The GCE-ready version of Photon OS adds the following packages to the [packages installed with the minimal version](https://github.com/vmware/photon/blob/master/common/data/packages_minimal.json): 

```
sudo, tar, which, google-daemon, google-startup-scripts, 
kubernetes, perl-DBD-SQLite, perl-DBIx-Simple, perl, ntp
</code></pre><pre><code>
- Verify that you have the `gcloud command-line tool`. 
    For more information see,  [https://cloud.google.com/compute/docs/gcloud-compute](https://cloud.google.com/compute/docs/gcloud-compute).

### Procedure 

1. Use the following commands to create an instance of Photon OS from the Photon GCE image without using cloud-init. In the commands, you must replace `&lt;bucket-name&gt;` with the name of your bucket and the path to the Photon GCE tar file. 
	
    ```
$ gcloud compute instances list
	$ gcloud compute images list
	$ gcloud config list
	$ gsutil mb gs://&lt;bucket-name&gt;
	$ gsutil cp &lt;path-to-photon-gce-image.tar.gz&gt; gs://&lt;bucket-name&gt;/photon-gce.tar.gz
	$ gcloud compute images create photon-gce-image --source-uri gs://&lt;bucket-name&gt;/photon-gce.tar.gz 
	$ gcloud compute instances create photon-gce-vm --machine-type &quot;n1-standard-1&quot; --image photon-gce-image
	$ gcloud compute instances describe photon-gce-vm
</code></pre><ol><li><p>To create a new instance of a Photon OS machine and configure it with a cloud-init user data file, replace the <code>gcloud compute instances create</code> command in the example above with the following command. Before running this command, you must upload your user-data file to Google&rsquo;s cloud infrastructure and replace <code>&lt;path-to-userdata-file></code> with its path and file name.</p><pre><code>gcloud compute instances create photon-gce-vm --machine-type &quot;n1-standard-1&quot; --image photon-gce-vm --metadata-from-file=user-data=&lt;path-to-userdata-file&gt;
</code></pre></li></ol><pre><code>     
    You can also add a cloud-init user-data file to an existing instance of a Photon OS machine on GCE: 
	
    ```
gcloud compute instances add-metadata photon-gce-vm --metadata-from-file=user-data=&lt;path-to-userdata-file&gt;
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-0990d9372509a57cc6bcbd54bb06dd5b>8 - Containers</h1><p>A container is a process that runs on the Photon OS host with its own isolated application, file system, and networking.</p><p>Photon OS includes the open source version of Docker. With Docker, Photon OS becomes a Linux run-time host for containers, that is, a Linux cloud container.</p><p>The full version of Photon OS includes Kubernetes so you can manage clusters of containers.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-049de2e7e2971394ac98bd0fbaf437ba>8.1 - Docker Containers</h1><p>On Photon OS, the Docker daemon is enabled by default. To view the status of the daemon, run the following command:</p><pre><code>systemctl status docker
</code></pre><p>Docker is loaded and running by default on the full version of Photon OS. On the minimal version, it is loaded but not running by default. To start it, run the following command:</p><pre><code>systemctl start docker
</code></pre><p>To obtain information about Docker, run the following command as root:</p><pre><code>docker info
</code></pre><p>After Docker is enabled and started, you can create a container. For example, run the following docker command as root to create a container running Ubuntu 14.04 with an interactive terminal shell:</p><pre><code>docker run -i -t ubuntu:14.04 /bin/bash
</code></pre><p>Photon OS also enables you to run a docker container that runs Photon OS:</p><pre><code>docker run -i -t photon /bin/bash
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-236638060a87773fb6e1ad2401baba69>8.2 - Kubernetes</h1><p>The Kubernetes package provides several services: kube-apiserver, kube-scheduler, kube-controller-manager, kubelet, kube-proxy. These services are managed by <code>systemd</code>. Their configuration resides in a central location: <code>/etc/kubernetes</code>.</p><p>For more information, see <a href=../../../user-guide/kubernetes-on-photon-os/>Running Kubernetes on Photon OS</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c17a1e127da35ce88db6ba685c12104c>9 - Changing the Locale</h1><p>You can change the locale if the default locale does not meet your requirements.</p><p>To find the locale, run the the <code>localectl</code> command:</p><pre><code>localectl
System Locale: LANG=en_US.UTF-8
   VC Keymap: n/a
  X11 Layout: n/a
</code></pre><p>To change the locale, choose the languages that you want from <code>/usr/share/locale/locale.alias</code>, add them to <code>/etc/locale-gen.conf</code>, and then regenerate the locale list by running the following command as root:</p><pre><code>locale-gen.sh
</code></pre><p>Finally, run the following command to set the new locale, replacing the example (<code>en_US.UTF-8</code>) with the locale that you require:</p><pre><code>localectl set-locale LANG=&quot;de_CH.UTF-8&quot; LC_CTYPE=&quot;de_CH.UTF-8&quot;
</code></pre><h1 id=changing-the-keyboard-layout>Changing the keyboard layout</h1><p>See which keymaps are currently available on your system:</p><pre><code>localectl list-keymaps
</code></pre><p>If the response to that command is the all-too-common <code>Couldn't find any console keymaps</code>, install the key tables files and utilities:</p><pre><code>tdnf install kbd
</code></pre><p>You should now be able to find a keymap matching your keyboard. As an example, here I&rsquo;m searching for the German keyboard layout (so I&rsquo;m expecting something with <code>de</code> in the name) used in Switzerland:</p><pre><code>localectl list-keymaps | grep de
</code></pre><pre><code class=language-console data-lang=console>    ...
    de-latin1
    de-latin1-nodeadkeys
    de-mobii
    de_CH-latin1
    de_alt_UTF-8
    ...
</code></pre><p><code>de_CH-latin1</code> seems to be what we&rsquo;re looking for, so change your current layout to that keymap:</p><pre><code>localectl set-keymap de_CH-latin1
</code></pre><p>and confirm that the change has been made:</p><pre><code>localectl
System Locale: LANG=de_CH.UTF-8
   VC Keymap: de_CH-latin1
  X11 Layout: n/a
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-aa12f342ea5e96c0bf80a28c55f666ea>10 - Security Policy</h1><p>This section describes the security policy of Photon OS.</p></div><div class=td-content><h1 id=pg-74864e4a4766a18875ff1ba7ea83c95d>10.1 - Default Firewall Settings</h1><p>The design of Photon OS emphasizes security. On the minimal and full versions of Photon OS, the default security policy turns on the firewall and drops packets from external interfaces and applications. As a result, you might need to add rules to iptables to permit forwarding, allow protocols like HTTP, and open ports. You must configure the firewall for your applications and requirements.</p><p>The default iptables on the full version have the following settings:</p><pre><code>iptables --list
Chain INPUT (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh

Chain FORWARD (policy DROP)
target     prot opt source               destination

Chain OUTPUT (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
</code></pre><p>For more information on how to change the settings, see the man page for iptables.</p><p>Although the default iptables policy accepts SSH connections, the <code>sshd</code> configuration file on the full version of Photon OS is set to reject SSH connections. See <a href=../../../troubleshooting-guide/solutions-to-common-problems/permitting-root-login-with-ssh/>Permitting Root Login with SSH</a>.</p><p>If you are unable to ping a Photon OS machine, check the firewall rules. To verify if the rules allow connectivity for the port and protocol, change the <code>iptables</code> commands by using <code>lsof</code> commands to see the processes listening on ports:</p><pre><code>lsof -i -P -n</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-e38c9d1982878fda5ab827b2767db33c>10.2 - Default Permissions and umask</h1><p>The <code>umask</code> on Photon OS is set to <code>0027</code>.</p><p>When you create a new file with the <code>touch</code> command as root, the default on Photon OS is to set the permissions to <code>0640</code>&ndash;which translates to <code>read-write</code> for user, <code>read</code> for group, and no access for others. Here&rsquo;s an example:</p><pre><code>touch newfile.md
stat newfile.md
  File: 'newfile.md'
  Size: 0               Blocks: 0          IO Block: 4096   regular empty file
Device: 801h/2049d      Inode: 316454      Links: 1
Access: (0640/-rw-r-----)  Uid: (    0/    root)   Gid: (    0/    root)
</code></pre><p>When you create a directory as root, Photon OS sets the permissions to <code>0750</code>:</p><pre><code>mkdir newdir
stat newdir
  File: 'newdir'
  Size: 4096            Blocks: 8          IO Block: 4096   directory
Device: 801h/2049d      Inode: 316455      Links: 2
Access: (0750/drwxr-x---)  Uid: (    0/    root)   Gid: (    0/    root)
</code></pre><p>Because the <code>mkdir</code> command uses the umask to modify the permissions placed on newly created files or directories, you can see <code>umask</code> at work in the permissions of the new directory. Its default permissions are set at <code>0750</code> after the umask subtracts <code>0027</code> from the full set of open permissions, <code>0777</code>.</p><p>Similarly, a new file begins as <code>0666</code> if you were to set umask to <code>0000</code>. But because umask is set by default to <code>0027</code>, a new file&rsquo;s permissions are set to <code>0640</code>.</p><p>So be aware of the default permissions on the directories and files that you create. Some system services and applications might require permissions other than the default. The <code>systemd</code> network service, for example, requires user-defined configuration files to be set to <code>644</code>, not the default of <code>640</code>. Thus, after you create a network configuration file with a <code>.network</code> extension, you must run the <code>chmod</code> command to set the new file&rsquo;s mode bits to <code>644</code>. For example:</p><pre><code>chmod 644 10-static-en.network 
</code></pre><p>For more information on permissions, see the man pages for <code>stat</code>, <code>umask</code>, and <code>acl</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c7abef9aaf3c4a27b0772f48541f3371>10.3 - Disabling TLS 1.0 to Improve Transport Layer Security</h1><p>Photon OS includes GnuTLS to help secure the transport layer. <a href=http://www.gnutls.org/>GnuTLS</a> is a library that implements the SSL and TLS protocols to secure communications.</p><p>On Photon OS, SSL 3.0, which contains a known vulnerability, is disabled by default.</p><p>However, TLS 1.0, which also contains known vulnerabilities, is enabled by default.</p><p>To turn off TLS 1.0, perform the follwoing steps:</p><ol><li>Create a directory named <code>/etc/gnutls</code>.</li><li>In <code>/etc/gnutls</code> create a file named <code>default-priorities</code>.</li><li>In the <code>default-priorities</code> file, specify GnuTLS priority strings that remove TLS 1.0 and SSL 3.0 but retain TLS 1.1 and TLS 1.2.</li><li>After adding a new <code>default-priorities</code> file or after modifying it, you must restart all applications, including SSH, with an open TLS session for the changes to take effect.</li></ol><p>The following is an example of a <code>default-priorities</code> file that contains GnuTLS priorities to disable TLS 1.0 and SSL 3.0:</p><pre><code>cat /etc/gnutls/default-priorities
SYSTEM=NONE:!VERS-SSL3.0:!VERS-TLS1.0:+VERS-TLS1.1:+VERS-TLS1.2:+AES-128-CBC:+RSA:+SHA1:+COMP-NULL
</code></pre><p>In this example, the priority string imposes system-specific policies. The <code>NONE</code> keyword means that no algorithms, protocols, or compression methods are enabled, so that you can enable specific versions individually later in the string. The priority string then specifies that SSL version 3.0 and TLS version 1.0 be removed, as marked by the exclamation point. The priority string then enables, as marked by the plus sign, versions 1.1 and 1.2 of TLS. The cypher is AES-128-CBC. The key exchange is RSA. The MAC is SHA1. And the compression algorithm is COMP-NULL.</p><p>On Photon OS, you can verify the system-specific policies in the <code>default-priorities</code> file as follows:</p><ol><li><p>Concatenate the <code>default-priorities</code> file to check its contents:</p><pre><code></code></pre></li></ol><p>root@photon-rc [ ~ ]# cat /etc/gnutls/default-priorities
SYSTEM=NONE:!VERS-SSL3.0:!VERS-TLS1.0:+VERS-TLS1.1:+VERS-TLS1.2:+AES-128-CBC:+RSA:+SHA1:+COMP-NULL</p><pre><code>
1. Run the following command to check the protocols that are enabled for the system: 	

    ```
    root@photon-rc [ /etc/gnutls ]# gnutls-cli --priority @SYSTEM -l
	Cipher suites for @SYSTEM
	TLS_RSA_AES_128_CBC_SHA1                                0x00, 0x2f      SSL3.0

	Certificate types: none
	Protocols: VERS-TLS1.1, VERS-TLS1.2
	Compression: COMP-NULL
	Elliptic curves: none
	PK-signatures: none
</code></pre><p>For information about the GnuTLS priority strings, see <a href=https://gnutls.org/manual/html_node/Priority-Strings.html>https://gnutls.org/manual/html_node/Priority-Strings.html</a>.</p><p>For information about the vulnerability in SSL 3.0, see <a href=https://www.us-cert.gov/ncas/alerts/TA14-290A>SSL 3.0 Protocol Vulnerability and POODLE Attack</a>.</p><p>For information about the vulnerabilities in TLS 1.0, see <a href=http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-52r1.pdf>Guidelines for the Selection, Configuration, and Use of Transport Layer Security (TLS) Implementations</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7b214cc408cfd2696dd663e9695fa956>11 - Photon RPM OSTree: a simple guide</h1></div><div class=td-content><h1 id=pg-8bc44d4a336637a36731fa2fec02b610>11.1 - Introduction</h1><h2 id=rpm-ostree-overview>RPM-OSTree Overview</h2><p>OSTree is a tool to manage bootable, immutable, versioned filesystem trees. Unlike traditional package managers like rpm or dpkg that know how to install, uninstall, configure packages, OSTree has no knowledge of the relationship between files. But when you add rpm capabilities on top of OSTree, it becomes RPM-OSTree, meaning a filetree replication system that is also package-aware.</p><p>The idea behind it is to use a client/server architecture to keep your Linux installed machines (physical or VM) in sync with the latest bits, in a predictable and reliable manner. To achieve that, OSTree uses a git-like repository that records the changes to any file and replicate them to any subscriber.</p><p>A system administrator or an image builder developer takes a base Linux image, prepares the packages and other configuration on a server box, executes a command to compose a filetree that the host machines will download and then incrementally upgrade whenever a new change has been committed.
You may read more about OSTree <a href=https://ostree.readthedocs.org/en/latest/>here</a>.</p><h2 id=why-use-rpm-ostree-in-photon>Why use RPM-OSTree in Photon?</h2><p>There are several important benefits:</p><ul><li>Reliable, efficient: The filetree replication is simple, reliable and efficient. It will only transfer deltas over the network. If you have deployed two almost identical bootable images on same box (differing just by several files), it will not take twice the space. The new tree will have a set of hardlinks to the old tree and only the different files will have a separate copy stored to disk.</li><li>Atomic: the filetree replication is atomic. At the end of a deployment, you are either booting from one deployment, or the other. There is no &ldquo;partial deployed bootable image&rdquo;. If anything bad happens during replication or deployment- power loss, network failure, your machine boots from the old image. There is even a tool option to cleanup old deployed (successfully or not) image.</li><li>Manageable: You are provided simple tools to figure out exactly what packages have been installed, to compare files, configuration and package changes between versions.</li><li>Predictable, repeatable: A big headache for a system administrator is to maintain a farm of computers with different packages, files and configuration installed in different order, that will result in exponential set of test cases. With RPM-OStree, you get identical, predictable installed systems.</li></ul><p>As drawbacks, I would mention:</p><ul><li>Some applications configured by user on host may have compatibility issues if they save configuration or download into read only directories like /usr.</li><li>People not used with &ldquo;read only&rdquo; file systems will be disappointed that they could no longer use RPM, yum, tdnf to install whatever they want. Think of this as an &ldquo;enterprise policy&rdquo;. They may circumvent this by customizing the target directory to a writable directory like /var or using rpm to install packages and record them using a new RPM repository in a writable place.</li><li>Administrators need to be aware about the directories re-mapping specific to OSTree and plan accordingly.</li></ul><h2 id=photon-with-rpm-ostree-installation-profiles>Photon with RPM-OSTree installation profiles</h2><p>Photon takes advantage of RPM-OSTree and offers several installation choices:</p><ul><li>Photon RPM-OSTree server - used to compose customized Photon OS installations and to prepare updates. I will call it for short &lsquo;server&rsquo;.</li><li>Photon RPM-OSTree host connected to a default online server repository via http or https, maintained by VMware Photon OS team, where future updates will be published. This will create a minimal installation profile, but with the option to self-upgrade. I will call it for short &lsquo;default host&rsquo;.</li><li>Photon RPM-OSTree host connected to a custom server repository. It requires a Photon RPM-OSTree Server installed in advance. I will call it for short &lsquo;custom host&rsquo;.</li></ul><h2 id=terminology>Terminology</h2><p>In this section, the term <em>OSTree</em> refers to the general use of this technology, the format of the repository or replication protocol.</p><p>The term <em>RPM-OSTree</em> emphasizes the layer that adds RedHat Package Manager compatibility on both ends - at server and at host. However, since Photon OS is an RPM-based Linux, there are places in the documentation and even in the installer menus where <em>OSTree</em> may be used instead of <em>RPM-OSTree</em> when the distinction is not obvious or does not matter in that context.</p><p>When <code>ostree</code> and <code>rpm-ostree</code> are encountered, they refer to the usage of the specific Unix commands.</p><p>Finally, <em>Photon RPM-OSTree</em> is the application or implementation of the RPM-OStree system into Photon OS, materialized into two options: Photon Server and Photon Host (or client). <em>Server</em> or <em>Host</em> may be used with or without the <em>Photon</em> and/or <em>RPM-OStree</em> qualifier, but it means the same thing.</p><h2 id=sample-code>Sample code</h2><p>Codes samples used throughout the book are small commands that can be typed at shell command prompt and do not require downloading additional files. As an alternative, one can remote connect via ssh, so cut & paste sample code from outside sources or copy files via scp will work. See the Photon Administration guide to learn <a href=../../../troubleshooting-guide/solutions-to-common-problems/permitting-root-login-with-ssh/>how to enable ssh</a>.
The samples assume that the following VMs have been installed - see the steps in the next chapters:</p><ul><li>A default host VM named <strong>photon-host-def</strong>.</li><li>Two server VMs named <strong>photon-srv1</strong> and <strong>photon-srv2</strong>.</li><li>Two custom host VMs named <strong>photon-host-cus1</strong> and <strong>photon-host-cus2</strong>, connected each to the corresponding server during install.</li></ul><h2 id=how-to-read-this-book>How to read this book</h2><p>The RPM OSTree guide is structured to be used both as a sequential read and as a reference documentation.<br>If you are just interested in deploying a host system and keeping it up to date, then read <a href=../installing-a-host-against-default-server-repository/>Installing a Photon RPM-OSTree host against default server repository</a> and <a href=../host-updating-operations/>Host updating operations</a>.</p><p>If you want to install your own server and experiment with customizing packages for your Photon hosts, then read [Installing a Photon RPM-OSTree server](../creating-a-rpm-ostree-
server/) onwards. There are references to the concepts discussed throughout the book, if you need to understand them better.<br>However, if you want to read page by page, information is presented from simple to complex, although as with any technical book, we occasionally run into the chicken and egg problem - forward references to concepts that have yet to be explained later. In other cases, concepts are introduced and presented in great detail that may be seem hard to follow at first, but I promise they will make sense in the later pages when you get to use them.</p><h2 id=rpm-ostree-in-photon-os-30>RPM OSTree in Photon OS 3.0</h2><p>This book is relevant to RPM OSTree in Photon OS 3.0.</p><p>Version 3.0 supports the following features:</p><ul><li>Upgrade</li><li>Rollback</li><li>Remote, compose, and rebase server</li><li>Installation and uninstallation of packages with URL</li><li>Installation and uninstallation of packages from default repos</li><li>Automatic updates</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-892db7bed87d9eb3b9fa6fae638395b0>11.2 - Installing a host against default server repository</h1><p>RPM-OSTree Host default server repo installation option in Photon 3.0 will setup a profile similar to Photon Minimal, with the added benefit of being able to self-upgrade.</p><h2 id=who-is-this-for>Who is this for?</h2><p>The RPM-OSTree &lsquo;default host&rsquo; is the easiest way to deploy a Photon RPM-OSTree host from ISO/cdrom, without the need to deploy and maintain an RPM-OSTree server. It is targeted at the user who relies on VMware Photon OS team to keep his or her system up-to-date, configured to get its updates from the official Photon 3.0 OSTree repository.</p><p>This is also the fastest way to install a host, as we&rsquo;ve included in the ISO/cdrom an identical copy of the Photon 3.0 &ldquo;starter&rdquo; RPM-OSTree repository that is published online by VMware Photon OS team. So rather than pulling from the online repository, the installer pulls the repo from cdrom, which saves bandwidth and also reduces to zero the chances of failing due to a networking problem. After successful installation, any updates are going to be pulled from the official online repository, when Photon OS team will make them available.</p><p><strong>Note</strong>: It is also possible to install an RPM-OSTree host against the official online repo via PXE boot, without the benefit of fast, local pull from cdrom. This will be covered in the PXE boot/kickstart chapter, as it requires additional configuration.</p><h2 id=installing-the-iso>Installing the ISO</h2><p>User will first download <a href=https://github.com/vmware/photon/wiki/Downloading-Photon-OS>Photon OS ISO file</a> that contains the installer, which is able to deploy any of the supported Photon installation profiles.</p><p>There are some steps common to all Photon installation profiles, starting with adding a VM in VMware Fusion, Workstation or ESXi, selecting the OS family, then customizing for disk size, CPU, memory size, network interface etc. (or leaving the defaults) and selecting the ISO image as cdrom. The installer will launch, that will go through disk partitioning and accepting the license agreement screens, followed by selecting an installation profile.
These steps are described at the page linked below, so I won&rsquo;t repeat them, just that instead of setting up a Photon Minimal profile, we will install a Photon OSTree host:</p><p><a href=../../../installation-guide/run-photon-on-fusion/>Running Project Photon on Fusion</a>.</p><p>Select the <strong>Photon OSTree Host</strong> option.</p><p><img src=../../../images/rpmostree-install-options.png alt=PhotonChooseHost></p><p>Continue with setting up a host name like <strong>photon1-def</strong> and a root password, re-confirm.
Then, select &ldquo;Default OSTree Server&rdquo; and continue.</p><p><img src=../../../images/rpmostree-default.png alt=PhotonChooseHostDefault></p><p><img src=../../../images/photon-os-finish.png alt=PhotonHostDefaultFinish></p><p>When installation is over, the VM will reboot and will show in grub VMWare Photon/Linux 3.0_minimal (ostree), which will reassure that it&rsquo;s booting from an OSTree image!</p><p><img src=../../../images/rpmostree-grub.png alt=PhotonHostFirstRebootGrub></p><p>Boot, login and you are ready to use it.</p><p>To upgrade your host, see <a href=../host-updating-operations/>Host updating operations</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e35a78141715aabfec52a74c647a086a>11.3 - Concepts in Action</h1><p>Now that we have a fresh installed host (either as [[default|Photon-RPM-OSTree:-2-Installing-a-host-against-default-server-repository]] or [[custom|Photon-RPM-OSTree:-7-Installing-a-host-against-a-custom-server-repository]]), I can explain better the OStree concepts and see them in action.</p><h2 id=querying-the-deployed-filetrees>Querying the deployed filetrees</h2><p>The first thing to do is to run a command that tells us what is installed on the machine and when. Since it&rsquo;s a fresh install from the CD, there is only one bootable filetree image deployed.</p><pre><code>root@photon-host [ ~ ]# rpm-ostree status
  * ostree://photon:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal (2019-08-29T11:20:19Z)
                    Commit: a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650
</code></pre><h2 id=bootable-filetree-version>Bootable filetree version</h2><p><strong>3.0_minimal</strong> is not the Linux Photon OS release version, nor daily build, but rather a human readable, self-incrementing version associated with every commit that brings file/package updates. Think of this as version 0. The following versions are going to be 3.0_minimal.1, 3.0_minimal.2, 3.0_minimal.3 and so on.</p><h2 id=commit-id>Commit ID</h2><p>The ID listed is actually the first 5 bytes (10 hex digits) of the commit hash. If you want to see the verbose mode, use the <code>-v</code> option.</p><pre><code>root@photon-host [ ~ ]# rpm-ostree status -v
State: idle
AutomaticUpdates: disabled
Deployments:
* ostree://photon:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal (2019-08-29T11:20:19Z)
                    Commit: a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650
                            `- photon (2019-08-29T11:18:53Z)
                    Staged: no
                 StateRoot: photon
</code></pre><h3 id=rpm-ostree-options>RPM OStree Options</h3><p>To see the list of options available with the rpm-ostree command, use the -h option.</p><pre><code>root@photon-host [ ~ ]# rpm-ostree -h
Usage:
  rpm-ostree [OPTION?] COMMAND

Builtin Commands:
  compose          Commands to compose a tree
  cleanup          Clear cached/pending data
  db               Commands to query the RPM database
  deploy           Deploy a specific commit
  rebase           Switch to a different tree
  rollback         Revert to the previously booted tree
  status           Get the version of the booted system
  upgrade          Perform a system upgrade
  reload           Reload configuration
  usroverlay       Apply a transient overlayfs to /usr
  cancel           Cancel an active transaction
  initramfs        Enable or disable local initramfs regeneration
  install          Overlay additional packages
  uninstall        Remove overlayed additional packages
  override         Manage base package overrides
  reset            Remove all mutations
  refresh-md       Generate rpm repo metadata
  kargs            Query or modify kernel arguments

Help Options:
  -h, --help       Show help options

Application Options:
  --version        Print version information and exit
</code></pre><h2 id=osname>OSname</h2><p>The OS Name identifies the operating system installed. All bootable filetrees for the same OS will share the /var directory, in other words applications installed in one booted image into this directory will be available in all other images.<br>If a new set of images are created for a different OS, they will receive a fresh copy of /var that is not shared with the previous OS images for the initial OS. In other words, if a machine is dual boot for different operating systems, they will not share each other&rsquo;s /var content, however they will still merge 3-way /etc.</p><h2 id=refspec>Refspec</h2><p>The <strong>Refspec</strong> is a branch inside the repo, expressed in a hierarchical way. In this case, it&rsquo;s the default branch that will receive package updates for the Photon OS 1.0 Minimal installation profile on Intel platforms. There could be other branches in the future, for example photon/3.0/x86_64/full that will match the Full installation profile (full set of packages installed).<br>Think of Refspec as the head of the minimal branch (just like in git) at the origin repo. On the replicated, local repo at the host, <strong>minimal</strong> is a file that contains the latest commit ID known for that branch.</p><pre><code>root@photon-host [ ~ ]# cat /ostree/repo/refs/remotes/photon/photon/3.0/x86_64/minimal 
a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650
</code></pre><p>Why are there two &lsquo;photon&rsquo; directory levels in the remotes path? The <strong>photon:</strong> prefix in the Refspec listed by <code>rpm-ostree status</code> corresponds to the first <strong>photon</strong> directory in the remotes path and is actually the name given to the remote that the host is connected to, which points to an http or https URL. We&rsquo;ll talk about remotes later, but for now think of it as a namespace qualifier. The second <strong>photon</strong> is part of the Refspec path itself.</p><h2 id=deployments>Deployments</h2><p>We&rsquo;ve used so far <code>rpm-ostree</code>. The same information can be obtained running an <code>ostree</code> command:</p><pre><code>root@photon-host [ ~ ]# ostree admin status
* photon a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650.0
    Version: 3.0_minimal
    origin refspec: photon:photon/3.0/x86_64/minimal
</code></pre><p>But where is this information stored? As you may have guessed, the local repo stores the heads of the deployed trees - the most recent commitment ID, just like Git does:</p><pre><code>root@photon-host [ ~ ]# cat /ostree/repo/refs/heads/ostree/0/1/0 
a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650
</code></pre><p>This also where this command that lists the references (local heads and remotes) takes its data from:</p><pre><code>root@photon-host [ ~ ]# ostree refs
ostree/0/1/0
photon:photon/3.0/x86_64/minimal
</code></pre><p>Based on that, it could find the root of the deployment that it boots from. The actual filetree is deployed right here:</p><pre><code>root@photon-host [ ~ ]#  ls -l /ostree/deploy/photon/deploy/a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650.0
total 36
lrwxrwxrwx  2 root root    7 Sep  4 04:58 bin -&gt; usr/bin
drwxr-xr-x  2 root root 4096 Jan  1  1970 boot
drwxr-xr-x  2 root root 4096 Jan  1  1970 dev
drwxr-xr-x 34 root root 4096 Sep  4 05:00 etc
lrwxrwxrwx  2 root root    8 Sep  4 04:58 home -&gt; var/home
lrwxrwxrwx  3 root root    7 Sep  4 04:58 lib -&gt; usr/lib
lrwxrwxrwx  3 root root    7 Sep  4 04:58 lib64 -&gt; usr/lib
lrwxrwxrwx  2 root root    9 Sep  4 04:58 media -&gt; run/media
lrwxrwxrwx  2 root root    7 Sep  4 04:58 mnt -&gt; var/mnt
lrwxrwxrwx  2 root root    7 Sep  4 04:58 opt -&gt; var/opt
lrwxrwxrwx  2 root root   14 Sep  4 04:58 ostree -&gt; sysroot/ostree
drwxr-xr-x  2 root root 4096 Jan  1  1970 proc
lrwxrwxrwx  2 root root   12 Sep  4 04:58 root -&gt; var/roothome
drwxr-xr-x  2 root root 4096 Jan  1  1970 run
lrwxrwxrwx  2 root root    8 Sep  4 04:58 sbin -&gt; usr/sbin
lrwxrwxrwx  2 root root    7 Sep  4 04:58 srv -&gt; var/srv
drwxr-xr-x  2 root root 4096 Jan  1  1970 sys
drwxr-xr-x  2 root root 4096 Jan  1  1970 sysroot
lrwxrwxrwx  2 root root   11 Sep  4 04:58 tmp -&gt; sysroot/tmp
drwxr-xr-x 10 root root 4096 Jan  1  1970 usr
drwxr-xr-x  8 root root 4096 Sep  4 04:59 var
</code></pre><p>So how is a deployment linked to a specific branch, originating from a remote repo? Well, there is a file next to the deployed filetree root directory with the same name and <strong>.origin</strong> suffix, that contains exactly this info:</p><pre><code>root@photon-host [ ~ ]# cat /ostree/deploy/photon/deploy/a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84
f20833650.0.origin
[origin]
refspec=photon:photon/3.0/x86_64/minimal
</code></pre><p>Fast forwarding a bit, if there is a new deployment due to an upgrade or rebase, a new filetree will be added at the same level, and a new .origin file will tie it to the remote branch it originated from.</p><p>The <strong>photon</strong> directory in the path is the actual OSname. Multiple deployments of same OS will share a writable /var folder.</p><pre><code>root@photon-host [ ~ ]# ls -l /ostree/deploy/photon/var/
total 52
drwxr-xr-x  4 root root 4096 Sep  4 05:00 cache
drwxr-xr-x  2 root root 4096 Sep  4 05:00 home
drwxr-xr-x 14 root root 4096 Sep  4 05:00 lib
drwxr-xr-x  2 root root 4096 Sep  4 05:00 local
lrwxrwxrwx  1 root root   11 Sep  4 04:59 lock -&gt; ../run/lock
drwxr-xr-x  4 root root 4096 Sep  4 05:00 log
drwxr-xr-x  2 root root 4096 Sep  4 05:00 mail
drwxr-xr-x  2 root root 4096 Sep  4 05:00 mnt
drwxr-xr-x  4 root root 4096 Sep  4 05:00 opt
drwx------  3 root root 4096 Sep  4 05:25 roothome
lrwxrwxrwx  1 root root    6 Sep  4 04:59 run -&gt; ../run
drwxr-xr-x  2 root root 4096 Sep  4 05:00 spool
drwxr-xr-x  2 root root 4096 Sep  4 05:00 srv
drwxrwxrwt  5 root root 4096 Sep  4 05:34 tmp
drwxr-xr-x 11 root root 4096 Sep  4 05:00 usrlocal
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-84649216fef2a5c5bc00f0d7146ddb38>11.4 - Querying For Commit File and Package Metadata</h1><p>There are several ostree and rpm-ostree commands that list file or package data based on either the Commit ID, or Refspec. If Refspec is passed as a parameter, it&rsquo;s the same as passing the most recent commit ID (head) for that branch.</p><h2 id=commit-history>Commit history</h2><p>For a host that is freshly installed, there is only one commit in the history for the only branch.</p><pre><code>root@photon-host [ ~ ]# ostree log photon/3.0/x86_64/minimal
commit a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650
ContentChecksum:  e91261daf8d60074f334a7ebf81d3b930c3fc88c765f994f79ab2445296f03c5
Date:  2019-08-29 11:20:19 +0000
Version: 3.0_minimal
</code></pre><p>This commit has no parent; if there was an older commit, it would have been listed too. We can get the same listing (either nicely formatted or raw variant data) by passing the Commit ID. Just the first several hex digits will suffice to identify the commit ID. We can either request to be displayed in a pretty format, or raw - the actual C struct.</p><pre><code>root@photon-host [ ~ ]# ostree log a31a
commit a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650
ContentChecksum:  e91261daf8d60074f334a7ebf81d3b930c3fc88c765f994f79ab2445296f03c5
Date:  2019-08-29 11:20:19 +0000
Version: 3.0_minimal
</code></pre><pre><code>root@photon-host [ ~ ]# ostree log a31a --raw
commit a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650
({'rpmostree.inputhash': &lt;'a3e8f3f6ef6e93c2ed6ce9edd1e9e80c93a36ecda0fed0d78f607e6ec3179d04'&gt;, 'rpmostree.rpmmd-repos': &lt;[{'id': &lt;'photon'&gt;, 'timestamp': &lt;uint64 1567077533&gt;}]&gt;, 'version': &lt;'3.0_minimal'&gt;, 'rpmostree.rpmdb.pkglist': &lt;[('Linux-PAM', '0', '1.3.0', '1.ph3', 'x86_64'), ('attr', '0', '2.4.48', '1.ph3', 'x86_64'), ('autogen-libopts', '0', '5.18.16', '1.ph3', 'x86_64'), ('bash', '0', '4.4.18', '1.ph3', 'x86_64'), ('bc', '0', '1.07.1', '1.ph3', 'x86_64'), ('binutils', '0', '2.31.1', '6.ph3', 'x86_64'), ('bridge-utils', '0', '1.6', '1.ph3', 'x86_64'), ('bubblewrap', '0', '0.3.0', '2.ph3', 'x86_64'), ('bzip2', '0', '1.0.6', '10.ph3', 'x86_64'), ('bzip2-libs', '0', '1.0.6', '10.ph3', 'x86_64'), ('ca-certificates', '0', '20190521', '1.ph3', 'x86_64'), ('ca-certificates-pki', '0', '20190521', '1.ph3', 'x86_64'), ('coreutils', '0', '8.30', '1.ph3', 'x86_64'), ('cpio', '0', '2.12', '4.ph3', 'x86_64'), ('cracklib', '0', '2.9.6', '8.ph3', 'x86_64'), ('cracklib-dicts', '0', '2.9.6', '8.ph3', 'x86_64'), ('curl', '0', '7.61.1', '4.ph3', 'x86_64'), ('curl-libs', '0', '7.61.1', '4.ph3', 'x86_64'), ('dbus', '0', '1.13.6', '1.ph3', 'x86_64'), ('device-mapper', '0', '2.02.181', '1.ph3', 'x86_64'), ('device-mapper-libs', '0', '2.02.181', '1.ph3', 'x86_64'), ('docker', '0', '18.06.2', '3.ph3', 'x86_64'), ('dracut', '0', '048', '1.ph3', 'x86_64'), ('dracut-tools', '0', '048', '1.ph3', 'x86_64'), ('e2fsprogs-libs', '0', '1.44.3', '2.ph3', 'x86_64'), ('elfutils', '0', '0.176', '1.ph3', 'x86_64'), ('elfutils-libelf', '0', '0.176', '1.ph3', 'x86_64'), ('expat', '0', '2.2.6', '2.ph3', 'x86_64'), ('expat-libs', '0', '2.2.6', '2.ph3', 'x86_64'), ('file', '0', '5.34', '1.ph3', 'x86_64'), ('file-libs', '0', '5.34', '1.ph3', 'x86_64'), ('filesystem', '0', '1.1', '4.ph3', 'x86_64'), ('findutils', '0', '4.6.0', '5.ph3', 'x86_64'), ('flex', '0', '2.6.4', '2.ph3', 'x86_64'), ('fuse', '0', '2.9.7', '5.ph3', 'x86_64'), ('gc', '0', '8.0.0', '1.ph3', 'x86_64'), ('glib', '0', '2.58.0', '4.ph3', 'x86_64'), ('glib-networking', '0', '2.59.1', '2.ph3', 'x86_64'), ('glibc', '0', '2.28', '4.ph3', 'x86_64'), ('glibc-iconv', '0', '2.28', '4.ph3', 'x86_64'), ('gmp', '0', '6.1.2', '2.ph3', 'x86_64'), ('gnupg', '0', '2.2.17', '1.ph3', 'x86_64'), ('gnutls', '0', '3.6.3', '3.ph3', 'x86_64'), ('gobject-introspection', '0', '1.58.0', '2.ph3', 'x86_64'), ('gpgme', '0', '1.11.1', '2.ph3', 'x86_64'), ('grep', '0', '3.1', '1.ph3', 'x86_64'), ('grub2', '0', '2.02', '13.ph3', 'x86_64'), ('grub2-efi', '0', '2.02', '13.ph3', 'x86_64'), ('grub2-pc', '0', '2.02', '13.ph3', 'x86_64'), ('guile', '0', '2.0.13', '2.ph3', 'x86_64'), ('gzip', '0', '1.9', '1.ph3', 'x86_64'), ('iana-etc', '0', '2.30', '2.ph3', 'noarch'), ('icu', '0', '61.1', '1.ph3', 'x86_64'), ('iproute2', '0', '4.18.0', '2.ph3', 'x86_64'), ('iptables', '0', '1.8.3', '1.ph3', 'x86_64'), ('js', '0', '1.8.5', '2.ph3', 'x86_64'), ('json-c', '0', '0.13.1', '1.ph3', 'x86_64'), ('json-glib', '0', '1.4.4', '1.ph3', 'x86_64'), ('kmod', '0', '25', '1.ph3', 'x86_64'), ('krb5', '0', '1.17', '1.ph3', 'x86_64'), ('libapparmor', '0', '2.13', '7.ph3', 'x86_64'), ('libarchive', '0', '3.3.3', '3.ph3', 'x86_64'), ('libassuan', '0', '2.5.1', '1.ph3', 'x86_64'), ('libcap', '0', '2.25', '8.ph3', 'x86_64'), ('libdb', '0', '5.3.28', '2.ph3', 'x86_64'), ('libffi', '0', '3.2.1', '6.ph3', 'x86_64'), ('libgcc', '0', '7.3.0', '4.ph3', 'x86_64'), ('libgcrypt', '0', '1.8.3', '2.ph3', 'x86_64'), ('libgomp', '0', '7.3.0', '4.ph3', 'x86_64'), ('libgpg-error', '0', '1.32', '1.ph3', 'x86_64'), ('libgsystem', '0', '2015.2', '2.ph3', 'x86_64'), ('libksba', '0', '1.3.5', '1.ph3', 'x86_64'), ('libltdl', '0', '2.4.6', '3.ph3', 'x86_64'), ('libmodulemd', '0', '2.4.0', '1.ph3', 'x86_64'), ('libpsl', '0', '0.20.2', '1.ph3', 'x86_64'), ('librepo', '0', '1.10.2', '1.ph3', 'x86_64'), ('libseccomp', '0', '2.4.0', '1.ph3', 'x86_64'), ('libselinux', '0', '2.8', '1.ph3', 'x86_64'), ('libsepol', '0', '2.8', '1.ph3', 'x86_64'), ('libsolv', '0', '0.6.35', '1.ph3', 'x86_64'), ('libsoup', '0', '2.64.0', '2.ph3', 'x86_64'), ('libssh2', '0', '1.9.0', '1.ph3', 'x86_64'), ('libstdc++', '0', '7.3.0', '4.ph3', 'x86_64'), ('libtasn1', '0', '4.13', '1.ph3', 'x86_64'), ('libtool', '0', '2.4.6', '3.ph3', 'x86_64'), ('libunistring', '0', '0.9.10', '1.ph3', 'x86_64'), ('libxml2', '0', '2.9.9', '1.ph3', 'x86_64'), ('libyaml', '0', '0.2.1', '2.ph3', 'x86_64'), ('linux', '0', '4.19.65', '3.ph3', 'x86_64'), ('m4', '0', '1.4.18', '2.ph3', 'x86_64'), ('mpfr', '0', '4.0.1', '1.ph3', 'x86_64'), ('ncurses', '0', '6.1', '1.ph3', 'x86_64'), ('ncurses-libs', '0', '6.1', '1.ph3', 'x86_64'), ('ncurses-terminfo', '0', '6.1', '1.ph3', 'x86_64'), ('net-tools', '0', '1.60', '11.ph3', 'x86_64'), ('nettle', '0', '3.4', '1.ph3', 'x86_64'), ('npth', '0', '1.6', '1.ph3', 'x86_64'), ('nspr', '0', '4.21', '1.ph3', 'x86_64'), ('nss-altfiles', '0', '2.23.0', '1.ph3', 'x86_64'), ('nss-libs', '0', '3.44', '2.ph3', 'x86_64'), ('openssh', '0', '7.8p1', '5.ph3', 'x86_64'), ('openssh-clients', '0', '7.8p1', '5.ph3', 'x86_64'), ('openssh-server', '0', '7.8p1', '5.ph3', 'x86_64'), ('openssl', '0', '1.0.2s', '1.ph3', 'x86_64'), ('ostree', '0', '2019.2', '1.ph3', 'x86_64'), ('ostree-grub2', '0', '2019.2', '1.ph3', 'x86_64'), ('ostree-libs', '0', '2019.2', '1.ph3', 'x86_64'), ('pcre', '0', '8.42', '1.ph3', 'x86_64'), ('pcre-libs', '0', '8.42', '1.ph3', 'x86_64'), ('photon-release', '0', '3.0', '3.ph3', 'noarch'), ('photon-repos', '0', '3.0', '3.ph3', 'noarch'), ('pinentry', '0', '1.1.0', '1.ph3', 'x86_64'), ('pkg-config', '0', '0.29.2', '2.ph3', 'x86_64'), ('polkit', '0', '0.113', '5.ph3', 'x86_64'), ('popt', '0', '1.16', '5.ph3', 'x86_64'), ('procps-ng', '0', '3.3.15', '1.ph3', 'x86_64'), ('python3', '0', '3.7.3', '2.ph3', 'x86_64'), ('python3-libs', '0', '3.7.3', '2.ph3', 'x86_64'), ('readline', '0', '7.0', '2.ph3', 'x86_64'), ('rpm-libs', '0', '4.14.2', '4.ph3', 'x86_64'), ('rpm-ostree', '0', '2019.3', '1.ph3', 'x86_64'), ('sed', '0', '4.5', '1.ph3', 'x86_64'), ('shadow', '0', '4.6', '3.ph3', 'x86_64'), ('shadow-tools', '0', '4.6', '3.ph3', 'x86_64'), ('sqlite-libs', '0', '3.27.2', '3.ph3', 'x86_64'), ('systemd', '0', '239', '13.ph3', 'x86_64'), ('util-linux', '0', '2.32', '1.ph3', 'x86_64'), ('util-linux-libs', '0', '2.32', '1.ph3', 'x86_64'), ('vim', '0', '8.1.0388', '4.ph3', 'x86_64'), ('which', '0', '2.21', '5.ph3', 'x86_64'), ('xz', '0', '5.2.4', '1.ph3', 'x86_64'), ('xz-libs', '0', '5.2.4', '1.ph3', 'x86_64'), ('zchunk', '0', '1.1.1', '1.ph3', 'x86_64'), ('zchunk-libs', '0', '1.1.1', '1.ph3', 'x86_64'), ('zlib', '0', '1.2.11', '1.ph3', 'x86_64')]&gt;}, @ay [], @a(say) [], '', '', uint64 1567077619, [byte 0x1e, 0x0a, 0x85, 0x20, 0xa8, 0xe0, 0x18, 0x6a, 0x88, 0x15, 0xc0, 0xd9, 0xb0, 0xab, 0xc9, 0x98, 0x94, 0xa1, 0xfb, 0x0a, 0x48, 0xdf, 0xa0, 0x73, 0x32, 0x02, 0x9a, 0xdf, 0x49, 0xed, 0x13, 0x8d], [byte 0x44, 0x6a, 0x0e, 0xf1, 0x1b, 0x7c, 0xc1, 0x67, 0xf3, 0xb6, 0x03, 0xe5, 0x85, 0xc7, 0xee, 0xee, 0xb6, 0x75, 0xfa, 0xa4, 0x12, 0xd5, 0xec, 0x73, 0xf6, 0x29, 0x88, 0xeb, 0x0b, 0x6c, 0x54, 0x88])
</code></pre><h2 id=listing-file-mappings>Listing file mappings</h2><p>This command lists the file relations between the original source Linux Photon filetree and the deployed filetree. The normal columns include file type type (regular file, directory, link), permissions in chmod octal format, userID, groupID, file size, file name.</p><pre><code>root@photon-host [ ~ ]# ostree ls photon/3.0/x86_64/minimal
d00755 0 0      0 /
l00777 0 0      0 /bin -&gt; usr/bin
l00777 0 0      0 /home -&gt; var/home
l00777 0 0      0 /lib -&gt; usr/lib
l00777 0 0      0 /lib64 -&gt; usr/lib
l00777 0 0      0 /media -&gt; run/media
l00777 0 0      0 /mnt -&gt; var/mnt
l00777 0 0      0 /opt -&gt; var/opt
l00777 0 0      0 /ostree -&gt; sysroot/ostree
l00777 0 0      0 /root -&gt; var/roothome
l00777 0 0      0 /sbin -&gt; usr/sbin
l00777 0 0      0 /srv -&gt; var/srv
l00777 0 0      0 /tmp -&gt; sysroot/tmp
d00755 0 0      0 /boot
d00755 0 0      0 /dev
d00755 0 0      0 /proc
d00755 0 0      0 /run
d00755 0 0      0 /sys
d00755 0 0      0 /sysroot
d00755 0 0      0 /usr
d00755 0 0      0 /var
</code></pre><p>Extra columns can be added like checksum (-C) and extended attributes (-X).</p><pre><code>root@photon-host [ /usr/share/man/man1 ]# ostree ls photon/3.0/x86_64/minimal -C
d00755 0 0      0 1e0a8520a8e0186a8815c0d9b0abc99894a1fb0a48dfa07332029adf49ed138d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /
l00777 0 0      0 389846c2702216e1367c8dfb68326a6b93ccf5703c89c93979052a9bf359608e /bin -&gt; usr/bin
l00777 0 0      0 4344c10bf4931483f918496534f12ed9b50dc6a2cead35e3cd9dd898d6ac9414 /home -&gt; var/home
l00777 0 0      0 f11902ca9d69a80df33918534a3e443251fd0aa7f94b76301e1f55e52aed29dd /lib -&gt; usr/lib
l00777 0 0      0 f11902ca9d69a80df33918534a3e443251fd0aa7f94b76301e1f55e52aed29dd /lib64 -&gt; usr/lib
l00777 0 0      0 75317a3df11447c470ffdd63dde045450ca97dfb2a97a0f3f6a21a5da66f737c /media -&gt; run/media
l00777 0 0      0 97c55dbe24e8f3aecfd3f3e5b3f44646fccbb39799807d37a217e9c871da108b /mnt -&gt; var/mnt
l00777 0 0      0 46b1abbd27a846a9257a8d8c9fc4b384ac0888bdb8ac0d6a2d5de72715bd5092 /opt -&gt; var/opt
l00777 0 0      0 d37269e3f46023fd0275212473e07011894cdf4148cbf3fb5758a7e9471dad8e /ostree -&gt; sysroot/ostree
l00777 0 0      0 6f800e74eed172661278d1e1f09e389a6504dcd3358618e1c1618f91f9d33601 /root -&gt; var/roothome
l00777 0 0      0 e0bead7be9323b06bea05cb9b66eb151839989e3a4e5d1a93e09a36919e91818 /sbin -&gt; usr/sbin
l00777 0 0      0 5d4250bba1ed300f793fa9769474351ee5cebd71e8339078af7ebfbe6256d9b5 /srv -&gt; var/srv
l00777 0 0      0 364fbd62f91ca1e06eb7dbd50c93de8976f2cea633658e2dbe803ce6f7490c09 /tmp -&gt; sysroot/tmp
d00755 0 0      0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /boot
d00755 0 0      0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /dev
d00755 0 0      0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /proc
d00755 0 0      0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /run
d00755 0 0      0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /sys
d00755 0 0      0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /sysroot
d00755 0 0      0 ef1c0980e0d77f64e7f250a3e48f0b24e9285fc0716b80520dac6f98c148324a 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /usr
d00755 0 0      0 a3a987e053ea5a116f1e75a31cd7557fc6e57a3ae09e64171d7fea17ef71ec3e 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /var
</code></pre><p>By default, only the top folders are listed, but -R will list recursively. Instead of listing over 10,000 files, let&rsquo;s filter to just all files that contain &lsquo;rpm-ostree&rsquo;, &lsquo;rpmostree&rsquo; or &lsquo;RpmOstree&rsquo;, that must belong to <strong>rpm-ostree</strong> package itself.</p><pre><code>root@photon-host [ /usr/share/rpm-ostree ]# ostree ls photon/3.0/x86_64/minimal -R | grep -e '[Rr]pm-\?[Oo]stree'
-00755 0 0 749000 /usr/bin/rpm-ostree
d00755 0 0      0 /usr/bin/rpm-ostree-host
-00644 0 0   1069 /usr/bin/rpm-ostree-host/function.inc
-00755 0 0  10507 /usr/bin/rpm-ostree-host/mk-ostree-host.sh
-00644 0 0    209 /usr/etc/rpm-ostreed.conf
-00644 0 0   1530 /usr/etc/dbus-1/system.d/org.projectatomic.rpmostree1.conf
l00777 0 0      0 /usr/lib/librpmostree-1.so.1 -&gt; librpmostree-1.so.1.0.0
-00755 0 0 5278496 /usr/lib/librpmostree-1.so.1.0.0
-00644 0 0   2312 /usr/lib/girepository-1.0/RpmOstree-1.0.typelib
-00755 0 0     22 /usr/lib/kernel/install.d/00-rpmostree-skip.install
d00755 0 0      0 /usr/lib/rpm-ostree
-00755 0 0 1640704 /usr/lib/rpm-ostree/libdnf.so.2
-00644 0 0    622 /usr/lib/rpm-ostree/rpm-ostree-0-integration.conf
d00755 0 0      0 /usr/lib/sysimage/rpm-ostree-base-db
-00644 0 0 544768 /usr/lib/sysimage/rpm-ostree-base-db/Basenames
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Conflictname
-00644 0 0 110592 /usr/lib/sysimage/rpm-ostree-base-db/Dirnames
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Enhancename
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Filetriggername
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Group
-00644 0 0  12288 /usr/lib/sysimage/rpm-ostree-base-db/Installtid
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Name
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Obsoletename
-00644 0 0 2625536 /usr/lib/sysimage/rpm-ostree-base-db/Packages
-00644 0 0  86016 /usr/lib/sysimage/rpm-ostree-base-db/Providename
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Recommendname
-00644 0 0  69632 /usr/lib/sysimage/rpm-ostree-base-db/Requirename
-00644 0 0  20480 /usr/lib/sysimage/rpm-ostree-base-db/Sha1header
-00644 0 0  16384 /usr/lib/sysimage/rpm-ostree-base-db/Sigmd5
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Suggestname
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Supplementname
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Transfiletriggername
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Triggername
-00644 0 0    263 /usr/lib/systemd/system/rpm-ostree-bootstatus.service
-00644 0 0    257 /usr/lib/systemd/system/rpm-ostreed-automatic.service
-00644 0 0    227 /usr/lib/systemd/system/rpm-ostreed-automatic.timer
-00644 0 0    272 /usr/lib/systemd/system/rpm-ostreed.service
-00644 0 0    102 /usr/lib/systemd/system-preset/40-rpm-ostree-auto.preset
-00644 0 0    622 /usr/lib/tmpfiles.d/rpm-ostree-0-integration.conf
-00644 0 0   1082 /usr/lib/tmpfiles.d/rpm-ostree-1-autovar.conf
-00755 0 0     53 /usr/libexec/rpm-ostreed
-00644 0 0   3049 /usr/share/bash-completion/completions/rpm-ostree
-00644 0 0  15997 /usr/share/dbus-1/interfaces/org.projectatomic.rpmostree1.xml
-00644 0 0    133 /usr/share/dbus-1/system-services/org.projectatomic.rpmostree1.service
-00644 0 0   6160 /usr/share/polkit-1/actions/org.projectatomic.rpmostree1.policy
d00755 0 0      0 /usr/share/rpm-ostree
-00644 0 0   1169 /usr/share/rpm-ostree/treefile.json
</code></pre><p><strong>atomic</strong> is really an alias for rpm-ostree command. The last file <strong>treefile.json</strong> is not installed by the rpm-ostree package, it is actually downloaded from the server, as we will see in the next chapter. For now, let us notice <strong>&ldquo;osname&rdquo; : &ldquo;photon&rdquo;, &ldquo;ref&rdquo; : &ldquo;photon/1.0/x86_64/minimal&rdquo;, &ldquo;automatic_version_prefix&rdquo; : &ldquo;1.0_minimal&rdquo;</strong>, that matches what we have known so far, and also the <strong>&ldquo;documentation&rdquo; : false</strong> setting, that explains why there are no manual files installed for rpm-ostree, and in fact for any package.</p><pre><code>root@photon-host [ /usr/share/rpm-ostree ]# ls -l /usr/share/man/man1 
total 0
</code></pre><h2 id=listing-configuration-changes>Listing configuration changes</h2><p>To diff the current /etc configuration versus default /etc (from the base image), this command will show the <strong>M</strong>odified, <strong>A</strong>dded and <strong>D</strong>eleted files:</p><pre><code>root@photon-host [ ~ ]# ostree admin config-diff
M    ssh/sshd_config
M    machine-id
M    fstab
M    hosts
M    mtab
M    shadow
A    ssh/ssh_host_rsa_key
A    ssh/ssh_host_rsa_key.pub
A    ssh/ssh_host_dsa_key
A    ssh/ssh_host_dsa_key.pub
A    ssh/ssh_host_ecdsa_key
A    ssh/ssh_host_ecdsa_key.pub
A    ssh/ssh_host_ed25519_key
A    ssh/ssh_host_ed25519_key.pub
A    udev/hwdb.bin
A    resolv.conf
A    hostname
A    localtime
A    .pwd.lock
A    .updated
</code></pre><h2 id=listing-packages>Listing packages</h2><p>The following is the rpm-ostree command that lists all the packages for that branch, extracted from RPM database.</p><pre><code>root@photon-host [ ~ ]# rpm-ostree db list photon/3.0/x86_64/minimal
ostree commit: photon/3.0/x86_64/minimal (a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650)
 Linux-PAM-1.3.0-1.ph3.x86_64
 attr-2.4.48-1.ph3.x86_64
 autogen-libopts-5.18.16-1.ph3.x86_64
 bash-4.4.18-1.ph3.x86_64
 bc-1.07.1-1.ph3.x86_64
 binutils-2.31.1-6.ph3.x86_64
 bridge-utils-1.6-1.ph3.x86_64
 bubblewrap-0.3.0-2.ph3.x86_64
 bzip2-1.0.6-10.ph3.x86_64
 bzip2-libs-1.0.6-10.ph3.x86_64
 ca-certificates-20190521-1.ph3.x86_64
 ca-certificates-pki-20190521-1.ph3.x86_64
 coreutils-8.30-1.ph3.x86_64
 cpio-2.12-4.ph3.x86_64
 cracklib-2.9.6-8.ph3.x86_64
 cracklib-dicts-2.9.6-8.ph3.x86_64
 curl-7.61.1-4.ph3.x86_64
 curl-libs-7.61.1-4.ph3.x86_64
 dbus-1.13.6-1.ph3.x86_64
 device-mapper-2.02.181-1.ph3.x86_64
 device-mapper-libs-2.02.181-1.ph3.x86_64
 docker-18.06.2-3.ph3.x86_64
 dracut-048-1.ph3.x86_64
 dracut-tools-048-1.ph3.x86_64
 e2fsprogs-libs-1.44.3-2.ph3.x86_64
 elfutils-0.176-1.ph3.x86_64
 elfutils-libelf-0.176-1.ph3.x86_64
 expat-2.2.6-2.ph3.x86_64
 expat-libs-2.2.6-2.ph3.x86_64
 file-5.34-1.ph3.x86_64
 file-libs-5.34-1.ph3.x86_64
 filesystem-1.1-4.ph3.x86_64
 findutils-4.6.0-5.ph3.x86_64
 flex-2.6.4-2.ph3.x86_64
 fuse-2.9.7-5.ph3.x86_64
 gc-8.0.0-1.ph3.x86_64
 glib-2.58.0-4.ph3.x86_64
 glib-networking-2.59.1-2.ph3.x86_64
 glibc-2.28-4.ph3.x86_64
 glibc-iconv-2.28-4.ph3.x86_64
 gmp-6.1.2-2.ph3.x86_64
 gnupg-2.2.17-1.ph3.x86_64
 gnutls-3.6.3-3.ph3.x86_64
 gobject-introspection-1.58.0-2.ph3.x86_64
 gpgme-1.11.1-2.ph3.x86_64
 grep-3.1-1.ph3.x86_64
 grub2-2.02-13.ph3.x86_64
 grub2-efi-2.02-13.ph3.x86_64
 grub2-pc-2.02-13.ph3.x86_64
 guile-2.0.13-2.ph3.x86_64
 gzip-1.9-1.ph3.x86_64
 iana-etc-2.30-2.ph3.noarch
 icu-61.1-1.ph3.x86_64
 iproute2-4.18.0-2.ph3.x86_64
 iptables-1.8.3-1.ph3.x86_64
 js-1.8.5-2.ph3.x86_64
 json-c-0.13.1-1.ph3.x86_64
 json-glib-1.4.4-1.ph3.x86_64
 kmod-25-1.ph3.x86_64
 krb5-1.17-1.ph3.x86_64
 libapparmor-2.13-7.ph3.x86_64
 libarchive-3.3.3-3.ph3.x86_64
 libassuan-2.5.1-1.ph3.x86_64
 libcap-2.25-8.ph3.x86_64
 libdb-5.3.28-2.ph3.x86_64
 libffi-3.2.1-6.ph3.x86_64
 libgcc-7.3.0-4.ph3.x86_64
 libgcrypt-1.8.3-2.ph3.x86_64
 libgomp-7.3.0-4.ph3.x86_64
 libgpg-error-1.32-1.ph3.x86_64
 libgsystem-2015.2-2.ph3.x86_64
 libksba-1.3.5-1.ph3.x86_64
 libltdl-2.4.6-3.ph3.x86_64
 libmodulemd-2.4.0-1.ph3.x86_64
 libpsl-0.20.2-1.ph3.x86_64
 librepo-1.10.2-1.ph3.x86_64
 libseccomp-2.4.0-1.ph3.x86_64
 libselinux-2.8-1.ph3.x86_64
 libsepol-2.8-1.ph3.x86_64
 libsolv-0.6.35-1.ph3.x86_64
 libsoup-2.64.0-2.ph3.x86_64
 libssh2-1.9.0-1.ph3.x86_64
 libstdc++-7.3.0-4.ph3.x86_64
 libtasn1-4.13-1.ph3.x86_64
 libtool-2.4.6-3.ph3.x86_64
 libunistring-0.9.10-1.ph3.x86_64
 libxml2-2.9.9-1.ph3.x86_64
 libyaml-0.2.1-2.ph3.x86_64
 linux-4.19.65-3.ph3.x86_64
 m4-1.4.18-2.ph3.x86_64
 mpfr-4.0.1-1.ph3.x86_64
 ncurses-6.1-1.ph3.x86_64
 ncurses-libs-6.1-1.ph3.x86_64
 ncurses-terminfo-6.1-1.ph3.x86_64
 net-tools-1.60-11.ph3.x86_64
 nettle-3.4-1.ph3.x86_64
 npth-1.6-1.ph3.x86_64
 nspr-4.21-1.ph3.x86_64
 nss-altfiles-2.23.0-1.ph3.x86_64
 nss-libs-3.44-2.ph3.x86_64
 openssh-7.8p1-5.ph3.x86_64
 openssh-clients-7.8p1-5.ph3.x86_64
 openssh-server-7.8p1-5.ph3.x86_64
 openssl-1.0.2s-1.ph3.x86_64
 ostree-2019.2-1.ph3.x86_64
 ostree-grub2-2019.2-1.ph3.x86_64
 ostree-libs-2019.2-1.ph3.x86_64
 pcre-8.42-1.ph3.x86_64
 pcre-libs-8.42-1.ph3.x86_64
 photon-release-3.0-3.ph3.noarch
 photon-repos-3.0-3.ph3.noarch
 pinentry-1.1.0-1.ph3.x86_64
 pkg-config-0.29.2-2.ph3.x86_64
 polkit-0.113-5.ph3.x86_64
 popt-1.16-5.ph3.x86_64
 procps-ng-3.3.15-1.ph3.x86_64
 python3-3.7.3-2.ph3.x86_64
 python3-libs-3.7.3-2.ph3.x86_64
 readline-7.0-2.ph3.x86_64
 rpm-libs-4.14.2-4.ph3.x86_64
 rpm-ostree-2019.3-1.ph3.x86_64
 sed-4.5-1.ph3.x86_64
 shadow-4.6-3.ph3.x86_64
 shadow-tools-4.6-3.ph3.x86_64
 sqlite-libs-3.27.2-3.ph3.x86_64
 systemd-239-13.ph3.x86_64
 util-linux-2.32-1.ph3.x86_64
 util-linux-libs-2.32-1.ph3.x86_64
 vim-8.1.0388-4.ph3.x86_64
 which-2.21-5.ph3.x86_64
 xz-5.2.4-1.ph3.x86_64
 xz-libs-5.2.4-1.ph3.x86_64
 zchunk-1.1.1-1.ph3.x86_64
 zchunk-libs-1.1.1-1.ph3.x86_64
 zlib-1.2.11-1.ph3.x86_64
</code></pre><h2 id=querying-for-package-details>Querying for package details</h2><p>We are able to use the query option of rpm to make sure any package have been installed properly. The files list should match the previous file mappings in 4.2, so let&rsquo;s check package <strong>rpm-ostree</strong>. As we&rsquo;ve seen, manual files listed here are actually missing, they were not installed.</p><pre><code>root@photon-host [ /usr/share/man/man1 ]# rpm -ql  rpm-ostree
/usr/bin/atomic
/usr/bin/rpm-ostree
/usr/lib/girepository-1.0/RpmOstree-1.0.typelib
/usr/lib/librpmostree-1.so.1
/usr/lib/librpmostree-1.so.1.0.0
/usr/lib/rpm-ostree
/usr/lib/rpm-ostree/tmpfiles-ostree-integration.conf
/usr/share/man/man1/atomic.1.gz
/usr/share/man/man1/rpm-ostree.1.gz
</code></pre><h2 id=why-am-i-unable-to-install-upgrade-or-uninstall-packages>Why am I unable to install, upgrade or uninstall packages?</h2><p>The OSTree host installer needs the server URL or the server repository.</p><p>When you perform the installation using the repo, the install packages are located under the layer package. When you install with the URL, the packages are located under the local packages.</p><p>You can use the <code>rpm-ostree uninstall</code> command to uninstall only the layered and local packages but not the base packages. To modify the base packages, you can use the <code>rpm-ostree override</code> command.</p><p>When you run <code>rpm-ostree upgrade</code>, the command will only upgrade packages based on the commit available in the server.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ba1fa102a185c528f503dc2105bda918>11.5 - Host Updating Operations</h1><ul><li><a href=#upgrade-overview>Upgrade Overview</a></li><li><a href=#incremental-upgrade>Incremental upgrade</a></li><li><a href=#listing-file-differences>Listing file differences</a></li><li><a href=#listing-package-differences>Listing package differences</a></li><li><a href=#rollback>Rollback</a></li><li><a href=#installing-packages>Installing Packages</a></li><li><a href=#uninstalling-packages>Uninstalling Packages</a></li><li><a href=#deleting-a-deployed-filetree>Deleting a deployed filetree</a></li><li><a href=#version-skipping-upgrade>Version skipping upgrade</a></li><li><a href=#tracking-parent-commits>Tracking parent commits</a></li><li><a href=#resetting-a-branch-to-a-previous-commit>Resetting a branch to a previous commit</a></li></ul><h2 id=upgrade-overview>Upgrade overview</h2><p>If you&rsquo;ve used yum, dnf (and now tdnf for Photon) in RPM systems or apt-get in Debian based Unix, you understand what &ldquo;install&rdquo; is for packages and the subtle difference between &ldquo;update&rdquo; and &ldquo;upgrade&rdquo;.</p><p>OSTree and RPM-OSTree don&rsquo;t distinguish between them and the term &ldquo;upgrade&rdquo; has a slightly different meaning - to bring the system in sync with the remote repo, to the top of the Refspec (branch), just like in Git, by pulling the latest changes.</p><p>In fact, ostree and rpm-ostree commands support a single &ldquo;upgrade&rdquo; verb for a file image tree and a package list in the same refspec (branch). <code>rpm-ostree upgrade</code> will install a package if it doesn&rsquo;t exist, will not touch it if it has same version in the new image, will upgrade it if the version number is higher and it may actually downgrade it, if the package has been downgraded in the new image. I wish this operation had a different name, to avoid any confusion.</p><p>The reverse operation of an upgrade is a &ldquo;rollback&rdquo; and fortunately it&rsquo;s not named &ldquo;downgrade&rdquo; because it may upgrade packages in the last case describe above.</p><p>As we&rsquo;ll see in a future chapter, a jump to a different Refspec (branch) is also supported and it&rsquo;s named &ldquo;rebase&rdquo;.</p><h2 id=incremental-upgrade>Incremental upgrade</h2><p>To check if there are any updates available, one would execute:</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree upgrade
Updating from: photon:photon/3.0/x86_64/minimal


No upgrade available.
</code></pre><p>It is good idea to check periodically for updates.</p><p>To check if there are any new updates without actually applying them, we will pass the &ndash;check-diff flag, that would list the different packages as added, modified or deleted - if such operations were to happen.</p><pre><code>root@photon-host [ ~ ]# rpm-ostree upgrade --check-diff
Updating from: photon:photon/3.0/x86_64/minimal

8 metadata, 13 content objects fetched; 1026 KiB transferred in 0 seconds
+gawk-4.1.3-2.ph1.x86_64
+sudo-1.8.15-3.ph1.x86_64
+wget-1.17.1-2.ph1.x86_64
</code></pre><p>We like what we see and now let&rsquo;s upgrade for real. This command will deploy a new bootable filetree.</p><pre><code>root@photon-host [ ~ ]# rpm-ostree upgrade
Receiving metadata objects: 134/(estimating) 14.1 MB/s 14.1 MB... done
Checking out tree c8f2b11... done
Enabled rpm-md repositories: repo photon-updates photon photon-extras
rpm-md repo 'repo' (cached); generated: 2019-09-18T05:26:00Z
rpm-md repo 'photon-updates' (cached); generated: 2019-09-11T00:02:44Z
rpm-md repo 'photon' (cached); generated: 2019-02-06T08:56:24Z
rpm-md repo 'photon-extras' (cached); generated: 2018-11-02T18:09:56Z
Importing rpm-md... done
Resolving dependencies... done
Checking out packages... done
Running pre scripts... done
Running post scripts... done
Writing rpmdb... done
Writing OSTree commit... done
Staging deployment... done
Freed: 20.7 MB (pkgcache branches: 0)
  zlib 1.2.11-1.ph3 -&gt; 1.2.11-2.ph3
Downgraded:
  ostree 2019.2-15.ph3 -&gt; 2019.2-2.ph3
  ostree-grub2 2019.2-15.ph3 -&gt; 2019.2-2.ph3
  ostree-libs 2019.2-15.ph3 -&gt; 2019.2-2.ph3
Removed:
  chkconfig-1.9-1.ph3.x86_64
  elasticsearch-6.7.0-2.ph3.x86_64
  kibana-6.7.0-2.ph3.x86_64
  logstash-6.7.0-2.ph3.x86_64
  newt-0.52.20-1.ph3.x86_64
  nodejs-10.15.2-1.ph3.x86_64
  openjdk8-1.8.0.212-2.ph3.x86_64
  openjre8-1.8.0.212-2.ph3.x86_64
  ruby-2.5.3-2.ph3.x86_64
  slang-2.3.2-1.ph3.x86_64
Added:
  nss-3.44-2.ph3.x86_64
  xmlsec1-1.2.26-2.ph3.x86_64
Run &quot;systemctl reboot&quot; to start a reboot
</code></pre><p>By looking at the commit history, notice that the new commit has the original commit as parent.</p><pre><code>root@photon-host [ ~ ]# ostree log photon/3.0/x86_64/minimal
commit c8f2b116b067d7695f9033bf2a99505198269354e157c0f2d5b78266cb874239
ContentChecksum:  9bc2079ad70df6dc9373752b254711f3413ae8a07628016c7de7f7d3fa505a6f
Date:  2019-09-18 08:22:15 +0000
Version: 3.0_minimal.2
(no subject)

commit 28dc49ecb4604c0bc349e4445adc659491a1874c01198e6253a261f4d59708b7
ContentChecksum:  c3650c76e2bb0e9b6b063cda2dd55939c965c54fd0b0f5ce2cfb7e801403e610
Date:  2019-09-16 09:51:33 +0000
Version: 3.0_minimal.1
</code></pre><p>Notice that now we have a new reference, that corresponds to the newly deployed image.</p><pre><code>root@photon-host [ ~ ]# ostree refs
rpmostree/pkg/createrepo__c/0.11.1-2.ph3.x86__64
rpmostree/pkg/wget/1.20.3-1.ph3.x86__64
photon-1:photon/3.0/x86_64/minimal
rpmostree/base/0
rpmostree/base/1
ostree/0/0/0
ostree/0/0/1
ostree/0/0/2
rpmostree/pkg/rpm/4.14.2-4.ph3.x86__64
</code></pre><p>Let us look at the status. The new filetree version .1 has the expected Commit ID and a newer timestamp, that is actually the server date/time when the image has been generated, not the time/date when it was downloaded or installed at the host. The old image has a star next to it, showing that&rsquo;s the image the system is booted currently into.</p><pre><code>root@photon-host [ ~ ]# rpm-ostree status
State: idle
AutomaticUpdates: disabled
Deployments:
  ostree://photon-1:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.2 (2019-09-18T08:22:15Z)
                BaseCommit: c8f2b116b067d7695f9033bf2a99505198269354e157c0f2d5b78266cb874239
                      Diff: 1 upgraded, 3 downgraded, 10 removed, 2 added
           LayeredPackages: createrepo_c rpm wget

* ostree://photon-1:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.1 (2019-09-16T09:51:33Z)
                BaseCommit: 28dc49ecb4604c0bc349e4445adc659491a1874c01198e6253a261f4d59708b7
           LayeredPackages: createrepo_c rpm wget

  ostree://photon:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.1 (2019-09-16T09:51:33Z)
                BaseCommit: 28dc49ecb4604c0bc349e4445adc659491a1874c01198e6253a261f4d59708b7
           LayeredPackages: createrepo_c rpm wget
</code></pre><p>Now let&rsquo;s type &lsquo;reboot&rsquo;. Grub will list the new filetree as the first image, marked with a star, as the default bootable image. If the keyboard is not touched and order is not changed, grub will timeout and will boot into that image.</p><p><img src=../images/rpmostree-grub.png alt=Grub-dual-boot-1-0></p><p>Let&rsquo;s look again at the status. It&rsquo;s identical, just that the star is next to the newer image, to show it&rsquo;s the current image it has booted from.</p><pre><code>root@photon-host [ ~ ]# rpm-ostree status
State: idle
AutomaticUpdates: disabled
Deployments:
* ostree://photon-1:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.2 (2019-09-18T08:22:15Z)
                BaseCommit: c8f2b116b067d7695f9033bf2a99505198269354e157c0f2d5b78266cb874239
           LayeredPackages: createrepo_c rpm wget

  ostree://photon-1:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.1 (2019-09-16T09:51:33Z)
                BaseCommit: 28dc49ecb4604c0bc349e4445adc659491a1874c01198e6253a261f4d59708b7
           LayeredPackages: createrepo_c rpm wget
</code></pre><p>Also, the current deployment directory is based on the new commit:</p><pre><code>root@photon-host-def [ ~ ]# ostree admin config-diff --print-current-dir
/ostree/deploy/photon/deploy/63fd7a46dac6c169ee997039c229dd1d626f9b13eaf47b7a183f7a449eb4076f.0
</code></pre><p>A fresh upgrade for a new version will delete the older, original image and bring a new one, that will become the new default image. The previous &lsquo;default&rsquo; image will move down one position as the backup image.</p><h2 id=listing-file-differences>Listing file differences</h2><p>Now we can look at what files have been <strong>A</strong>dded, <strong>M</strong>odified, <strong>D</strong>eleted due to the addition of those three packages and switching of the boot directories, by comparing the two commits.</p><pre><code>root@photon-host-def [ ~ ]# ostree diff 63fd 37e2
M    /usr/etc/ld.so.cache
M    /usr/lib/sysimage/rpm-ostree-base-db/Basenames
M    /usr/lib/sysimage/rpm-ostree-base-db/Conflictname
M    /usr/lib/sysimage/rpm-ostree-base-db/Dirnames
M    /usr/lib/sysimage/rpm-ostree-base-db/Enhancename
M    /usr/lib/sysimage/rpm-ostree-base-db/Filetriggername
M    /usr/lib/sysimage/rpm-ostree-base-db/Group
M    /usr/lib/sysimage/rpm-ostree-base-db/Installtid
M    /usr/lib/sysimage/rpm-ostree-base-db/Name
M    /usr/lib/sysimage/rpm-ostree-base-db/Obsoletename
M    /usr/lib/sysimage/rpm-ostree-base-db/Packages
M    /usr/lib/sysimage/rpm-ostree-base-db/Providename
M    /usr/lib/sysimage/rpm-ostree-base-db/Recommendname
M    /usr/lib/sysimage/rpm-ostree-base-db/Requirename
M    /usr/lib/sysimage/rpm-ostree-base-db/Sha1header
M    /usr/lib/sysimage/rpm-ostree-base-db/Sigmd5
M    /usr/lib/sysimage/rpm-ostree-base-db/Suggestname
M    /usr/lib/sysimage/rpm-ostree-base-db/Supplementname
M    /usr/lib/sysimage/rpm-ostree-base-db/Transfiletriggername
M    /usr/lib/sysimage/rpm-ostree-base-db/Triggername
M    /usr/share/rpm/Basenames
M    /usr/share/rpm/Conflictname
M    /usr/share/rpm/Dirnames
M    /usr/share/rpm/Enhancename
M    /usr/share/rpm/Filetriggername
M    /usr/share/rpm/Group
M    /usr/share/rpm/Installtid
M    /usr/share/rpm/Name
M    /usr/share/rpm/Obsoletename
M    /usr/share/rpm/Packages
M    /usr/share/rpm/Providename
M    /usr/share/rpm/Recommendname
M    /usr/share/rpm/Requirename
M    /usr/share/rpm/Sha1header
M    /usr/share/rpm/Sigmd5
M    /usr/share/rpm/Suggestname
M    /usr/share/rpm/Supplementname
M    /usr/share/rpm/Transfiletriggername
M    /usr/share/rpm/Triggername
M    /usr/share/rpm-ostree/treefile.json
D    /usr/bin/certutil
D    /usr/bin/nss-config
D    /usr/bin/pk12util
D    /usr/bin/xmlsec1
D    /usr/lib/libfreebl3.chk
D    /usr/lib/libfreebl3.so
D    /usr/lib/libfreeblpriv3.chk
D    /usr/lib/libgtest1.so
D    /usr/lib/libgtestutil.so
D    /usr/lib/libnssckbi.so
D    /usr/lib/libnssdbm3.chk
D    /usr/lib/libnssdbm3.so
D    /usr/lib/libnsssysinit.so
D    /usr/lib/libsmime3.so
D    /usr/lib/libsoftokn3.chk
D    /usr/lib/libssl3.so
D    /usr/lib/libxmlsec1-nss.so
D    /usr/lib/libxmlsec1-nss.so.1
D    /usr/lib/libxmlsec1-nss.so.1.2.26
D    /usr/lib/libxmlsec1-openssl.so
D    /usr/lib/libxmlsec1-openssl.so.1
D    /usr/lib/libxmlsec1-openssl.so.1.2.26
D    /usr/lib/libxmlsec1.so
D    /usr/lib/libxmlsec1.so.1
D    /usr/lib/libxmlsec1.so.1.2.26
</code></pre><h2 id=listing-package-differences>Listing package differences</h2><p>We can also look at package differences, as you expect, using the right tool for the job.</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree db diff 63fd 37e2
ostree diff commit old: rollback deployment (63fd7a46dac6c169ee997039c229dd1d626f9b13eaf47b7a183f7a449eb4076f)
ostree diff commit new: booted deployment (37e2ecfa34eb808962fdfed28623bbc457184bcd6bb788b79143d33e3569084f)
Removed:
  nss-3.44-2.ph3.x86_64
  xmlsec1-1.2.26-2.ph3.x86_64
</code></pre><h2 id=rollback>Rollback</h2><p>If we want to go back to the previous image, we can rollback. The order of the images will be changed, so the old filetree will become the default bootable image. If -r option is passed, the rollback will continue with a reboot.</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree rollback
Moving 'e663b2872efa01d80e4c34c823431472beb653373af32de83c7d2480316b8a6a.0' to be first deployment
Transaction complete; bootconfig swap: yes; deployment count change: 0
Upgraded:
  ostree 2019.2-2.ph3 -&gt; 2019.2-15.ph3
  ostree-grub2 2019.2-2.ph3 -&gt; 2019.2-15.ph3
  ostree-libs 2019.2-2.ph3 -&gt; 2019.2-15.ph3
  zlib 1.2.11-2.ph3 -&gt; 1.2.11-1.ph3
Removed:
  nss-3.44-2.ph3.x86_64
  xmlsec1-1.2.26-2.ph3.x86_64
Added:
  chkconfig-1.9-1.ph3.x86_64
  elasticsearch-6.7.0-2.ph3.x86_64
  kibana-6.7.0-2.ph3.x86_64
  logstash-6.7.0-2.ph3.x86_64
  newt-0.52.20-1.ph3.x86_64
  nodejs-10.15.2-1.ph3.x86_64
  openjdk8-1.8.0.212-2.ph3.x86_64
  openjre8-1.8.0.212-2.ph3.x86_64
  ruby-2.5.3-2.ph3.x86_64
  slang-2.3.2-1.ph3.x86_64
Run &quot;systemctl reboot&quot; to start a reboot
</code></pre><p>In fact, we can repeat the rollback operation as many times as we want before reboot. On each execution, it&rsquo;s going to change the order. It will not delete any image.<br>However, an upgrade will keep the current default image and will eliminate the other image, whichever that is. So if Photon installation rolled back to an older build, an upgrade will keep that, eliminate the newer version and will replace it with an even newer version at the next upgrade.</p><p>The boot order moved back to original:</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree status
State: idle
AutomaticUpdates: disabled
Deployments:
* ostree://photon-2:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.3 (2019-09-18T12:48:03Z)
                    Commit: cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b

  ostree://photon:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal (2019-08-29T11:20:19Z)
                    Commit: a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650

</code></pre><p>The current bootable image path moved also back to the original value:</p><pre><code>root@photon-host-def [ ~ ]# ostree admin config-diff --print-current-dir
/ostree/deploy/photon/deploy/47899767bdd4276266383fce13c4a26a51ca0304ae754609283d75f7d8aad36e.0
</code></pre><h2 id=installing-packages>Installing Packages</h2><p>You can add more packages onto the system that are not part of the commit composed on the server.</p><pre><code>rpm-ostree install &lt;packages&gt;
</code></pre><p><strong>Example</strong>:</p><pre><code>rpm-ostree install https://kojipkgs.fedoraproject.org//packages/wget/1.19.5/5.fc29/x86_64/wget-1.19.5-5.fc29.x86_64.rpm

</code></pre><h2 id=uninstalling-packages>Uninstalling Packages</h2><p>To remove layered packages installed from a repository, use</p><pre><code>rpm-ostree uninstall &lt;pkg&gt;
</code></pre><p>To remove layered packages installed from a local package, you must specify the full NEVRA of the package.</p><p>For example:</p><pre><code>rpm-ostree uninstall ltrace-0.7.91-16.fc22.x86_64
</code></pre><p>To uninstall a package that is a part of the base layer, use</p><pre><code>rpm-ostree override remove &lt;pkg&gt;
</code></pre><p>For example:</p><pre><code>rpm-ostree override remove firefox
</code></pre><h2 id=deleting-a-deployed-filetree>Deleting a deployed filetree</h2><p>It is possible to delete a deployed tree. You won&rsquo;t need to do that normally, as upgrading to a new image will delete the old one, but if for some reason deploying failed (loss of power, networking issues), you&rsquo;ll want to delete the partially deployed image.<br>The only supported index is 1. (If multiple bootable images will be supported in the future, a larger than one, zero-based index of the image to delete will be supported).<br>You cannot delete the default bootable filetree, so passing 0 will result in an error.</p><pre><code>root@photon-host-def [ ~ ]# ostree admin undeploy -v 1
OT: Using bootloader: OstreeBootloaderGrub2
Transaction complete; bootconfig swap: yes deployment count change: -1
Deleted deployment a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650

root@photon-host-cus1 [ ~ ]# ostree admin undeploy -v 0
OT: Deployment cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b.0 unlocked=0
error: Cannot undeploy currently booted deployment 0
</code></pre><p>Now, we can see that the newer image is gone, the deployment directory for commit a31a has been removed.</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree status
State: idle
AutomaticUpdates: disabled
Deployments:
* ostree://photon-2:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.3 (2019-09-18T12:48:03Z)
                    Commit: cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b

root@photon-host-cus1 [ ~ ]# ls /ostree/deploy/photon/deploy/
cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b.0
cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b.0.origin 
</code></pre><p>However the commit is still there in the OSTree repo.</p><pre><code>root@photon-host-def [ ~ ]# ostree log cf35                 
commit cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b
ContentChecksum:  c24d108c7b7451374b474456a47f512e648833040bfbd4f43d862456bd6d5a18
Date:  2019-09-18 12:48:03 +0000
Version: 3.0_minimal.3
</code></pre><p>But there is nothing to rollback to.</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree rollback
error: Found 1 deployments, at least 2 required for rollback
</code></pre><p>If we were to upgrade again, it would bring these packages back, but let&rsquo;s just check the differeneces.</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree upgrade --check-diff
Updating from: photon:photon/3.0/x86_64/minimal


+gawk-4.1.0-2.ph1.x86_64
+sudo-1.8.11p1-4.ph1.x86_64
+wget-1.15-1.ph1.x86_64
</code></pre><h2 id=version-skipping-upgrade>Version skipping upgrade</h2><p>Let&rsquo;s assume that after a while, VMware releases version 2 that removes <strong>sudo</strong> and adds <strong>bison</strong> and <strong>tar</strong>. Now, an upgrade will skip version 1 and go directly to 2. Let&rsquo;s first look at what packages are pulled (notice sudo missing, as expected), then upgrade with reboot option.</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree upgrade --check-diff
Updating from: photon:photon/3.0/x86_64/minimal

7 metadata, 13 content objects fetched; 1287 KiB transferred in 0 seconds
+bison-3.0.2-2.ph1.x86_64
+gawk-4.1.0-2.ph1.x86_64
+tar-1.27.1-1.ph1.x86_64
+wget-1.15-1.ph1.x86_64

root@photon-host-def [ ~ ]# rpm-ostree upgrade -r
Updating from: photon:photon/3.0/x86_64/minimal

107 metadata, 512 content objects fetched; 13064 KiB transferred in 1 seconds
Copying /etc changes: 5 modified, 0 removed, 16 added
Transaction complete; bootconfig swap: yes deployment count change: 1
Freed objects: 19.3 MB
</code></pre><p>After reboot, let&rsquo;s check the booting filetrees, the current dir for the current filetree and look at commit differences:</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree status
State: idle
AutomaticUpdates: disabled
Deployments:
* ostree://photon-1:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.1 (2019-09-16T09:51:33Z)
                BaseCommit: 28dc49ecb4604c0bc349e4445adc659491a1874c01198e6253a261f4d59708b7
           LayeredPackages: createrepo_c rpm wget

  ostree://photon:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.1 (2019-09-16T09:51:33Z)
                BaseCommit: 28dc49ecb4604c0bc349e4445adc659491a1874c01198e6253a261f4d59708b7
           LayeredPackages: createrepo_c rpm wget
</code></pre><pre><code>root@photon-host-cus1 [ ~ ]# ostree admin config-diff --print-current-dir
/ostree/deploy/photon/deploy/e663b2872efa01d80e4c34c823431472beb653373af32de83c7d2480316b8a6a.0

root@photon-host-cus1 [ ~ ]# rpm-ostree db diff  8b4b e663
ostree diff commit old: rollback deployment (8b4b9d4ec033d1eb816711bfdda595d1013fecbe5cd340f6a619cdc9d83a3bf2)
ostree diff commit new: booted deployment (e663b2872efa01d80e4c34c823431472beb653373af32de83c7d2480316b8a6a)

root@photon-host-cus1 [ ~ ]# rpm-ostree db diff  82bc 092e
error: Refspec '82bc' not found
</code></pre><p>Interesting fact: The metadata for commit 82bc has been removed from the local repo.</p><h2 id=tracking-parent-commits>Tracking parent commits</h2><p>OSTree will display limited commit history - maximum 2 levels, so if you want to traverse the history even though it may not find a commitment by its ID, you can refer to its parent using &lsquo;^&rsquo; suffix, grandfather via &lsquo;^^&rsquo; and so on. We know that 82bc is the parent of 092e:</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree db diff  092e^ 092e
error: No such metadata object 82bca728eadb7292d568404484ad6889c3f6303600ca8c743a4336e0a10b3817.commit
error: Refspec '82cb' not found
root@photon-host-def [ ~ ]# rpm-ostree db diff  092e^^ 092e
error: No such metadata object 82bca728eadb7292d568404484ad6889c3f6303600ca8c743a4336e0a10b3817.commit
</code></pre><p>So commit 092e knows who its parent is, but its metadata is no longer in the local repo, so it cannot traverse further to its parent to find an existing grandfather.</p><h2 id=resetting-a-branch-to-a-previous-commit>Resetting a branch to a previous commit</h2><p>We can reset the head of a branch in a local repo to a previous commit, for example corresponding to version 0 (3.0_minimal).</p><pre><code>root@photon-host-def [ ~ ]# ostree reset photon:photon/3.0/x86_64/minimal cf35
</code></pre><p>Now if we look again at the branch commit history, the head is at version 0.</p><pre><code>root@photon-host-def [ ~ ]# ostree log photon/3.0/x86_64/minimal
commit cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b
ContentChecksum:  c24d108c7b7451374b474456a47f512e648833040bfbd4f43d862456bd6d5a18
Date:  2019-09-18 12:48:03 +0000
Version: 3.0_minimal
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-7f2ee5bef24972135e64293d2eec474f>11.6 - Creating a Server</h1><p>Photon OS 3.0 includes a <code>rpm-ostree-repo</code> package that can be installed on a VM.</p><p>This package provides an automated script that creates a repo tree that acts as a server.</p><p>Run the following commands to create a server:</p><pre><code>tdnf install rpm-ostree-repo
</code></pre><p>A script is created, which provides options to create a server.</p><p>Script to create a Photon OSTree repo
Usage:<pre><code>/usr/bin/rpm-ostree-server/mkostreerepo -r=&lt;repo path&gt; 
/usr/bin/rpm-ostree-server/mkostreerepo -r=&lt;repo path&gt; -p=&lt;json treefile&gt;
/usr/bin/rpm-ostree-server/mkostreerepo -c -r=&lt;repo path&gt; -p=&lt;json treefile&gt;
-r|--repopath   &lt;Provide repo path&gt; 
-p|--jsonfile   &lt;Provide Json file&gt; 
-c|--customrepo &lt;Provide custom repo file inside repo path directory&gt;
</code></pre><p><strong>Note</strong></p><ul><li>Use <strong>PATH=$PATH:/usr/bin/rpm-ostree-server</strong> and then use <strong>mkostreerepo</strong> from any directory for ease of use.</li><li><strong>mkostreerepo</strong> is used to create the fresh tree for ostree.</li><li><strong>mkostreerepo</strong> is also used to update a new commit to the existing tree.</li><li>You can also use custom repo as to create/append the tree.</li></ul><p>Run the following command to initiate the script, choose different help options to create a server.</p><pre><code>mkostreerepo
</code></pre><h2 id=manually-composing-your-ostree-repo>Manually Composing your OSTree repo</h2><p>Use the following commands to initialize a new repo and to compose it.</p><pre><code>root [ ~ ]# cd /srv/rpm-ostree
root [ /srv/rpm-ostree ]# ostree --repo=repo init --mode=archive-z2
root [ /srv/rpm-ostree ]# rpm-ostree compose tree --repo=repo photon-base.json
</code></pre><p>You can now deploy a host. For more information, see <a href=../file-oriented-server-operations/>File oriented server operations</a> and <a href=../package-oriented-server-operations/>Package oriented server operations</a> to learn create your own customized file tree.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9a44f81f40079416d0814c0d7e6093cc>11.7 - Installing a Photon RPM-OStree host against a custom server repository</h1><p>Organizations that maintain their own OSTree servers create custom image trees suited to their needs from which hosts can be deployed and upgraded. One single server may make available several branches to install, for example &ldquo;base&rdquo;, &ldquo;minimal&rdquo; and &ldquo;full&rdquo;. Or, if you think in terms of Windows OS SKUs - &ldquo;Home&rdquo;, &ldquo;Professional&rdquo; or &ldquo;Enterprise&rdquo; edition.</p><p>So in fact there are two pieces of information the OSTree host installer needs - the server URL and the branch ref. Also, there are two ways to pass this info - manually via keyboard, when prompted and automated, by reading from a config file.</p><h2 id=manual-install-of-a-custom-host>Manual install of a custom host</h2><p>For Photon 1.0 or 1.0 Revision 2, installing a Photon RPM-OSTree host that will pull from a server repository of your choice is very similar to the way we installed the host against the default server repo in <a href=../installing-a-host-against-default-server-repository/>Chapter 2</a>.</p><p>We will follow the same steps, selecting &ldquo;Photon OSTree Host&rdquo;, and after assigning a host name like <strong>photon-host</strong> and a root password, this time we will click on &ldquo;Custom RPM-OSTree Server&rdquo;.</p><p><img src=../../../images/rpmostree-custom.png alt=PhotonHostCustom></p><p>An additional screen will ask for the URL of server repo - just enter the IP address or fully qualified domain name of the <a href=../creating-a-rpm-ostree-server/>server installed in the previous step</a>.</p><p><img src=../../../images/rpmostree-url.png alt=PhotonHostCustomURL></p><p>Once this is done and the installation finished, reboot and you are ready to use it.
You may verify - just like in <a href=../concepts-in-action/#querying-the-deployed-filetrees>Chapter 3.1</a> - that you can get an rpm-ostree status. The value for the CommitID should be identical to the <a href=../installing-a-host-against-default-server-repository/>host that installed from default repo</a>, if the <a href=../creating-a-rpm-ostree-server/>server</a> has been installed fresh, from the same ISO.</p><h2 id=automated-install-of-a-custom-host-via-kickstart>Automated install of a custom host via kickstart</h2><p>Photon 3.0 supports automated install that will not interact with the user, in other words installer will display its progress, but will not prompt for any keys to be clicked, and will boot at the end of installation.</p><p>If not familiar with the way kickstart works, visit <a href=../../../user-guide/working-with-kickstart/>Kickstart Support in Photon OS</a>. The kickstart json config for OSTree is similar to minimal or full, except for these settings that should sound familiar:</p><pre><code>    ...
    &quot;type&quot;: &quot;ostree_host&quot;,
    &quot;ostree_repo_url&quot;: &quot;http://192.168.218.249&quot;,
    &quot;ostree_repo_ref&quot;: &quot;photon/3.0/x86_64/minimal&quot;,
    ...
</code></pre><p>Or, for default installation</p><pre><code>    ....
    &quot;type&quot;: &quot;ostree_host&quot;,
    &quot;default_repo&quot;: true,
    ....
</code></pre><p>If the server is a future version of Photon OS, say Photon OS 4.0, and the administrator composed trees for the included json files, the ostree_repo_ref will take either value: <strong>photon/4.0/x86_64/base</strong>, <strong>photon/4.0/x86_64/minimal</strong>, or <strong>photon/4.0/x86_64/full</strong>.</p><p>In most situations, kickstart file is accessed via http from PXE boot. That enables booting from network and end to end install of hosts from pre-defined server URL and branch without assistance from user.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-aa06d00ff26aed06d1458656d5014d3b>11.8 - Automatic Updates</h1><p>Automatic updates are disabled by default.</p><p>To verify this, run the status command.</p><pre><code>root@photon-host-def [ ~ ]# rpm-ostree status
State: idle
AutomaticUpdates: disabled
Deployments:
* ostree://photon-1:photon/3.0/x86_64/minimal
                   Version: 3.0_minimal.1 (2019-09-16T09:51:33Z)
                BaseCommit: 28dc49ecb4604c0bc349e4445adc659491a1874c01198e6253a261f4d59708b7
           LayeredPackages: createrepo_c rpm wget

</code></pre><h2 id=enable-automatic-updates>Enable Automatic Updates</h2><ol><li>Run the following command:</li></ol><pre><code>$ systemctl restart rpm-ostreed
</code></pre><ol><li><p>To enable automatic background updates, edit the <code>/etc/rpm-ostreed.conf</code>, and include the below lines in the <code>Daemon</code> section:</p><pre><code>[Daemon]
AutomaticUpdatePolicy=stage
#IdleExitTimeout=60
</code></pre></li><li><p>Run the following commands:</p><pre><code>$ systemctl reload rpm-ostreed
$ systemctl enable rpm-ostree-automatic.timer --now  
$ systemctl restart rpm-ostree-automatic
</code></pre></li><li><p>Verify that the automatic update feature has been enabled:</p><pre><code>$ rpm-ostree status -v 
      State: idle

      AutomaticUpdates: stage; rpm-ostreed-automatic.timer: last run 16min ago
</code></pre></li><li><p>On the server machine, perform another commit on the base tree.</p></li></ol><p>Automatic updates are now enabled and will automatically update the host system.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b901522c7ceba939641d14dc328418b6>11.9 - File Oriented Server Operations</h1><p>In this section, we will checkout a filetree into a writable directory structure on disk, make several file changes and commit the changes back into the repository. Then we will download this commit and apply at the host. As you may have guessed, this chapter is mostly about OSTree - the base technology. I&rsquo;ve not mentioned anything about packages, although it is quite possible to install packages (afler all, packages are made of files, right?) and commit without the help of rpm-ostree, but it&rsquo;s too much of a headache and not worth the effort, since rpm-ostree does it simpler and better.</p><p>When would you want to do that? When you want for all your hosts to get an application or configuration customization that is not encapsulated as part of a package upgrade.</p><h2 id=starting-a-fresh-ostree-repo>Starting a fresh OSTree repo</h2><p>If you want to start fresh with your own branch and/or versioning scheme, you can delete the OSTree repo created during the Photon 3.0 RPM-OSTree server install and re-create it empty.</p><pre><code>root [ /srv/rpm-ostree ]# rm -rf repo/*

root [ /srv/rpm-ostree ]# ostree --repo=repo init --mode=archive-z2

root [ /srv/rpm-ostree ]# ls repo
config  objects  refs  state  tmp  uncompressed-objects-cache

root [ /srv/rpm-ostree ]# cat repo/config
[core]
repo_version=1
mode=archive-z2
</code></pre><h2 id=creating-summary-metadata>Creating summary metadata</h2><p>A newer ostree feature, available in Photon OS 2.0 and higher, allows the OSTree server admin to create server summary metadata, that includes among other things the list of available branches and the list of static deltas, so they could be discovered by hosts. To create a summary, run this command after you committed for your branches:</p><pre><code>root [ /srv/rpm-ostree ]# ostree summary -u &quot;This is BigData's OSTree server, it has three branches&quot;
</code></pre><p>We will find out later how the <a href=../remotes/#list-available-branches>hosts query for branches list</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-481240d4c42564fc6771e086012b4ab6>11.10 - Package Oriented Server Operations</h1><p>Now that we have a Photon RPM-OSTree server up and running (if not, see how to <a href=../creating-a-rpm-ostree-server/>install</a>), we will learn how to provide the desired set of packages as input and instruct rpm-ostree to compose a filetree, that will result in creation (or update) of an OSTree repo.<br>The simplest way to explain is to take a look at the files installed by the Photon RPM-OSTree server during setup.</p><pre><code>root [ ~ ]# cd /srv/rpm-ostree/
root [ /srv/rpm-ostree ]# ls -l
total 16
lrwxrwxrwx 1 root root   31 Aug 28 19:06 lightwave-ostree.repo -&gt; /etc/yum.repos.d/lightwave.repo
-rw-r--r-- 1 root root 7356 Aug 28 19:06 ostree-httpd.conf
-rw-r--r-- 1 root root 1085 Aug 28 19:06 photon-base.json
lrwxrwxrwx 1 root root   35 Aug 28 19:06 photon-extras-ostree.repo -&gt; /etc/yum.repos.d/photon-extras.repo
lrwxrwxrwx 1 root root   32 Aug 28 19:06 photon-iso-ostree.repo -&gt; /etc/yum.repos.d/photon-iso.repo
lrwxrwxrwx 1 root root   28 Aug 28 19:06 photon-ostree.repo -&gt; /etc/yum.repos.d/photon.repo
lrwxrwxrwx 1 root root   36 Aug 28 19:06 photon-updates-ostree.repo -&gt; /etc/yum.repos.d/photon-updates.repo
drwxr-xr-x 7 root root 4096 Aug 20 22:27 repo
</code></pre><h2 id=json-configuration-file>JSON configuration file</h2><p>How can we tell rpm-ostree what packages we want to include, where to get them from and how to compose the filetree? There is JSON file for that. Let&rsquo;s take a look at photon-base.json used by the Photon OS team.</p><pre><code>root [ /srv/rpm-ostree ]# cat photon-base.json
{
    &quot;comment&quot;: &quot;Photon Minimal OSTree&quot;,

    &quot;osname&quot;: &quot;photon&quot;,

    &quot;ref&quot;: &quot;photon/3.0/x86_64/minimal&quot;,

    &quot;automatic_version_prefix&quot;: &quot;3.0_minimal&quot;,

    &quot;repos&quot;: [&quot;photon&quot;],

    &quot;selinux&quot;: false,

    &quot;initramfs-args&quot;: [&quot;--no-hostonly&quot;],

    &quot;bootstrap_packages&quot;: [&quot;filesystem&quot;],

    &quot;documentation&quot;: false,

    &quot;packages&quot;: [&quot;glibc&quot;, &quot;zlib&quot;, &quot;binutils&quot;, &quot;gmp&quot;, &quot;mpfr&quot;, &quot;libgcc&quot;, &quot;libstdc++&quot;,&quot;libgomp&quot;,
                &quot;pkg-config&quot;, &quot;ncurses&quot;, &quot;bash&quot;, &quot;bzip2&quot;, &quot;cracklib&quot;, &quot;cracklib-dicts&quot;, &quot;shadow&quot;,
                &quot;procps-ng&quot;, &quot;iana-etc&quot;, &quot;readline&quot;, &quot;coreutils&quot;, &quot;bc&quot;, &quot;libtool&quot;, &quot;net-tools&quot;,
                &quot;findutils&quot;, &quot;xz&quot;, &quot;grub2&quot;, &quot;grub2-pc&quot;, &quot;grub2-efi&quot;, &quot;iproute2&quot;, &quot;util-linux&quot;, &quot;linux&quot;,
                &quot;attr&quot;, &quot;libcap&quot;, &quot;kmod&quot;, &quot;expat&quot;, &quot;dbus&quot;, &quot;file&quot;,
                &quot;sed&quot;, &quot;grep&quot;, &quot;cpio&quot;, &quot;gzip&quot;,
                &quot;openssl&quot;, &quot;ca-certificates&quot;, &quot;curl&quot;,
                &quot;systemd&quot;,
                &quot;openssh&quot;, &quot;iptables&quot;,
                &quot;photon-release&quot;,
                &quot;vim&quot;, &quot;photon-repos&quot;,
                &quot;docker&quot;, &quot;bridge-utils&quot;,
                &quot;dracut&quot;, &quot;dracut-tools&quot;, &quot;rpm-ostree&quot;, &quot;nss-altfiles&quot;, &quot;which&quot;]
}
</code></pre><p>There are some mandatory settings, some optional. I&rsquo;m only going to explain the most important ones for our use case.
<strong>osname</strong> and <strong>ref</strong> should be familiar, they have been explained in previous sections <a href=../concepts-in-action/#osname>OSname</a> and <a href=../concepts-in-action#refspec>Refspec</a>. Basicaly, we are asking <code>rpm-ostree</code> to compose a tree for photon OS and photon/3.0/x86_64/minimal branch.</p><p>For more information, see the <a href=https://coreos.github.io/rpm-ostree/treefile/>OS Tree Documentation</a>.</p><h2 id=package-addition-removal-upgrade>Package addition, removal, upgrade</h2><p><strong>packages</strong> is the list of packages that are to be added, in this case, in the &ldquo;minimal&rdquo; installation profile, on top of the packages already included by default. This is not quite the identical set of RPMS you get when you select the minimal profile in the ISO installer, but it&rsquo;s pretty close and that&rsquo;s why it&rsquo;s been named the same.
Let&rsquo;s add to the list three new packages: gawk, sudo and wget using <code>vim photon-base.json</code></p><p><strong>!!!Warning: do not remove any packages from the default list, even an &ldquo;innocent&rdquo; one, as it may bring the system to an unstable condition. During my testing, I&rsquo;ve removed &ldquo;which&rdquo;; it turns out it was used to figure out the grub booting roots: on reboot, the system was left hanging at grub prompt.</strong></p><h2 id=rpms-repository>RPMS repository</h2><p>But where are these packages located? RPM-OStree uses the same standard RPMS repositories, that yum installs from.</p><pre><code>root [ /srv/rpm-ostree ]# ls /etc/yum.repos.d/
photon-debuginfo.repo  photon-extras.repo  photon-iso.repo  photon-updates.repo  photon.repo
</code></pre><p>Going back to our JSON file, <strong>repos</strong> is a multi-value setting that tells RPM-OSTree in what RPMS repositories to look for packages. In this case, it looks in the current directory for a &ldquo;photon&rdquo; repo configuration file, that is a .repo file starting with a [photon] section. There is such a file: <strong>photon-ostree.repo</strong>, that is in fact a link to <strong>photon.repo</strong> in /etc/yum.repos.d directory.</p><pre><code>root [ /srv/rpm-ostree ]# cat /etc/yum.repos.d/photon.repo 
[photon]
name=VMware Photon Linux 3.0(x86_64)
baseurl=https://dl.bintray.com/vmware/photon_release_$releasever_$basearch
gpgkey=file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY
gpgcheck=1
enabled=1
skip_if_unavailable=True
</code></pre><p>In this case, <code>rpm-ostree</code> is instructed to download its packages in RPM format from the bintray URL, that is the location of an online RPMS repo maintained by the WMware Photon OS team. To make sure those packages are genuine, signed by VMware, the signature is checked against the official VMware public key.</p><p>So what&rsquo;s in an RPMS repository? If we point the browser to <a href=https://dl.bintray.com/vmware/photon_release_3.0_x86_64,>https://dl.bintray.com/vmware/photon_release_3.0_x86_64,</a> we can see there are three top directories:</p><ul><li>noarch - where all packages that don&rsquo;t depend on the architecture reside. Those may contain scripts, platform neutral source files, configuration.</li><li>x86_64 - platform dependent packages for Intel 32 and 64 bits CPUs.</li><li>repodata - internal repo management data, like a catalog of all packages, and for every package its name, id, version, architecture and full path file/directory list. There is also a compressed XML file containing the history of changelogs extracted from github, as packages in RPM format were built by Photon OS team members from sources.</li></ul><p>Fortunately, in order to compose a tree, you don&rsquo;t need to download the packages from the online repository (which is time consuming - in the order of minutes), unless there are some new ones or updated versions of them, added by the Photon team after shipping 1.0 version or the 1.0 Refresh. A copy of the starter RPMS repository (as of 1.0 shipping date) has been included on the CD-ROM and you can access it.</p><pre><code>root [ /srv/rpm-ostree ]# mount /dev/cdrom
root [ /srv/rpm-ostree ]# ls /mnt/cdrom/RPMS
noarch  repodata  x86_64
</code></pre><p>All you have to do now is to replace the <code>"repos": ["photon"]</code> entry by <code>"repos": ["photon-iso"]</code>, which will point to the RPMS repo on CD-ROM, rather than the online repo. This way, composing saves time, bandwidth and reduces to zero the risk of failure because of a networking issue.</p><pre><code>root [ /srv/rpm-ostree ]# cat /etc/yum.repos.d/photon-iso.repo
[photon-iso]
name=VMWare Photon Linux ISO 3.0(x86_64)
baseurl=file:///mnt/cdrom/RPMS
gpgkey=file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY
gpgcheck=1
enabled=0
skip_if_unavailable=True
</code></pre><p>There are already in current directory links created to all repositories in /etc/yum.repos.d, so they are found when tree compose command is invoked. You may add any other repo to the list and include packages found in that repo to be part of the image.</p><h2 id=composing-a-tree>Composing a tree</h2><p>After so much preparation, we can execute a tree compose. We have only added 3 new packages and changed the RPMS repo source. Assuming that the JSON file is editted, run the following:</p><pre><code>root [ /srv/rpm-ostree ]# rpm-ostree compose tree --repo=repo photon-base.json
Previous commit: 2940e10c4d90ce6da572cbaeeff7b511cab4a64c280bd5969333dd2fca57cfa8

Downloading metadata [=========================================================================] 100%

Transaction: 117 packages
  Linux-PAM-1.1.8-2.ph3.x86_64
  attr-2.4.47-1.ph3.x86_64
  ...
  gawk-4.1.0-2.ph3.x86_64
  ...
  sudo-1.8.11p1-4.ph3.x86_64
  ...
  wget-1.15-1.ph3.x86_64
  which-2.20-1.ph3.x86_64
  xz-5.0.5-2.ph3.x86_64
  zlib-1.2.8-2.ph3.x86_64
Installing packages [==========================================================================] 100%
Writing '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/usr/share/rpm-ostree/treefile.json'
Preparing kernel
Creating empty machine-id
Executing: /usr/bin/dracut -v --tmpdir=/tmp -f /var/tmp/initramfs.img 4.0.9 --no-hostonly
...
*** Including module: bash ***
*** Including module: kernel-modules ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 91-permissions.rules
Skipping udev rule: 80-drivers-modprobe.rules
*** Including module: ostree ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
/etc/os-release: line 1: Photon: command not found
*** Including module: fs-lib ***
*** Including module: shutdown ***
*** Including modules done ***
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Stripping files ***
*** Stripping files done ***
*** Store current command line parameters ***
*** Creating image file ***
*** Creating image file done ***
Image: /var/tmp/initramfs.img: 11M
========================================================================
Version: dracut-041-1.ph3

Arguments: -v --tmpdir '/tmp' -f --no-hostonly

dracut modules:
bash
kernel-modules
resume
rootfs-block
terminfo
udev-rules
ostree
systemd
usrmount
base
fs-lib
shutdown
========================================================================
drwxr-xr-x  12 root     root            0 Sep  1 00:52 .
crw-r--r--   1 root     root       5,   1 Sep  1 00:52 dev/console
crw-r--r--   1 root     root       1,  11 Sep  1 00:52 dev/kmsg
...   (long list of files removed)
========================================================================
Initializing rootfs
Migrating /etc/passwd to /usr/lib/
Migrating /etc/group to /usr/lib/
Moving /usr to target
Linking /usr/local -&gt; ../var/usrlocal
Moving /etc to /usr/etc
Placing RPM db in /usr/share/rpm
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/lib/nss_db/Makefile'
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/cache/ldconfig/aux-cache'
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/log/btmp'
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/log/lastlog'
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/log/wtmp'
Moving /boot
Using boot location: both
Copying toplevel compat symlinks
Adding tmpfiles-ostree-integration.conf
Committing '/var/tmp/rpm-ostree.TVO089/rootfs.tmp' ...
photon/1.0/x86_64/minimal =&gt; c505f4bddb4381e8b5213682465f1e5bb150a18228aa207d763cea45c6a81bbe
</code></pre><p>I&rsquo;ve cut a big part of logging, but as you can see, the new filetree adds to the top of the previous (initial) commit 2940e10c4d and produces a new commit c505f4bddb. Our packages gawk-4.1.0-2.ph3.x86_64, sudo-1.8.11p1-4.ph3.x86_64 and wget-1.15-1.ph3.x86_64 have been added.</p><p>During compose, <code>rpm-ostree</code> checks out the file tree into its uncompressed form, applies the package changes, places the updated RPM repo into /usr/share/rpm and calls <code>ostree</code> to commit its changes back into the OSTree repo. If we were to look at the temp directory during this time:</p><pre><code>root [ /srv/rpm-ostree ]# ls /var/tmp/rpm-ostree.TVO089/rootfs.tmp
bin   dev   lib    media  opt     proc  run   srv  sysroot  usr
boot  home  lib64  mnt    ostree  root  sbin  sys  tmp      var
</code></pre><p>If we repeat the command, and there is no change in the JSON file settings and no change in metadata, rpm-ostree will figure out that nothing has changed and stop. You can force however to redo the whole composition.</p><pre><code>root [ /srv/rpm-ostree ]# rpm-ostree compose tree --repo=repo photon-base.json
Previous commit: c505f4bddb4381e8b5213682465f1e5bb150a18228aa207d763cea45c6a81bbe

Downloading metadata [=========================================================================] 100%


No apparent changes since previous commit; use --force-nocache to override
</code></pre><p>This takes several minutes. Then why is the RPM-OSTree server installing so fast, in 45 seconds on my SSD? The server doesn&rsquo;t compose the tree, it uses a pre-created OSTree repo that is stored on the CD-ROM. It comes of course at the expense of larger CD-ROM size. This OSTree repo is created from the same set of RPMS on the CD-ROM, so if you compose fresh, you will get the same exact tree, with same commit ID for the &ldquo;minimal&rdquo; ref.</p><h2 id=automatic-version-prefix>Automatic version prefix</h2><p>If you recall the filetree version explained earlier, this is where it comes into play. When a tree is composed from scratch, the first version (0) associated to the initial commit is going to get that human readable value. Any subsequent compose operation will auto-increment to .1, .2, .3 and so on.<br>It&rsquo;s a good idea to start a versionning scheme of your own, so that your customized Photon builds that may get different packages of your choice don&rsquo;t get the same version numbers as the official Photon team builds, coming from VMware&rsquo;s bintray OSTree repository. There is no conflict, it&rsquo;s just confusing to have same name for different commits coming from different repos,<br>So if you work for a company named Big Data Inc., you may want to switch to a new versioning scheme <code>"automatic_version_prefix": "1.0_bigdata"</code>.</p><h2 id=installing-package-updates>Installing package updates</h2><p>If you want to provide hosts with the package updates that VMware periodically releases, all that you need to do is to add the photon-updates.repo to the list of repos in photon-base.json and then re-compose the usual way.</p><pre><code>&quot;repos&quot;: [&quot;photon&quot;, &quot;photon-updates&quot;],
</code></pre><p>Even though you may have not modified the &ldquo;packages&rdquo; section in the json file, the newer versions of existing packages will be included in the new image and then downloaded by the host the usual way. Note that upgrading a package shows differently than adding (+) or removing (-). You may still see packages added (or removed) though because they are new dependencies (or no longer dependencies) for the newer versions of other packages, as libssh2 in the example below.</p><pre><code>root [ ~ ]# rpm-ostree upgrade --check-diff
Updating from: photon:photon/3.0/x86_64/minimal

8 metadata, 13 content objects fetched; 1002 KiB transferred in 0 seconds
!bridge-utils-1.5-2.ph3.x86_64
=bridge-utils-1.5-3.ph3.x86_64
!bzip2-1.0.6-5.ph3.x86_64
=bzip2-1.0.6-6.ph3.x86_64
!curl-7.47.1-2.ph3.x86_64
=curl-7.51.0-2.ph3.x86_64
!docker-1.11.0-5.ph3.x86_64
=docker-1.12.1-1.ph3.x86_64
...
+libssh2-1.8.0-1.ph3.x86_64
...

root [ ~ ]# rpm-ostree upgrade
Updating from: photon:photon/1.0/x86_64/minimal

258 metadata, 1165 content objects fetched; 76893 KiB transferred in 8 seconds
Copying /etc changes: 6 modified, 0 removed, 14 added
Transaction complete; bootconfig swap: yes deployment count change: 1
Changed:
  bridge-utils 1.5-2.ph3 -&gt; 1.5-3.ph3
  bzip2 1.0.6-5.ph3 -&gt; 1.0.6-6.ph3
  curl 7.47.1-2.ph3 -&gt; 7.51.0-2.ph3
  docker 1.11.0-5.ph3 -&gt; 1.12.1-1.ph3
  ...
Added:
  libssh2-1.8.0-1.ph3.x86_64
Upgrade prepared for next boot; run &quot;systemctl reboot&quot; to start a reboot
</code></pre><p>Now if we want to see what packages have been updated and what issues have been fixed, just run at the host the command that we learned about in chapter 5.4.</p><pre><code>root [ ~ ]# rpm-ostree db diff 56ef 396e
ostree diff commit old: 56e (56ef687f1319604b7900a232715718d26ca407de7e1dc89251b206f8e255dcb4)
ostree diff commit new: 396 (396e1116ad94692b8c105edaee4fa12447ec3d8f73c7b3ade4e955163d517497)
Upgraded:
 bridge-utils-1.5-3.ph3.x86_64
* Mon Sep 12 2016 Alexey Makhalov &lt;amakhalov@vmware.com&gt; 1.5-3
-	Update patch to fix-2.

 bzip2-1.0.6-6.ph3.x86_64
* Fri Oct 21 2016 Kumar Kaushik &lt;kaushikk@vmware.com&gt; 1.0.6-6
-       Fixing security bug CVE-2016-3189.

 curl-7.51.0-2.ph3.x86_64
* Wed Nov 30 2016 Xiaolin Li &lt;xiaolinl@vmware.com&gt; 7.51.0-2
-   Enable sftp support.

* Wed Nov 02 2016 Anish Swaminathan &lt;anishs@vmware.com&gt; 7.51.0-1
-   	Upgrade curl to 7.51.0

* Thu Oct 27 2016 Anish Swaminathan &lt;anishs@vmware.com&gt; 7.47.1-4
-   	Patch for CVE-2016-5421

* Mon Sep 19 2016 Xiaolin Li &lt;xiaolinl@vmware.com&gt; 7.47.1-3
-   	Applied CVE-2016-7167.patch.

 docker-1.12.1-1.ph3.x86_64
* Wed Sep 21 2016 Xiaolin Li &lt;xiaolinl@vmware.com&gt; 1.12.1-1
-   Upgraded to version 1.12.1

* Mon Aug 22 2016 Alexey Makhalov &lt;amakhalov@vmware.com&gt; 1.12.0-2
-   Added bash completion file

* Tue Aug 09 2016 Anish Swaminathan &lt;anishs@vmware.com&gt; 1.12.0-1
-   Upgraded to version 1.12.0

* Tue Jun 28 2016 Anish Swaminathan &lt;anishs@vmware.com&gt; 1.11.2-1
-   Upgraded to version 1.11.2
...
Added:
 libssh2-1.8.0-1.ph3.x86_64
</code></pre><h2 id=composing-for-a-different-branch>Composing for a different branch</h2><p>RPM-OSTree makes it very easy to create and update new branches, by composing using json config files that include the Refspec as the new branch name, the list of packages and the other settings we are now familiar with. Photon OS 2.0 RPM-OSTRee Server installer adds two extra files photon-minimal.json and photon-full.json in addition to photon-base.json, that correspond almost identically to the minimal and full profiles installed via tdnf. It also makes &lsquo;photon-base&rsquo; a smaller set of starter branch.</p><p>Of course, you can create your own config files for your branches with desired lists of packages. You may compose on top of the existing tree, or you can <a href=../file-oriented-server-operations/#starting-a-fresh-ostree-repo>start fresh your own OSTRee repo</a>, using your own customized versioning.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c576f34fd93bc55d29c98e625f27b9b0>11.11 - Remotes</h1><p>In Chapter 3 we talked about the Refspec that contains a <strong>photon:</strong> prefix, that is the name of a remote. When a Photon host is installed, a remote is added - which contains the URL for an OSTree repository that is the origin of the commits we are going to pull from and deploy filetrees, in our case the Photon RPM-OSTree server we installed the host from. This remote is named <strong>photon</strong>, which may be confusing, because it&rsquo;s also the OS name and part of the Refspec (branch) path.</p><h2 id=listing-remotes>Listing remotes</h2><p>A host repo can be configured to switch between multiple remotes to pull from, however only one remote is the &ldquo;active&rdquo; one at a time. We can list the remotes created so far, which brings back the expected result.</p><pre><code>root@photon-host-def [ ~ ]# ostree remote list
photon
photon-1
</code></pre><p>We can inquiry about the URL for that remote name, which for the default host is the expected Photon OS online OSTree repo.</p><pre><code>root@photon-host-def [ ~ ]# ostree remote show-url photon
https://&lt;host-name&gt;:8080/repo
</code></pre><p>But where is this information stored? The repo&rsquo;s config file has it.</p><pre><code>root@photon-host-def [ ~ ]# cat /ostree/repo/config 
[core]
repo_version=1
mode=bare

[remote &quot;photon&quot;]
url=http:&lt;Server-IP-Address:port&gt;/repo
gpg-verify=false
</code></pre><p>If same command is executed on the custom host we&rsquo;ve installed, it&rsquo;s going to reveal the URL of the Photon RPM-OSTree server connected to during setup.</p><pre><code>root@photon-host-cus [ ~ ]# ostree remote show-url photon
http://10.197.103.175:8000/repo
</code></pre><h2 id=gpg-signature-verification>GPG signature verification</h2><p>You may wonder what is the purpose of <code>gpg-verify=false</code> in the config file, associated with the specific remote. This will instruct any host update to skip the signing verification for the updates that come from server, resulted from tree composed locally at the server, as they are not signed. Without this, host updating will fail.</p><p>There is a whole chapter about signing, importing keys and so on that I will not get into, but the idea is that signing adds an extra layer of security, by validating that everything you download comes from the trusted publisher and has not been altered. That is the case for all Photon OS artifacts downloaded from VMware official site. All OVAs and packages, either from the online RPMS repositories or included in the ISO file - are signed by VMware. We&rsquo;ve seen a similar setting <code>gpgcheck=1</code> in the RPMS repo configuration files that tdnf uses to validate or not the signature for all packages downloaded to be installed.</p><h2 id=switching-repositories>Switching repositories</h2><p>Since mapping name/url is stored in the repo&rsquo;s config file, in principle you can re-assign a different URL, connecting the host to a different server. The next upgrade will get the latest commit chain from the new server.<br>If we edit photon-host-def&rsquo;s repo config and replace the bintray URL by photon-srv1&rsquo;s IP address, all original packages in the original 3.0_minimal version will be preserved, but any new package change (addition, removal, upgrade) added after that (in 3.0_minimal.1, 3.0_minimal.2) will be reverted and all new commits from photon-srv1 (that may have same version) will be applied. This is because the two repos are identical copies, so they have the same original commit ID as a common ancestor, but they diverge from there.</p><p>If the old and new repo have nothing in common (no common ancestor commit), this will undo even the original commit, so all commits from the new tree will be applied.<br>A better solution would be to add a new remote that will identify where the commits come from.</p><h2 id=adding-and-removing-remotes>Adding and removing remotes</h2><p>A cleaner way to switch repositories is to add remotes that point to different servers. Let us add another server that we will refer to as <strong>photon2</strong>, along with (optional) the refspecs for branches that it provides (we will see later that in the newer OSTree versions, we don&rsquo;t need to know the branch names, they could be <a href=#list-available-branches>queried at run-time</a>).</p><pre><code>root@photon-host-cus [ ~ ]# ostree remote add --repo=/ostree/repo -v --no-gpg-verify photon2 http://10.197.103.204:8080 photon/3.0/x86_64/minimal photon/3.0/x86_64/full
root@photon-host-cus [ ~ ]# ostree remote list
photon
photon2
root@photon-host-cus [ ~ ]# ostree remote show-url photon2
http://10.118.101.86
</code></pre><p>Where is this information stored? There is an extra config file created per each remote:</p><pre><code>root@photon-host-cus [ ~ ]# cat /etc/ostree/remotes.d/photon2.conf 
[remote &quot;photon2&quot;]
url=http://10.118.101.86
branches=photon/3.0/x86_64/minimal;photon/2.0/x86_64/full;
gpg-verify=false
</code></pre><p>You may have guessed what is the effect of <code>--no-gpg-verify option</code>.<br>Obviously, remotes could also be deleted.</p><pre><code>root@photon-host-cus [ ~ ]# ostree remote delete photon2
root@photon-host-cus [ ~ ]# ostree remote list
photon
</code></pre><h2 id=list-available-branches>List available branches</h2><p>If a host has been deployed from a specific branch and would like to switch to a different one, maybe from a different server, how would it know what branches are available? In git, you would run <code>git remote show origin</code> or <code>git remote -a</code> (although last command would not show all branches, unless you ran <code>git fetch</code> first).</p><p>Fortunately, in Photon OS 3.0 and higher, the hosts are able to query the server, if summary metadata has been generated, as we&rsquo;ve seen in <a href=../file-oriented-server-operations/#creating-summary-metadata>Creating summary metadata</a>. This command lists all branches available for remote <strong>photon2</strong>.</p><pre><code>root@photon-host-cus [ ~ ]# ostree remote refs photon2 
photon2:photon/3.0/x86_64/base
photon2:photon/3.0/x86_64/full
photon2:photon/3.0/x86_64/minimal
</code></pre><h2 id=switching-branches-rebasing>Switching branches (rebasing)</h2><p>If you have an installed Photon 1.0 or 1.0 Rev2 that you want to carry to 3.0, you need to rebase it.</p><p>See <a href=../install-or-rebase-to-photon-os-3#rebasing-a-host-from-photon-10-to-30>Rebasing a host from Photon 1.0 to 3.0</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c3cbddd48a0df603ff7ba6bab63aa2c6>11.12 - Running container applications between bootable images</h1><p>In this chapter, we want to test a docker application and make sure that all the settings and downloads done in one bootable filetree are going to be saved into writable folders and be available in the other image, in other words after reboot from the other image, everything is available exactly the same way.<br>We are going to do this twice: first, to verify an existing bootable image installed in parallel and then create a new one.</p><h2 id=downloading-a-docker-container-appliance>Downloading a docker container appliance</h2><p>Photon OS comes with docker package installed and configured, but we expect that the docker daemon is inactive (not started). Configuration file /usr/lib/systemd/system/docker.service is read-only (remember /usr is bound as read-only).</p><pre><code>root@sample-host-def [ ~ ]# systemctl status docker
* docker.service - Docker Daemon
   Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled)
   Active: inactive (dead)

root@sample-host-def [ ~ ]# cat /usr/lib/systemd/system/docker.service
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
# the default is not to use systemd for cgroups because the delegate issues still
# exists and systemd currently does not support the cgroup feature set required
# for containers run by docker
ExecStart=/usr/bin/dockerd
ExecReload=/bin/kill -s HUP $MAINPID
# Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
# Uncomment TasksMax if your systemd version supports it.
# Only systemd 226 and above support this version.
#TasksMax=infinity
TimeoutStartSec=0
# set delegate yes so that systemd does not reset the cgroups of docker containers
Delegate=yes
# kill only the docker process, not all processes in the cgroup
KillMode=process
# restart the docker process if it exits prematurely
Restart=on-failure
StartLimitBurst=3
StartLimitInterval=60s

[Install]
WantedBy=multi-user.target
</code></pre><p>Now let&rsquo;s enable docker daemon to start at boot time - this will create a symbolic link into writable folder /etc/systemd/system/multi-user.target.wants to its systemd configuration, as with all other systemd controlled services.</p><pre><code>root@sample-host-def [ ~ ]# systemctl enable docker
Created symlink /etc/systemd/system/multi-user.target.wants/docker.service -&gt; /lib/systemd/system/docker.service.

root@sample-host-def [ ~ ]# ls -l /etc/systemd/system/multi-user.target.wants
total 0
lrwxrwxrwx 1 root root 34 Sep 10 10:48 docker.service -&gt; /lib/systemd/system/docker.service
lrwxrwxrwx 1 root root 36 Sep  4 04:59 iptables.service -&gt; /lib/systemd/system/iptables.service
lrwxrwxrwx 1 root root 35 Sep  4 04:59 machines.target -&gt; /lib/systemd/system/machines.target
lrwxrwxrwx 1 root root 36 Sep  4 04:59 remote-fs.target -&gt; /lib/systemd/system/remote-fs.target
lrwxrwxrwx 1 root root 39 Sep  4 04:59 sshd-keygen.service -&gt; /lib/systemd/system/sshd-keygen.service
lrwxrwxrwx 1 root root 32 Sep  4 04:59 sshd.service -&gt; /lib/systemd/system/sshd.service
lrwxrwxrwx 1 root root 44 Sep  4 04:59 systemd-networkd.service -&gt; /lib/systemd/system/systemd-networkd.service
lrwxrwxrwx 1 root root 44 Sep  4 04:59 systemd-resolved.service -&gt; /lib/systemd/system/systemd-resolved.service
</code></pre><p>To verify that the symbolic link points to a file in a read-only directory, try to make a change in this file using vim and save. you&rsquo;ll get an error: &ldquo;/usr/lib/systemd/system/docker.service&rdquo; E166: Can&rsquo;t open linked file for writing".</p><p>Finally, let&rsquo;s start the daemon, check again that is active.</p><pre><code>root@sample-host-def [ ~ ]# systemctl start docker

root@sample-host-def [ ~ ]# systemctl status -l docker
* docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2019-09-10 10:54:32 UTC; 14s ago
     Docs: https://docs.docker.com
 Main PID: 2553 (dockerd)
    Tasks: 35 (limit: 4711)
   Memory: 148.2M
   CGroup: /system.slice/docker.service
           |-2553 /usr/bin/dockerd
           `-2566 docker-containerd --config /var/run/docker/containerd/containerd.toml

Sep 10 10:54:31 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:31.421759662Z&quot; level=info msg=&quot;pickfirstBalancer: HandleSubConnStateChange: 0xc420312f90, CONNECTING&quot; module=grpc
Sep 10 10:54:31 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:31.421935355Z&quot; level=info msg=&quot;pickfirstBalancer: HandleSubConnStateChange: 0xc420312f90, READY&quot; module=grpc
Sep 10 10:54:31 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:31.421980614Z&quot; level=info msg=&quot;Loading containers: start.&quot;
Sep 10 10:54:31 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:31.886520281Z&quot; level=info msg=&quot;Default bridge
(docker0) is assigned with an IP address 172.17.0.0/16. Daemon option --bip can be used to set a preferred IP address&quot;
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.027763113Z&quot; level=info msg=&quot;Loading containers: done.&quot;
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.468277184Z&quot; level=info msg=&quot;Docker daemon&quot;
commit=6d37f41 graphdriver(s)=overlay2 version=18.06.2-ce
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.468441587Z&quot; level=info msg=&quot;Daemon has completed initialization&quot;
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.684925824Z&quot; level=warning msg=&quot;Could not register builder git source: failed to find git binary: exec: \&quot;git\&quot;: executable file not found in $PATH&quot;
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.691070166Z&quot; level=info msg=&quot;API listen on /var/run/docker.sock&quot;
Sep 10 10:54:32 photon-76718dd2fa33 systemd[1]: Started Docker Application Container Engine.
</code></pre><p>We&rsquo;ll ask docker to run Ubuntu Linux in a container. Since it&rsquo;s not present locally, it&rsquo;s going to be downloaded first from the official docker repository <a href=https://hub.docker.com/_/ubuntu/>https://hub.docker.com/_/ubuntu/</a>.</p><pre><code>root@sample-host-def [ ~ ]# docker ps -a
CONTAINER ID        IMAGE            COMMAND      CREATED           STATUS              PORTS       NAMES

root@sample-host-def [ ~ ]# docker run -it ubuntu
Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
35c102085707: Pull complete
251f5509d51d: Pull complete
8e829fe70a46: Pull complete
6001e1789921: Pull complete
Digest: sha256:d1d454df0f579c6be4d8161d227462d69e163a8ff9d20a847533989cf0c94d90
Status: Downloaded newer image for ubuntu:latest
</code></pre><p>When downloading is complete, it comes to Ubuntu root prompt with assigned host name 7029a64e7aa3, that is actually the Container ID. Let&rsquo;s verify it&rsquo;s indeed the expected OS.</p><pre><code>root@sample-host-def [ ~ ]# docker run -it ubuntu
Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
d3a1f33e8a5a: Pull complete
c22013c84729: Pull complete
d74508fb6632: Pull complete
91e54dfb1179: Already exists
library/ubuntu:latest: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.
Digest: sha256:fde8a8814702c18bb1f39b3bd91a2f82a8e428b1b4e39d1963c5d14418da8fba
Status: Downloaded newer image for ubuntu:latest

root@7029a64e7aa3:/# cat /etc/os-release
NAME=&quot;Ubuntu&quot;
VERSION=&quot;18.04.3 LTS (Bionic Beaver)&quot;
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME=&quot;Ubuntu 18.04.3 LTS&quot;
VERSION_ID=&quot;18.04&quot;
HOME_URL=&quot;https://www.ubuntu.com/&quot;
SUPPORT_URL=&quot;https://help.ubuntu.com/&quot;
BUG_REPORT_URL=&quot;https://bugs.launchpad.net/ubuntu/&quot;
PRIVACY_POLICY_URL=&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;
VERSION_CODENAME=bionic
UBUNTU_CODENAME=bionic
root@7029a64e7aa3:/#
</code></pre><p>Now let&rsquo;s write a file into Ubuntu home directory</p><pre><code>echo &quot;Ubuntu file&quot; &gt;&gt; /home/myfile
root@7029a64e7aa3:/home# cat /home/myfile
Ubuntu file
</code></pre><p>We&rsquo;ll exit back to the Photon prompt and if it&rsquo;s stopped, we will re-start it.</p><pre><code>root@7029a64e7aa3:/# exit
exit

root@sample-host-def [ ~ ]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
7029a64e7aa3        ubuntu              &quot;/bin/bash&quot;         6 minutes ago       Exited (0) 11 seconds ago                        gifted_dijkstra

root@photon-host-cus1 [ ~ ]# docker start  7029a64e7aa3
7029a64e7aa3

root@photon-host-cus1 [ ~ ]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
7029a64e7aa3        ubuntu              &quot;/bin/bash&quot;         7 minutes ago       Up 21 seconds                                    gifted_dijkstra
</code></pre><h2 id=rebooting-into-an-existing-image>Rebooting into an existing image</h2><p>Now let&rsquo;s reboot the machine and select the other image. First, we&rsquo;ll verify that the docker daemon is automaically started.</p><pre><code>root@photon-host-cus1 [ ~ ]# systemctl status docker
* docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2019-09-10 10:54:32 UTC; 13min ago
     Docs: https://docs.docker.com
 Main PID: 2553 (dockerd)
    Tasks: 55 (limit: 4711)
   Memory: 261.3M
   CGroup: /system.slice/docker.service
           |-2553 /usr/bin/dockerd
   ...
</code></pre><p>Next, is the Ubuntu OS container still there?</p><pre><code>root@photon-host-cus1 [ ~ ]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
7029a64e7aa3        ubuntu              &quot;/bin/bash&quot;         9 minutes ago       Up 2 minutes                                     gifted_dijkstra
</code></pre><p>It is, so let&rsquo;s start it, attach and verify that our file is persisted, then add another line to it and save, exit.</p><pre><code>root@photon-host-cus1 [ ~ ]# docker start -i  7029a64e7aa3
root@7029a64e7aa3:/# cat /home/myfile
Ubuntu file
root@7029a64e7aa3:/# echo &quot;booted into existing image&quot; &gt;&gt; /home/myfile
root@7029a64e7aa3:/# exit
exit
</code></pre><h2 id=reboot-into-a-newly-created-image>Reboot into a newly created image</h2><p>Let&rsquo;s upgrade and replace the .0 image by a .3 build that contains git and also perl_YAML (because it is a dependency of git).</p><pre><code>root@photon-host-cus1 [ ~ ]# rpm-ostree status
  TIMESTAMP (UTC)         VERSION               ID             OSNAME     REFSPEC
* 2015-09-04 00:36:37     3.0_tp2_minimal.2     092e21d292     photon     photon:photon/tp2/x86_64/minimal
  2015-08-20 22:27:43     3.0_tp2_minimal       2940e10c4d     photon     photon:photon/tp2/x86_64/minimal

root@photon-host-cus1 [ ~ ]# rpm-ostree upgrade
Updating from: photon:photon/tp2/x86_64/minimal

43 metadata, 209 content objects fetched; 19992 KiB transferred in 0 seconds
Copying /etc changes: 5 modified, 0 removed, 19 added
Transaction complete; bootconfig swap: yes deployment count change: 0
Freed objects: 16.2 MB
Added:
  git-2.1.2-1.ph3tp2.x86_64
  perl-YAML-1.14-1.ph3tp2.noarch
Upgrade prepared for next boot; run &quot;systemctl reboot&quot; to start a reboot

root@photon-host-cus1 [ ~ ]# rpm-ostree status
  TIMESTAMP (UTC)         VERSION               ID             OSNAME     REFSPEC
  2015-09-06 18:12:08     3.0_tp2_minimal.3     d16aebd803     photon     photon:photon/tp2/x86_64/minimal
* 2015-09-04 00:36:37     3.0_tp2_minimal.2     092e21d292     photon     photon:photon/tp2/x86_64/minimal
</code></pre><p>After reboot from 3.0_tp2_minimal.3 build, let&rsquo;s check that the 3-way /etc merge succeeded as expected. The docker.service slink is still there, and docker demon restarted at boot.</p><pre><code>root@photon-host-cus1 [ ~ ]# ls -l /etc/systemd/system/multi-user.target.wants/docker.service
lrwxrwxrwx 1 root root 38 Sep  6 12:50 /etc/systemd/system/multi-user.target.wants/docker.service -&gt; /usr/lib/systemd/system/docker.service

root@photon-host-cus1 [ ~ ]# systemctl status docker
* docker.service - Docker Daemon
   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled)
   Active: active (running) since Sun 2015-09-06 12:56:33 UTC; 1min 27s ago
 Main PID: 292 (docker)
   CGroup: /system.slice/docker.service
           `-292 /bin/docker -d -s overlay
   ...
</code></pre><p>Let&rsquo;s revisit the Ubuntu container. Is the container still there? is myfile persisted?</p><pre><code>root@photon-host-cus1 [ ~ ]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                    PORTS               NAMES
7029a64e7aa3        ubuntu              &quot;/bin/bash&quot;         5 days ago          Exited (0) 5 days ago                         gifted_dijkstra
55825c961f95        ubuntu              &quot;/bin/bash&quot;         5 days ago          Exited (127) 5 days ago                       distracted_shannon

root@photon-host-cus1 [ ~ ]# docker start 57dcac5d0490

root@57dcac5d0490:/# cat /home/myfile
Ubuntu file
booted into existing image
root@57dcac5d0490:/# echo &quot;booted into new image&quot; &gt;&gt; /home/myfile
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-47d938d24c094a3c507e7cead3de3897>11.13 - Install or rebase to Photon OS 3.0</h1><p>Photon OS 3.0 provides full RPM-OSTree functionality, it lets the user drive it, rather than provide a pre-defined solution as part of the installation.</p><p>The number of packages included in the RPMS repo in Photon OS 3.0 increased significantly, compared to 1.0. To keep the ISO at reasonable size, Photon OS 2.0 no longer includes the compressed ostree.repo file, that helped optimize both the server and host install in 1.0 or 1.0 Rev2. That decision affected the OSTree features we ship out of the box. Customer could achieve the same results by several additional simple steps, that will be explained in this chapter. In addition, there is a new way to create a host raw image at server.</p><h2 id=composing-your-own-rpm-ostree-server>Composing your own RPM-OSTree Server</h2><p>You can compose your own RPM-OSTRee server in the following two ways:</p><ol><li><p>By Manually executing the below command:</p><pre><code>root [ /srv/rpm-ostree ]# ostree --repo=repo init --mode=archive-z2
root [ /srv/rpm-ostree ]# rpm-ostree compose tree --repo=repo photon-base.json
</code></pre></li><li><p>By installing <code>rpm-ostree-repo package</code> . This provides the script to create the repo tree which act as server by executing a single command.</p></li></ol><h2 id=installing-an-rpm-ostree-host>Installing an RPM-OSTree host</h2><p>Automated host install is supported, as explained in <a href=../installing-a-host-against-custom-server-repository/#automated-install-of-a-custom-host-via-kickstart>Chapter 7.2 Automated install of a custom host via kickstart</a>.</p><h2 id=rebasing-a-host-from-photon-10-to-30>Rebasing a host from Photon 1.0 to 3.0</h2><p>If kickstart sounds too complicated and we still want to go the UI way there is a workaround that requires an extra step. Also, if you have an installed Photon 1.0 or 1.0 Rev2 that you want to carry to 3.0, you need to rebase it. Notice that I didn&rsquo;t say &ldquo;upgrade&rdquo;.</p><p>Basically the OSTree repo will switch to a different branch on a different server, following the new server&rsquo;s branch versioning scheme. The net result is that the lots of packages will get changed to newer versions from newer OSTree repo, that has been composed from a newer Photon OS 3.0 RPMS repo. Again, I didn&rsquo;t say &ldquo;upgraded&rdquo;, neither the rebase command output, that lists &ldquo;changed&rdquo; packages. Some obsolete packages will be removed, new packages will be added, either because they didn&rsquo;t exist in 2.0 repo, or because the new config file includes them.<br>The OS name is the same (Photon), so the content in /var and /etc will be transferred over.</p><ol><li>To install fresh, deploy a Photon 1.0 Rev2 host default, as described in <a href=../installing-a-host-against-default-server-repository/>Chapter 2</a>. Of course, if you already have an existing Photon OS 1.0 host that you want to move to 2.0, skip this step.</li><li>Edit /ostree/repo/config and substitute the url, providing the IP address for the Photon OS 2.0 RPM-OSTree server installed above. This was explained in <a href=../remotes/#switching-repositories>Chapter 10</a>.<br>ostree should confirm that is the updated server IP for the &ldquo;photon&rdquo; remote.</li></ol><pre><code>root@ostree-host [ ~ ]# ostree remote show-url photon
http://10.197.103.175:8000/repo
</code></pre><ol start=3><li><p>Rebase your host to the new 2.0 server and Refspec.</p><pre><code>root@ostree-host [ ~ ]# ostree remote add photon-2 http://10.197.103.204:8000/repo --no-gpg-verify
root@ostree-host [ ~ ]# rpm-ostree rebase photon-2:photon/3.0/x86_64/minimal
   
Rebasing to photon-2:photon/3.0/x86_64/minimal
 Receiving objects: 99% (1541/1549) 478.3 kB/s 107.1 MB
Receiving objects: 99% (1541/1549) 478.3 kB/s 107.1 MB... done
Staging deployment... done
Upgraded:
  docker 18.06.2-3.ph3 -&gt; 18.06.2-4.ph3
  gmp 6.1.2-2.ph3 -&gt; 6.1.2-3.ph3
  gobject-introspection 1.58.0-2.ph3 -&gt; 1.58.0-3.ph3
  gzip 1.9-1.ph3 -&gt; 1.9-2.ph3
  linux 4.19.65-3.ph3 -&gt; 4.19.69-1.ph3
  mpfr 4.0.1-1.ph3 -&gt; 4.0.1-2.ph3
  ostree 2019.2-1.ph3 -&gt; 2019.2-2.ph3
  ostree-grub2 2019.2-1.ph3 -&gt; 2019.2-2.ph3
  ostree-libs 2019.2-1.ph3 -&gt; 2019.2-2.ph3
  zlib 1.2.11-1.ph3 -&gt; 1.2.11-2.ph3
Added:
  efibootmgr-15-1.ph3.x86_64
  efivar-36-1.ph3.x86_64
  tar-1.30-3.ph3.x86_64
Run &quot;systemctl reboot&quot; to start a reboot
</code></pre></li><li><p>Check the status</p><pre><code>root@ostree-host [ ~ ]# rpm-ostree status
State: idle
AutomaticUpdates: disabled
Deployments:
* ostree://photon-1:photon/3.0/x86_64/minimal
               Version: 3.0_minimal.2 (2019-09-18T08:22:15Z)
            BaseCommit: c8f2b116b067d7695f9033bf2a99505198269354e157c0f2d5b78266cb874239
       LayeredPackages: createrepo_c rpm wget

  ostree://photon:photon/1.0/x86_64/minimal
               Version: 1.0_minimal.1 (2017-01-11T02:18:42)
            BaseCommit: 28dc49ecb4604c0bc349e4445adc659491a1874c01198e6253a261f4d59708b7
       LayeredPackages: createrepo_c rpm wget
</code></pre></li></ol><p>You may now reboot to the new Photon OS 3.0 image.</p><h2 id=creating-a-host-raw-image>Creating a host raw image</h2><p>It is now possible to run at server a script that is part of RPM-OStree package, to create a host raw mage.</p></div></main></div></div><div class=container><footer class="container-fluid p-0 m-0 py-5 row d-print-none"><div class="container-fluid p-0"><div class="row d-flex justify-content-between align-items-center mx-0"><div class="order-sm-1 left-links"><ul class="list-inline mb-0"><li class="list-inline-item h1 px-3 m-0" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class="text-dark ml-4" target=_blank rel="noopener noreferrer" href=https://github.com/vmware/photon#readme><i class="fab fa-github">&nbsp;</i>
GitHub</a></li><li class="list-inline-item h1 px-3 m-0" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class="text-dark ml-4" target=_blank rel="noopener noreferrer" href=https://vmwarecode.slack.com><i class="fab fa-slack">&nbsp;</i>
Slack</a></li></ul></div><div class="order-sm-3 justify-items-end footer-logo"><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511.4375 135.7375" height="135.7375" width="511.4375" id="svg3355"><defs id="defs3359"><clipPath id="clipPath3387" clipPathUnits="userSpaceOnUse"><path id="path3389" d="M142.293 245.191l494.93 337.36L74.8398 348.098"/></clipPath><linearGradient id="linearGradient3391" spreadMethod="pad" gradientTransform="matrix(-493.8,-339.007,339.007,-493.8,601.845,634.081)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3393" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3395" offset="1" style="stop-opacity:1;stop-color:#80c64c"/></linearGradient><clipPath id="clipPath3405" clipPathUnits="userSpaceOnUse"><path id="path3407" d="M85.2852 570.719 516.813 593.84 54.5195 690.582"/></clipPath><linearGradient id="linearGradient3409" spreadMethod="pad" gradientTransform="matrix(-304.079,-208.759,208.759,-304.079,420.197,734.568)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3411" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3413" offset="1" style="stop-opacity:1;stop-color:#22437e"/></linearGradient><clipPath id="clipPath3423" clipPathUnits="userSpaceOnUse"><path id="path3425" d="m538.137 270.234 95.324 293.5-205.699-247.089"/></clipPath><linearGradient id="linearGradient3427" spreadMethod="pad" gradientTransform="matrix(-255.101,-175.134,175.134,-255.101,686.667,486.234)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3429" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3431" offset="1" style="stop-opacity:1;stop-color:#65a5de"/></linearGradient><clipPath id="clipPath3441" clipPathUnits="userSpaceOnUse"><path id="path3443" d="M857.758 94.3906 656.035 546.801 745.172 53.6406"/></clipPath><linearGradient id="linearGradient3445" spreadMethod="pad" gradientTransform="matrix(-102.35,-449.574,449.574,-102.35,800.888,513.826)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3447" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3449" offset="1" style="stop-opacity:1;stop-color:#c6da3a"/></linearGradient><clipPath id="clipPath3459" clipPathUnits="userSpaceOnUse"><path id="path3461" d="M481.316 864.746 635.938 602.125l-41.313 301.32"/></clipPath><linearGradient id="linearGradient3463" spreadMethod="pad" gradientTransform="matrix(67.7401,274.401,-274.401,67.7401,532.514,627.656)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3465" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3467" offset="1" style="stop-opacity:1;stop-color:#c6da3a"/></linearGradient><clipPath id="clipPath3477" clipPathUnits="userSpaceOnUse"><path id="path3479" d="M1085.54 913.828 683.598 585.359l456.522 219.75"/></clipPath><linearGradient id="linearGradient3481" spreadMethod="pad" gradientTransform="matrix(441.375,262.068,-262.068,441.375,675.147,599.59)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3483" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3485" offset="1" style="stop-opacity:1;stop-color:#22638b"/></linearGradient><clipPath id="clipPath3495" clipPathUnits="userSpaceOnUse"><path id="path3497" d="M1177.19 335.031 693.664 556.211 1106.69 235.887"/></clipPath><linearGradient id="linearGradient3499" spreadMethod="pad" gradientTransform="matrix(450.785,-274.875,274.875,450.785,694.818,558.101)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3501" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3503" offset="1" style="stop-opacity:1;stop-color:#a6dbe7"/></linearGradient><clipPath id="clipPath3513" clipPathUnits="userSpaceOnUse"><path id="path3515" d="M209.754 773.73l382.32-187.417L280.926 872.391"/></clipPath><linearGradient id="linearGradient3517" spreadMethod="pad" gradientTransform="matrix(-360.263,223.047,-223.047,-360.263,601.957,602.271)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3519" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3521" offset="1" style="stop-opacity:1;stop-color:#a6dbe7"/></linearGradient></defs><g transform="matrix(1.25,0,0,-1.25,0,135.7375)" id="g3363"><g transform="scale(0.1,0.1)" id="g3365"><path id="path3367" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1544.2 536.77c69.27.0 114.66 37.031 114.66 91.972v1.192c0 59.726-44.79 90.781-112.28 90.781h-105.7V536.77h103.32zm-150.51 203.652c0 13.141 10.75 23.891 23.29 23.891h133.19c94.36.0 156.47-50.172 156.47-132.586v-1.192c0-90.183-75.25-136.765-164.24-136.765h-101.52V367.148c0-13.132-10.76-23.886-23.9-23.886-12.54.0-23.29 10.754-23.29 23.886v373.274"/><path id="path3369" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1765.51 743.41c0 13.141 10.76 23.887 23.29 23.887 13.14.0 23.9-10.746 23.9-23.887V578.574h241.28V743.41c0 13.141 10.74 23.887 23.88 23.887 12.55.0 23.3-10.746 23.3-23.887V367.148c0-13.132-10.75-23.886-23.3-23.886-13.14.0-23.88 10.754-23.88 23.886v167.227H1812.7V367.148c0-13.132-10.76-23.886-23.9-23.886-12.53.0-23.29 10.754-23.29 23.886V743.41"/><path id="path3371" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m2554.86 554.082v1.203c0 94.957-69.28 172.598-164.83 172.598-95.56.0-163.65-76.445-163.65-171.406v-1.192c0-94.961 69.28-172.597 164.84-172.597 95.55.0 163.64 76.445 163.64 171.394zm-377.45.0v1.203c0 115.262 86.6 216.192 213.81 216.192 127.2.0 212.6-99.739 212.6-215v-1.192c0-115.265-86.59-216.203-213.79-216.203-127.22.0-212.62 99.738-212.62 215"/><path id="path3373" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m2756.35 720.715h-121.24c-11.94.0-22.09 9.555-22.09 21.5.0 11.941 10.15 22.098 22.09 22.098h290.26c11.94.0 22.1-10.157 22.1-22.098.0-11.945-10.16-21.5-22.1-21.5h-121.23V367.148c0-13.132-10.75-23.886-23.9-23.886-13.13.0-23.89 10.754-23.89 23.886v353.567"/><path id="path3375" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3332.78 554.082v1.203c0 94.957-69.28 172.598-164.83 172.598-95.56.0-163.65-76.445-163.65-171.406v-1.192c0-94.961 69.28-172.597 164.84-172.597 95.55.0 163.64 76.445 163.64 171.394zm-377.45.0v1.203c0 115.262 86.6 216.192 213.81 216.192 127.2.0 212.6-99.739 212.6-215v-1.192c0-115.265-86.59-216.203-213.79-216.203-127.22.0-212.62 99.738-212.62 215"/><path id="path3377" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3458.31 742.813c0 12.539 10.75 23.292 23.29 23.292h6.57c10.75.0 17.32-5.375 23.89-13.742l253.83-323.691v315.332c0 12.547 10.14 23.293 23.29 23.293 12.54.0 22.69-10.746 22.69-23.293V366.555c0-12.539-8.96-22.09-21.5-22.09h-2.4c-10.14.0-17.31 5.965-24.48 14.324l-259.2 331.465V366.555c0-12.539-10.14-23.293-23.29-23.293-12.54.0-22.69 10.754-22.69 23.293v376.258"/><path id="path3379" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3982.91 759.98c0 4.528 3.13 7.665 7.66 7.665h2.09c3.14.0 5.22-1.395 6.97-3.829l37.6-58.503 38.3 58.503c1.74 2.434 3.83 3.829 6.61 3.829h2.09c3.83.0 7.32-3.485 7.32-7.665v-94.011c0-4.18-3.49-7.66-7.66-7.66-4.18.0-7.31 3.48-7.31 7.66v72.426l-32.38-48.403c-1.75-2.785-3.83-4.527-6.97-4.527-3.13.0-5.22 1.742-6.96 4.527l-32.04 48.403v-72.426c0-4.18-3.48-7.66-7.66-7.66s-7.66 3.48-7.66 7.66v94.011zm-73.47-7.308h-28.91c-3.82.0-7.3 3.48-7.3 7.308.0 3.836 3.48 7.317 7.3 7.317h72.78c4.18.0 7.31-3.481 7.31-7.317.0-3.828-3.13-7.308-7.31-7.308h-28.55v-86.703c0-4.18-3.48-7.66-8.01-7.66-4.18.0-7.31 3.48-7.31 7.66v86.703"/><path id="path3381" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m597.898 989.039c-236.39.0-428.714-192.324-428.714-428.719.0-236.39 192.324-428.715 428.714-428.715 236.395.0 428.722 192.325 428.722 428.715.0 236.395-192.327 428.719-428.722 428.719zm0-954.289c-289.796.0-525.566 235.773-525.566 525.57s235.77 525.57 525.566 525.57c289.801.0 525.572-235.773 525.572-525.57S887.699 34.75 597.898 34.75"/><g id="g3383"><g clip-path="url(#clipPath3387)" id="g3385"><path id="path3397" style="fill:url(#linearGradient3391);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M142.293 245.191l494.93 337.36L74.8398 348.098"/></g></g><path id="path3399" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m167.938 304.09c-4.524 34.332-36.024 58.496-70.356 53.973-34.332-4.52-58.5-36.02-53.9765-70.352 4.5234-34.336 36.0234-58.5 70.3555-53.977 34.332 4.524 58.5 36.02 53.977 70.356"/><g id="g3401"><g clip-path="url(#clipPath3405)" id="g3403"><path id="path3415" style="fill:url(#linearGradient3409);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M85.2852 570.719 516.813 593.84 54.5195 690.582"/></g></g><path id="path3417" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m124.875 636.605c-4.523 34.333-36.0234 58.5-70.3555 53.977C20.1875 686.059-3.98047 654.559.542969 620.227 5.06641 585.895 36.5664 561.727 70.8984 566.25c34.3356 4.523 58.4996 36.023 53.9766 70.355"/><g id="g3419"><g clip-path="url(#clipPath3423)" id="g3421"><path id="path3433" style="fill:url(#linearGradient3427);fill-opacity:1;fill-rule:nonzero;stroke:none" d="m538.137 270.234 95.324 293.5-205.699-247.089"/></g></g><path id="path3435" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m541.352 289.715c-4.524 34.332-36.024 58.5-70.356 53.973-34.336-4.52-58.5-36.02-53.976-70.352 4.523-34.336 36.023-58.5 70.355-53.977 34.332 4.524 58.496 36.024 53.977 70.356"/><g id="g3437"><g clip-path="url(#clipPath3441)" id="g3439"><path id="path3451" style="fill:url(#linearGradient3445);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M857.758 94.3906 656.035 546.801 745.172 53.6406"/></g></g><path id="path3453" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m846.91 110.883c-26.609 22.164-66.144 18.558-88.308-8.051-22.164-26.6132-18.559-66.1406 8.05-88.3125 26.61-22.16013 66.145-18.55075 88.309 8.0586 22.164 26.6016 18.559 66.1446-8.051 88.3049"/><g id="g3455"><g clip-path="url(#clipPath3459)" id="g3457"><path id="path3469" style="fill:url(#linearGradient3463);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M481.316 864.746 635.938 602.125l-41.313 301.32"/></g></g><path id="path3471" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m491.863 848.059c26.203-22.645 65.797-19.758 88.442 6.441 22.64 26.203 19.758 65.797-6.446 88.441-26.199 22.645-65.796 19.758-88.437-6.445-22.645-26.199-19.762-65.797 6.441-88.437"/><g id="g3473"><g clip-path="url(#clipPath3477)" id="g3475"><path id="path3487" style="fill:url(#linearGradient3481);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M1085.54 913.828 683.598 585.359l456.522 219.75"/></g></g><path id="path3489" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1050.12 855.145c2.26-34.555 32.1-60.743 66.66-58.485 34.55 2.254 60.74 32.098 58.48 66.653-2.25 34.554-32.09 60.742-66.65 58.484-34.56-2.254-60.74-32.098-58.49-66.652"/><g id="g3491"><g clip-path="url(#clipPath3495)" id="g3493"><path id="path3505" style="fill:url(#linearGradient3499);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M1177.19 335.031 693.664 556.211 1106.69 235.887"/></g></g><path id="path3507" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1108.75 338.84c-29.47-18.176-38.63-56.805-20.46-86.281 18.18-29.477 56.81-38.637 86.29-20.461 29.47 18.179 38.63 56.808 20.45 86.285-18.17 29.476-56.8 38.637-86.28 20.457"/><g id="g3509"><g clip-path="url(#clipPath3513)" id="g3511"><path id="path3523" style="fill:url(#linearGradient3517);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M209.754 773.73l382.32-187.417L280.926 872.391"/></g></g><path id="path3525" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m278.168 769.453c29.598 17.977 39.02 56.543 21.043 86.145-17.977 29.597-56.543 39.019-86.145 21.043-29.597-17.977-39.019-56.543-21.043-86.141 17.977-29.602 56.543-39.023 86.145-21.047"/><path id="path3527" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m714.422 718.262c8.172-9.321 22.351-10.246 31.672-2.074 9.316 8.175 10.246 22.355 2.07 31.675-8.172 9.317-22.351 10.246-31.672 2.071-9.316-8.172-10.246-22.356-2.07-31.672"/><path id="path3529" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m827.305 484.969c8.175-9.321 22.355-10.25 31.672-2.074 9.32 8.171 10.25 22.355 2.074 31.671-8.172 9.321-22.356 10.247-31.672 2.075-9.32-8.176-10.246-22.356-2.074-31.672"/><path id="path3531" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m906.813 877.289c8.175-9.316 22.355-10.246 31.675-2.07 9.317 8.172 10.246 22.351 2.071 31.672-8.172 9.32-22.356 10.246-31.672 2.074-9.321-8.176-10.246-22.356-2.074-31.676"/><path id="path3533" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m987.531 166.984c8.172-9.32 22.359-10.246 31.669-2.074 9.32 8.176 10.25 22.356 2.08 31.676-8.18 9.316-22.358 10.242-31.678 2.07-9.317-8.176-10.247-22.355-2.071-31.672"/><path id="path3535" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m140.008 473.707c8.172-9.32 22.351-10.246 31.672-2.074 9.316 8.176 10.246 22.355 2.074 31.676-8.176 9.316-22.356 10.246-31.676 2.07-9.316-8.172-10.246-22.356-2.07-31.672"/><path id="path3537" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m609.063 315.641c8.171-9.321 22.355-10.246 31.671-2.075 9.321 8.176 10.246 22.356 2.075 31.676-8.176 9.317-22.356 10.246-31.676 2.071-9.317-8.172-10.246-22.352-2.07-31.672"/><path id="path3539" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m458.551 398.422c8.172-9.317 22.351-10.246 31.672-2.07 9.32 8.171 10.246 22.351 2.074 31.671-8.176 9.317-22.356 10.247-31.676 2.071-9.316-8.172-10.246-22.352-2.07-31.672"/><path id="path3541" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m518.754 661.82c8.176-9.32 22.355-10.246 31.672-2.074 9.32 8.176 10.25 22.356 2.074 31.676-8.176 9.316-22.355 10.246-31.672 2.07-9.32-8.172-10.25-22.355-2.074-31.672"/><path id="path3543" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m744.523 394.66c8.172-9.32 22.356-10.246 31.672-2.074 9.321 8.176 10.246 22.355 2.075 31.676-8.176 9.316-22.356 10.246-31.672 2.07-9.321-8.172-10.25-22.355-2.075-31.672"/><path id="path3545" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m714.422 605.379c8.172-9.32 22.351-10.246 31.672-2.074 9.316 8.172 10.246 22.355 2.07 31.672-8.172 9.32-22.351 10.246-31.672 2.074-9.316-8.176-10.246-22.356-2.07-31.672"/><path id="path3547" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m368.242 469.918c8.172-9.32 22.356-10.25 31.672-2.074 9.32 8.172 10.246 22.355 2.074 31.672-8.175 9.32-22.355 10.246-31.675 2.074-9.317-8.176-10.247-22.356-2.071-31.672"/><path id="path3549" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m633.461 620.176c8.172-9.317 22.355-10.246 31.672-2.071 9.32 8.172 10.246 22.356 2.074 31.672-8.176 9.321-22.355 10.246-31.676 2.075-9.316-8.176-10.246-22.356-2.07-31.676"/><path id="path3551" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m646.691 752.129c8.172-9.32 22.352-10.25 31.672-2.074 9.321 8.172 10.246 22.355 2.075 31.672-8.176 9.32-22.356 10.246-31.676 2.074-9.317-8.176-10.246-22.356-2.071-31.672"/><path id="path3553" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m819.777 334.453c8.176-9.316 22.356-10.246 31.676-2.07 9.317 8.172 10.246 22.351 2.07 31.672-8.171 9.32-22.351 10.246-31.671 2.074-9.321-8.176-10.247-22.356-2.075-31.676"/><path id="path3555" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m812.242 571.512c8.176-9.321 22.356-10.246 31.676-2.074 9.316 8.175 10.246 22.355 2.07 31.675-8.172 9.317-22.351 10.246-31.672 2.071-9.316-8.172-10.246-22.356-2.074-31.672"/><path id="path3557" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m382.156 392.988c8.172-9.316 22.356-10.246 31.672-2.07 9.32 8.172 10.246 22.355 2.074 31.672-8.175 9.32-22.355 10.246-31.672 2.074-9.32-8.176-10.25-22.355-2.074-31.676"/><path id="path3559" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m613.543 476.398c8.176-9.32 22.355-10.25 31.676-2.074 9.316 8.176 10.246 22.356 2.07 31.672-8.172 9.32-22.355 10.246-31.672 2.074-9.32-8.175-10.246-22.355-2.074-31.672"/><path id="path3561" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m435.969 645.902c8.172-9.32 22.351-10.246 31.672-2.074 9.32 8.176 10.246 22.356 2.074 31.676-8.176 9.316-22.356 10.246-31.676 2.07-9.316-8.172-10.246-22.355-2.07-31.672"/><path id="path3563" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m629.688 164.293c8.171-9.32 22.355-10.246 31.671-2.074 9.321 8.176 10.246 22.355 2.075 31.676-8.176 9.316-22.356 10.246-31.672 2.07-9.321-8.172-10.25-22.356-2.074-31.672"/><path id="path3565" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m499.398 462.395c12.329-1.301 23.379 7.632 24.684 19.96 1.305 12.325-7.633 23.375-19.961 24.68-12.324 1.305-23.375-7.633-24.68-19.957-1.304-12.328 7.633-23.379 19.957-24.683"/><path id="path3567" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m721.23 510.641c-12.3 1.527-23.511-7.207-25.039-19.508-1.527-12.301 7.207-23.512 19.508-25.039 12.301-1.528 23.512 7.207 25.039 19.508 1.528 12.3-7.207 23.507-19.508 25.039"/><path id="path3569" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m594.34 420.676c-7.543 9.836-21.629 11.695-31.469 4.152-9.836-7.543-11.691-21.633-4.148-31.469s21.632-11.695 31.468-4.152 11.696 21.633 4.149 31.469"/><path id="path3571" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m594.828 581.156c-7.543 9.836-21.633 11.696-31.469 4.153s-11.695-21.633-4.152-31.469c7.547-9.836 21.633-11.695 31.469-4.152 9.836 7.542 11.695 21.632 4.152 31.468"/><path id="path3573" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m458.199 576.973c5.156 11.273.199 24.59-11.07 29.75-11.274 5.156-24.59.199-29.746-11.071-5.16-11.273-.203-24.589 11.066-29.75 11.274-5.156 24.594-.199 29.75 11.071"/><path id="path3575" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m635.691 569.449c-5.234-11.234-.367-24.59 10.868-29.82 11.238-5.234 24.589-.371 29.824 10.867 5.234 11.234.367 24.586-10.867 29.82-11.239 5.235-24.59.372-29.825-10.867"/></g></g></svg></div></div><div class="row d-flex m-0 my-4 justify-content-end align-items-end"><small class="text-dark align-content-center mx-3">&copy; 2021 Photon OS Authors. <a href=https://vmware.github.io>A VMware Backed Project</a></small><div class=text-right><a href=../../../><img class=vmw-footer-logo src=../../../img/vmware-logo.svg></a></div></div></footer></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=../../../js/main.min.906bd02f142be20eb94bb49539a18a3e93ec0b9ff5f5dcf3796eed436a6103d2.js integrity="sha256-kGvQLxQr4g65S7SVOaGKPpPsC5/19dzzeW7tQ2phA9I=" crossorigin=anonymous></script><script src=../../../js/animated.js></script></body></html>